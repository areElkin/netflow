

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>netflow.keepers.keeper &#8212; netflow v0.0.dev Manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/netflow/keepers/keeper';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.0.dev" />
    <meta name="docbuild:last-update" content="Jul 24, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/NF_logo3.png" class="logo__image only-light" alt="netflow v0.0.dev Manual - Home"/>
    <img src="../../../_static/NF_logo3.png" class="logo__image only-dark pst-js-only" alt="netflow v0.0.dev Manual - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../building/index.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../overview/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorial/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../references.html">
    References
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../building/index.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../overview/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorial/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../references.html">
    References
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item"><nav class="sidebar-indices-items" aria-labelledby="pst-indices-navigation-heading-2">
  <p id="pst-indices-navigation-heading-2" class="sidebar-indices-items__title" role="heading" aria-level="1">Indices</p>
  <ul class="indices-link">
        <li class="toctree-l1">
          <a class="reference internal"
             href="../../../genindex.html"
             accesskey="I">General Index</a>
        </li>
        <li class="toctree-l1">
          <a class="reference internal" href="../../../py-modindex.html">Python Module Index</a>
        </li>
  </ul>
</nav></div>
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">netflow.keepers.keeper</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for netflow.keepers.keeper</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">keeper</span>
<span class="sd">======</span>

<span class="sd">Classes used for data storage and manipulation. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn.decomposition</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">checks</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.._utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">_docstring_parameter</span><span class="p">,</span> <span class="n">_desc_distance</span><span class="p">,</span> \
    <span class="n">_desc_data_distance</span><span class="p">,</span> <span class="n">load_from_file</span><span class="p">,</span> <span class="n">fuse_labels</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">unstack_triu_</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..methods.classes</span><span class="w"> </span><span class="kn">import</span> <span class="n">InfoNet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..pose</span><span class="w"> </span><span class="kn">import</span> <span class="n">similarity</span> <span class="k">as</span> <span class="n">nfs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..pose</span><span class="w"> </span><span class="kn">import</span> <span class="n">organization</span> <span class="k">as</span> <span class="n">nfo</span>
<span class="c1"># from ..pose.organization import compute_transitions, dpt_from_augmented_sym_transitions, POSER, compute_rw_transitions, </span>
<span class="c1"># import netflow.InfoNet as InfoNet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.._logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">_gen_logger</span><span class="p">,</span> <span class="n">set_verbose</span>

<span class="c1"># from importlib import reload</span>
<span class="c1"># reload(nfo)</span>
<span class="c1"># nfo = reload(nfo)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">_gen_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="DataKeeper"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">DataKeeper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A class to store and handle multiple data sets.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : {`numpy.ndarray`, `pandas.DataFrame`, `dict` [`str`, `numpy.ndarray`], `dict` [`str`, `pandas.DataFrame`]}</span>
<span class="sd">        One or multiple feature data sets, where each data set is size (num_features, num_observations).</span>

<span class="sd">        Feature data set(s) may be provided in multiple ways:</span>

<span class="sd">        - `numpy.ndarray` : A single feature data set.</span>

<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">          * To include feature labels, ``data`` should be a `pandas.DataFrame`.</span>
<span class="sd">          * The array ``data`` is placed in a `dict` with default label of the form</span>
<span class="sd">            ``{&#39;data&#39; : data}``. </span>
<span class="sd">        - `pandas.DataFrame` : A single feature data set.</span>
<span class="sd">    </span>
<span class="sd">          * The index indicates feature labels.</span>
<span class="sd">          * Columns indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the columns of the dataframe,</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">          * The array ``data.values`` is placed in a `dict` with default label of the form</span>
<span class="sd">            ``{&#39;data&#39; : data.values}``. </span>
<span class="sd">        - `dict` [`str`, `numpy.ndarray`] : A single or mutliple feature data set(s) may be provided as </span>
<span class="sd">           the value(s) of a `dict` keyed by a `str` that serves as the feature data descriptor or label </span>
<span class="sd">           for each input of the form ``{&#39;data_label&#39; : `numpy.ndarray`}``.</span>

<span class="sd">          * All arrays are expected to have the same number of columns corresponding to the number</span>
<span class="sd">            of observations with the same ordering.</span>
<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">          * To include feature labels, pass a `dict` of `pandas.DataFrame`\s instaed.</span>
<span class="sd">        - `dict` [`str`, `pandas.DataFrame`] : A single or mutliple feature data set(s) may be provided as </span>
<span class="sd">           the value(s) of a `dict` keyed by a `str` that serves as the feature data descriptor or label </span>
<span class="sd">           for each input of the form ``{&#39;data_label&#39; : `pandas.DataFrame`}``.</span>

<span class="sd">          * All dataframes are expected to have the same number of columns corresponding to the number</span>
<span class="sd">            of observations with the same columns provided in the same order.</span>
<span class="sd">          * The index of each input indicates feature labels.</span>
<span class="sd">          * Columns indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the columns of the dataframe(s),</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">    observation_labels : `list` [`str`], optional</span>
<span class="sd">        List of labels for each observation with length equal to num_observations.</span>
<span class="sd">        If provided when ``data`` is a `pandas.DataFrame` or `dict` [`str`, `pandas.DataFrame`],</span>
<span class="sd">        it should match the columns of the dataframe(s), which will be ordered according to</span>
<span class="sd">        ``observation_labels``.</span>
<span class="sd">    </span>
<span class="sd">        If not provided and ``data`` is a :</span>

<span class="sd">        - `pandas.DataFrame` or `dict` [`str`, `pandas.DataFrame`],</span>
<span class="sd">          then the columns of the (first) dataframe are used.</span>
<span class="sd">        - `numpy.ndarray` or `dict` [`str`, `numpy.ndarray`],</span>
<span class="sd">          then the columns are labeled by their row index from :math:`0, 1, ..., num\_observations - 1`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    All data sets are assumed to contain the same set of data points in the same order.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DataKeeper.__init__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observation_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">observation_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observation labels must be unique&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="n">observation_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">observation_labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_features_labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">cur_data</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">cur_data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized type for data, must be one of [pandas.DataFrame, numpy.ndarray, dict].&quot;</span><span class="p">)</span>            </div>


<div class="viewcode-block" id="DataKeeper.__getitem__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.__getitem__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1"># return self._data[key]</span>
        <span class="k">return</span> <span class="n">DataView</span><span class="p">(</span><span class="n">dkeeper</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataKeeper.__contains__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.__contains__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>


<div class="viewcode-block" id="DataKeeper.__iter__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.__iter__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">DataView</span><span class="p">(</span><span class="n">dkeeper</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataKeeper.keys"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.keys">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>


<div class="viewcode-block" id="DataKeeper.items"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.items">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>
        


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; A dictionary of all data sets. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">observation_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Labels for each observation. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span>


<div class="viewcode-block" id="DataKeeper.observation_index"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.observation_index">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation_label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return index of observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observation_label : `str`</span>
<span class="sd">            The observation label.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        observation_index : `int`</span>
<span class="sd">            Index of observation in list of observation labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">observation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">observation_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observation_index</span></div>


    <span class="c1"># @observation_labels.setter</span>
    <span class="c1"># def observation_labels(self, labels):</span>
    <span class="c1">#     if self._observation_labels is not None:</span>
    <span class="c1">#         raise ValueError(&quot;Observation labels cannot be changed.&quot;)</span>

    <span class="c1">#     if (self._num_observations is not None) and (self._num_observations != len(labels)):</span>
    <span class="c1">#         raise ValueError(&quot;Inconsisstent size, number of labels must match the number of observations.&quot;)</span>
            
    <span class="c1">#     self._observation_labels = labels.copy()</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of observations. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">features_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; A dictionary of feature labels for each data set. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features_labels</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; A dictionary with the number of features in each data set. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> 


<div class="viewcode-block" id="DataKeeper.add_data"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.add_data">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a feature data set to the keeper.</span>

<span class="sd">        .. Note::</span>

<span class="sd">           Observation labels may be set after object initialization.</span>
<span class="sd">           This may require upkeep in :class:`Keeper` to update and coordinate</span>
<span class="sd">           observation labels among the different keepers.</span>
<span class="sd">            </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : {`numpy.ndarray`, `pandas.DataFrame`}</span>
<span class="sd">            The data set of size (num_features, num_observations).</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the data set.        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that label is not already in the keeper</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dubplicate label detected, </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> already exists in the keeper.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check that data is numpy ndarray or pandas DataFrame:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized type, data must be numpy ndarray or pandas DataFrame.&quot;</span><span class="p">)</span>
        
        <span class="c1"># If no data in keeper yet, initialize:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inconsistent data size, must be the same as num_observations.&quot;</span><span class="p">)</span>
            
            <span class="c1"># if isinstance(data, pd.DataFrame):</span>
        <span class="c1">#         self._observation_labels = data.columns.tolist()  # overrides pre-specified observation_labels</span>
        <span class="c1">#     else:  # np.ndarray</span>
        <span class="c1">#         self._observation_labels = self._observation_labels if self._observation_labels is not None \</span>
        <span class="c1">#             else list(range(self._num_observations))</span>
            
        <span class="c1"># else:  # Check that the data has the right number of columns        </span>
        <span class="c1">#     if data.shape[1] != self._num_observations:</span>
        <span class="c1">#         raise ValueError(&quot;Inconsistent data size, must be the same as num_observations&quot;)</span>

        <span class="c1"># Check that the data has the right number of columns        </span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inconsistent data size, must be the same as num_observations&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="o">!=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observation labels must be unique&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Set observation labels.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="o">!=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;feature labels must be unique&quot;</span><span class="p">)</span>
            <span class="n">feature_labels</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># np.ndarray</span>
            <span class="n">feature_labels</span> <span class="o">=</span> <span class="kc">None</span>        
        
        <span class="c1"># checks.check_matrix_no_nan(data)</span>
        <span class="c1"># checks.check_matrix_nonnegative(data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_features_labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> features added to keeper.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataKeeper.subset"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.subset">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return a new instance of DataKeeper restricted to subset of observations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observations : `list`, </span>
<span class="sd">            List of observations to include in the subset.</span>
<span class="sd">            This is treated differently depending on the type of observation labels :</span>

<span class="sd">            - If ``self._observation_labels`` is `List` [`str`], ``observations`` can be of the form:</span>
<span class="sd">        </span>
<span class="sd">              * `List` [`str`], to reference observations by their `str` label or;</span>
<span class="sd">              * `List` [`int`], to reference observations by their location index.</span>

<span class="sd">            - If ``self._observation_labels`` is `None` or `List` [`int`], ``observations`` must </span>
<span class="sd">              be of the form `List` [`int`], to reference observations by their location index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_subset : `DataKeeper`</span>
<span class="sd">            A DataKeeper object restricted to the selected observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_subset</span> <span class="o">=</span> <span class="n">DataKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observation_labels</span><span class="o">=</span><span class="n">observations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">data_subset</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">observations</span><span class="o">=</span><span class="n">observations</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data_subset</span></div>


<div class="viewcode-block" id="DataKeeper.standardize"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataKeeper.standardize">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Standardize features by removing the mean and scaling to unit variance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : `str`</span>
<span class="sd">            The reference key of the data in the data-keeper that will be</span>
<span class="sd">            standardized.</span>
<span class="sd">        kwargs </span>
<span class="sd">          Keyword arguments passed to `sklearn.preprocessing.StandardScalar`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_z : `pandas.DataFrame`</span>
<span class="sd">            The standardized data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">standardize</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data_z</span></div></div>
            

<div class="viewcode-block" id="DataView"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataView">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">DataView</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A class to extract single data view from DataKeeper for analysis.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dkeeper : `DataKeeper`</span>
<span class="sd">        The object to extract data from.        </span>
<span class="sd">    label : `str`</span>
<span class="sd">        The identifier of the data to be extracted from ``dkeeper``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DataView.__init__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataView.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dkeeper</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="c1"># data=None, observation_labels=None, feature_labels=None,</span>
                 <span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> in dkeeper.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">observation_labels</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">num_observations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_feature_labels</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">features_labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">num_features</span><span class="p">[</span><span class="n">label</span><span class="p">]</span></div>
        

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The data label. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The data set. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">observation_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Labels for each observation. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of observations. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">feature_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Feature labels. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_labels</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The number of features in the data set. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_features</span> 



<div class="viewcode-block" id="DataView.subset"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataView.subset">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return data for specified subset of observations and/or features.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observations : `list`, </span>
<span class="sd">            List of observations to include in the subset.</span>
<span class="sd">            This is treated differently depending on the type of observation labels :</span>

<span class="sd">            - If ``self._observation_labels`` is `List` [`str`], ``observations`` can be of the form:</span>
<span class="sd">        </span>
<span class="sd">              * `List` [`str`], to reference observations by their `str` label or;</span>
<span class="sd">              * `List` [`int`], to reference observations by their location index.</span>

<span class="sd">            - If ``self._observation_labels`` is `None` or `List` [`int`], ``observations`` must </span>
<span class="sd">              be of the form `List` [`int`], to reference observations by their location index.</span>
<span class="sd">        features : `list`</span>
<span class="sd">            List of features to include in the subset.</span>
<span class="sd">            The list type depends on the type of ``self._feature_labels``, analogous to</span>
<span class="sd">            ``self._observation_labels`` for ``observations`` above.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : `pandas.DataFrame`, (``len(observations)``, ``len(features)``)</span>
<span class="sd">            The data subset where the :math:`ij^{th}` entry is the value of the</span>
<span class="sd">            :math:`i^{th}` feature in ``features`` for the  :math:`j^{th}`</span>
<span class="sd">            observation in ``observations``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either observations or features must be provided.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="k">if</span> <span class="n">observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span>            
        <span class="c1"># if observations is not None:</span>
        <span class="c1">#     if isinstance(observations[0], str):  # convert to location index</span>
        <span class="c1">#         observations = [self._observation_labels.index(k) for k in observations]</span>
        <span class="c1"># data = data[:, observations]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># convert to location index</span>
            <span class="n">observations_ix</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">observations</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">observations_ix</span> <span class="o">=</span> <span class="n">observations</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">observations_ix</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_labels</span>
        <span class="c1"># if features is not None:</span>
        <span class="c1">#     if isinstance(features[0], str):  # convert to location index</span>
        <span class="c1">#         features = [self._feature_labels.index(k) for k in features]</span>
        <span class="c1">#     data = data[features, :]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># convert to location index</span>
            <span class="n">features_ix</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_feature_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">features_ix</span> <span class="o">=</span> <span class="n">features</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">features_ix</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">observations</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataView.observation_index"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataView.observation_index">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation_label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return index of observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observation_label : `str`</span>
<span class="sd">            The observation label.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        observation_index : `int`</span>
<span class="sd">            Index of observation in list of observation labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">observation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">observation_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observation_index</span></div>


<div class="viewcode-block" id="DataView.feature_index"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataView.feature_index">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">feature_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return index of feature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        feature_label : `str`</span>
<span class="sd">            The feature label.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        feature_index : `int`</span>
<span class="sd">            Index of feature in list of feature labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">feature_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">feature_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_index</span></div>


<div class="viewcode-block" id="DataView.to_frame"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataView.to_frame">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return data as a pandas DataFrame &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                          <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">,</span>
                          <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_labels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="DataView.standardize"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DataView.standardize">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Standardize features by removing the mean and scaling to unit variance</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kwargs </span>
<span class="sd">          Keyword arguments passed to `sklearn.preprocessing.StandardScalar`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_z : `pandas.DataFrame`</span>
<span class="sd">            The standardized data.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="c1"># data_z = (data - data.mean(axis=1)[:, np.newaxis]) / data.std(axis=1)[:, np.newaxis]</span>
        <span class="n">data_z</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">data_z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_z</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data_z</span></div></div>
        
    

        
<div class="viewcode-block" id="DistanceKeeper"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">DistanceKeeper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A class to store and handle multiple distances.</span>

<span class="sd">    This class may also be used to store and handle similarity matrices.</span>
<span class="sd">    Distance may be interchanged with similarity, but distance is used for simplicity.</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : {`numpy.ndarray`, `pandas.DataFrame`, `dict` [`str`, `numpy.ndarray`], `dict` [`str`, `pandas.DataFrame`]}</span>
<span class="sd">        One or multiple symmetric distance(s) between observations, where each distance matrix is size</span>
<span class="sd">        (num_observations, num_observations).</span>

<span class="sd">        Distance(s) may be provided in multiple ways:</span>

<span class="sd">        - `numpy.ndarray` : A single distance matrix.</span>

<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">          * To include feature labels, ``data`` should be a `pandas.DataFrame`.</span>
<span class="sd">          * The array ``data`` is placed in a `dict` with default label of the form ``{&#39;distance&#39; : data}``. </span>
<span class="sd">        - `pandas.DataFrame` : A single distance matrix.</span>
<span class="sd">    </span>
<span class="sd">          * The index should be the same as the columns, which indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the rows and columns of the dataframe,</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">          * The array ``data.values`` is placed in a `dict` with default label of the form</span>
<span class="sd">            ``{&#39;distance&#39; : data.values}``. </span>
<span class="sd">        - `dict` [`str`, `numpy.ndarray`] : A single or mutliple distance(s) may be provided as the value(s) </span>
<span class="sd">           of a `dict` keyed by a `str` that serves as the distance descriptor or label for each</span>
<span class="sd">           input of the form ``{&#39;distance_label&#39; : `numpy.ndarray`}``.</span>

<span class="sd">          * All arrays are expected to have the same number of columns and rows corresponding to the number</span>
<span class="sd">            of observations with the same ordering.</span>
<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">        - `dict` [`str`, `pandas.DataFrame`] : A single or mutliple distance(s) may be provided as the value(s) </span>
<span class="sd">           of a `dict` keyed by a `str` that serves as the distance descriptor or label for each</span>
<span class="sd">           input of the form ``{&#39;distance_label&#39; : `pandas.DataFrame`}``.</span>

<span class="sd">          * All dataframes are expected to have the same number of rows and columns corresponding </span>
<span class="sd">            to the number of observations with the same columns provided in the same order.</span>
<span class="sd">          * The index and columns indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the columns of the dataframe(s),</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">    observation_labels : `list` [`str`]</span>
<span class="sd">        List of labels for each observation with length equal to num_observations.</span>
<span class="sd">        If provided when ``data`` is a `pandas.DataFrame` or `dict` [`str`, `pandas.DataFrame`],</span>
<span class="sd">        it should match the columns of the dataframe(s), which will be ordered according to</span>
<span class="sd">        ``observation_labels``.</span>
<span class="sd">    </span>
<span class="sd">        If not provided and ``data`` is a :</span>

<span class="sd">        - `pandas.DataFrame` or `dict` [`str`, `pandas.DataFrame`],</span>
<span class="sd">          then the columns of the (first) dataframe are used.</span>
<span class="sd">        - `numpy.ndarray` or `dict` [`str`, `numpy.ndarray`],</span>
<span class="sd">          then the columns are labeled by their row index from :math:`0, 1, ..., num_observations - 1`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    All sets are assumed to contain the same set of data points in the same order.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DistanceKeeper.__init__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observation_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">observation_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observation labels must be unique&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="n">observation_labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">observation_labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">cur_distance</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">cur_distance</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized type for data, must be one of [pandas.DataFrame, numpy.ndarray, dict].&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DistanceKeeper.__getitem__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.__getitem__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1"># return self._data[key]</span>
        <span class="k">return</span> <span class="n">DistanceView</span><span class="p">(</span><span class="n">dkeeper</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="DistanceKeeper.__contains__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.__contains__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>


<div class="viewcode-block" id="DistanceKeeper.__iter__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.__iter__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">DistanceView</span><span class="p">(</span><span class="n">dkeeper</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></div>


<div class="viewcode-block" id="DistanceKeeper.keys"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.keys">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>


<div class="viewcode-block" id="DistanceKeeper.items"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.items">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;\ A dictionary of all distances. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">observation_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Labels for each observation. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of observations. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>


<div class="viewcode-block" id="DistanceKeeper.add_data"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.add_data">[docs]</a>    <span class="nd">@_docstring_parameter</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="n">_desc_distance</span><span class="p">,</span> <span class="n">desc_data</span><span class="o">=</span><span class="n">_desc_data_distance</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">        {desc}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        {desc_data}</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that label is not already in the keeper</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dubplicate label detected, </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> already exists in the keeper.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check that distance is numpy ndarray or pandas DataFrame:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized type, data must be numpy ndarray or pandas DataFrame&quot;</span><span class="p">)</span>
        
        <span class="c1"># If no distance in keeper yet, initialize:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inconsistent data size, must be the same as num_observations.&quot;</span><span class="p">)</span>
            
        <span class="c1"># Check that the distance has the right number of rows and columns        </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inconsistent distance matrix size, should be (num_observations, num_observations).&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="o">!=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observation labels must be unique&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Set observation labels.&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>


        <span class="n">checks</span><span class="o">.</span><span class="n">check_matrix_no_nan</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">checks</span><span class="o">.</span><span class="n">check_distance_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> between </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations added to keeper.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DistanceKeeper.add_stacked_data"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.add_stacked_data">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_stacked_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">diag</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a symmetric distance from stacked Series to the keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : `pandas.Series`</span>
<span class="sd">            The stacked distances of size (num_observations * (num_observations - 1) / 2,)</span>
<span class="sd">            with a 2-multi-index of the pairwise observation labels.</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the input.</span>
<span class="sd">        diag : `float`</span>
<span class="sd">            Value used on diagonal. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that label is not already in the keeper</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dubplicate label detected, </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> already exists in the keeper.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">unstack_triu_</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">diag</span><span class="o">=</span><span class="n">diag</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="DistanceKeeper.observation_index"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.observation_index">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation_label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return index of observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observation_label : `str`</span>
<span class="sd">            The observation label.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        observation_index : `int`</span>
<span class="sd">            Index of observation in list of observation labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">observation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">observation_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observation_index</span></div>


<div class="viewcode-block" id="DistanceKeeper.subset"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceKeeper.subset">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return a new instance of DistanceKeeper restricted to subset of observations</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observations : `list`, </span>
<span class="sd">            List of observations to include in the subset.</span>
<span class="sd">            This is treated differently depending on the type of observation labels :</span>

<span class="sd">            - If ``self._observation_labels`` is `List` [`str`], ``observations`` can be of the form:</span>
<span class="sd">        </span>
<span class="sd">              * `List` [`str`], to reference observations by their `str` label or;</span>
<span class="sd">              * `List` [`int`], to reference observations by their location index.</span>

<span class="sd">            - If ``self._observation_labels`` is `None` or `List` [`int`], ``observations`` must </span>
<span class="sd">              be of the form `List` [`int`], to reference observations by their location index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        distance_subset : `DistanceKeeper`</span>
<span class="sd">            A DistnaceKeeper object restricted to the selected observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">distance_subset</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observation_labels</span><span class="o">=</span><span class="n">observations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">distance_subset</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">observations_a</span><span class="o">=</span><span class="n">observations</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">distance_subset</span></div></div>



<div class="viewcode-block" id="DistanceView"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceView">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">DistanceView</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A class to extract single distance matrix view from DistanceKeeper for analysis.</span>

<span class="sd">    This class may also be used to extract a similarity matrix.</span>
<span class="sd">    Distance may be interchanged with similarity, but distance is used for simplicity.    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dkeeper : `DistanceKeeper`</span>
<span class="sd">        The object to extract the distance from.</span>
<span class="sd">    label : `str`</span>
<span class="sd">        The identifier of the distance matrix to be extracted from ``dkeeper``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DistanceView.__init__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceView.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dkeeper</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> in dkeeper.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">observation_labels</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="n">dkeeper</span><span class="o">.</span><span class="n">num_observations</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The distance label. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The distance matrix. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">observation_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Labels for each observation. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of observations. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>


<div class="viewcode-block" id="DistanceView.subset"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceView.subset">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations_a</span><span class="p">,</span> <span class="n">observations_b</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return subset of distances between ``observations_a`` and ``observations_b``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observations_a : `list`</span>
<span class="sd">            Subset of observations to extract distances from, that make up the rows of</span>
<span class="sd">            the returned sub-distance matrix.</span>
<span class="sd">            This is treated differently depending on the type of observation labels :</span>

<span class="sd">            - If ``self._observation_labels`` is `List` [`str`], ``observations_a`` can</span>
<span class="sd">              be of the form:</span>
<span class="sd">        </span>
<span class="sd">              * `List` [`str`], to reference observations by their `str` label or;</span>
<span class="sd">              * `List` [`int`], to reference observations by their location index.</span>

<span class="sd">            - If ``self._observation_labels`` is `None` or `List` [`int`], ``observations``</span>
<span class="sd">              must be of the form `List` [`int`], to reference observations by their</span>
<span class="sd">              location index.</span>
<span class="sd">        observations_b : {`None`, `list`}, optional</span>
<span class="sd">            Subset of observations to extract distances computed from ``observations_a``.</span>
<span class="sd">            The list type depends on the type of ``self._feature_labels``, analogous to</span>
<span class="sd">            ``self._observation_labels`` for ``observations_a`` above.</span>
<span class="sd">            If `None`, ``observations_a`` is used to create symmetric matrix.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        distance : `pandas.DataFrame`, (``len(observations_a)``, ``len(observations_b)``)</span>
<span class="sd">            The sub-matrix of distances where the :math:`ij^{th}` entry is the distance</span>
<span class="sd">            between the :math:`i^{th}` observation in ``observations_a`` and the</span>
<span class="sd">            :math:`j^{th}` observation in ``observations_b``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observations_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># convert to location index</span>
            <span class="n">observations_a_ix</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">observations_a</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">observations_a_ix</span> <span class="o">=</span> <span class="n">observations_a</span>

        <span class="k">if</span> <span class="n">observations_b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">observations_b</span> <span class="o">=</span> <span class="n">observations_a</span>
            <span class="n">observations_b_ix</span> <span class="o">=</span> <span class="n">observations_a_ix</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observations_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># convert to location index</span>
            <span class="n">observations_b_ix</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">observations_b</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">observations_b_ix</span> <span class="o">=</span> <span class="n">observations_b</span>

        <span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">observations_a_ix</span><span class="p">,</span> <span class="n">observations_b_ix</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">observations_a</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">observations_b</span><span class="p">)</span></div>


<div class="viewcode-block" id="DistanceView.observation_index"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceView.observation_index">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation_label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return index of observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observation_label : `str`</span>
<span class="sd">            The observation label.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        observation_index : `int`</span>
<span class="sd">            Index of observation in list of observation labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">observation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">observation_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observation_index</span></div>


<div class="viewcode-block" id="DistanceView.to_frame"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceView.to_frame">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return data as a pandas DataFrame &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                          <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">,</span>
                          <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="DistanceView.density"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.DistanceView.density">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return density of each observation</span>

<span class="sd">        The density of an observation is its net distance to all other</span>
<span class="sd">        observations. This should be minimized for distances and maximized</span>
<span class="sd">        for similarities.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        d : `pandas.Series`</span>
<span class="sd">            The densities indexed by the observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div></div>
            
            
        
        

<div class="viewcode-block" id="GraphKeeper"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">GraphKeeper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A class to store and handle multiple netowrks.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    graphs : {`networkx.Graph`, `dict` [`str&#39;, `networkx.Graph`]}</span>
<span class="sd">        One or multiple networks.</span>

<span class="sd">        The network(s) may be provided in multiple ways:</span>

<span class="sd">        - `networkx.Graph` : A single network.</span>
<span class="sd">          </span>
<span class="sd">          * The network is placed in a `dict` with default label of the form</span>
<span class="sd">            ``{&#39;graph&#39; : graphs}``.</span>
<span class="sd">          * To use a customized label for the network, provide the network</span>
<span class="sd">            as a `dict`, shown next.</span>
<span class="sd">        - `dict` [`str`, `networkx.Graph`] : A single or multiple networks may</span>
<span class="sd">          be provided as the value(s) of a `dict` keyed by a `str` that serves as</span>
<span class="sd">          the netwwork descriptor or label for each input of the form</span>
<span class="sd">          ``{&#39;graph_label&#39; : `networkx.Graph`}``.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The graph label is also set to the graph&#39;s name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GraphKeeper.__init__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graphs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graphs</span><span class="p">,</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_graph</span><span class="p">(</span><span class="n">graphs</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graphs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">cur_graph</span> <span class="ow">in</span> <span class="n">graphs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_graph</span><span class="p">(</span><span class="n">cur_graph</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">graphs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized type for graphs, must be one of [networkx.Graph or dict].&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="GraphKeeper.__getitem__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper.__getitem__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<div class="viewcode-block" id="GraphKeeper.__contains__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper.__contains__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span></div>


<div class="viewcode-block" id="GraphKeeper.__iter__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper.__iter__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">graph</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">graph</span></div>

            
<div class="viewcode-block" id="GraphKeeper.keys"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper.keys">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>


<div class="viewcode-block" id="GraphKeeper.items"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper.items">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; A dictionary of all the graphs. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span>


<div class="viewcode-block" id="GraphKeeper.add_graph"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.GraphKeeper.add_graph">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a network to the keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph : `networkx.Graph`</span>
<span class="sd">            The network.</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that the label is not already in the keeper</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dupblicate label detected, </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> already exists in the keeper.&quot;</span><span class="p">)</span>

        <span class="c1"># Check that the graph is a networkx.Graph instance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized type, graph must be networkx Graph.&quot;</span><span class="p">)</span>

        <span class="n">graph</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">label</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">graph</span></div></div>

    
<div class="viewcode-block" id="Keeper"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">Keeper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A class to store and handle data, distances and similarities between data points</span>
<span class="sd">    (or observations), and miscellaneous related results.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : {`numpy.ndarray`, `pandas.DataFrame`, `dict` [`str`, `numpy.ndarray`], `dict` [`str`, `pandas.DataFrame`]}</span>
<span class="sd">        One or multiple feature data sets, where each data set is size (num_features, num_observations).</span>

<span class="sd">        Feature data set(s) may be provided in multiple ways:</span>

<span class="sd">        - `numpy.ndarray` : A single feature data set.</span>

<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">          * To include feature labels, ``data`` should be a `pandas.DataFrame`.</span>
<span class="sd">          * The array ``data`` is placed in a `dict` with default label of the form ``{&#39;data&#39; : data}``. </span>
<span class="sd">        - `pandas.DataFrame` : A single feature data set.</span>
<span class="sd">    </span>
<span class="sd">          * The index indicates feature labels.</span>
<span class="sd">          * Columns indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the columns of the dataframe,</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">          * The array ``data.values`` is placed in a `dict` with default label of the form ``{&#39;data&#39; : data.values}``. </span>
<span class="sd">        - `dict` [`str`, `numpy.ndarray`] : A single or mutliple feature data set(s) may be provided as the value(s) </span>
<span class="sd">           of a `dict` keyed by a `str` that serves as the feature data descriptor or label for each</span>
<span class="sd">           input of the form ``{&#39;data_label&#39; : `numpy.ndarray`}``.</span>

<span class="sd">          * All arrays are expected to have the same number of columns corresponding to the number</span>
<span class="sd">            of observations with the same ordering.</span>
<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">          * To include feature labels, pass a `dict` of `pandas.DataFrame`\s instaed.</span>
<span class="sd">        - `dict` [`str`, `pandas.DataFrame`] : A single or mutliple feature data set(s) may be provided as the value(s) </span>
<span class="sd">           of a `dict` keyed by a `str` that serves as the feature data descriptor or label for each</span>
<span class="sd">           input of the form ``{&#39;data_label&#39; : `pandas.DataFrame`}``.</span>

<span class="sd">          * All dataframes are expected to have the same number of columns corresponding to the number</span>
<span class="sd">            of observations with the same columns provided in the same order.</span>
<span class="sd">          * The index of each input indicates feature labels.</span>
<span class="sd">          * Columns indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the columns of the dataframe(s),</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">    distances : {`numpy.ndarray`, `pandas.DataFrame`, `dict` [`str`, `numpy.ndarray`], `dict` [`str`, `pandas.DataFrame`]}</span>
<span class="sd">        One or multiple symmetric distance(s) between observations, where each distance matrix is size</span>
<span class="sd">        (num_observations, num_observations).</span>

<span class="sd">        Distance(s) may be provided in multiple ways:</span>

<span class="sd">        - `numpy.ndarray` : A single distance matrix.</span>

<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">          * To include feature labels, ``distances`` should be a `pandas.DataFrame`.</span>
<span class="sd">          * The array ``distances`` is placed in a `dict` with default label of the form</span>
<span class="sd">            ``{&#39;distance&#39; : distances}``. </span>
<span class="sd">        - `pandas.DataFrame` : A single distance matrix.</span>
<span class="sd">    </span>
<span class="sd">          * The index should be the same as the columns, which indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the rows and columns of the dataframe,</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">          * The array ``distances.values`` is placed in a `dict` with default label of the form</span>
<span class="sd">            ``{&#39;distance&#39; : distances.values}``. </span>
<span class="sd">        - `dict` [`str`, `numpy.ndarray`] : A single or mutliple distance(s) may be provided as the value(s) </span>
<span class="sd">           of a `dict` keyed by a `str` that serves as the distance descriptor or label for each</span>
<span class="sd">           input of the form ``{&#39;distance_label&#39; : `numpy.ndarray`}``.</span>

<span class="sd">          * All arrays are expected to have the same number of columns and rows corresponding to the number</span>
<span class="sd">            of observations with the same ordering.</span>
<span class="sd">          * Observation labels may be specified in ``observation_labels``.</span>
<span class="sd">        - `dict` [`str`, `pandas.DataFrame`] : A single or mutliple distance(s) may be provided as the value(s) </span>
<span class="sd">           of a `dict` keyed by a `str` that serves as the distance descriptor or label for each</span>
<span class="sd">           input of the form ``{&#39;distance_label&#39; : `pandas.DataFrame`}``.</span>

<span class="sd">          * All dataframes are expected to have the same number of rows and columns corresponding </span>
<span class="sd">            to the number of observations with the same columns provided in the same order.</span>
<span class="sd">          * The index and columns indicate observation labels.</span>
<span class="sd">          * If ``observation_labels`` is provided, it should match the columns of the dataframe(s),</span>
<span class="sd">            that will be ordered according to the ``observation_labels``.</span>
<span class="sd">    similarities : {`numpy.ndarray`, `pandas.DataFrame`, `dict` [`str`, `numpy.ndarray`], `dict` [`str`, `pandas.DataFrame`]}</span>
<span class="sd">        One or multiple symmetric similarit(y/ies) between observations, where each similarity</span>
<span class="sd">        matrix is size (num_observations, num_observations).</span>
<span class="sd">        Similarit(y/ies) may be provided in multiple ways, analogous to ``distances``.</span>
<span class="sd">    graphs : : {`networkx.Graph`, `dict` [`str&#39;, `networkx.Graph`]}</span>
<span class="sd">        One or multiple networks.</span>

<span class="sd">        The network(s) may be provided in multiple ways:</span>

<span class="sd">        - `networkx.Graph` : A single network.</span>
<span class="sd">          </span>
<span class="sd">          * The network is placed in a `dict` with default label of the form</span>
<span class="sd">            ``{&#39;graph&#39; : graphs}``.</span>
<span class="sd">          * To use a customized label for the network, provide the network</span>
<span class="sd">            as a `dict`, shown next.</span>
<span class="sd">        - `dict` [`str`, `networkx.Graph`] : A single or multiple networks may</span>
<span class="sd">          be provided as the value(s) of a `dict` keyed by a `str` that serves as</span>
<span class="sd">          the netwwork descriptor or label for each input of the form</span>
<span class="sd">          ``{&#39;graph_label&#39; : `networkx.Graph`}``.</span>
<span class="sd">    misc : `dict`</span>
<span class="sd">        Miscellaneous data or results.</span>
<span class="sd">    observation_labels : `list` [`str`], optional</span>
<span class="sd">        List of labels for each observation with length equal to num_observations.</span>

<span class="sd">        Labels will be set depending on the input format accordingly :</span>
<span class="sd">    </span>
<span class="sd">        - If ``observation_labels`` is provided and ``data``, ``distances``, or ``similarities``  is a :</span>

<span class="sd">          * `pandas.DataFrame` or `dict` [`str`, `pandas.DataFrame`], then ``observation_labels`` should </span>
<span class="sd">            match the columns of the dataframe(s), which will be ordered according to ``observation_labels``.</span>
<span class="sd">          * `numpy.ndarray` or `dict` [`str`, `numpy.ndarray`], then the array(s) is (are) assumed to be</span>
<span class="sd">            ordered according to ``observation_labels``.</span>
<span class="sd">    </span>
<span class="sd">        - If ``observation_labels`` is not provided and ``data``, ``distances``, or ``similarities``  is a :</span>

<span class="sd">          * `pandas.DataFrame` or `dict` [`str`, `pandas.DataFrame`], then all dataframes are expected to</span>
<span class="sd">            have the same column names, which is used as the ``observation_labels``.</span>
<span class="sd">          * `numpy.ndarray` or `dict` [`str`, `numpy.ndarray`], then the array(s) is (are) assumed to have</span>
<span class="sd">            columns corresponding to the observations in the same order. Default values are used for</span>
<span class="sd">            ``observation_labels`` of the form &#39;X0&#39;, &#39;X1&#39;, ... and so on.</span>
<span class="sd">    outdir : {`None`, `str` `pathlib.Path`}</span>
<span class="sd">        Global path where any results will be saved. If `None`, no results will be saved.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    All data sets, distances and similarities are assumed to contain the same set of data points in the same order.</span>

<span class="sd">    Subsets of a data set, distance or similarity should be stored in ``Keeper.misc`` as a `pandas.DataFrame`</span>
<span class="sd">    to keep track of the subset of observations (and features).</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="Keeper.__init__"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">similarities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">graphs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">misc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">observation_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">set_verbose</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># if (data is None) and (distances is None) and (similarities is None):</span>
        <span class="c1">#     raise ValueError(&quot;At least one of data, distances, or similarities must be provided.&quot;)</span>
        
        <span class="c1"># check if observation labels given in data, distances or similarities:</span>
        <span class="k">if</span> <span class="n">observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">num_observations</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">DataKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">observation_labels</span><span class="o">=</span><span class="n">observation_labels</span><span class="p">)</span>
            <span class="n">observation_labels</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">observation_labels</span>
            <span class="k">if</span> <span class="n">tmp</span><span class="o">.</span><span class="n">num_observations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num_observations</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">num_observations</span>
            <span class="c1"># if observation_labels are still None, try distances:</span>
            <span class="k">if</span> <span class="n">observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">distances</span><span class="p">,</span>
                                     <span class="n">observation_labels</span><span class="o">=</span><span class="n">observation_labels</span><span class="p">)</span>
                <span class="n">observation_labels</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">observation_labels</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">num_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">num_observations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">num_observations</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">num_observations</span>
                <span class="c1"># if observation_labels are still None, try similarities:</span>
                <span class="k">if</span> <span class="n">observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">similarities</span><span class="p">,</span>
                                         <span class="n">observation_labels</span><span class="o">=</span><span class="n">observation_labels</span><span class="p">)</span>
                    <span class="n">observation_labels</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">observation_labels</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">num_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">num_observations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">num_observations</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">num_observations</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_observations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)</span>
                    
                    
        <span class="c1"># if no observation labels have been found at this point, set to default</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num_observations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_observations</span><span class="p">)]</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">observation_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num_observations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observation labels must be unique&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation_labels</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_observations</span><span class="p">,</span> \
                <span class="s2">&quot;Inconsistent number of observation labels, length of observation_labels must equal num_observations&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="n">observation_labels</span>
        <span class="c1"># self._num_observations = None if self._observation_labels is None else len(self._observation_labels)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="n">num_observations</span> <span class="c1"># len(self._observation_labels)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">distances</span><span class="p">,</span>
                                         <span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">similarities</span><span class="p">,</span>
                                            <span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span> <span class="o">=</span> <span class="n">GraphKeeper</span><span class="p">(</span><span class="n">graphs</span><span class="o">=</span><span class="n">graphs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_misc</span> <span class="o">=</span> <span class="n">misc</span> <span class="k">if</span> <span class="n">misc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">=</span> <span class="n">outdir</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="p">,</span> <span class="n">Path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created directory </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outdir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper._check_num_observations"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper._check_num_observations">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_num_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check that num_observation are consistent (or None) across keepers. &quot;&quot;&quot;</span>
        <span class="n">num_cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>
        <span class="n">num_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">num_observations</span>
        <span class="n">num_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="o">.</span><span class="n">num_observations</span>
        <span class="n">num_sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="o">.</span><span class="n">num_observations</span>

        <span class="n">record</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dl</span> <span class="ow">in</span> <span class="p">[</span><span class="n">num_cur</span><span class="p">,</span> <span class="n">num_data</span><span class="p">,</span> <span class="n">num_dist</span><span class="p">,</span> <span class="n">num_sim</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">dl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">dl2</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dl</span> <span class="o">!=</span> <span class="n">dl2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missmatched number of observation detected between keepers.&quot;</span><span class="p">)</span></div>
                

<div class="viewcode-block" id="Keeper._check_observation_labels"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper._check_observation_labels">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_observation_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check that observation_labels are consistent (or None) across keepers. &quot;&quot;&quot;</span>
        <span class="n">cur_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span>
        <span class="n">data_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">observation_labels</span>
        <span class="n">dist_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="o">.</span><span class="n">observation_labels</span>
        <span class="n">sim_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="o">.</span><span class="n">observation_labels</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dl</span> <span class="ow">in</span> <span class="p">[</span><span class="n">cur_labels</span><span class="p">,</span> <span class="n">data_labels</span><span class="p">,</span> <span class="n">dist_labels</span><span class="p">,</span> <span class="n">sim_labels</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">dl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">dl2</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dl</span> <span class="o">!=</span> <span class="n">dl2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missmatched observation labels detected between keepers.&quot;</span><span class="p">)</span></div>

                
    <span class="c1"># def _update_observation_labels(self):</span>
    <span class="c1">#     &quot;&quot;&quot; Update observation labels (and number of observations) if changed in keeper. &quot;&quot;&quot;</span>
    <span class="c1">#     # first check that num_observations and observation labels match (or are None) across sub-keepers:</span>
    <span class="c1">#     self.check_num_observations()</span>
    <span class="c1">#     self._check_observation_labels()</span>

    <span class="c1">#     record = [None]</span>
    <span class="c1">#     for dl in [self._data, self._distances, self._similarities]:</span>
    <span class="c1">#         if dl.observation_labels is not None:</span>
    <span class="c1">#             record.append(dl.observation_labels)</span>
    <span class="c1">#             # num_labels.append(dl.num_observations)</span>
    <span class="c1">#             break  # already checked that labels are eqiovalent, so no need to keep looking</span>

    <span class="c1">#     labels = record[-1]</span>
    <span class="c1">#     # num_labels = num_labels[-1]</span>

    <span class="c1">#     if self._observation_labels is not None and labels is not None:</span>
            

    <span class="c1">#     if self._observation_labels is None:</span>
    <span class="c1">#         if labels is not None:</span>
    <span class="c1">#             if self._num_observations is None:</span>
                    
    <span class="c1">#             if (self._num_observations is not None) and (len(labels) != self_num_observations):</span>
    <span class="c1">#                 raise ValueError(&quot;Number of observations in sub-keepers does not match global keeper.&quot;)</span>
    <span class="c1">#             self._observation_labels = labels.copy()</span>
    <span class="c1">#             # check that all</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         if (labels is not None) and (self._observation_labels != labels):</span>
    <span class="c1">#             raise ValueError(&quot;Inconsisstent observation labels detected between keepers.&quot;)</span>
            
            
                  
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">observation_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Labels for each observation. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span>
    

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The feature data sets. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">distances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The distances. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">similarities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The similarities. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The networks. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span>
    

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">misc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The misc data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_misc</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The number of observations. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span>
        
        <span class="c1"># num_obs = self._data.num_observations</span>
        <span class="c1"># if num_obs is not None:</span>
        <span class="c1">#     return num_obs</span>

        <span class="c1"># num_obs = self._distances.num_observations</span>
        <span class="c1"># if num_obs is not None:</span>
        <span class="c1">#     return num_obs</span>

        <span class="c1"># num_obs = self._similarities.num_observations</span>
        <span class="c1"># if num_obs is not None:</span>
        <span class="c1">#     return num_obs</span>

        <span class="c1"># return None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span>
        
        
<div class="viewcode-block" id="Keeper.add_data"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.add_data">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a feature data set to the data keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : {`numpy.ndarray`, `pandas.DataFrame`}</span>
<span class="sd">            The data set of size (num_features, num_observations).</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the data set.        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added data input </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> to the keeper.&quot;</span><span class="p">)</span>

        <span class="c1"># If not yet initialized, update keeper observation_labels and num_observations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">num_observations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">observation_labels</span>            
            <span class="c1"># if self._data[label]._observation_labels is None:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">)]</span>

            <span class="c1"># initialize distances and similarities:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span></div>


<div class="viewcode-block" id="Keeper.add_distance"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.add_distance">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a distance array to the distance keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : {`numpy.ndarray`, `pandas.DataFrame`}</span>
<span class="sd">            The distance array of size (num_observations, num_observations).</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the distance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added distance input </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> to the keeper.&quot;</span><span class="p">)</span>

        <span class="c1"># If not yet initialized, update keeper observation_labels and num_observations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">num_observations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">observation_labels</span>            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">)]</span>

            <span class="c1"># initialize data and similarities</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span></div>


<div class="viewcode-block" id="Keeper.add_stacked_distance"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.add_stacked_distance">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_stacked_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a stacked distance array to the distance keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : `pandas.Series`</span>
<span class="sd">            The stacked distances of size (num_observations * (num_observations - 1) / 2,)</span>
<span class="sd">            with a 2-multi-index of the pairwise observation labels.</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the distance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="o">.</span><span class="n">add_stacked_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added distance input </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> to the keeper.&quot;</span><span class="p">)</span>

        <span class="c1"># If not yet initialized, update keeper observation_labels and num_observations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">num_observations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">observation_labels</span>            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">)]</span>

            <span class="c1"># initialize data and similarities</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span></div>


<div class="viewcode-block" id="Keeper.add_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.add_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a similarity array to the similarity keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : {`numpy.ndarray`, `pandas.DataFrame`}</span>
<span class="sd">            The similarity array of size (num_observations, num_observations).</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the similarity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added similarity input </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> to the keeper.&quot;</span><span class="p">)</span>

        <span class="c1"># If not yet initialized, update keeper observation_labels and num_observations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">num_observations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">observation_labels</span>            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">)]</span>

            <span class="c1"># initialize data and distances</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span></div>
    
        
<div class="viewcode-block" id="Keeper.add_stacked_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.add_stacked_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_stacked_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">diag</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a stacked similarity array to the similarity keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : `pandas.Series`</span>
<span class="sd">            The stacked similarities of size (num_observations * (num_observations - 1) / 2,)</span>
<span class="sd">            with a 2-multi-index of the pairwise observation labels.</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the similarity.</span>
<span class="sd">        diag : `float`</span>
<span class="sd">            Value used on diagonal. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="o">.</span><span class="n">add_stacked_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">diag</span><span class="o">=</span><span class="n">diag</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added similarity input </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> to the keeper.&quot;</span><span class="p">)</span>

        <span class="c1"># If not yet initialized, update keeper observation_labels and num_observations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">num_observations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">observation_labels</span>            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;X</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_observations</span><span class="p">)]</span>

            <span class="c1"># initialize data and distances</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">DataKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span> <span class="o">=</span> <span class="n">DistanceKeeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span></div>


<div class="viewcode-block" id="Keeper.add_graph"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.add_graph">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add a network to the graph keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph : `networkx.Graph`</span>
<span class="sd">            The network to add.</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span><span class="o">.</span><span class="n">add_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added graph input </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> to the keeper.&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Keeper.add_misc"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.add_misc">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_misc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add misc information to be stored.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data </span>
<span class="sd">            The misc information, e.g., a graph.</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing the input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_misc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dubplicate label detected, </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> already exists in the keeper.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_misc</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added misc input </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> to the keeper.&quot;</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="Keeper.load_data"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.load_data">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                  
                  <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cols_as_obs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load data from file into the keeper.</span>

<span class="sd">        .. Note::</span>

<span class="sd">           Currently loads data using ``pandas.read_csv``.</span>
<span class="sd">           Additional formats will be added in the future.</span>
<span class="sd">                  </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name: {`str`, `pathlib.Path`} </span>
<span class="sd">            Input data file name.</span>
<span class="sd">        label : `str`, (default: &#39;data&#39;)</span>
<span class="sd">            Reference label describing the data set.        </span>
<span class="sd">        file_path: {`str` `pathlib.Path`}, optional (default: None)</span>
<span class="sd">            File path. Empty string by default</span>
<span class="sd">        file_format: `str`, optional (default: None)</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">            If `None`, ``file_format`` will be inferred from the file extension</span>
<span class="sd">            in ``file_name``.</span>
<span class="sd">            Currently, this is ignored.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        dtype</span>
<span class="sd">            If provided, ensure to convert data type after loaded.</span>
<span class="sd">        cols_as_obs : `bool` (default = `True`)</span>
<span class="sd">            If `True`, columns in the loaded data are observations, otherwise,</span>
<span class="sd">            the rows are observations.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.read_csv``.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                              <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cols_as_obs</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.load_distance"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.load_distance">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load distance from file into the keeper. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           Assumed that the distance array is stored with the first row and first column as</span>
<span class="sd">           the index and header, respectively.</span>
<span class="sd">        </span>
<span class="sd">           Currently loads data using ``pandas.read_csv``.</span>
<span class="sd">           Additional formats will be added in the future.</span>
<span class="sd">                  </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name: {`str`, `pathlib.Path`} </span>
<span class="sd">            Input distance file name.</span>
<span class="sd">        label : `str`, (default: &#39;distance&#39;)</span>
<span class="sd">            Reference label describing the data set.        </span>
<span class="sd">        file_path: {`str` `pathlib.Path`}, optional (default: None)</span>
<span class="sd">            File path. Empty string by default</span>
<span class="sd">        file_format: `str`, optional (default: None)</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">            If `None`, ``file_format`` will be inferred from the file extension</span>
<span class="sd">            in ``file_name``.</span>
<span class="sd">            Currently, this is ignored.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.read_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                              <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_distance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Keeper.load_stacked_distance"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.load_stacked_distance">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_stacked_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load distance in stacked form from file, convert to unstacked form and store in the keeper. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           Assumed that the stacked distances are stored with a 2-multi-index of the pairwise-observattion</span>
<span class="sd">           (excluding self-pairs) and a single column with the pairwise distances.</span>
<span class="sd">        </span>
<span class="sd">           Currently loads data using ``pandas.read_csv``.</span>
<span class="sd">           Additional formats will be added in the future.</span>
<span class="sd">                  </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name: {`str`, `pathlib.Path`} </span>
<span class="sd">            Input distance file name.</span>
<span class="sd">        label : `str`, (default: &#39;distance&#39;)</span>
<span class="sd">            Reference label describing the data set.        </span>
<span class="sd">        file_path: {`str` `pathlib.Path`}, optional (default: None)</span>
<span class="sd">            File path. Empty string by default</span>
<span class="sd">        file_format: `str`, optional (default: None)</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">            If `None`, ``file_format`` will be inferred from the file extension</span>
<span class="sd">            in ``file_name``.</span>
<span class="sd">            Currently, this is ignored.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.read_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                              <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distances</span><span class="o">.</span><span class="n">add_stacked_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.load_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.load_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;similarity&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load similarity from file into the keeper. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           Assumed that the distance array is stored with the first row and first column as</span>
<span class="sd">           the index and header, respectively.</span>
<span class="sd">        </span>
<span class="sd">           Currently loads data using ``pandas.read_csv``.</span>
<span class="sd">           Additional formats will be added in the future.</span>
<span class="sd">                  </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name: {`str`, `pathlib.Path`} </span>
<span class="sd">            Input similarity file name.</span>
<span class="sd">        label : `str`, (default: &#39;similarity&#39;)</span>
<span class="sd">            Reference label describing the data set.        </span>
<span class="sd">        file_path: {`str` `pathlib.Path`}, optional (default: None)</span>
<span class="sd">            File path. Empty string by default</span>
<span class="sd">        file_format: `str`, optional (default: None)</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">            If `None`, ``file_format`` will be inferred from the file extension</span>
<span class="sd">            in ``file_name``.</span>
<span class="sd">            Currently, this is ignored.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.read_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                              <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_similarity</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.load_stacked_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.load_stacked_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_stacked_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;similarity&#39;</span><span class="p">,</span> <span class="n">diag</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                                <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load similarity in stacked form from file, convert to unstacked form and store in the keeper. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           Assumed that the stacked distances are stored with a 2-multi-index of the pairwise-observattion</span>
<span class="sd">           (excluding self-pairs) and a single column with the pairwise distances.</span>

<span class="sd">           Currently loads data using ``pandas.read_csv``.</span>
<span class="sd">           Additional formats will be added in the future.</span>
<span class="sd">                  </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name: {`str`, `pathlib.Path`} </span>
<span class="sd">            Input distance file name.</span>
<span class="sd">        label : `str`, (default: &#39;distance&#39;)</span>
<span class="sd">            Reference label describing the data set.</span>
<span class="sd">        diag : `float`</span>
<span class="sd">            Value used on diagonal. </span>
<span class="sd">        file_path: {`str` `pathlib.Path`}, optional (default: None)</span>
<span class="sd">            File path. Empty string by default</span>
<span class="sd">        file_format: `str`, optional (default: None)</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">            If `None`, ``file_format`` will be inferred from the file extension</span>
<span class="sd">            in ``file_name``.</span>
<span class="sd">            Currently, this is ignored.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.read_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">data</span> <span class="o">=</span> <span class="n">load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                              <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_similarities</span><span class="o">.</span><span class="n">add_stacked_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.load_graph"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.load_graph">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">file_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
                   <span class="n">source</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load network (edgelist) from file into graph and store in the keeper. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           Currently loads graph from edgelist. Future release will allow different</span>
<span class="sd">           graph types (e.g., adjacency, graphml).</span>

<span class="sd">           Assumed that the edge-list is stored as two columns, where the first row</span>
<span class="sd">           is labeled as source and target.</span>

<span class="sd">           Currently loads data using ``pandas.read_csv``.</span>
<span class="sd">           Additional formats will be added in the future.</span>
<span class="sd">                  </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name: {`str`, `pathlib.Path`} </span>
<span class="sd">            Input edge-list file name.</span>
<span class="sd">        label : `str`, (default: &#39;graph&#39;)</span>
<span class="sd">            Reference label describing the network.</span>
<span class="sd">        file_path: {`str` `pathlib.Path`}, optional (default: None)</span>
<span class="sd">            File path. Empty string by default</span>
<span class="sd">        file_format: `str`, optional (default: None)</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">            If `None`, ``file_format`` will be inferred from the file extension</span>
<span class="sd">            in ``file_name``.</span>
<span class="sd">            Currently, this is ignored.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        source : {`str`, `int`} (default: &#39;source&#39;)</span>
<span class="sd">            A valid column name (string or integer) for the source nodes</span>
<span class="sd">            passed to ``networkx.from_pandas_edgelist``.</span>
<span class="sd">        target : {`str`, `int`} (default: &#39;target&#39;)</span>
<span class="sd">            A valid column name (string or integer) for the target nodes</span>
<span class="sd">            passed to ``networkx.from_pandas_edgelist``.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.read_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">E</span> <span class="o">=</span> <span class="n">load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="n">file_format</span><span class="p">,</span>
                           <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_graph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.save_data"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.save_data">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Save data to file. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           This currently only saves a pandas DataFrame to .txt, .csv, or .tsv.</span>
<span class="sd">           Future releases will allow for other formats.</span>

<span class="sd">        Data set is saved to the file named &#39;{self.outdir}/data_{label}.{file_format}&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing which data set to save.</span>
<span class="sd">        file_format : `str`</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.to_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot store data - outdir was not set.&quot;</span><span class="p">)</span>

        <span class="n">_fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;data_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">_fp</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File already exists, cannot save data to </span><span class="si">{</span><span class="n">_fp</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">_fp</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data set saved to </span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.save_distance"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.save_distance">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Save distance to file. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           This currently only saves a pandas DataFrame to .txt, .csv, or .tsv.</span>
<span class="sd">           Future releases will allow for other formats.</span>

<span class="sd">        Distance is saved to the file named &#39;{self.outdir}/distance_{label}.{file_format}&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing which distance to save.</span>
<span class="sd">        file_format : `str`</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.to_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot store distance - outdir was not set.&quot;</span><span class="p">)</span>

        <span class="n">_fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;distance_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">_fp</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File already exists, cannot save distance to </span><span class="si">{</span><span class="n">_fp</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">_fp</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distance set saved to </span><span class="si">{</span><span class="n">_fp</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.save_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.save_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Save similarity to file. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           This currently only saves a pandas DataFrame to .txt, .csv, or .tsv.</span>
<span class="sd">           Future releases will allow for other formats.</span>

<span class="sd">        Similarity is saved to the file named &#39;{self.outdir}/similarity_{label}.{file_format}&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing which similarity to save.</span>
<span class="sd">        file_format : `str`</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.to_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot store similarity - outdir was not set.&quot;</span><span class="p">)</span>

        <span class="n">_fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;similarity_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">_fp</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File already exists, cannot save similarity to </span><span class="si">{</span><span class="n">_fp</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">_fp</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Similarities set saved to </span><span class="si">{</span><span class="n">_fp</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.save_misc"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.save_misc">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_misc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Save misc data to file. </span>

<span class="sd">        .. Note::</span>

<span class="sd">           This currently only saves a pandas DataFrame to .txt, .csv, or .tsv.</span>
<span class="sd">           Future releases will allow for other formats.</span>

<span class="sd">        Misc data is saved to the file named &#39;{self.outdir}/misc_{label}.{file_format}&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            Reference label describing which misc data to save.</span>
<span class="sd">        file_format : `str`</span>
<span class="sd">            File format. Currently supported file formats: &#39;txt&#39;, &#39;csv&#39;, &#39;tsv&#39;.</span>
<span class="sd">        delimiter: `str`, optional (default: &#39;,&#39;)</span>
<span class="sd">            Delimiter to use.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional key-word arguments passed to ``pandas.to_csv``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot store misc data - outdir was not set.&quot;</span><span class="p">)</span>

        <span class="n">_fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;misc_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">_fp</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File already exists, cannot save misc data to </span><span class="si">{</span><span class="n">_fp</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">_fp</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Misc data set saved to </span><span class="si">{</span><span class="n">_fp</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.observation_index"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.observation_index">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">observation_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation_label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return index of observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observation_label : `str`</span>
<span class="sd">            The observation label.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        observation_index : `int`</span>
<span class="sd">            Index of observation in list of observation labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">observation_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">observation_label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observation_index</span></div>


<div class="viewcode-block" id="Keeper.subset"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.subset">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">keep_misc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">keep_graphs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Return a new instance of Keeper restricted to subset of observations.</span>

<span class="sd">        The default behavior is to not include misc or graphs in the Keeper subset.</span>
<span class="sd">        This is because there is no check for which observations the misc and graphs</span>
<span class="sd">        correspond to.</span>

<span class="sd">        Warning: The subset keeper and all data it contains is not a copy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        observations : `list`</span>
<span class="sd">            List of observations to include in the subset.</span>
<span class="sd">            This is treated differently depending on the type of observation labels :</span>

<span class="sd">            - If ``self._observation_labels`` is `List` [`str`], ``observations`` can be of the form:</span>
<span class="sd">        </span>
<span class="sd">              * `List` [`str`], to reference observations by their `str` label or;</span>
<span class="sd">              * `List` [`int`], to reference observations by their location index.</span>

<span class="sd">            - If ``self._observation_labels`` is `None` or `List` [`int`], ``observations`` must </span>
<span class="sd">              be of the form `List` [`int`], to reference observations by their location index.</span>
<span class="sd">        keep_misc : `bool`</span>
<span class="sd">            If True, misc is added to the new Keeper. </span>
<span class="sd">        keep_graphs : `bool`</span>
<span class="sd">            If True, the graphs are added to the new Keeper.</span>
<span class="sd">        outdir : {`None`, `str` `pathlib.Path`}</span>
<span class="sd">            Global path where any results will be saved. If `None`, no results will be saved.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        keeper_subset : `Keeper`</span>
<span class="sd">            A Keeper object restricted to the selected observations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keeper_subset</span> <span class="o">=</span> <span class="n">Keeper</span><span class="p">(</span><span class="n">observation_labels</span><span class="o">=</span><span class="n">observations</span><span class="p">,</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outdir</span><span class="p">)</span>
        <span class="n">keeper_subset</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span>
        <span class="n">keeper_subset</span><span class="o">.</span><span class="n">_distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span>
        <span class="n">keeper_subset</span><span class="o">.</span><span class="n">_similarities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarities</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">observations</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">keep_misc</span><span class="p">:</span>
            <span class="n">keeper_subset</span><span class="o">.</span><span class="n">_misc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span>

        <span class="k">if</span> <span class="n">keep_graphs</span><span class="p">:</span>
            <span class="n">keeper_subset</span><span class="o">.</span><span class="n">_graphs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphs</span>

        <span class="n">keeper_subset</span><span class="o">.</span><span class="n">_check_num_observations</span><span class="p">()</span>
        <span class="n">keeper_subset</span><span class="o">.</span><span class="n">_check_observation_labels</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">keeper_subset</span></div>


<div class="viewcode-block" id="Keeper.distance_density"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.distance_density">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">distance_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute each observation&#39;s density from a distance.</span>

<span class="sd">        The density of an observation is its net distance to all other observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            The reference label for the distance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        density : `pandas.Series`</span>
<span class="sd">            The densities indexed by the observation labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">density</span></div>


<div class="viewcode-block" id="Keeper.distance_density_argmin"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.distance_density_argmin">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">distance_density_argmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Find the observation with the smallest density from a distance.</span>

<span class="sd">        The density of an observation is its net distance to all other observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            The reference label for the distance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obs : `int`</span>
<span class="sd">            The index of the observation with the smallest density.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obs</span></div>


<div class="viewcode-block" id="Keeper.distance_density_argmax"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.distance_density_argmax">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">distance_density_argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Find the observation with the largest density from a distance.</span>

<span class="sd">        The density of an observation is its net distance to all other observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            The reference label for the distance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obs : `int`</span>
<span class="sd">            The index of the observation with the largest density.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obs</span></div>


<div class="viewcode-block" id="Keeper.similarity_density"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.similarity_density">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">similarity_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute each observation&#39;s density from a similarity.</span>

<span class="sd">        The density of an observation is its net similarity to all other observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            The reference label for the similarity.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        density : `pandas.Series`</span>
<span class="sd">            The densities indexed by the observation labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">density</span></div>


<div class="viewcode-block" id="Keeper.similarity_density_argmax"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.similarity_density_argmax">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">similarity_density_argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Find the observation with the largest density from a similarity.</span>

<span class="sd">        The density of an observation is its net similarity to all other observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : `str`</span>
<span class="sd">            The reference label for the similarity.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obs : `str`</span>
<span class="sd">            The label of the observation with the largest density.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarities</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obs</span></div>


<div class="viewcode-block" id="Keeper.wass_distance_pairwise_observation_profile"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.wass_distance_pairwise_observation_profile">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">wass_distance_pairwise_observation_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_key</span><span class="p">,</span> <span class="n">graph_key</span><span class="p">,</span>
                                                   <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                   <span class="n">graph_distances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                   <span class="n">proc</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span> <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                   <span class="n">measure_cutoff</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">solvr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute Wasserstein distances between feature profiles of every two observations</span>

<span class="sd">        .. Note::</span>

<span class="sd">           If ``object.outdir`` is not `None`, Wasserstein distances are saved to file every 10 iterations.</span>
<span class="sd">           Before starting the computation, check if the file exists. If so, load and remove already computed</span>
<span class="sd">           nodes from the iteration. Wasserstein distances are computed for the remaining nodes, combined with</span>
<span class="sd">           the previously computed and saved results before saving and returning the combined results.</span>

<span class="sd">           Only nodes with at least 2 neighbors are included, as leaf nodes will all have the same Wassserstein</span>
<span class="sd">           distance and do not provide any further information.</span>

<span class="sd">        The resulting observation-pairwise Wasserstein distances are saved to the DistanceKeeper (aka self.distances)</span>
<span class="sd">        and can be accessed by ``self.distances[f&#39;{data_key}_{label}_wass_dist_observation_pairwise_profiles&#39;]``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_key : `str`</span>
<span class="sd">            The key to the data in the data keeper that should be used.</span>
<span class="sd">        graph_key : &#39;str&#39;</span>
<span class="sd">            The key to the graph in the graph keeper that should be used.</span>
<span class="sd">            (Does not have to include all features in the data)</span>
<span class="sd">        features : {`None`, `list` [`str`])}</span>
<span class="sd">            List of features to compute profile distances on. If `None`, all features are used.</span>
<span class="sd">        label : str</span>
<span class="sd">            Label that resulting Wasserstein distances are saved in ``keeper.distances`` and</span>
<span class="sd">            name of file to store stacked results.</span>
<span class="sd">        graph_distances : `numpy.ndarray`, (n, n)</span>
<span class="sd">            A matrix of node-pairwise graph distances between the :math:`n` nodes (ordered from :math:`0, 1, ..., n-1`).</span>
<span class="sd">            If `None`, use hop distance.</span>
<span class="sd">        edge_weight : {`None`, `str`}</span>
<span class="sd">            The edge attribute used as the weight for computed the graph distances. This is</span>
<span class="sd">            ignored if ``graph_distances`` is provided, If `None`, no edge weight is used.</span>
<span class="sd">        measure_cutoff : `float`</span>
<span class="sd">            Threshold for treating values in profiles as zero, default = 1e-6.</span>
<span class="sd">        proc : `int`</span>
<span class="sd">            Number of processor used for multiprocessing. (Default value = cpu_count()). </span>
<span class="sd">        chunksize : `int`</span>
<span class="sd">            Chunksize to allocate for multiprocessing.</span>
<span class="sd">        solvr : `str`</span>
<span class="sd">            Solver to pass to POT library for computing Wasserstein distance.    </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        wds : `pandas.DataFrame`</span>
<span class="sd">            Wasserstein distances between pairwise profiles where rows are observation-pairs and columns are node names,</span>
<span class="sd">            saved in ``keeper.distances`` with the key ``f&#39;{data_key}_{label}_profile_wass&#39;``,</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inet</span> <span class="o">=</span> <span class="n">InfoNet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_key</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">data_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">graph_distances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">graph_distances</span> <span class="o">=</span> <span class="n">inet</span><span class="o">.</span><span class="n">compute_graph_distances</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">edge_weight</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s1">_profile_wass&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">_profile_wass&#39;</span>
            
        <span class="n">inet</span><span class="o">.</span><span class="n">pairwise_observation_profile_wass_distance</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">graph_distances</span><span class="o">=</span><span class="n">graph_distances</span><span class="p">,</span> 
                                                        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                                                        <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Computing pairwise profile Wasserstein distances&#39;</span><span class="p">,</span>
                                                        <span class="n">proc</span><span class="o">=</span><span class="n">proc</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
                                                        <span class="n">measure_cutoff</span><span class="o">=</span><span class="n">measure_cutoff</span><span class="p">,</span> <span class="n">solvr</span><span class="o">=</span><span class="n">solvr</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Keeper.euc_distance_pairwise_observation_profile"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.euc_distance_pairwise_observation_profile">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">euc_distance_pairwise_observation_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_key</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                  <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute Euclidean distances between feature profiles of every two observations</span>

<span class="sd">        .. Note::</span>

<span class="sd">           If ``object.outdir`` is not `None`, Euclidean distances are saved to file.</span>
<span class="sd">           Before starting the computation, check if the file exists. If so, load and remove already computed</span>
<span class="sd">           nodes from the iteration. Euclidean distances are computed for the remaining nodes, combined with</span>
<span class="sd">           the previously computed and saved results before saving and returning the combined results.</span>

<span class="sd">           Only nodes with at least 2 neighbors are included, as leaf nodes will all have the same Wassserstein</span>
<span class="sd">           distance and do not provide any further information.</span>

<span class="sd">        The resulting observation-pairwise Wasserstein distances are saved to the DistanceKeeper (aka self.distances)</span>
<span class="sd">        and can be accessed by ``self.distances[f&#39;{data_key}_{label}_profile_euc&#39;]``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_key : `str`</span>
<span class="sd">            The key to the data in the data keeper that should be used.</span>
<span class="sd">        features : {`None`, `list` [`str`])}</span>
<span class="sd">            List of features to compute profile distances on. If `None`, all features are used.</span>
<span class="sd">        label : str</span>
<span class="sd">            Label that resulting Wasserstein distances are saved in ``keeper.distances`` and</span>
<span class="sd">            name of file to store stacked results.</span>
<span class="sd">        metric : `str`</span>
<span class="sd">            The metric used to compute the distance, passed to scipy.spatial.distance.cdist.</span>
<span class="sd">        normalize : `bool`</span>
<span class="sd">            If `True`, normalize neighborhood profiles to sum to 1.</span>
<span class="sd">        **kwargs : `dict`</span>
<span class="sd">            Extra arguments to metric, passed to `scipy.spatial.distance.cdist`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        eds : `pandas.DataFrame`</span>
<span class="sd">            Euclidean distances between pairwise profiles where rows are observation-pairs and columns are node names,</span>
<span class="sd">            saved in ``keeper.distances`` with the key ``f&#39;{data_key}_{label}_profile_euc&#39;``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inet</span> <span class="o">=</span> <span class="n">InfoNet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">data_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s1">_profile_euc&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">_profile_euc&#39;</span>

        <span class="n">inet</span><span class="o">.</span><span class="n">pairwise_observation_profile_euc_distance</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
                                                       <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> 
                                                       <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Computing pairwise profile Euclidean distances&#39;</span><span class="p">,</span>
                                                       <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.wass_distance_pairwise_observation_feature_nbhd"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.wass_distance_pairwise_observation_feature_nbhd">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">wass_distance_pairwise_observation_feature_nbhd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_key</span><span class="p">,</span> <span class="n">graph_key</span><span class="p">,</span>
                                                        <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_self</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="n">graph_distances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="n">proc</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span> <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="n">measure_cutoff</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">solvr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute Wasserstein distances between feature neighborhoods of every two observations</span>

<span class="sd">        .. Note::</span>

<span class="sd">           If ``object.outdir`` is not `None`, Wasserstein distances are saved to file every 10 iterations.</span>
<span class="sd">           Before starting the computation, check if the file exists. If so, load and remove already computed</span>
<span class="sd">           nodes from the iteration. Wasserstein distances are computed for the remaining nodes, combined with</span>
<span class="sd">           the previously computed and saved results before saving and returning the combined results.</span>

<span class="sd">           Only nodes with at least 2 neighbors are included, as leaf nodes will all have the same Wassserstein</span>
<span class="sd">           distance and do not provide any further information.</span>

<span class="sd">        The resulting observation-pairwise Wasserstein distances are saved to misc  (aka self.misc) and can be accessed by</span>
<span class="sd">        ``self.misc[f&quot;{data_key}_{label}_nbhd_wass_with{&#39;&#39; if include_self else &#39;out&#39;}_self&quot;]``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_key : `str`</span>
<span class="sd">            The key to the data in the data keeper that should be used.</span>
<span class="sd">        graph_key : &#39;str&#39;</span>
<span class="sd">            The key to the graph in the graph keeper that should be used.</span>
<span class="sd">            (Does not have to include all features in the data)</span>
<span class="sd">        features : {`None`, `list` [`str`])}</span>
<span class="sd">            List of features (nodes) to compute neighborhood distances on.</span>
<span class="sd">            If `None`, all features are used.</span>
<span class="sd">        include_self : `bool`</span>
<span class="sd">            If `True`, add node in neighborhood which will result in computing normalized profile over the neighborhood.</span>
<span class="sd">            If `False`, node is not included in neighborhood which results in computing the transition distribution</span>
<span class="sd">            over the neighborhood.</span>
<span class="sd">        label : str</span>
<span class="sd">            Label that resulting Wasserstein distances are saved in ``keeper.misc`` </span>
<span class="sd">            and name of file to store stacked results.</span>
<span class="sd">        graph_distances : `numpy.ndarray`, (n, n)</span>
<span class="sd">            A matrix of node-pairwise graph distances between the</span>
<span class="sd">            :math:`n` nodes (ordered from :math:`0, 1, ..., n-1`).</span>
<span class="sd">            If `None`, use hop distance.</span>
<span class="sd">        edge_weight : {`None`, `str`}</span>
<span class="sd">            The edge attribute used as the weight for computed the graph distances. This is</span>
<span class="sd">            ignored if ``graph_distances`` is provided, If `None`, no edge weight is used.</span>
<span class="sd">        measure_cutoff : `float`</span>
<span class="sd">            Threshold for treating values in profiles as zero, default = 1e-6.</span>
<span class="sd">        proc : `int`</span>
<span class="sd">            Number of processor used for multiprocessing. (Default value = cpu_count()). </span>
<span class="sd">        chunksize : `int`</span>
<span class="sd">            Chunksize to allocate for multiprocessing.</span>
<span class="sd">        solvr : `str`</span>
<span class="sd">            Solver to pass to POT library for computing Wasserstein distance.    </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        wds : `pandas.DataFrame`</span>
<span class="sd">            Wasserstein distances between pairwise observations where rows are observation-pairs and columns are</span>
<span class="sd">            feature (node) names.</span>
<span class="sd">            saved in ``keeper.misc`` with the key</span>
<span class="sd">            ``f&quot;{data_key}_{label}_nbhd_wass_with{&#39;&#39; if include_self else &#39;out&#39;}_self&quot;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inet</span> <span class="o">=</span> <span class="n">InfoNet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_key</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">data_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">graph_distances</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">graph_distances</span> <span class="o">=</span> <span class="n">inet</span><span class="o">.</span><span class="n">compute_graph_distances</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="n">edge_weight</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s2">_nbhd_wass_with</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">include_self</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;out&#39;</span><span class="si">}</span><span class="s2">_self&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_nbhd_wass_with</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">include_self</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;out&#39;</span><span class="si">}</span><span class="s2">_self&quot;</span>
            
        <span class="n">inet</span><span class="o">.</span><span class="n">multiple_pairwise_observation_neighborhood_wass_distance</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">include_self</span><span class="o">=</span><span class="n">include_self</span><span class="p">,</span>
                                                                      <span class="n">graph_distances</span><span class="o">=</span><span class="n">graph_distances</span><span class="p">,</span>
                                                                      <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                                                                      <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Computing pairwise 1-hop nbhd Wasserstein distances&#39;</span><span class="p">,</span>
                                                                      <span class="n">proc</span><span class="o">=</span><span class="n">proc</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
                                                                      <span class="n">measure_cutoff</span><span class="o">=</span><span class="n">measure_cutoff</span><span class="p">,</span> <span class="n">solvr</span><span class="o">=</span><span class="n">solvr</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.euc_distance_pairwise_observation_feature_nbhd"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.euc_distance_pairwise_observation_feature_nbhd">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">euc_distance_pairwise_observation_feature_nbhd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_key</span><span class="p">,</span> <span class="n">graph_key</span><span class="p">,</span>
                                                        <span class="n">features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_self</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                        <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute Euclidean distances between feature neighborhoods of every two observations</span>

<span class="sd">        .. Note::</span>

<span class="sd">           If ``object.outdir`` is not `None`, Euclidean distances are saved to file every 10 iterations.</span>
<span class="sd">           Before starting the computation, check if the file exists. If so, load and remove already computed</span>
<span class="sd">           nodes from the iteration. Euclidean distances are computed for the remaining nodes, combined with</span>
<span class="sd">           the previously computed and saved results before saving and returning the combined results.</span>

<span class="sd">           Only nodes with at least 2 neighbors are included, as leaf nodes will all have the same Euclidean</span>
<span class="sd">           distance and do not provide any further information.</span>

<span class="sd">        The resulting observation-pairwise Euclidean distances are saved to misc (aka self.misc) and can be accessed by</span>
<span class="sd">        ``self.misc[f&quot;{data_key}_{label}_nbhd_euc_with{&#39;&#39; if include_self else &#39;out&#39;}_self&quot;]``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_key : `str`</span>
<span class="sd">            The key to the data in the data keeper that should be used.</span>
<span class="sd">        graph_key : &#39;str&#39;</span>
<span class="sd">            The key to the graph in the graph keeper that should be used.</span>
<span class="sd">            (Does not have to include all features in the data)</span>
<span class="sd">        features : {`None`, `list` [`str`])}</span>
<span class="sd">            List of features (nodes) to compute neighborhood distances on.</span>
<span class="sd">            If `None`, all features are used.</span>
<span class="sd">        include_self : `bool`</span>
<span class="sd">            If `True`, add node in neighborhood which will result in computing normalized profile over the neighborhood.</span>
<span class="sd">            If `False`, node is not included in neighborhood which results in computing the transition distribution</span>
<span class="sd">            over the neighborhood.</span>
<span class="sd">        label : str</span>
<span class="sd">            Label that resulting Wasserstein distances are saved in ``keeper.misc`` </span>
<span class="sd">            and name of file to store stacked results.</span>
<span class="sd">        metric : `str`</span>
<span class="sd">            The metric used to compute the distance, passed to scipy.spatial.distance.cdist.</span>
<span class="sd">        normalize : `bool`</span>
<span class="sd">            If `True`, normalize neighborhood profiles to sum to 1.</span>
<span class="sd">        **kwargs : `dict`</span>
<span class="sd">            Extra arguments to metric, passed to `scipy.spatial.distance.cdist`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        eds : `pandas.DataFrame`</span>
<span class="sd">            Euclidean distances between pairwise observations where rows are observation-pairs and columns are</span>
<span class="sd">            feature (node) names.</span>
<span class="sd">            saved in ``keeper.misc`` with the key</span>
<span class="sd">            ``f&quot;{data_key}_{label}_nbhd_euc_with{&#39;&#39; if include_self else &#39;out&#39;}_self&quot;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inet</span> <span class="o">=</span> <span class="n">InfoNet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_key</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">data_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s2">_nbhd_euc_with</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">include_self</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;out&#39;</span><span class="si">}</span><span class="s2">_self&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_nbhd_euc_with</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">include_self</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;out&#39;</span><span class="si">}</span><span class="s2">_self&quot;</span>
            
        <span class="k">if</span> <span class="n">normalize</span> <span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;normalized&#39;</span><span class="p">])</span>
            
        <span class="n">inet</span><span class="o">.</span><span class="n">multiple_pairwise_observation_neighborhood_euc_distance</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">include_self</span><span class="o">=</span><span class="n">include_self</span><span class="p">,</span>
                                                                     <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                                                                     <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Computing pairwise 1-hop nbhd Euclidean distances&#39;</span><span class="p">,</span>
                                                                     <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.compute_sigmas"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.compute_sigmas">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_key</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">return_nn</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Set sigma for each obs as the distance to its k-th neighbor from keeper.</span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        distance_key : `str`</span>
<span class="sd">            The label used to reference the distance matrix stored in ``keeper.distances``,</span>
<span class="sd">            of size (n_observations, n_observations).</span>
<span class="sd">        label : {`None`, `str`}</span>
<span class="sd">            If provided, this is appended to the context tag</span>
<span class="sd">            (``tag = f&quot;{method}{n_neighbors}nn_{distance_key}&quot;``). The key used to store the</span>
<span class="sd">            results defaults to the tag when ``label`` is not provided: ``key = tag``. Otherwise,</span>
<span class="sd">            the key is set to: ``key = tag + &quot;-&quot; + label``. The resulting sigmas</span>
<span class="sd">            are stored in ``keeper.misc[&#39;sigmas_&#39; + key]``.</span>
<span class="sd">            </span>
<span class="sd">            If ``return_nn`` is `True`,</span>
<span class="sd">            nearest neighbor indices are stored in ``keeper.misc[&#39;nn_indices_&#39; + key]`` and nearest</span>
<span class="sd">            neighbor distances are stored in ``keeper.misc[&#39;nn_distances_&#39; + key]``.</span>
<span class="sd">        n_neighbors : {`int`, `None`}</span>
<span class="sd">            K-th nearest neighbor (or number of nearest neighbors) to use for computing ``sigmas``,</span>
<span class="sd">            ``n_neighbors &gt; 0``. (Uses ``n_neighbors + 1``, since each obs is it&#39;s closest neighbor).</span>
<span class="sd">            If `None`, all neighbors are used.</span>
<span class="sd">        method : {&#39;mean&#39;, &#39;median&#39;, &#39;max&#39;}</span>
<span class="sd">            Indicate how to compute sigma.</span>

<span class="sd">            Options:</span>

<span class="sd">            - &#39;mean&#39; : mean of distance to ``n_neighbors`` nearest neighbors</span>
<span class="sd">            - &#39;median&#39; : median of distance to ``n_neighbors`` nearest neighbors</span>
<span class="sd">            - &#39;max&#39; : distance to ``n_neighbors``-nearest neighbor</span>
<span class="sd">        return_nn : `bool`</span>
<span class="sd">            If `True`, also store indices and distances of ``n_neighbors`` nearest neighbors.</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sigmas : `numpy.ndarray`, (n_observations, )</span>
<span class="sd">            The distance to the k-th nearest neighbor for all rows in ``d``.</span>
<span class="sd">            Sigmas represent the kernel width representing each data point&#39;s accessible neighbors.</span>
<span class="sd">            Written to ``keeper.misc[&#39;sigmas_&#39; + key]``.</span>
<span class="sd">        indices : `numpy.ndarray`, (n_observations, )</span>
<span class="sd">            Indices of nearest neighbors where each row corresponds to an observation.</span>
<span class="sd">            Written, if ``return_nn`` is `True`, to ``keeper.misc[&#39;nn_indices_&#39; + key]``.</span>
<span class="sd">        distances : `numpy.ndarray`, (n_observations, ``n_neighbors + 1``)</span>
<span class="sd">            Distances to nearest neighbors where each row corresponds to an obs.</span>
<span class="sd">            Written, if ``return_nn`` is `True`, to ``keeper.misc[&#39;nn_distances_&#39; + key]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}{</span><span class="n">n_neighbors</span><span class="si">}</span><span class="s2">nn_</span><span class="si">{</span><span class="n">distance_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tag</span><span class="p">,</span> <span class="n">label</span><span class="p">])</span>
        
        <span class="n">nfs</span><span class="o">.</span><span class="n">sigma_knn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_key</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span>
                      <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">return_nn</span><span class="o">=</span><span class="n">return_nn</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.compute_similarity_from_distance"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.compute_similarity_from_distance">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_similarity_from_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_key</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">precomputed_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knn</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert distance matrix to symmetric similarity measure.</span>

<span class="sd">        The resulting similarity is written to the similarity keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        distance_key : `str`</span>
<span class="sd">            The label used to reference the distance matrix stored in ``keeper.distances``,</span>
<span class="sd">            of size (n_observations, n_observations).    </span>
<span class="sd">        n_neighbors : {`int`, `None`}</span>
<span class="sd">            K-th nearest neighbor (or number of nearest neighbors) to use for computing ``sigmas``,</span>
<span class="sd">            ``n_neighbors &gt; 0``. (Uses ``n_neighbors + 1``, since each obs is it&#39;s closest neighbor).</span>
<span class="sd">            If `None`, all neighbors are used.</span>
<span class="sd">        method : {`float`, &#39;mean&#39;, &#39;median&#39;, &#39;max&#39;, &#39;precomputed&#39;}</span>
<span class="sd">            Indicate how to compute sigma.</span>

<span class="sd">            Options:</span>

<span class="sd">            - `float` : constant float to use as sigma</span>
<span class="sd">            - `int` : constant int to use as sigma</span>
<span class="sd">            - &#39;mean&#39; : mean of distance to ``n_neighbors`` nearest neighbors</span>
<span class="sd">            - &#39;median&#39; : median of distance to ``n_neighbors`` nearest neighbors</span>
<span class="sd">            - &#39;max&#39; : distance to ``n_neighbors``-nearest neighbor</span>
<span class="sd">            - &#39;precomputed&#39; : precomputed values extracted from ``keeper.misc[f&quot;sigmas_{key}&quot;]`` as a `numpy.ndarray` of size (n_observations, ).</span>
<span class="sd">        precomputed_method : {&#39;mean&#39;, &#39;median&#39;, &#39;max&#39;}</span>
<span class="sd">            This is ignored if `method` is not `&#39;precomputed&#39;`. When `method` is `&#39;precomputed&#39;`, specify the method that</span>
<span class="sd">            was previously used for computing sigmas. See `method` for description of options.</span>
<span class="sd">        label : {`None`, `str`}</span>
<span class="sd">            If provided, this is appended to the context tag (``tag = f&quot;{method}{n_neighbors}nn_{distance_key}&quot;``)</span>
<span class="sd">            The key used to store the resulting similarity matrix of size (n_observations, n_observations)</span>
<span class="sd">            in ``keeper.similarities[f&quot;similarity_{key}]`` defaults to the tag when ``label`` is not provided: ``key = tag``. Otherwise,</span>
<span class="sd">            the key is set to: ``key = tag + &quot;-&quot; + label``.        </span>
<span class="sd">        knn : `bool`</span>
<span class="sd">            If `True`, restrict similarity measure to be non-zero only between ``n_neighbors`` nearest neighbors.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        K : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">            Symmetric similarity measure. </span>
<span class="sd">            Written to ``keeper.similarities[key]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s1">&#39;precomputed&#39;</span><span class="p">:</span>
            <span class="n">precomputed_method</span> <span class="o">=</span> <span class="n">method</span>
            
        <span class="n">tag</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">precomputed_method</span><span class="p">)</span><span class="si">}{</span><span class="n">n_neighbors</span><span class="si">}</span><span class="s2">nn_</span><span class="si">{</span><span class="n">distance_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tag</span><span class="p">,</span> <span class="n">label</span><span class="p">])</span>
            
        <span class="n">nfs</span><span class="o">.</span><span class="n">distance_to_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_key</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span>
                                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;similarity_</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sigmas</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;sigmas_</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                   <span class="n">knn</span><span class="o">=</span><span class="n">knn</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>



<div class="viewcode-block" id="Keeper.convert_similarity_to_distance"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.convert_similarity_to_distance">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">convert_similarity_to_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convert a similarity to a distance.</span>

<span class="sd">        The distance, computed as 1-similarity, is added to the distance keeper</span>
<span class="sd">        with the key ``&quot;distance_from_&quot; + similarity_key``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        similarity_key : `str`</span>
<span class="sd">            The similiratiy reference key.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The following are saved to the distance keeper:</span>

<span class="sd">            d : The new distance is saved to the keeper in</span>
<span class="sd">               ``keeper.distances[f&quot;distance_from_{similarity_key}&quot;]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarities</span><span class="p">[</span><span class="n">similarity_key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_distance</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">sim</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;distance_from_</span><span class="si">{</span><span class="n">similarity_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="Keeper.fuse_similarities"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.fuse_similarities">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">fuse_similarities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_keys</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fused_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Fuse similarities in the keeper</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        similarity_keys : `list`</span>
<span class="sd">            Reference keys of similiraties to fuse.</span>
<span class="sd">        weights : `list`</span>
<span class="sd">            (Optional) Weight each similarity contributes to the fused similarity.</span>
<span class="sd">            Should be the same length as ``similarity_keys``.</span>
<span class="sd">            If not provided, default behavior is to apply uniform weights.</span>
<span class="sd">        fused_key : `str`</span>
<span class="sd">            (Optional) Specify key used to store the fused similarity in the keeper.</span>
<span class="sd">            Default behavior is to fuse the keys of the original similarities.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The following is added to the similarity keeper :</span>

<span class="sd">          - fused_sim : The fused similarity, where the reference key, if not provided,</span>
<span class="sd">            is fused from the original labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">similarity_keys</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;``weights`` must have the same number of values as ``similarity_keys``.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fused_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>            
            <span class="n">fused_key</span> <span class="o">=</span> <span class="n">fuse_labels</span><span class="p">(</span><span class="n">similarity_keys</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarities</span><span class="p">[</span><span class="n">similarity_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span>

        <span class="n">fused_sim</span> <span class="o">=</span> <span class="n">s</span>
        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">similarity_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarities</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span>
            <span class="n">fused_sim</span> <span class="o">=</span> <span class="n">fused_sim</span> <span class="o">+</span> <span class="n">s</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">similarity_keys</span><span class="p">)</span>
            <span class="n">fused_sim</span> <span class="o">=</span> <span class="n">fused_sim</span> <span class="o">/</span> <span class="n">n</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_similarity</span><span class="p">(</span><span class="n">fused_sim</span><span class="p">,</span> <span class="n">fused_key</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="Keeper.compute_transitions_from_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.compute_transitions_from_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_transitions_from_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_key</span><span class="p">,</span> <span class="n">density_normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute symmetric and asymmetric transition matrices and store in keeper.</span>

<span class="sd">        .. Note:: Code primarily copied from `scanpy.neighbors`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        similarity_key : `str`</span>
<span class="sd">            Reference key to the `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">            symmetric similarity measure (with 1s on the diagonal) stored in the similarities</span>
<span class="sd">            in the keeper.</span>
<span class="sd">        density_normalize : `bool`</span>
<span class="sd">            The density rescaling of Coifman and Lafon (2006): Then only the</span>
<span class="sd">            geometry of the data matters, not the sampled density.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Adds the following to `keeper.misc` (with 0s on the diagonals):</span>
<span class="sd">            transitions_asym_{similarity_key} : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">                Asymmetric Transition matrix.</span>
<span class="sd">            Transitions_sym_{similarity_key} : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">                Symmetric Transition matrix.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nfo</span><span class="o">.</span><span class="n">compute_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_key</span><span class="p">,</span> <span class="n">density_normalize</span><span class="o">=</span><span class="n">density_normalize</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.compute_dpt_from_augmented_sym_transitions"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.compute_dpt_from_augmented_sym_transitions">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_dpt_from_augmented_sym_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">n_comps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">save_eig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the diffusion pseudotime metric between observations,</span>
<span class="sd">        computed from the symmetric transitions.</span>

<span class="sd">        .. Note::</span>

<span class="sd">            - :math:`T` is the symmetric transition matrix</span>
<span class="sd">            - :math:`M(x,z) = \sum_{i=1}^{n-1} (\lambda_i * (1 - \lambda_i))\psi_i(x)\psi_i^T(z)`</span>
<span class="sd">            - :math:`dpt(x,z) = ||M(x, .) - M(y, .)||^2`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : `str`</span>
<span class="sd">            Reference ID for the symmetric transitions `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">            stored in ``keeper.misc``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dpt : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">            Pairwise-observation Diffusion pseudotime distances are stored</span>
<span class="sd">            in keeper.distances[dpt_key] where ``dpt_key=&quot;dpt_from_{key}&quot;``.</span>
<span class="sd">            If the full spectrum is not used (i.e., ``0 &lt; n_comps &lt; n_observations&quot;``),</span>
<span class="sd">            then ``dpt_key=&quot;dpt_from_{key}_{n_comps}comps&quot;``.</span>
<span class="sd">        n_comps : `int`</span>
<span class="sd">            Number of eigenvalues/vectors to be computed, set ``n_comps = 0`` to compute the whole spectrum.</span>
<span class="sd">            Alternatively, if set ``n_comps &gt;= n_observations``, the whole spectrum will be computed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nfo</span><span class="o">.</span><span class="n">dpt_from_augmented_sym_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">n_comps</span><span class="o">=</span><span class="n">n_comps</span><span class="p">,</span> <span class="n">save_eig</span><span class="o">=</span><span class="n">save_eig</span><span class="p">)</span></div>

<div class="viewcode-block" id="Keeper.compute_rw_transitions_from_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.compute_rw_transitions_from_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_rw_transitions_from_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the row-stochastic transition matrix and store in keeper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        similarity_key : `str`</span>
<span class="sd">            Reference key to the `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">            symmetric similarity measure (with 1s on the diagonal) stored in the similarities</span>
<span class="sd">            in the keeper.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Adds the following to `keeper.misc` (with 0s on the diagonals):</span>
<span class="sd">            transitions_rw_{similarity_key} : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">                Asymmetric random walk transition matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">nfo</span><span class="o">.</span><span class="n">compute_rw_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_key</span><span class="p">)</span></div>



<div class="viewcode-block" id="Keeper.compute_dpt_from_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.compute_dpt_from_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_dpt_from_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_key</span><span class="p">,</span> <span class="n">density_normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                    <span class="n">n_comps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">save_eig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the diffusion pseudotime metric between observations,</span>
<span class="sd">        computed from similarity </span>

<span class="sd">        .. Note::</span>

<span class="sd">            - This entails computing the augmented symmetric transitions.</span>
<span class="sd">            - :math:`T` is the symmetric transition matrix</span>
<span class="sd">            - :math:`M(x,z) = \sum_{i=1}^{n-1} (\lambda_i * (1 - \lambda_i))\psi_i(x)\psi_i^T(z)`</span>
<span class="sd">            - :math:`dpt(x,z) = ||M(x, .) - M(y, .)||^2`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        similarity_key : `str`</span>
<span class="sd">            Reference key to the `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">            symmetric similarity measure (with 1s on the diagonal) stored in the similarities</span>
<span class="sd">            in the keeper.</span>
<span class="sd">        density_normalize : `bool`</span>
<span class="sd">            The density rescaling of Coifman and Lafon (2006): Then only the</span>
<span class="sd">            geometry of the data matters, not the sampled density.</span>
<span class="sd">        n_comps : `int`</span>
<span class="sd">            Number of eigenvalues/vectors to be computed, set ``n_comps = 0`` to compute the whole spectrum.</span>
<span class="sd">            Alternatively, if set ``n_comps &gt;= n_observations``, the whole spectrum will be computed.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The following are stored in the keeper :</span>
<span class="sd">           transitions_asym : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">                Asymmetric Transition matrix (with 0s on the diagonal) added to</span>
<span class="sd">                ``keeper.misc[f&quot;transitions_asym_{similarity_key}&quot;]``.</span>
<span class="sd">           transitions_sym : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">                Symmetric Transition matrix (with 0s on the diagonal) added to</span>
<span class="sd">                ``keeper.misc[f&quot;transitions_sym_{similarity_key}&quot;]``.</span>
<span class="sd">        </span>
<span class="sd">           dpt : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">               Pairwise-observation Diffusion pseudotime distances are stored</span>
<span class="sd">               in keeper.distances[dpt_key] where</span>
<span class="sd">               ``dpt_key=&quot;dpt_from_transitions_asym_{similarity_key}&quot;``.</span>
<span class="sd">               If the full spectrum is not used (i.e., ``0 &lt; n_comps &lt; n_observations&quot;``),</span>
<span class="sd">               then ``dpt_key=&quot;dpt_from_transitions_asym_{similarity_key}_{n_comps}comps&quot;``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">T_sym_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transitions_sym_</span><span class="si">{</span><span class="n">similarity_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">density_normalize</span><span class="p">:</span>
            <span class="n">T_sym_key</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">T_sym_key</span><span class="p">,</span> <span class="s2">&quot;density_normalized&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">T_sym_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_transitions_from_similarity</span><span class="p">(</span><span class="n">similarity_key</span><span class="p">,</span> <span class="n">density_normalize</span><span class="p">)</span>        

        <span class="bp">self</span><span class="o">.</span><span class="n">compute_dpt_from_augmented_sym_transitions</span><span class="p">(</span><span class="n">T_sym_key</span><span class="p">,</span> <span class="n">n_comps</span><span class="o">=</span><span class="n">n_comps</span><span class="p">,</span> <span class="n">save_eig</span><span class="o">=</span><span class="n">save_eig</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.integrate_transitions"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.integrate_transitions">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">integrate_transitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transition_keys</span><span class="p">,</span> <span class="n">integrated_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Integrate transitions</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        transition_keys : `list`</span>
<span class="sd">            Reference keys of transitions to integrate.</span>
<span class="sd">        integrated_key : `str`</span>
<span class="sd">            (Optional) Specify key used to store the integrated transitions into the keeper.</span>
<span class="sd">            Default behavior is to integrate the keys of the original transitions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The following is added to the similarity keeper :</span>

<span class="sd">          - integrated transition : The integrated transition, where the reference key, if not provided, is fused from the original labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">integrated_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>            
            <span class="n">integrated_key</span> <span class="o">=</span> <span class="n">fuse_labels</span><span class="p">(</span><span class="n">transition_keys</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;fused&#39;</span><span class="p">,</span> <span class="s1">&#39;integrated&#39;</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="n">transition_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># .data</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">transition_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">p_cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="c1"># .data</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">@</span> <span class="n">p_cur</span>

        <span class="c1"># ensure symmetric</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_misc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">integrated_key</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Keeper.integrate_transitions_from_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.integrate_transitions_from_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">integrate_transitions_from_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                              <span class="n">similarity_keys</span><span class="p">,</span> <span class="n">integrated_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                              <span class="n">density_normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                              <span class="n">n_comps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the integrated transition from similarities,</span>

<span class="sd">        .. Note::</span>

<span class="sd">            - This entails computing the augmented symmetric transitions.</span>
<span class="sd">            - :math:`T` is the symmetric transition matrix</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        similarity_keys : `list`</span>
<span class="sd">            Reference keys of similarities to compute transitions and integrate.</span>
<span class="sd">        integrated_key : `str`</span>
<span class="sd">            (Otional) Specify key used to store the integrated transitions into the keeper.</span>
<span class="sd">            Default behavior is to integrate the keys of the original transitions.</span>
<span class="sd">        density_normalize : `bool`</span>
<span class="sd">            The density rescaling of Coifman and Lafon (2006): Then only the</span>
<span class="sd">            geometry of the data matters, not the sampled density.</span>
<span class="sd">        n_comps : `int`</span>
<span class="sd">            Number of eigenvalues/vectors to be computed, set ``n_comps = 0`` to compute the whole spectrum.</span>
<span class="sd">            Alternatively, if set ``n_comps &gt;= n_observations``, the whole spectrum will be computed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The following are stored in the keeper :</span>
<span class="sd">        </span>
<span class="sd">           - transitions_asym : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">                Asymmetric Transition matrix (with 0s on the diagonal) added to</span>
<span class="sd">                ``keeper.misc[f&quot;transitions_asym_{similarity_key}&quot;]``.</span>
<span class="sd">           - transitions_sym : `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">                Symmetric Transition matrix (with 0s on the diagonal) added to</span>
<span class="sd">                ``keeper.misc[f&quot;transitions_sym_{similarity_key}&quot;]``.</span>
<span class="sd">           - transitions_i : The integrated transition, where the reference key, if not provided, is fused from the original labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">transition_keys</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">similarity_key</span> <span class="ow">in</span> <span class="n">similarity_keys</span><span class="p">:</span>
            <span class="n">T_sym_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transitions_sym_</span><span class="si">{</span><span class="n">similarity_key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">density_normalize</span><span class="p">:</span>
                <span class="n">T_sym_key</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">T_sym_key</span><span class="p">,</span> <span class="s2">&quot;density_normalized&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">T_sym_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_transitions_from_similarity</span><span class="p">(</span><span class="n">similarity_key</span><span class="p">,</span>
                                                         <span class="n">density_normalize</span><span class="p">)</span>
            <span class="n">transition_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T_sym_key</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">integrate_transitions</span><span class="p">(</span><span class="n">transition_keys</span><span class="p">,</span> <span class="n">integrated_key</span><span class="o">=</span><span class="n">integrated_key</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="Keeper.compute_multiscale_VNE_transition_from_similarity"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.compute_multiscale_VNE_transition_from_similarity">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_multiscale_VNE_transition_from_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_key</span><span class="p">,</span>
                                                          <span class="n">tau_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                          <span class="n">do_save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Compute the multi-scale transition matrix based on the elbow of the Von Neumann Entropy (VNE)</span>

<span class="sd">        as described in GSPA and PHATE https://github.com/KrishnaswamyLab/spARC/blob/main/SPARC/vne.py,</span>
<span class="sd">        https://pdfs.semanticscholar.org/16ab/e92b7630d5b84b904bde97dad9b9fbce406c.pdf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        similarity_key : `str`</span>
<span class="sd">            Reference key to the `numpy.ndarray`, (n_observations, n_observations)</span>
<span class="sd">            symmetric similarity measure (with 1s on the diagonal) stored in the similarities</span>
<span class="sd">            in the keeper.</span>
<span class="sd">        tau_max : `int`</span>
<span class="sd">            Max scale ``tau`` tested for VNE (default is 100).</span>
<span class="sd">        do_save : `bool`</span>
<span class="sd">            If `True`, save to ``keeper``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        P : `numpy.ndarray` (n_observations, n_observations)</span>
<span class="sd">            The symmetric VNE multi-scale transition matrix (with 0s on the diagonals).</span>
<span class="sd">            If ``do_save`` is `True`, ``P`` is added to the ``keeper.misc`` with the key ``&#39;transitions_sym_multiscaleVNE_{similarity_key}&#39;``</span>
<span class="sd">        P_asym : `numpy.ndarray` (n_observations, n_observations)</span>
<span class="sd">            The random-walk VNE multi-scale transition matrix (with 0s on the diagonals).</span>
<span class="sd">            If ``do_save`` is `True`, ``P_asym`` is added to the ``keeper.misc`` with the key ``&#39;transitions_multiscaleVNE_{similarity_key}&#39;``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P_sym_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transitions_sym_multiscaleVNE_</span><span class="si">{</span><span class="n">similarity_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">P_asym_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;transitions_multiscaleVNE_</span><span class="si">{</span><span class="n">similarity_key</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="n">P_sym_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span> <span class="ow">and</span> <span class="n">P_asym_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="n">P_sym_label</span><span class="p">]</span>
            <span class="n">P_asym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="n">P_asym_label</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span><span class="p">,</span> <span class="n">P_asym</span> <span class="o">=</span> <span class="n">nfo</span><span class="o">.</span><span class="n">compute_multiscale_VNE_transitions_from_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                                               <span class="n">similarity_key</span><span class="p">,</span>
                                                                               <span class="n">tau_max</span><span class="o">=</span><span class="n">tau_max</span><span class="p">,</span>
                                                                               <span class="n">do_save</span><span class="o">=</span><span class="n">do_save</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">P</span><span class="p">,</span> <span class="n">P_asym</span></div>
    
    
<div class="viewcode-block" id="Keeper.integrate_multiscale_VNE_transitions_from_similarities"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.integrate_multiscale_VNE_transitions_from_similarities">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">integrate_multiscale_VNE_transitions_from_similarities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">similarity_keys</span><span class="p">,</span>
                                                               <span class="n">tau_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                               <span class="n">integrated_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Integrate multi-scale transitions where scale is determined by elbow</span>
<span class="sd">        of Von Neumann Entropy (VNE)</span>

<span class="sd">        As described in https://pdfs.semanticscholar.org/16ab/e92b7630d5b84b904bde97dad9b9fbce406c.pdf.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        similarity_keys : `list`</span>
<span class="sd">            Reference keys of similarities to compute transitions and integrate.</span>
<span class="sd">        tau_max : `int`</span>
<span class="sd">            Max scale ``tau`` to test Von Neumann Entropy on (default is 100).</span>
<span class="sd">        integrated_key : `str`</span>
<span class="sd">            (Optional) Specify key used to store the integrated transitions into the keeper.</span>
<span class="sd">            Default behavior is to integrate the keys of the original transitions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The following is added to the similarity keeper :</span>

<span class="sd">          - integrated transition : The (symmetric) integrated multi-scale transition, where the reference key, if not provided, is fused from the original labels.</span>
<span class="sd">          - integrated asymmetric transition : The (asymmetric random-walk) integrated multi-scale transition, where the reference key, if not provided, is fused from the original labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">integrated_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># flabel = &#39;integrated_sym_VNE&#39; if use_affinity_diffusion_matrix else &#39;integrated_VNE&#39;</span>
            <span class="c1"># integrated_key = fuse_labels(similarity_keys).replace(&#39;fused&#39;, flabel)</span>
            <span class="n">integrated_key</span> <span class="o">=</span> <span class="n">fuse_labels</span><span class="p">(</span><span class="n">similarity_keys</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;fused&#39;</span><span class="p">,</span> <span class="s1">&#39;integrated_VNE&#39;</span><span class="p">)</span>

        <span class="n">P_sym_integrated_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sym_</span><span class="si">{</span><span class="n">integrated_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">P_asym_integrated_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;asym_</span><span class="si">{</span><span class="n">integrated_key</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">P_sym_integrated_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span> <span class="ow">and</span> <span class="n">P_asym_integrated_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">misc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Already computed </span><span class="si">{</span><span class="n">P_sym_integrated_label</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">P_asym_integrated_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
        

            <span class="n">p</span><span class="p">,</span> <span class="n">p_asym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_multiscale_VNE_transition_from_similarity</span><span class="p">(</span><span class="n">similarity_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                               <span class="n">tau_max</span><span class="o">=</span><span class="n">tau_max</span><span class="p">,</span>
                                                                               <span class="c1"># use_affinity_diffusion_matrix=use_affinity_diffusion_matrix,</span>
                                                                               <span class="n">do_save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">similarity_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">p_cur</span><span class="p">,</span> <span class="n">p_asym_cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_multiscale_VNE_transition_from_similarity</span><span class="p">(</span><span class="n">key</span><span class="p">,</span>
                                                                                           <span class="n">tau_max</span><span class="o">=</span><span class="n">tau_max</span><span class="p">,</span>

                                                                                           <span class="c1"># use_affinity_diffusion_matrix=use_affinity_diffusion_matrix,</span>
                                                                                           <span class="n">do_save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">@</span> <span class="n">p_cur</span>
                <span class="n">p_asym</span> <span class="o">=</span> <span class="n">p_asym</span> <span class="o">@</span> <span class="n">p_asym_cur</span>

            <span class="c1"># ensure symmetric</span>
            <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">p_asym</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_asym</span> <span class="o">+</span> <span class="n">p_asym</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_misc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">P_sym_integrated_label</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encountered error when adding </span><span class="si">{</span><span class="n">P_sym_integrated_label</span><span class="si">}</span><span class="s2">: </span><span class="se">\n</span><span class="s2"> .. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_misc</span><span class="p">(</span><span class="n">p_asym</span><span class="p">,</span> <span class="n">P_asym_integrated_label</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encountered error when adding </span><span class="si">{</span><span class="n">P_asym_integrated_label</span><span class="si">}</span><span class="s2">: </span><span class="se">\n</span><span class="s2"> .. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

        

<div class="viewcode-block" id="Keeper.construct_pose"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.construct_pose">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root_as_tip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">min_branch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">choose_largest_segment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">flavor</span><span class="o">=</span><span class="s1">&#39;haghverdi16&#39;</span><span class="p">,</span> <span class="n">allow_kendall_tau_shift</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">smooth_corr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">brute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">n_branches</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">until_branched</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mutual</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">k_mnn</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">connect_closest</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">connect_trunk</span><span class="o">=</span><span class="s1">&#39;classic&#39;</span><span class="p">,</span>
                       <span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="p">):</span>                
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Construct the POSE from specified distance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : `str`</span>
<span class="sd">            The label used to reference the distance matrix stored in ``keeper.distances``,</span>
<span class="sd">            of size (n_observations, n_observations).</span>
<span class="sd">        root : {`None`, `int`, &#39;density&#39;, &#39;density_inv&#39;, &#39;ratio&#39;}</span>
<span class="sd">            The root. If `None`, &#39;density&#39; is used.</span>

<span class="sd">            Options:</span>

<span class="sd">            - `int` : index of observation</span>
<span class="sd">            - &#39;density&#39; : select observation with minimal distance-density</span>
<span class="sd">            - &#39;density_inv&#39; : select observation with maximal distance-density</span>
<span class="sd">            - &#39;ratio&#39; : select observation which leads to maximal triangular ratio distance</span>
<span class="sd">        root_as_tip : `bool`</span>
<span class="sd">            If `True`, force first tip as the root.</span>
<span class="sd">            Defaults to `False` following scanpy implementation.</span>
<span class="sd">        min_branch_size : {`int`, `float`}</span>
<span class="sd">            During recursive splitting of branches, only consider splitting a branch with at least</span>
<span class="sd">            ``min_branch_size &gt; 2`` data points.</span>
<span class="sd">            If a `float`, ``min_branch_size`` refers to the fraction of the total number of data points</span>
<span class="sd">            (``0 &lt; min_branch_size &lt; 1``).</span>
<span class="sd">        choose_largest_segment : `bool`</span>
<span class="sd">            If `True`, select largest segment for branching.</span>
<span class="sd">        flavor : {&#39;haghverdi16&#39;, &#39;wolf17_tri&#39;, &#39;wolf17_bi&#39;, &#39;wolf17_bi_un&#39;}</span>
<span class="sd">            Branching algorithm (based on `scanpy` implementation).</span>
<span class="sd">        allow_kendall_tau_shift : `bool`</span>
<span class="sd">            If a very small branch is detected upon splitting, shift away from</span>
<span class="sd">            maximum correlation in Kendall tau criterion of [Haghverdi16]_ to</span>
<span class="sd">            stabilize the splitting.</span>
<span class="sd">        smooth_corr : `bool`, default = `False`</span>
<span class="sd">            If `True`, smooth correlations before identifying cut points for branch splitting.</span>
<span class="sd">        brute : `bool`</span>
<span class="sd">            If `True`, data points not associated with any branch upon split are combined with</span>
<span class="sd">            undecided (trunk) points. Otherwise, if `False`, they are treated as individual islands,</span>
<span class="sd">            not associated with any branch (and assigned branch index -1).</span>
<span class="sd">        split : `bool` (default = True)</span>
<span class="sd">                if `True`, split segment into multiple branches. Otherwise,</span>
<span class="sd">                determine a single branching off of the main segment.</span>
<span class="sd">                This is ignored if flavor is not &#39;haghverdi16&#39;.</span>
<span class="sd">                If `True`, ``brute`` is ignored.</span>
<span class="sd">        n_branches : `int`</span>
<span class="sd">            Number of branches to look for (``n_branches &gt; 0``).</span>
<span class="sd">        until_branched : `bool`</span>
<span class="sd">            If `True`, iteratively find segment to branch and perform branching</span>
<span class="sd">            until a segement is successfully branched or no branchable segments</span>
<span class="sd">            remain. Otherwise, if `False`, attempt to perform branching only once </span>
<span class="sd">            on the next potentially branchable segment.</span>
<span class="sd">            Note: This is only applicable when branching is being performed. If previous</span>
<span class="sd">            iterations of branching has already been performed, it is not possible to</span>
<span class="sd">            identify the number of iterations where no branching was performed.</span>
<span class="sd">        mutual : `bool` (default = `False`)</span>
<span class="sd">            If `True`, add ``k_mnn`` mutual nn edges. Otherwise, add single nn edge.</span>
<span class="sd">            When `False`, ``k_mnn`` is ignored.</span>
<span class="sd">        k_mnn : `int` (``0 &lt; k_mnn &lt; len(G)``)</span>
<span class="sd">            The number of nns to consider when extracting mutual nns.</span>
<span class="sd">            Note, this is ignored when ``mutual`` is `False`.</span>
<span class="sd">        connect_closest : `bool` (default = False)</span>
<span class="sd">            If `True`, connect branches by points with smallest distance between the branches.</span>
<span class="sd">            Otherwise, connect by continuum of ordering.</span>
<span class="sd">        connect_trunk : {&#39;classic&#39;, &#39;endpoint&#39;, &#39;dual&#39;}, default = &#39;classic&#39;</span>
<span class="sd">            Specify how to connect segments to unresolved/unidentified trunk.</span>
<span class="sd">            Note, this only applies when a split results in a trunk consisting of unresolved/unidentified points.</span>
<span class="sd">            Additionally, this is ignored if ``flavor ~= &#39;haghverdi16&#39;``.</span>
<span class="sd">            It is also ignored If ``flavor = `haghverdi16&#39;`` and ``split = False``.</span>

<span class="sd">            Options:</span>

<span class="sd">            - `classic` : point identified in trunk is connected to the point in the segment closest to it</span>
<span class="sd">            - `endpoint` : point identified in trunk is connected to the the segment&#39;s second tip</span>
<span class="sd">            - `dual` : point identified in trunk is connected to both points determined by `classic` and `endpoint`</span>
<span class="sd">        annotate : `bool`</span>
<span class="sd">            If `True`, annotate edges and nodes with POSE features. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        poser : `netflow.pose.POSER`</span>
<span class="sd">            The object used to construct the POSE.</span>
<span class="sd">        G_poser_nn : `networkx.Graph`</span>
<span class="sd">            The updated graph with nearest neighbor edges.</span>
<span class="sd">            If ``annotate`` is `True`, edge attribute &quot;edge_origin&quot;</span>
<span class="sd">            is added with the possible values :</span>

<span class="sd">            - &quot;POSE&quot; : for edges in the original graph that are not nearest neighbor edges</span>
<span class="sd">            - &quot;NN&quot; : for nearest neighbor edges that were not in the original graph</span>
<span class="sd">            - &quot;POSE + NN&quot; : for edges in the original graph that are also nearest neighbor edges</span>
<span class="sd">        &quot;&quot;&quot;</span>                
        <span class="n">poser</span> <span class="o">=</span> <span class="n">nfo</span><span class="o">.</span><span class="n">POSER</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">root_as_tip</span><span class="o">=</span><span class="n">root_as_tip</span><span class="p">,</span> <span class="n">min_branch_size</span><span class="o">=</span><span class="n">min_branch_size</span><span class="p">,</span>
                          <span class="n">choose_largest_segment</span><span class="o">=</span><span class="n">choose_largest_segment</span><span class="p">,</span>
                          <span class="n">connect_closest</span><span class="o">=</span><span class="n">connect_closest</span><span class="p">,</span> <span class="n">connect_trunk</span><span class="o">=</span><span class="n">connect_trunk</span><span class="p">,</span>
                          <span class="n">flavor</span><span class="o">=</span><span class="n">flavor</span><span class="p">,</span> <span class="n">allow_kendall_tau_shift</span><span class="o">=</span><span class="n">allow_kendall_tau_shift</span><span class="p">,</span>
                          <span class="n">smooth_corr</span><span class="o">=</span><span class="n">smooth_corr</span><span class="p">,</span> <span class="n">brute</span><span class="o">=</span><span class="n">brute</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="n">G_poser</span> <span class="o">=</span> <span class="n">poser</span><span class="o">.</span><span class="n">branchings_segments</span><span class="p">(</span><span class="n">n_branches</span><span class="p">,</span> <span class="n">until_branched</span><span class="o">=</span><span class="n">until_branched</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">)</span>
        <span class="n">G_poser_nn</span> <span class="o">=</span> <span class="n">poser</span><span class="o">.</span><span class="n">construct_pose_nn_topology</span><span class="p">(</span><span class="n">G_poser</span><span class="p">,</span> <span class="n">mutual</span><span class="o">=</span><span class="n">mutual</span><span class="p">,</span> <span class="n">k_mnn</span><span class="o">=</span><span class="n">k_mnn</span><span class="p">,</span> <span class="n">annotate</span><span class="o">=</span><span class="n">annotate</span><span class="p">)</span>

        <span class="c1"># label = [key]</span>
        <span class="c1"># if root is not None:</span>
        <span class="c1">#     label.append(f&quot;root_{root}&quot;)</span>
        <span class="c1"># label.append(f&quot;n_branches_{n_branches}&quot;)</span>
        <span class="c1"># label.append(f&quot;min_branch_size_{min_branch_size}&quot;)</span>
        <span class="c1"># if choose_largest_segment:</span>
        <span class="c1">#     label.append(&quot;choose_largest_segment&quot;)</span>
        <span class="c1"># label.append(f&quot;flavor_{flavor}&quot;)</span>
        <span class="c1"># if allow_kendall_tau_shift:</span>
        <span class="c1">#     label.append(&quot;allow_kendall_tau_shift&quot;)</span>
        <span class="c1"># if smooth_corr:</span>
        <span class="c1">#     label.append(&quot;smooth_corr&quot;)</span>
        <span class="c1"># if brute:</span>
        <span class="c1">#     label.append(&quot;brute&quot;)</span>
        <span class="c1"># if split:</span>
        <span class="c1">#     label.append(&quot;split&quot;)</span>
        <span class="c1"># if until_branched:</span>
        <span class="c1">#     label.append(&quot;until_branched&quot;)</span>
        <span class="c1"># label = &quot;_&quot;.join(label)</span>
        <span class="c1"># keeper.add_graph(G_poser_nn, &quot;POSE_{label}&quot;)</span>

        <span class="k">return</span> <span class="n">poser</span><span class="p">,</span> <span class="n">G_poser_nn</span></div>

<div class="viewcode-block" id="Keeper.PCA"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.PCA">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">PCA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Principle component analysis (PCA) decomposition.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : `str`</span>
<span class="sd">            The reference key of the data in the data-keeper that PCA decomposition</span>
<span class="sd">            will be performed on.</span>
<span class="sd">        n_components : {`None`, `int`}</span>
<span class="sd">            The number of principle components to keep.</span>
<span class="sd">            If `None`, all principle components are kept.</span>
<span class="sd">        random_state : {`None`, `int`}</span>
<span class="sd">            Random state used for certain solvers. Pass an `int` for reproducible results across runs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        PCA data with label &quot;{key}_PCA&quot; is added to the data keeper.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pca_obj</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">decomposition</span><span class="o">.</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">data_pca</span> <span class="o">=</span> <span class="n">pca_obj</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="n">data_pca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_pca</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;PC</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data_pca</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
                                <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data_pca</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_PCA&quot;</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="Keeper.log1p"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.log1p">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">log1p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Logarithmic data transformation.</span>

<span class="sd">        Computes :math:`data = \\log(data + 1)` with the natural logarithm as the default base.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : `str`</span>
<span class="sd">            The reference key of the data in the data-keeper that will be</span>
<span class="sd">            logarithmically transformed.</span>
<span class="sd">        base : {`None`, `int`}</span>
<span class="sd">            Base used for the logarithmic transformation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Logarithmically transformed data with label &quot;{key}_log1p&quot; is added to the data keeper.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">feature_labels</span><span class="p">[:]</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">[:]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">base</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_log1p&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Keeper.standardize"><a class="viewcode-back" href="../../../reference/generated/netflow.keepers.keeper.html#netflow.keepers.keeper.Keeper.standardize">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">standardize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Standardize features in DataKeeper by removing the mean and scaling to unit variance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : `str`</span>
<span class="sd">            The reference key of the data in the data-keeper that will be</span>
<span class="sd">            standardized.</span>
<span class="sd">        label : {`str`, `None`}</span>
<span class="sd">            The label used to store the standardized data. If `None`, default</span>
<span class="sd">            label ``f&#39;{key}_z&#39;`` is used.</span>
<span class="sd">        kwargs </span>
<span class="sd">          Keyword arguments passed to `sklearn.preprocessing.StandardScalar`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_z : `pandas.DataFrame`</span>
<span class="sd">            The standardized data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_z&quot;</span>

        <span class="n">data_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">standardize</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">data_z</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></div></div>
        

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../building/index.html">Installation</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../overview/index.html">User guide</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../tutorial/index.html">Tutorials</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../reference/index.html">API reference</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../../references.html">References</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2023-2025, The netflow community.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>