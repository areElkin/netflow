

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Multiple myeloma example &#8212; netflow v0.0.dev Manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/notebooks/MM_paper_example';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Multiple myeloma example" href="MM_example.html" />
    <link rel="prev" title="Load libraries" href="keeper_tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.0.dev" />
    <meta name="docbuild:last-update" content="Jul 25, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/NF_logo3.png" class="logo__image only-light" alt="netflow v0.0.dev Manual - Home"/>
    <img src="../../_static/NF_logo3.png" class="logo__image only-dark pst-js-only" alt="netflow v0.0.dev Manual - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../building/index.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../overview/index.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../references.html">
    References
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../building/index.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../overview/index.html">
    User guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../references.html">
    References
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="keeper_tutorial.html">Load libraries</a></li>












<li class="toctree-l1 current active"><a class="current reference internal" href="#">Multiple myeloma example</a></li>




<li class="toctree-l1"><a class="reference internal" href="MM_example.html">Multiple myeloma example</a></li>




<li class="toctree-l1"><a class="reference internal" href="BC_example.html">Breast cancer example</a></li>










<li class="toctree-l1"><a class="reference internal" href="GBM_multimodal_example.html">Glioblastoma multiforme multi-omics example</a></li>






</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item"><nav class="sidebar-indices-items" aria-labelledby="pst-indices-navigation-heading-2">
  <p id="pst-indices-navigation-heading-2" class="sidebar-indices-items__title" role="heading" aria-level="1">Indices</p>
  <ul class="indices-link">
        <li class="toctree-l1">
          <a class="reference internal"
             href="../../genindex.html"
             accesskey="I">General Index</a>
        </li>
        <li class="toctree-l1">
          <a class="reference internal" href="../../py-modindex.html">Python Module Index</a>
        </li>
  </ul>
</nav></div>
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Tutorials</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Multiple myeloma example</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="multiple-myeloma-example">
<h1>Multiple myeloma example<a class="headerlink" href="#multiple-myeloma-example" title="Permalink to this heading">#</a></h1>
</section>
<section id="pose-pipeline-overview">
<h1>POSE pipeline overview<a class="headerlink" href="#pose-pipeline-overview" title="Permalink to this heading">#</a></h1>
<p>(Single-modal) In this tutorial, we demonstrate how to perform the POSE pipeline on multiple myeloma (MM) RNA data restricted to the WEE1 neighborhood. For an extended tutorial detailing alternative computational options, see the <em>MM_example.ipynb</em> notebook. The analysis performed here entails the following:</p>
<ol class="arabic simple">
<li><p>Upload data</p></li>
<li><p>Compute pairwise sample (Euclidean) distances with respect to the WEE1 gene neigborhood.</p></li>
<li><p>Compute net pairwise sample (Euclidean) distance matrices</p></li>
<li><p>Convert net distances to a single sample pairwise similarity matrix</p></li>
<li><p>Compute (multi-scale / scale-free) diffusion distance from similirities</p></li>
<li><p>Compue the POSE from the DPT distances</p></li>
<li><p>Probe the POSE</p></li>
</ol>
<p>A more detailed description of the pipeline:</p>
<p><strong>Input</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X</span></code> : RNA-Seq data matrix</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">genelist</span></code> : list of gene(s) of interest in <code class="docutils literal notranslate"><span class="pre">X</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">G</span></code> : gene-gene (or protein-protein) interaction network</p></li>
</ul>
<p><strong>Algorithm</strong></p>
<ol class="arabic simple">
<li><p>Upload input data</p></li>
<li><p>Compute sample-pairwise distances with respect to 1-hop-neighborhoods:</p>
<ul class="simple">
<li><p>For each gene <code class="docutils literal notranslate"><span class="pre">g</span></code> in the <code class="docutils literal notranslate"><span class="pre">genelist</span></code>, compute $$d_{(g)}(i, j)$$ which is the distance of gene <code class="docutils literal notranslate"><span class="pre">g</span></code>’s 1-hop neighborhood (including self) between every two samples <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></li>
</ul>
</li>
<li><p>Compute net sample-pairwise distances:</p>
<ul class="simple">
<li><p>$$d(i,j) = |d_{(g)}(i, j)|$$ as the $L_1$ or $L_2$ norm of the vector of gene-1-hop-neighborhood distances for all genes <code class="docutils literal notranslate"><span class="pre">g</span></code> in the <code class="docutils literal notranslate"><span class="pre">genelist</span></code>.</p></li>
</ul>
</li>
<li><p>Convert net sample-pairwise distances to standardized similarities:</p>
<ul class="simple">
<li><p>$\sigma$ : Kernel width representing each data point’s accessible neighbors.</p></li>
<li><p>Set $\sigma$ normalization for each obs as the distance to its k-th neighbor : $$K_{ij}^{(d)} = \sqrt{\frac{2\sigma_i\sigma_j}{\sigma_i^2 + \sigma_j^2}}e^{-\frac{|d_{ij}^2|}{2(\sigma_i^2 + \sigma_j^2)}}$$
where for each observation $i$, $\sigma_i$ is the distance to its $k$-th nearest neighbor.</p></li>
</ul>
</li>
<li><p>Compute diffusion distance from similairites.</p></li>
<li><p>Compute POSE from diffusion distances.</p></li>
<li><p>Probing the POSE entails:</p>
<ol class="arabic simple">
<li><p>Perform BL-clustering on the final POSE</p></li>
<li><p>Visualization (interactive)</p></li>
</ol>
</li>
</ol>
<p><strong>Aknowledgement</strong></p>
<ul class="simple">
<li><p>The diffusion distance and pseudo-ordering is performed according to the diffusion pseudo-time (DPT) lineage tracing algorithm presented in Haghverdi, et al. (2019).</p></li>
<li><p>The code for computing the ordering is largely adopted from the scanpy implementation in Python.</p></li>
</ul>
<p>First, import the necessary packages:</p>
</section>
<section id="load-libraries">
<h1>Load libraries<a class="headerlink" href="#load-libraries" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">lifelines</span><span class="w"> </span><span class="kn">import</span> <span class="n">KaplanMeierFitter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_at_risk_counts</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lifelines.statistics</span><span class="w"> </span><span class="kn">import</span> <span class="n">logrank_test</span><span class="p">,</span> <span class="n">multivariate_logrank_test</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">netflow</span></code> has not been installed, add the path to the library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>From the <code class="docutils literal notranslate"><span class="pre">netflow</span></code> package, we load the following modules:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">InfoNet</span></code> class is used to compute 1-hop neighborhood distances</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Keeper</span></code> class is used to store and manipulate data/results</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">netflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">netflow.probe.clustering</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nfc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">netflow.probe.visualization</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nfv</span>
</pre></div>
</div>
</div>
</div>
<p><strong>A brief note on Keepers:</strong></p>
<p>NetFlow’s data structure is called a <code class="docutils literal notranslate"><span class="pre">Keeper</span></code>. The <code class="docutils literal notranslate"><span class="pre">Keeper</span></code>, among other features, stores the feature data, sample-pairwise distances, sample-pairwise similarities, graphs, and miscellaneous data. The <code class="docutils literal notranslate"><span class="pre">Keeper</span></code> has sub-keepers specific to the type of data:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataKeeper</span></code></p>
<ul>
<li><p>Stores features datasets where rows are features and columns are samples</p></li>
<li><p>All datasets in the global Keeper are expected to have the same samples</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DistanceKeeper</span></code></p>
<ul>
<li><p>Stores sample-pairwise distances</p></li>
<li><p>All distances in the global Keeper are expected to have the same samples</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SimilarityKeeper</span></code></p>
<ul>
<li><p>Stores sample-pairwise similarities</p></li>
<li><p>All similarities in the global Keeper are expected to have the same samples</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GraphKeeper</span></code></p>
<ul>
<li><p>Stores graphs. Can be feature graphs or sample graphs - no checks or requirements are enforced.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">misc</span></code></p>
<ul>
<li><p>A dictionary to store miscellaneous data or results that don’t directly fit into any of the previous sub-keepers</p></li>
</ul>
</li>
</ul>
<p>To load the data into the <code class="docutils literal notranslate"><span class="pre">Keeper</span></code>, you can first load the data into your workspace and then add it to the <code class="docutils literal notranslate"><span class="pre">Keeper</span></code>. I find it easier, and useful for repeating any analysis, to save the data so that it can be directly upload into the <code class="docutils literal notranslate"><span class="pre">Keeper</span></code> from the file. (Future versions of NetFlow will support more options for loading from file. Currently, the easiest is to save feature/distance/similarity data in a form that can be loaded by <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, and to save graphs in the form of an edgelist with columns labelled <code class="docutils literal notranslate"><span class="pre">'source'</span></code> and <code class="docutils literal notranslate"><span class="pre">'target'</span></code></p>
</section>
<section id="directories">
<h1>Directories<a class="headerlink" href="#directories" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MAIN_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="o">/</span> <span class="s1">&#39;example_data&#39;</span> <span class="o">/</span> <span class="s1">&#39;MM&#39;</span> 
<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">MAIN_DIR</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RNA_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;rna_full.csv&#39;</span>
<span class="n">E_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;edgelist_HPRD.csv&#39;</span>
<span class="n">CLIN_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;clin_full.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We first make a directory to save netflow results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RESULTS_DIR</span> <span class="o">=</span> <span class="n">MAIN_DIR</span> <span class="o">/</span> <span class="s1">&#39;netflow_results&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">RESULTS_DIR</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">RESULTS_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="netflow-pipeline">
<h1>NetFlow pipeline<a class="headerlink" href="#netflow-pipeline" title="Permalink to this heading">#</a></h1>
<p>Before starting the NetFlow pipeline, we initialize the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> with the NetFlow results output directory:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span> <span class="o">=</span> <span class="n">nf</span><span class="o">.</span><span class="n">Keeper</span><span class="p">(</span><span class="n">outdir</span><span class="o">=</span><span class="n">RESULTS_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="step-1-load-data">
<h2>Step 1: Load data<a class="headerlink" href="#step-1-load-data" title="Permalink to this heading">#</a></h2>
<p>Next, we load the data into the keeper:</p>
<section id="load-the-clinical-data">
<h3>Load the clinical data<a class="headerlink" href="#load-the-clinical-data" title="Permalink to this heading">#</a></h3>
<p>Note: default NetFlow format for loading and storing feature data in the <code class="docutils literal notranslate"><span class="pre">Keeper</span></code> expects the data to be formatted with samples (a.k.a. observations) as columns and features as rows. However, the clinical data was saved with the transpose format (i.e., with features as columns and samples as rows). We specify this by setting the argument <code class="docutils literal notranslate"><span class="pre">cols_as_obs=False</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">CLIN_FNAME</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;clin&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols_as_obs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The clinical data is now stored in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code>’s <code class="docutils literal notranslate"><span class="pre">DataKeeper</span></code> and can be referenced with the key <code class="docutils literal notranslate"><span class="pre">'clin'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;clin&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;netflow.keepers.keeper.DataView at 0x7fdf99cf46a0&gt;
</pre></div>
</div>
</div>
</div>
<p>This returns the <code class="docutils literal notranslate"><span class="pre">DataView</span></code>. You can look into the code to see the different capabilities of the <code class="docutils literal notranslate"><span class="pre">DataView</span></code> class. In this tutorial I’ll demonstrate the main usage of the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> and its <code class="docutils literal notranslate"><span class="pre">subkeeper</span></code> classes that you will likely be interested in:</p>
<p>The first usage is to extract a feature dataset from the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> as a <code class="docutils literal notranslate"><span class="pre">pandas</span> <span class="pre">DataFrame</span></code>, with the <code class="docutils literal notranslate"><span class="pre">.to_frame()</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clin</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;clin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">clin</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MMRF_1021_1_BM_CD138pos</th>
      <th>MMRF_1029_1_BM_CD138pos</th>
      <th>MMRF_1030_1_BM_CD138pos</th>
      <th>MMRF_1031_1_BM_CD138pos</th>
      <th>MMRF_1032_1_BM_CD138pos</th>
      <th>MMRF_1033_1_BM_CD138pos</th>
      <th>MMRF_1037_1_BM_CD138pos</th>
      <th>MMRF_1048_1_BM_CD138pos</th>
      <th>MMRF_1068_1_BM_CD138pos</th>
      <th>MMRF_1073_1_BM_CD138pos</th>
      <th>...</th>
      <th>MMRF_2829_1_BM_CD138pos</th>
      <th>MMRF_2830_1_BM_CD138pos</th>
      <th>MMRF_2831_1_BM_CD138pos</th>
      <th>MMRF_2832_1_BM_CD138pos</th>
      <th>MMRF_2834_1_BM_CD138pos</th>
      <th>MMRF_2836_1_BM_CD138pos</th>
      <th>MMRF_2847_1_BM_CD138pos</th>
      <th>MMRF_2848_1_BM_CD138pos</th>
      <th>MMRF_2851_1_BM_CD138pos</th>
      <th>MMRF_2853_1_BM_CD138pos</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>T</th>
      <td>1.706849</td>
      <td>2.726027</td>
      <td>5.435616</td>
      <td>3.641096</td>
      <td>2.487671</td>
      <td>0.59726</td>
      <td>0.263014</td>
      <td>4.849315</td>
      <td>1.427397</td>
      <td>7.380822</td>
      <td>...</td>
      <td>0.575342</td>
      <td>0.391781</td>
      <td>0.471233</td>
      <td>0.156164</td>
      <td>0.331507</td>
      <td>0.383562</td>
      <td>0.158904</td>
      <td>0.413699</td>
      <td>0.432877</td>
      <td>0.156164</td>
    </tr>
    <tr>
      <th>E</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>label</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>label_str</th>
      <td>middle risk</td>
      <td>lower risk</td>
      <td>lower risk</td>
      <td>higher risk</td>
      <td>middle risk</td>
      <td>lower risk</td>
      <td>lower risk</td>
      <td>middle risk</td>
      <td>middle risk</td>
      <td>lower risk</td>
      <td>...</td>
      <td>middle risk</td>
      <td>lower risk</td>
      <td>higher risk</td>
      <td>lower risk</td>
      <td>middle risk</td>
      <td>higher risk</td>
      <td>higher risk</td>
      <td>middle risk</td>
      <td>higher risk</td>
      <td>middle risk</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 659 columns</p>
</div></div></div>
</div>
</section>
<section id="load-the-rna-data">
<h3>Load the RNA data:<a class="headerlink" href="#load-the-rna-data" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">RNA_FNAME</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RNA&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Similarly, the RNA data is also now stored in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code>’s <code class="docutils literal notranslate"><span class="pre">DataKeeper</span></code> and can be referenced with the key <code class="docutils literal notranslate"><span class="pre">'RNA'</span></code></p>
<p>The RNA dataset can be extracted from the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> in the same way as previously done for the clinical data, using the key <code class="docutils literal notranslate"><span class="pre">'RNA'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RNA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MMRF_1021_1_BM_CD138pos</th>
      <th>MMRF_1029_1_BM_CD138pos</th>
      <th>MMRF_1030_1_BM_CD138pos</th>
      <th>MMRF_1031_1_BM_CD138pos</th>
      <th>MMRF_1032_1_BM_CD138pos</th>
      <th>MMRF_1033_1_BM_CD138pos</th>
      <th>MMRF_1037_1_BM_CD138pos</th>
      <th>MMRF_1048_1_BM_CD138pos</th>
      <th>MMRF_1068_1_BM_CD138pos</th>
      <th>MMRF_1073_1_BM_CD138pos</th>
      <th>...</th>
      <th>MMRF_2829_1_BM_CD138pos</th>
      <th>MMRF_2830_1_BM_CD138pos</th>
      <th>MMRF_2831_1_BM_CD138pos</th>
      <th>MMRF_2832_1_BM_CD138pos</th>
      <th>MMRF_2834_1_BM_CD138pos</th>
      <th>MMRF_2836_1_BM_CD138pos</th>
      <th>MMRF_2847_1_BM_CD138pos</th>
      <th>MMRF_2848_1_BM_CD138pos</th>
      <th>MMRF_2851_1_BM_CD138pos</th>
      <th>MMRF_2853_1_BM_CD138pos</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A1CF</th>
      <td>0.060523</td>
      <td>0.071149</td>
      <td>0.013625</td>
      <td>0.018527</td>
      <td>0.012452</td>
      <td>0.034835</td>
      <td>0.000000</td>
      <td>0.010645</td>
      <td>0.063212</td>
      <td>0.036705</td>
      <td>...</td>
      <td>0.232524</td>
      <td>0.033547</td>
      <td>0.069779</td>
      <td>0.025636</td>
      <td>0.000000</td>
      <td>0.059870</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.004791</td>
      <td>0.004934</td>
    </tr>
    <tr>
      <th>A2M</th>
      <td>2.606094</td>
      <td>3.318758</td>
      <td>3.592433</td>
      <td>0.256151</td>
      <td>4.925435</td>
      <td>2.071656</td>
      <td>2.972069</td>
      <td>0.235788</td>
      <td>0.861647</td>
      <td>0.614808</td>
      <td>...</td>
      <td>0.058550</td>
      <td>0.066230</td>
      <td>3.190138</td>
      <td>0.301965</td>
      <td>2.318094</td>
      <td>0.887388</td>
      <td>2.302761</td>
      <td>0.674839</td>
      <td>2.241157</td>
      <td>0.023649</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 659 columns</p>
</div></div></div>
</div>
<p>To see the labels of all feature datasets stored in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;clin&#39;, &#39;RNA&#39;])
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-the-feature-graph">
<h3>Load the feature graph<a class="headerlink" href="#load-the-feature-graph" title="Permalink to this heading">#</a></h3>
<p>Since the feature graph corresponds the RNA data, where each node in the graph corresponds to a gene in the RNA dataset, we use the label of the feature dataset for the graph as well, and set <code class="docutils literal notranslate"><span class="pre">label='RNA'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">load_graph</span><span class="p">(</span><span class="n">E_FNAME</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RNA&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The graph can then be accessed from the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> referenced by the key <code class="docutils literal notranslate"><span class="pre">'RNA'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;RNA&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Graph named &#39;RNA&#39; with 8427 nodes and 33695 edges
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="step-2-compute-sample-pairwise-distances-on-the-wee1-neighborhood">
<h2>Step 2: Compute sample-pairwise distances on the WEE1 neighborhood:<a class="headerlink" href="#step-2-compute-sample-pairwise-distances-on-the-wee1-neighborhood" title="Permalink to this heading">#</a></h2>
<p>For any feature, we can compute distances, such as Wasserstein and Euclidean, between feature neighborhood profiles of every two observations.</p>
<p>Here’s a description of the arguments for computing distances over a neighborhood:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data_key</span></code>: the reference label of the feature dataset stored in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> that should be used to extract the feature profiles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">graph_key</span></code>: the reference label of the feature graph stored in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> that should be used to determine the feature neighborhoods</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">features</span></code> : a list of features for which the neighborhood distances should be computed.</p>
<ul>
<li><p>The distances are computed over the neighborhood of each feature in the list independently, and stored in <code class="docutils literal notranslate"><span class="pre">keeper.misc</span></code>.</p></li>
<li><p>Here, we only consider the WEE1 neighborhood, but alternative or additional genes could be added to this list.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">include_self</span></code>: specify if the feature itself should be included in the neighborhood profile.</p>
<ul>
<li><p>When computing transition probabilities, the weight of the feature itself ends up being excluded via the mass-action principle. When interested in the transition probabilities, set <code class="docutils literal notranslate"><span class="pre">include_self</span> <span class="pre">=</span> <span class="pre">False</span></code>. Otherwise, if interested in the distance between normalized profiles over the neighborhood, set <code class="docutils literal notranslate"><span class="pre">include_self</span> <span class="pre">=</span> <span class="pre">True</span></code>.</p></li>
<li><p>To take the mass-action approach when computing the Wasserstein distance, this should be set to <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
</ul>
</li>
</ul>
<p>For additional argument options, see the documentation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_key</span> <span class="o">=</span> <span class="s1">&#39;RNA&#39;</span>
<span class="n">graph_key</span> <span class="o">=</span> <span class="s1">&#39;RNA&#39;</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WEE1&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we compute the Euclidean distance between feature neighborhoods:</p>
<p>The Euclidean metric is specified by the attribute <code class="docutils literal notranslate"><span class="pre">metric</span></code>.
Any metric that can be passed to scipy.spatial.distance.cdist is acceptable. If no metric is specified, the default behavior is to use <code class="docutils literal notranslate"><span class="pre">'euclidean'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">euc_distance_pairwise_observation_feature_nbhd</span><span class="p">(</span><span class="n">data_key</span><span class="p">,</span> <span class="n">graph_key</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span> <span class="n">include_self</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">netflow.methods.classes: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">07</span>/<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">24</span>/<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2025</span> <span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">10:54:43</span>  AM | <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">MSG</span> |                                                           
classes:multiple_pairwise_observation_neighborhood_euc_distan<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">ce:928</span> | &gt;&gt;&gt; Loaded saved observation pairwise <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>-hop  
neighborhood Euclidean distances from RNA_nbhd_euc_with_self profiles of size <span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">216811</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span><span style="font-weight: bold">)</span>.                         
</pre>
</div></div>
</div>
<p>Note: If the <code class="docutils literal notranslate"><span class="pre">keeper</span></code> is instantiated with an output directory (<code class="docutils literal notranslate"><span class="pre">outdir</span></code>), the default behavior is to save the computed distances.</p>
<p>Any future computation with a <code class="docutils literal notranslate"><span class="pre">keeper</span></code> instantiated with the same output directory will first try to load these distances before recomputing.
Be sure to change the output directory (<code class="docutils literal notranslate"><span class="pre">outdir</span></code>) if the samples or features change, or if you want to recompute the distances.</p>
<p>As a result, the sample-pairwise (Euclidean) distances with respect to 1-hop neighborhoods for each feature provided in <code class="docutils literal notranslate"><span class="pre">features</span></code> is stored in <code class="docutils literal notranslate"><span class="pre">keeper.misc</span></code> keyed by <code class="docutils literal notranslate"><span class="pre">f&quot;{data_key}_{label}_nbhd_euc_with{''</span> <span class="pre">if</span> <span class="pre">include_self</span> <span class="pre">else</span> <span class="pre">'out'}_self&quot;</span></code>. The distances are stored in a stacked format as a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> where column(s) are labeled by the features (in <code class="docutils literal notranslate"><span class="pre">features</span></code>) and the 2-multi-index indicate the labels of the observation between which the distance was computed.</p>
<p>We can see the Euclidean feature neighborhood distances have been added to <code class="docutils literal notranslate"><span class="pre">keeper.misc</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;RNA_nbhd_euc_with_self&#39;])
</pre></div>
</div>
</div>
</div>
<p>And we can extract the computed distances as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s1">_nbhd_euc_with_self&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>WEE1</th>
    </tr>
    <tr>
      <th>observation_a</th>
      <th>observation_b</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">MMRF_1021_1_BM_CD138pos</th>
      <th>MMRF_1029_1_BM_CD138pos</th>
      <td>3.138194</td>
    </tr>
    <tr>
      <th>MMRF_1030_1_BM_CD138pos</th>
      <td>3.758586</td>
    </tr>
    <tr>
      <th>MMRF_1031_1_BM_CD138pos</th>
      <td>4.294601</td>
    </tr>
    <tr>
      <th>MMRF_1032_1_BM_CD138pos</th>
      <td>2.474873</td>
    </tr>
    <tr>
      <th>MMRF_1033_1_BM_CD138pos</th>
      <td>4.484517</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">MMRF_2847_1_BM_CD138pos</th>
      <th>MMRF_2851_1_BM_CD138pos</th>
      <td>4.353974</td>
    </tr>
    <tr>
      <th>MMRF_2853_1_BM_CD138pos</th>
      <td>6.715387</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">MMRF_2848_1_BM_CD138pos</th>
      <th>MMRF_2851_1_BM_CD138pos</th>
      <td>3.539159</td>
    </tr>
    <tr>
      <th>MMRF_2853_1_BM_CD138pos</th>
      <td>5.374954</td>
    </tr>
    <tr>
      <th>MMRF_2851_1_BM_CD138pos</th>
      <th>MMRF_2853_1_BM_CD138pos</th>
      <td>6.097771</td>
    </tr>
  </tbody>
</table>
<p>216811 rows × 1 columns</p>
</div></div></div>
</div>
</section>
<section id="step-3-extract-net-neighborhood-distances">
<h2>Step 3: Extract net neighborhood distances<a class="headerlink" href="#step-3-extract-net-neighborhood-distances" title="Permalink to this heading">#</a></h2>
<section id="distance-from-a-single-feature-neighborhood">
<h3>Distance from a single feature neighborhood<a class="headerlink" href="#distance-from-a-single-feature-neighborhood" title="Permalink to this heading">#</a></h3>
<p>If we are interested in the distances with respect to a single feature neighborhood, as we are here (WEE1), we can extract the stacked-distance format from <code class="docutils literal notranslate"><span class="pre">keeper.misc</span></code> and add it to the distances in <code class="docutils literal notranslate"><span class="pre">keeper.distances</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">misc_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_key</span><span class="si">}</span><span class="s1">_nbhd_euc_with_self&#39;</span>

<span class="n">keeper</span><span class="o">.</span><span class="n">add_stacked_distance</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="n">misc_key</span><span class="p">][</span><span class="s1">&#39;WEE1&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">misc_key</span><span class="o">+</span><span class="s1">&#39;_WEE1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now see this distance has been added to <code class="docutils literal notranslate"><span class="pre">keeper.distances</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;RNA_nbhd_euc_with_self_WEE1&#39;])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="step-4-compute-similarities-from-distances">
<h2>Step 4: Compute similarities from distances<a class="headerlink" href="#step-4-compute-similarities-from-distances" title="Permalink to this heading">#</a></h2>
<p>Next, we convert the distance to a similarity. (to fuse multiple similarities, see the documentation)</p>
<p>Following the DPT approach, we use the individual sample-controlled normalization. We specify the number of nearest-neighbor samples to be considered in the computation by <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code>. See the documentation for a description of other arguments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">12</span>
</pre></div>
</div>
</div>
</div>
<p>To compute the similarity for each of the computed distances, we iterate through the distances stored in <code class="docutils literal notranslate"><span class="pre">keeper.distances</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">distances</span><span class="p">:</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">compute_similarity_from_distance</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>                                                    
                                            <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can see that two similarities have been added to <code class="docutils literal notranslate"><span class="pre">keeper.similarities</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">similarities</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;similarity_max12nn_RNA_nbhd_euc_with_self_WEE1&#39;])
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-5-compute-diffusion-distances">
<h2>Step 5: Compute diffusion distances<a class="headerlink" href="#step-5-compute-diffusion-distances" title="Permalink to this heading">#</a></h2>
<p>Next we show how to compute the scale-free DPT distance from a similarity. This entails computing the transition matrix associated with the similarity which is stored in the misc keeper, keyed by <code class="docutils literal notranslate"><span class="pre">f&quot;transitions_sym_{s.label}&quot;</span></code> (<code class="docutils literal notranslate"><span class="pre">s</span></code> refers to the similarity view (i.e., keeper.DistanceView), as used below).</p>
<p>To compute the diffusion distance for each similarity, we simply loop through the similarities stored in the keeper. See the documentation for a description of additional options.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">similarities</span><span class="p">:</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">compute_dpt_from_similarity</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">density_normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that the multi-scale distances have been added to the <code class="docutils literal notranslate"><span class="pre">keeper</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">keeper</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RNA_nbhd_euc_with_self_WEE1
dpt_from_transitions_sym_similarity_max12nn_RNA_nbhd_euc_with_self_WEE1_density_normalized
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-6-compute-the-pose">
<h2>Step 6: Compute the POSE<a class="headerlink" href="#step-6-compute-the-pose" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">POSER</span></code> class is used to perform the iterative branching and keep track the branches and their splits.
The final <strong>POSE</strong>, i.e., the <strong>P</strong>seudo-<strong>O</strong>rganizational <strong>S</strong>tructur<strong>E</strong> of the observations is returned as a graph where each observation is represented as a node. The edges show the organizational relationship determined from the ordering (lineage tracing algorithm), called the <em>backbone</em> and nearest neighbors (alleviates strict assumptions of lineage tracing that do not apply and provides local affinity information).</p>
<p>Computing the pseudo-ordering <em>backbone</em> entails iteratively branching the data <code class="docutils literal notranslate"><span class="pre">n_branches</span></code> times, where <code class="docutils literal notranslate"><span class="pre">n_branches</span></code> is specified by the user.</p>
<p>See documentation for a description of other arguments. Here, I select my go-to settings.</p>
<p>We compute the POSE as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mutual</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">k_mnn</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">n_branches</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;dpt_from_transitions_sym_similarity_max12nn_RNA_nbhd_euc_with_self_WEE1_density_normalized&#39;</span>

<span class="n">poser</span><span class="p">,</span> <span class="n">G_pose</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">construct_pose</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">n_branches</span><span class="o">=</span><span class="n">n_branches</span><span class="p">,</span>
                                          <span class="n">min_branch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                          <span class="n">mutual</span><span class="o">=</span><span class="n">mutual</span><span class="p">,</span> <span class="n">k_mnn</span><span class="o">=</span><span class="n">k_mnn</span><span class="p">,</span>
                                          <span class="n">until_branched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;ERROR&#39;</span><span class="p">,</span> 
                                          <span class="n">root</span><span class="o">=</span><span class="s1">&#39;density_inv&#39;</span><span class="p">,</span> <span class="n">root_as_tip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">g_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;POSE_</span><span class="si">{</span><span class="n">k_mnn</span><span class="si">}</span><span class="s2">kmnn_</span><span class="si">{</span><span class="n">n_branches</span><span class="si">}</span><span class="s2">branches_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>    
<span class="nb">print</span><span class="p">(</span><span class="n">g_name</span><span class="p">)</span>
<span class="n">G_pose</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">g_name</span> 
<span class="c1"># add the POSE graph to the keeper:</span>
<span class="n">keeper</span><span class="o">.</span><span class="n">add_graph</span><span class="p">(</span><span class="n">G_pose</span><span class="p">,</span> <span class="n">G_pose</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>POSE_1kmnn_3branches_dpt_from_transitions_sym_similarity_max12nn_RNA_nbhd_euc_with_self_WEE1_density_normalized
</pre></div>
</div>
</div>
</div>
<p>We briefly go over some of the main arguments for consideration when computing the pose:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">root</span></code> : You can specify which observation should be used as the root or the method to select the root.
The default is to set the root as the central observation, determined as the observation with the smallest
average distance to all other observations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_branch_size</span></code> : The minimum number of observations a branch must have to be considered for branching
during the recursive branching procedure.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split</span></code> : If <code class="docutils literal notranslate"><span class="pre">True</span></code>, a branch is split according to its three tips. Otherwise, split the branch by determining
a single branching off the main segment with respect to the tip farthest from the root.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">n_branches</span></code> : The number of times to iteratively perform the branching, unless the process terminates earlier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">until_branched</span></code> : This is intended for compatibility with the <code class="docutils literal notranslate"><span class="pre">scanpy</span></code> implementation, where branching is
iteratively attempted <code class="docutils literal notranslate"><span class="pre">n_branches</span></code> times. However, some iterations may not result in any further branching
(e.g., if no split is found). We add the option (by setting <code class="docutils literal notranslate"><span class="pre">until_branched</span> <span class="pre">=</span> <span class="pre">True</span></code>) so that such iterations
that do not result in further branching do not count toward the number of iterations performed. Thus, when <code class="docutils literal notranslate"><span class="pre">until_branched</span> <span class="pre">=</span> <span class="pre">True</span></code>,
the iteration does not terminate until either a branch has been split or the process terminates.</p></li>
</ul>
<p>See the documentation for a description of all possible arguments.</p>
<p><strong>Note:</strong> here, we have computed the POSE with respect to the scale-free diffusion distance that was computed. In general, it can be computed with respect to any distance in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code>.</p>
</section>
<section id="step-7-probe-the-pose">
<h2>Step 7: Probe the POSE<a class="headerlink" href="#step-7-probe-the-pose" title="Permalink to this heading">#</a></h2>
<p>The topology of the POSE is return as <code class="docutils literal notranslate"><span class="pre">G_pose</span></code>.</p>
<p>We highlight some of the node and edge attributes</p>
<p><strong>Node attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'branch'</span></code> : Reference ID of the branch the observation belongs to.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'name'</span></code> : Label of the observation the node corresponds to.</p></li>
</ul>
<p><strong>Edge attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'connection</span></code>’ : Takes one of the following values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'intra-branch'</span></code> if the edge connects two observations in the same branch and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'inter-branch'</span></code> if the edge connects two observations in different branches.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'distance'</span></code> :</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'edge_origin'</span></code> : Takes one of the following values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'POSE</span> <span class="pre">+</span> <span class="pre">NN'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'POSE'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'NN'</span></code></p></li>
</ul>
</li>
</ul>
<section id="bl-clustering">
<h3>BL-clustering<a class="headerlink" href="#bl-clustering" title="Permalink to this heading">#</a></h3>
<p>We perform BL-clustering on each POSE (with Louvain resolution = 0.1) as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pose_key</span> <span class="o">=</span> <span class="s1">&#39;POSE_1kmnn_3branches_dpt_from_transitions_sym_similarity_max12nn_RNA_nbhd_euc_with_self_WEE1_density_normalized&#39;</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="n">pose_key</span><span class="p">]</span>

<span class="n">nfc</span><span class="o">.</span><span class="n">louvain_paritioned</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;branch&#39;</span><span class="p">,</span> <span class="n">louvain_attr</span><span class="o">=</span><span class="s2">&quot;louvain0x1&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now see the attributes</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'louvain0x1'</span></code>: Cluster index from the Louvain clustering with resolution = 0.1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'branch-louvain0x1'</span></code>: BL-cluster index (of the form <code class="docutils literal notranslate"><span class="pre">i-j</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span></code> indicates the reference branch and <code class="docutils literal notranslate"><span class="pre">j</span></code> indicates the reference Louvain cluster</p></li>
</ul>
<p>have been added to the POSE based on the WEE1-neighborhood as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;POSE_1kmnn_3branches_dpt_from_transitions_sym_similarity_max12nn_RNA_nbhd_euc_with_self_WEE1_density_normalized&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;branch&#39;: 4,
 &#39;undecided&#39;: True,
 &#39;name&#39;: &#39;MMRF_1021_1_BM_CD138pos&#39;,
 &#39;unidentified&#39;: 1,
 &#39;is_root&#39;: &#39;No&#39;,
 &#39;pseudo-distance from root&#39;: 0.7780698011805295,
 &#39;louvain0x1&#39;: 3,
 &#39;branch-louvain0x1&#39;: &#39;4-3&#39;}
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="step-8-visualizing-the-pose">
<h2>Step 8: Visualizing the POSE<a class="headerlink" href="#step-8-visualizing-the-pose" title="Permalink to this heading">#</a></h2>
<section id="interactive-visualization">
<h3>Interactive visualization<a class="headerlink" href="#interactive-visualization" title="Permalink to this heading">#</a></h3>
<p>To start the interactive POSE visualization dashboard, we specify the key for the POSE graph as referenced in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code>, and the key for the distance the POSE was computed off of, as stored in the <code class="docutils literal notranslate"><span class="pre">keeper</span></code>.</p>
<p><strong>Note:</strong> You can switch to view other POSEs after the dashboard is initialized.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distance_key</span> <span class="o">=</span> <span class="s1">&#39;dpt_from_transitions_sym_similarity_max12nn_RNA_nbhd_euc_with_self_WEE1_density_normalized&#39;</span>
<span class="n">pose_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;POSE_1kmnn_3branches_</span><span class="si">{</span><span class="n">distance_key</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">nf</span><span class="o">.</span><span class="n">render_pose</span><span class="p">(</span><span class="n">keeper</span><span class="p">,</span> <span class="n">pose_key</span><span class="p">,</span> <span class="n">distance_key</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">1784</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="100%"
            height="650"
            src="http://127.0.0.1:1784/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<section id="kaplan-meier-survival-analysis-from-selected-samples">
<h4>Kaplan-Meier Survival analysis from selected samples<a class="headerlink" href="#kaplan-meier-survival-analysis-from-selected-samples" title="Permalink to this heading">#</a></h4>
<p>Extract the survival time and event from the keeper:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clin</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;clin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selected</span> <span class="o">=</span> <span class="s1">&#39;MMRF_2828_1_BM_CD138pos, MMRF_1580_1_BM_CD138pos, MMRF_1089_1_BM_CD138pos, MMRF_1927_1_BM_CD138pos, MMRF_1835_1_BM_CD138pos, MMRF_1499_1_BM_CD138pos, MMRF_1715_1_BM_CD138pos, MMRF_2667_1_BM_CD138pos, MMRF_2739_1_BM_CD138pos, MMRF_2394_1_BM_CD138pos, MMRF_2041_1_BM_CD138pos, MMRF_2681_1_BM_CD138pos, MMRF_1700_1_BM_CD138pos, MMRF_2535_1_BM_CD138pos, MMRF_1401_1_BM_CD138pos, MMRF_2818_1_BM_CD138pos, MMRF_2718_1_BM_CD138pos, MMRF_2476_1_BM_CD138pos, MMRF_1539_1_BM_CD138pos, MMRF_1831_1_BM_CD138pos, MMRF_2587_1_BM_CD138pos, MMRF_2200_1_BM_CD138pos, MMRF_1918_1_BM_CD138pos, MMRF_2532_1_BM_CD138pos, MMRF_2194_1_BM_CD138pos, MMRF_2015_1_BM_CD138pos, MMRF_1780_1_BM_CD138pos, MMRF_1641_1_BM_CD138pos, MMRF_2471_1_BM_CD138pos, MMRF_2621_1_BM_CD138pos, MMRF_1338_1_BM_CD138pos, MMRF_2754_1_BM_CD138pos, MMRF_2568_1_BM_CD138pos, MMRF_2225_1_BM_CD138pos, MMRF_1586_1_BM_CD138pos, MMRF_2639_1_BM_CD138pos, MMRF_1992_1_BM_CD138pos, MMRF_1683_1_BM_CD138pos, MMRF_2473_1_BM_CD138pos, MMRF_1541_1_BM_CD138pos, MMRF_1328_1_BM_CD138pos, MMRF_1617_1_BM_CD138pos, MMRF_2801_1_BM_CD138pos, MMRF_2776_1_BM_CD138pos, MMRF_1164_1_BM_CD138pos, MMRF_2452_1_BM_CD138pos, MMRF_2368_1_BM_CD138pos, MMRF_2813_1_BM_CD138pos, MMRF_1627_1_BM_CD138pos, MMRF_1851_1_BM_CD138pos, MMRF_1403_1_BM_CD138pos, MMRF_1677_1_BM_CD138pos, MMRF_1805_1_BM_CD138pos, MMRF_1359_1_BM_CD138pos, MMRF_2847_1_BM_CD138pos, MMRF_2076_1_BM_CD138pos, MMRF_1167_1_BM_CD138pos, MMRF_2272_1_BM_CD138pos, MMRF_1451_1_BM_CD138pos, MMRF_2401_1_BM_CD138pos, MMRF_2531_1_BM_CD138pos, MMRF_2692_1_BM_CD138pos, MMRF_1790_1_BM_CD138pos, MMRF_1819_1_BM_CD138pos, MMRF_2314_1_BM_CD138pos, MMRF_2245_1_BM_CD138pos, MMRF_2017_1_BM_CD138pos, MMRF_1710_1_BM_CD138pos, MMRF_1670_1_BM_CD138pos, MMRF_1727_1_BM_CD138pos, MMRF_2622_1_BM_CD138pos, MMRF_1664_1_BM_CD138pos, MMRF_2026_1_BM_CD138pos, MMRF_1797_1_BM_CD138pos, MMRF_2433_1_BM_CD138pos, MMRF_2746_1_BM_CD138pos, MMRF_2690_1_BM_CD138pos, MMRF_1389_1_BM_CD138pos, MMRF_1689_1_BM_CD138pos, MMRF_1269_1_BM_CD138pos, MMRF_1388_1_BM_CD138pos, MMRF_1822_1_BM_CD138pos, MMRF_1893_1_BM_CD138pos, MMRF_2676_1_BM_CD138pos, MMRF_1300_1_BM_CD138pos, MMRF_2807_1_BM_CD138pos, MMRF_1634_1_BM_CD138pos, MMRF_2436_1_BM_CD138pos, MMRF_1726_1_BM_CD138pos, MMRF_1461_1_BM_CD138pos, MMRF_1771_1_BM_CD138pos, MMRF_2691_1_BM_CD138pos, MMRF_1637_1_BM_CD138pos, MMRF_1971_1_BM_CD138pos, MMRF_2307_1_BM_CD138pos, MMRF_1645_1_BM_CD138pos, MMRF_2335_1_BM_CD138pos, MMRF_1842_1_BM_CD138pos, MMRF_1450_1_BM_CD138pos, MMRF_1534_1_BM_CD138pos, MMRF_1890_1_BM_CD138pos, MMRF_1932_1_BM_CD138pos, MMRF_2788_1_BM_CD138pos, MMRF_2778_1_BM_CD138pos, MMRF_2457_1_BM_CD138pos, MMRF_1424_1_BM_CD138pos, MMRF_2339_1_BM_CD138pos, MMRF_2836_1_BM_CD138pos, MMRF_2608_1_BM_CD138pos, MMRF_2605_1_BM_CD138pos, MMRF_2300_1_BM_CD138pos, MMRF_2251_1_BM_CD138pos, MMRF_2469_1_BM_CD138pos, MMRF_2698_1_BM_CD138pos, MMRF_1453_1_BM_CD138pos, MMRF_2817_1_BM_CD138pos, MMRF_1886_1_BM_CD138pos, MMRF_1644_1_BM_CD138pos, MMRF_1810_1_BM_CD138pos, MMRF_1251_1_BM_CD138pos, MMRF_1432_1_BM_CD138pos, MMRF_1618_1_BM_CD138pos, MMRF_2769_1_BM_CD138pos, MMRF_1833_1_BM_CD138pos, MMRF_1031_1_BM_CD138pos, MMRF_2799_1_BM_CD138pos, MMRF_1286_1_BM_CD138pos, MMRF_2722_1_BM_CD138pos, MMRF_2781_1_BM_CD138pos, MMRF_1169_1_BM_CD138pos, MMRF_2787_1_BM_CD138pos, MMRF_1906_1_BM_CD138pos, MMRF_2574_1_BM_CD138pos, MMRF_2062_1_BM_CD138pos, MMRF_2039_1_BM_CD138pos, MMRF_2290_1_BM_CD138pos, MMRF_2643_1_BM_CD138pos, MMRF_1817_1_BM_CD138pos, MMRF_1671_1_BM_CD138pos, MMRF_1862_1_BM_CD138pos, MMRF_2455_1_BM_CD138pos, MMRF_1595_1_BM_CD138pos, MMRF_1668_1_BM_CD138pos, MMRF_1721_1_BM_CD138pos, MMRF_1879_1_BM_CD138pos, MMRF_2490_1_BM_CD138pos, MMRF_2201_1_BM_CD138pos, MMRF_1082_1_BM_CD138pos, MMRF_2341_1_BM_CD138pos, MMRF_1579_1_BM_CD138pos, MMRF_1364_1_BM_CD138pos, MMRF_1540_1_BM_CD138pos, MMRF_1837_1_BM_CD138pos, MMRF_2458_1_BM_CD138pos, MMRF_1736_1_BM_CD138pos, MMRF_1327_1_BM_CD138pos, MMRF_1682_1_BM_CD138pos, MMRF_2373_1_BM_CD138pos, MMRF_2174_1_BM_CD138pos, MMRF_2119_1_BM_CD138pos, MMRF_2706_1_BM_CD138pos, MMRF_2438_1_BM_CD138pos, MMRF_1755_1_BM_CD138pos, MMRF_2125_1_BM_CD138pos, MMRF_2595_1_BM_CD138pos, MMRF_1596_1_BM_CD138pos, MMRF_1079_1_BM_CD138pos, MMRF_2195_1_BM_CD138pos, MMRF_2211_1_BM_CD138pos&#39;</span>
<span class="n">selected</span> <span class="o">=</span> <span class="n">selected</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">))</span>

<span class="n">other_samples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">clin</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">selected</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 
<span class="n">kmf1</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">()</span>
<span class="n">kmf2</span> <span class="o">=</span> <span class="n">KaplanMeierFitter</span><span class="p">()</span>
<span class="n">kmf1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">event_observed</span><span class="o">=</span><span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;selected (n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">kmf2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">other_samples</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">event_observed</span><span class="o">=</span><span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">other_samples</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;not selected (n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">other_samples</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">logrank_test</span><span class="p">(</span><span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span> <span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">other_samples</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">],</span> 
                  <span class="n">event_observed_A</span><span class="o">=</span><span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="n">event_observed_B</span><span class="o">=</span><span class="n">clin</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">other_samples</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">])</span>

<span class="n">kmf1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">kmf2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;NetFlow&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;survival&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">);</span>

<span class="n">lrp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lr</span><span class="o">.</span><span class="n">p_value</span><span class="si">:</span><span class="s2">2.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">if</span> <span class="s1">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">lrp</span><span class="p">:</span>
    <span class="n">lrp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$p = </span><span class="si">{0}</span><span class="s2"> \times 10^{{</span><span class="si">{1}</span><span class="s2">}}$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">lrp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">lrp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$p = </span><span class="si">{0}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lrp</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">lrp</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> 
        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">);</span><span class="c1"># </span>

<span class="c1"># fig.savefig(&#39;mm_kmf.png&#39;, dpi=300, bbox_inches=&#39;tight&#39;, transparent=True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>169
</pre></div>
</div>
<img alt="../../_images/b2c819870801191307b5cd9e6829c62266411c1cbd412465c3591e66bc2fcb19.png" src="../../_images/b2c819870801191307b5cd9e6829c62266411c1cbd412465c3591e66bc2fcb19.png" />
</div>
</div>
</section>
</section>
<section id="panel-visualization">
<h3>Panel visualization<a class="headerlink" href="#panel-visualization" title="Permalink to this heading">#</a></h3>
<p>First, we collect some NetFlow features and cluster membership data for each observation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pose_key</span> <span class="o">=</span> <span class="s1">&#39;POSE_1kmnn_3branches_dpt_from_transitions_sym_similarity_max12nn_RNA_nbhd_euc_with_self_WEE1_density_normalized&#39;</span>
<span class="n">gg</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="n">pose_key</span><span class="p">]</span>

<span class="n">selected</span> <span class="o">=</span> <span class="s1">&#39;MMRF_2828_1_BM_CD138pos, MMRF_1580_1_BM_CD138pos, MMRF_1089_1_BM_CD138pos, MMRF_1927_1_BM_CD138pos, MMRF_1835_1_BM_CD138pos, MMRF_1499_1_BM_CD138pos, MMRF_1715_1_BM_CD138pos, MMRF_2667_1_BM_CD138pos, MMRF_2739_1_BM_CD138pos, MMRF_2394_1_BM_CD138pos, MMRF_2041_1_BM_CD138pos, MMRF_2681_1_BM_CD138pos, MMRF_1700_1_BM_CD138pos, MMRF_2535_1_BM_CD138pos, MMRF_1401_1_BM_CD138pos, MMRF_2818_1_BM_CD138pos, MMRF_2718_1_BM_CD138pos, MMRF_2476_1_BM_CD138pos, MMRF_1539_1_BM_CD138pos, MMRF_1831_1_BM_CD138pos, MMRF_2587_1_BM_CD138pos, MMRF_2200_1_BM_CD138pos, MMRF_1918_1_BM_CD138pos, MMRF_2532_1_BM_CD138pos, MMRF_2194_1_BM_CD138pos, MMRF_2015_1_BM_CD138pos, MMRF_1780_1_BM_CD138pos, MMRF_1641_1_BM_CD138pos, MMRF_2471_1_BM_CD138pos, MMRF_2621_1_BM_CD138pos, MMRF_1338_1_BM_CD138pos, MMRF_2754_1_BM_CD138pos, MMRF_2568_1_BM_CD138pos, MMRF_2225_1_BM_CD138pos, MMRF_1586_1_BM_CD138pos, MMRF_2639_1_BM_CD138pos, MMRF_1992_1_BM_CD138pos, MMRF_1683_1_BM_CD138pos, MMRF_2473_1_BM_CD138pos, MMRF_1541_1_BM_CD138pos, MMRF_1328_1_BM_CD138pos, MMRF_1617_1_BM_CD138pos, MMRF_2801_1_BM_CD138pos, MMRF_2776_1_BM_CD138pos, MMRF_1164_1_BM_CD138pos, MMRF_2452_1_BM_CD138pos, MMRF_2368_1_BM_CD138pos, MMRF_2813_1_BM_CD138pos, MMRF_1627_1_BM_CD138pos, MMRF_1851_1_BM_CD138pos, MMRF_1403_1_BM_CD138pos, MMRF_1677_1_BM_CD138pos, MMRF_1805_1_BM_CD138pos, MMRF_1359_1_BM_CD138pos, MMRF_2847_1_BM_CD138pos, MMRF_2076_1_BM_CD138pos, MMRF_1167_1_BM_CD138pos, MMRF_2272_1_BM_CD138pos, MMRF_1451_1_BM_CD138pos, MMRF_2401_1_BM_CD138pos, MMRF_2531_1_BM_CD138pos, MMRF_2692_1_BM_CD138pos, MMRF_1790_1_BM_CD138pos, MMRF_1819_1_BM_CD138pos, MMRF_2314_1_BM_CD138pos, MMRF_2245_1_BM_CD138pos, MMRF_2017_1_BM_CD138pos, MMRF_1710_1_BM_CD138pos, MMRF_1670_1_BM_CD138pos, MMRF_1727_1_BM_CD138pos, MMRF_2622_1_BM_CD138pos, MMRF_1664_1_BM_CD138pos, MMRF_2026_1_BM_CD138pos, MMRF_1797_1_BM_CD138pos, MMRF_2433_1_BM_CD138pos, MMRF_2746_1_BM_CD138pos, MMRF_2690_1_BM_CD138pos, MMRF_1389_1_BM_CD138pos, MMRF_1689_1_BM_CD138pos, MMRF_1269_1_BM_CD138pos, MMRF_1388_1_BM_CD138pos, MMRF_1822_1_BM_CD138pos, MMRF_1893_1_BM_CD138pos, MMRF_2676_1_BM_CD138pos, MMRF_1300_1_BM_CD138pos, MMRF_2807_1_BM_CD138pos, MMRF_1634_1_BM_CD138pos, MMRF_2436_1_BM_CD138pos, MMRF_1726_1_BM_CD138pos, MMRF_1461_1_BM_CD138pos, MMRF_1771_1_BM_CD138pos, MMRF_2691_1_BM_CD138pos, MMRF_1637_1_BM_CD138pos, MMRF_1971_1_BM_CD138pos, MMRF_2307_1_BM_CD138pos, MMRF_1645_1_BM_CD138pos, MMRF_2335_1_BM_CD138pos, MMRF_1842_1_BM_CD138pos, MMRF_1450_1_BM_CD138pos, MMRF_1534_1_BM_CD138pos, MMRF_1890_1_BM_CD138pos, MMRF_1932_1_BM_CD138pos, MMRF_2788_1_BM_CD138pos, MMRF_2778_1_BM_CD138pos, MMRF_2457_1_BM_CD138pos, MMRF_1424_1_BM_CD138pos, MMRF_2339_1_BM_CD138pos, MMRF_2836_1_BM_CD138pos, MMRF_2608_1_BM_CD138pos, MMRF_2605_1_BM_CD138pos, MMRF_2300_1_BM_CD138pos, MMRF_2251_1_BM_CD138pos, MMRF_2469_1_BM_CD138pos, MMRF_2698_1_BM_CD138pos, MMRF_1453_1_BM_CD138pos, MMRF_2817_1_BM_CD138pos, MMRF_1886_1_BM_CD138pos, MMRF_1644_1_BM_CD138pos, MMRF_1810_1_BM_CD138pos, MMRF_1251_1_BM_CD138pos, MMRF_1432_1_BM_CD138pos, MMRF_1618_1_BM_CD138pos, MMRF_2769_1_BM_CD138pos, MMRF_1833_1_BM_CD138pos, MMRF_1031_1_BM_CD138pos, MMRF_2799_1_BM_CD138pos, MMRF_1286_1_BM_CD138pos, MMRF_2722_1_BM_CD138pos, MMRF_2781_1_BM_CD138pos, MMRF_1169_1_BM_CD138pos, MMRF_2787_1_BM_CD138pos, MMRF_1906_1_BM_CD138pos, MMRF_2574_1_BM_CD138pos, MMRF_2062_1_BM_CD138pos, MMRF_2039_1_BM_CD138pos, MMRF_2290_1_BM_CD138pos, MMRF_2643_1_BM_CD138pos, MMRF_1817_1_BM_CD138pos, MMRF_1671_1_BM_CD138pos, MMRF_1862_1_BM_CD138pos, MMRF_2455_1_BM_CD138pos, MMRF_1595_1_BM_CD138pos, MMRF_1668_1_BM_CD138pos, MMRF_1721_1_BM_CD138pos, MMRF_1879_1_BM_CD138pos, MMRF_2490_1_BM_CD138pos, MMRF_2201_1_BM_CD138pos, MMRF_1082_1_BM_CD138pos, MMRF_2341_1_BM_CD138pos, MMRF_1579_1_BM_CD138pos, MMRF_1364_1_BM_CD138pos, MMRF_1540_1_BM_CD138pos, MMRF_1837_1_BM_CD138pos, MMRF_2458_1_BM_CD138pos, MMRF_1736_1_BM_CD138pos, MMRF_1327_1_BM_CD138pos, MMRF_1682_1_BM_CD138pos, MMRF_2373_1_BM_CD138pos, MMRF_2174_1_BM_CD138pos, MMRF_2119_1_BM_CD138pos, MMRF_2706_1_BM_CD138pos, MMRF_2438_1_BM_CD138pos, MMRF_1755_1_BM_CD138pos, MMRF_2125_1_BM_CD138pos, MMRF_2595_1_BM_CD138pos, MMRF_1596_1_BM_CD138pos, MMRF_1079_1_BM_CD138pos, MMRF_2195_1_BM_CD138pos, MMRF_2211_1_BM_CD138pos&#39;</span>
<span class="n">selected</span> <span class="o">=</span> <span class="n">selected</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>

<span class="n">record</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">gg</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;branch&#39;</span><span class="p">,</span> <span class="s1">&#39;branch-louvain0x1&#39;</span><span class="p">,</span> <span class="s1">&#39;louvain0x1&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;louvain0x1&#39;</span><span class="p">:</span> <span class="s1">&#39;Louvain&#39;</span><span class="p">,</span> <span class="s1">&#39;branch-louvain0x1&#39;</span><span class="p">:</span> <span class="s1">&#39;BL-clusters&#39;</span><span class="p">})</span>

<span class="n">record</span><span class="p">[</span><span class="s1">&#39;BL-clusters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;BL-clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;BL-clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="nb">range</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;BL-clusters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()))))</span>
<span class="n">record</span><span class="p">[</span><span class="s1">&#39;risk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;higher&#39;</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;lower&#39;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<span class="n">record</span>

<span class="c1"># clin_g[[&#39;NF_selected&#39;]].to_csv(NETFLOW_RESULTS_DIR / &#39;netflow_selected_samples_POSE_1kmnn_5branches_dpt_from_transitions_sym_similarity_max5nn_WEE1_RNA_nbhd_euc_with_self_density_normalize.csv&#39;, header=True, index=True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>branch</th>
      <th>BL-clusters</th>
      <th>Louvain</th>
      <th>risk</th>
    </tr>
    <tr>
      <th>name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MMRF_2368_1_BM_CD138pos</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>higher</td>
    </tr>
    <tr>
      <th>MMRF_1461_1_BM_CD138pos</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>higher</td>
    </tr>
    <tr>
      <th>MMRF_2245_1_BM_CD138pos</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>higher</td>
    </tr>
    <tr>
      <th>MMRF_1797_1_BM_CD138pos</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>higher</td>
    </tr>
    <tr>
      <th>MMRF_2433_1_BM_CD138pos</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>higher</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>MMRF_2761_1_BM_CD138pos</th>
      <td>9</td>
      <td>18</td>
      <td>3</td>
      <td>lower</td>
    </tr>
    <tr>
      <th>MMRF_1917_1_BM_CD138pos</th>
      <td>9</td>
      <td>18</td>
      <td>3</td>
      <td>lower</td>
    </tr>
    <tr>
      <th>MMRF_2638_1_BM_CD138pos</th>
      <td>9</td>
      <td>18</td>
      <td>3</td>
      <td>lower</td>
    </tr>
    <tr>
      <th>MMRF_2815_1_BM_CD138pos</th>
      <td>9</td>
      <td>18</td>
      <td>3</td>
      <td>lower</td>
    </tr>
    <tr>
      <th>MMRF_1180_1_BM_CD138pos</th>
      <td>9</td>
      <td>18</td>
      <td>3</td>
      <td>lower</td>
    </tr>
  </tbody>
</table>
<p>659 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">selected</span>
<span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">nodelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gg</span><span class="p">)</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">gg</span><span class="p">)</span>


<span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">border_linewidths</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">s_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">gg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">}</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s_names</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
    <span class="n">border_linewidths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.24</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">else</span> <span class="mf">0.</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>  <span class="c1"># : scalar or sequence (default=1.0) </span>
<span class="n">bordercolors</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>


<span class="n">fts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">record</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;risk&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;higher&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}),</span> 
                 <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RNA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WEE1&#39;</span><span class="p">,</span>  <span class="s1">&#39;PLK1&#39;</span><span class="p">,</span> <span class="s1">&#39;CDCA3&#39;</span><span class="p">,</span> <span class="s1">&#39;CDK1&#39;</span><span class="p">,</span> <span class="s1">&#39;CDK2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fts</span> <span class="o">=</span> <span class="n">fts</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="n">gg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">})</span>
<span class="n">fts</span> <span class="o">=</span> <span class="n">fts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nodelist</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">ft_label</span><span class="p">,</span> <span class="n">ft</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fts</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">ft_label</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Louvain&#39;</span><span class="p">,</span> <span class="s1">&#39;BL-clusters&#39;</span><span class="p">,</span> <span class="s1">&#39;branch&#39;</span><span class="p">]:</span>
        <span class="n">node_cmap</span> <span class="o">=</span> <span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">ft</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">ft</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;nipy_spectral&#39;</span>
        <span class="n">ntm</span><span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">ft_label</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span><span class="p">:</span>
        <span class="n">node_cmap</span> <span class="o">=</span> <span class="s1">&#39;tab10&#39;</span> 
        <span class="n">ntm</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;higher&#39;</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_cmap</span> <span class="o">=</span> <span class="s1">&#39;nipy_spectral&#39;</span>
        <span class="n">ntm</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mf">2.2</span><span class="p">,</span> <span class="c1"># 4.3, # 2.3, </span>
                      <span class="n">node_color</span><span class="o">=</span><span class="n">ft</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                      <span class="n">node_cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
                      <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ft_label</span><span class="p">,</span> 
                      <span class="n">node_cmap</span><span class="o">=</span><span class="n">node_cmap</span><span class="p">,</span>
                      <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                      <span class="n">border_linewidths</span><span class="o">=</span><span class="n">border_linewidths</span><span class="p">,</span> <span class="n">bordercolors</span><span class="o">=</span><span class="n">bordercolors</span><span class="p">,</span>
                     <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/97d7376c784a2a38a737d6354bf51cea565be5cb2bd6424b1e5e47f87222e2bd.png" src="../../_images/97d7376c784a2a38a737d6354bf51cea565be5cb2bd6424b1e5e47f87222e2bd.png" />
</div>
</div>
<p>Visualization annotating selected samples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">selected</span>
<span class="c1"># s = None</span>

<span class="n">nodelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gg</span><span class="p">)</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">gg</span><span class="p">)</span>


<span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">border_linewidths</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">s_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">gg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">}</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s_names</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
    <span class="n">border_linewidths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.24</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">else</span> <span class="mf">0.</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>  <span class="c1"># : scalar or sequence (default=1.0) </span>
<span class="n">bordercolors</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span> <span class="c1"># [&#39;k&#39; if k in s else cc for k, cc in zip(nl, nc)] # [None | scalar | sequence] (default = node_color)                    </span>


<span class="n">fts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">record</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;risk&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;higher&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}),</span> 
                 <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RNA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;WEE1&#39;</span><span class="p">,</span>  <span class="s1">&#39;PLK1&#39;</span><span class="p">,</span> <span class="s1">&#39;CDCA3&#39;</span><span class="p">,</span> <span class="s1">&#39;CDK1&#39;</span><span class="p">,</span> <span class="s1">&#39;CDK2&#39;</span><span class="p">,</span> 
                                          <span class="c1"># &#39;ATAD2&#39;, &#39;SPAG5&#39;, &#39;RAD21&#39;, &#39;MCM4&#39;, </span>
                                          <span class="c1"># &#39;GABARAPL1&#39;, &#39;RALGDS&#39;, &#39;SNUPN&#39;, &#39;CHIC2&#39;, &#39;FARSA&#39;,</span>
                                         <span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fts</span> <span class="o">=</span> <span class="n">fts</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="n">gg</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">})</span>
<span class="n">fts</span> <span class="o">=</span> <span class="n">fts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nodelist</span><span class="p">]</span>

<span class="c1"># fig, axes = plt.subplots(1, 6, figsize=(13, 2.5), layout=&#39;constrained&#39;, dpi=300)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>


<span class="k">for</span> <span class="p">(</span><span class="n">ft_label</span><span class="p">,</span> <span class="n">ft</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fts</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">ft_label</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Louvain&#39;</span><span class="p">,</span> <span class="s1">&#39;BL-clusters&#39;</span><span class="p">,</span> <span class="s1">&#39;branch&#39;</span><span class="p">]:</span>
        <span class="n">node_cmap</span> <span class="o">=</span> <span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">ft</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">ft</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;nipy_spectral&#39;</span>
        <span class="n">ntm</span><span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">ft_label</span> <span class="o">==</span> <span class="s1">&#39;risk&#39;</span><span class="p">:</span>
        <span class="n">node_cmap</span> <span class="o">=</span> <span class="s1">&#39;tab10&#39;</span> 
        <span class="n">ntm</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;higher&#39;</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_cmap</span> <span class="o">=</span> <span class="s1">&#39;nipy_spectral&#39;</span>
        <span class="n">ntm</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mf">2.2</span><span class="p">,</span> <span class="c1"># 4.3, # 2.3, </span>
                      <span class="n">node_color</span><span class="o">=</span><span class="n">ft</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span> <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                      <span class="n">node_cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;pad&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span>
                      <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ft_label</span><span class="p">,</span> 
                      <span class="n">node_cmap</span><span class="o">=</span><span class="n">node_cmap</span><span class="p">,</span>
                      <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                      <span class="n">border_linewidths</span><span class="o">=</span><span class="n">border_linewidths</span><span class="p">,</span> <span class="n">bordercolors</span><span class="o">=</span><span class="n">bordercolors</span><span class="p">,</span>
                     <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/912e3ae9ad635bac3a46e0c288c0eeff2c5dfd0752ed0c5ddd2cb3801f9be16d.png" src="../../_images/912e3ae9ad635bac3a46e0c288c0eeff2c5dfd0752ed0c5ddd2cb3801f9be16d.png" />
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="keeper_tutorial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Load libraries</p>
      </div>
    </a>
    <a class="right-next"
       href="MM_example.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Multiple myeloma example</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="current visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../building/index.html">Installation</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../overview/index.html">User guide</a></li>
<li class="toctree-l1 current toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../index.html">Tutorials</a><ul class="current visible nav section-nav flex-column">
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html">Load libraries</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#set-up-directories">Set up directories</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#load-data">Load data</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#initialize-the-keeper">Initialize the Keeper</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#load-data-into-the-keeper">Load data into the Keeper</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#load-data-into-keeper-at-time-of-instatiation">Load data into keeper at time of instatiation</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#load-data-into-keeper-from-file">Load data into Keeper from file</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#extract-data-from-the-keeper">Extract data from the Keeper</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#save-data-from-the-keeper">Save data from the Keeper</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#extract-keeper-subset">Extract Keeper subset</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#extract-data-subset">Extract data subset</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#iterating-through-feature-data-distances-or-similarities">Iterating through feature data, distances or similarities</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="keeper_tutorial.html#membership">Membership</a></li>
<li class="toctree-l2 current toc-h2 nav-item toc-entry"><a class="current reference internal nav-link" href="#">Multiple myeloma example</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pose-pipeline-overview">POSE pipeline overview</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-libraries">Load libraries</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#directories">Directories</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#netflow-pipeline">NetFlow pipeline</a><ul class="nav section-nav flex-column">
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-load-data">Step 1: Load data</a><ul class="nav section-nav flex-column">
<li class="toctree-l4 toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-clinical-data">Load the clinical data</a></li>
<li class="toctree-l4 toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-rna-data">Load the RNA data:</a></li>
<li class="toctree-l4 toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#load-the-feature-graph">Load the feature graph</a></li>
</ul>
</li>
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-compute-sample-pairwise-distances-on-the-wee1-neighborhood">Step 2: Compute sample-pairwise distances on the WEE1 neighborhood:</a></li>
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-extract-net-neighborhood-distances">Step 3: Extract net neighborhood distances</a><ul class="nav section-nav flex-column">
<li class="toctree-l4 toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-from-a-single-feature-neighborhood">Distance from a single feature neighborhood</a></li>
</ul>
</li>
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-compute-similarities-from-distances">Step 4: Compute similarities from distances</a></li>
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-compute-diffusion-distances">Step 5: Compute diffusion distances</a></li>
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-compute-the-pose">Step 6: Compute the POSE</a></li>
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-7-probe-the-pose">Step 7: Probe the POSE</a><ul class="nav section-nav flex-column">
<li class="toctree-l4 toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bl-clustering">BL-clustering</a></li>
</ul>
</li>
<li class="toctree-l3 toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-visualizing-the-pose">Step 8: Visualizing the POSE</a><ul class="nav section-nav flex-column">
<li class="toctree-l4 toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#interactive-visualization">Interactive visualization</a><ul class="nav section-nav flex-column">
<li class="toctree-l5 toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#kaplan-meier-survival-analysis-from-selected-samples">Kaplan-Meier Survival analysis from selected samples</a></li>
</ul>
</li>
<li class="toctree-l4 toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#panel-visualization">Panel visualization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="MM_example.html">Multiple myeloma example</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="MM_example.html#pose-pipeline-overview">POSE pipeline overview</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="MM_example.html#load-libraries">Load libraries</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="MM_example.html#directories">Directories</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="MM_example.html#netflow-pipeline">NetFlow pipeline</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html">Breast cancer example</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#pose-pipeline-overview">Pose pipeline overview</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#load-libraries">Load libraries</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#set-up-directories">Set up directories</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#load-clinical-data">Load clinical data</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#initialize-the-keeper">Initialize the Keeper</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#compute-observation-pairwise-distances">Compute observation-pairwise distances</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#compute-similarities-from-distances">Compute similarities from distances</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#fused-similarities">Fused similarities</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#compute-diffusion-distances">Compute diffusion distances</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="BC_example.html#compute-the-pose">Compute the POSE</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="GBM_multimodal_example.html">Glioblastoma multiforme multi-omics example</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="GBM_multimodal_example.html#load-libraries">Load libraries</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="GBM_multimodal_example.html#colors">Colors</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="GBM_multimodal_example.html#directories">Directories</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="GBM_multimodal_example.html#initialize-the-keeper">Initialize the keeper</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="GBM_multimodal_example.html#netflow-pipeline">NetFlow pipeline</a></li>
<li class="toctree-l2 toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="GBM_multimodal_example.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../reference/index.html">API reference</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../references.html">References</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/tutorial/notebooks/MM_paper_example.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023-2025, The netflow community.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>