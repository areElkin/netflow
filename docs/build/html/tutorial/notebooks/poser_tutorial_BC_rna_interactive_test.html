

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Pose pipeline tutorial &#8212; netflow v0.0.dev Manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorial/notebooks/poser_tutorial_BC_rna_interactive_test';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">netflow v0.0.dev Manual</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../building/index.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../overview/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../references.html">
                        References
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../building/index.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../overview/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../index.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../reference/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../references.html">
                        References
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item"><nav class="sidebar-indices-items">
  <p class="sidebar-indices-items__title" role="heading" aria-level="1">Indices</p>
  <ul class="indices-link">
        <li class="toctree-l1">
          <a class="reference internal"
             href="../../genindex.html"
             accesskey="I">General Index</a>
        </li>
        <li class="toctree-l1">
          <a class="reference internal" href="../../py-modindex.html">Python Module Index</a>
        </li>
  </ul>
</nav></div>
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Pose pipeline tutorial</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="pose-pipeline-tutorial">
<h1>Pose pipeline tutorial<a class="headerlink" href="#pose-pipeline-tutorial" title="Permalink to this headline">#</a></h1>
<p>(Single-modal) In this tutorial, we demonstrate how to perform the POSE pipeline on Breast Cancer (BC) RNA data from TCGA. This analysis entails the following:</p>
<ol class="arabic simple">
<li><p>Upload data</p></li>
<li><p>Compute pairwise sample (WE) distances with respect to gene neigborhoods</p></li>
<li><p>Compute global pairwise sample (WE) distance matrices</p></li>
<li><p>Convert global distances to a single sample pairwise similarity matrix</p></li>
<li><p>(Future work - dpt distance and/or multi-scale diffusion based distances)</p></li>
<li><p>Extract pseudo-organization (i.e., ordering) of samples.</p></li>
<li><p>Determine schema (i.e., branching).</p></li>
<li><p>Visualize schema</p></li>
<li><p>(Future work - further investigation into samples within different branches and differential analysis between branches)</p></li>
</ol>
<ul class="simple">
<li><p>$d_W(i,j,v)$ - The Wasserstein distance of the 1-hop neighborhood around gene $v$ between sample $i$ and sample $j$</p></li>
<li><p>$d_E(i,j,v)$ - The Euclidean distance of the 1-hop neighborhood around gene $v$ between sample $i$ and sample $j$</p></li>
<li><p>$D_W(i,j) = |d_W(i,j,v)|$ - Net Wasserstein distance between sample $i$ and sample $j$ wrt all genes $v$</p></li>
<li><p>$D_E(i,j) = |d_E(i,j,v)|$ - Net Euclidean distance between sample $i$ and sample $j$ wrt all genes $v$</p></li>
<li><p>$K_W = e^{-\frac{|D_W|^2}{\sigma^2}}$ - Pairwise sample Wasserstein similarity matrix</p></li>
<li><p>$K_E = e^{-\frac{|D_E|^2}{\sigma^2}}$ - Pairwise sample Euclidean similarity matrix</p></li>
<li><p>(Multi-feature, multi-modal) $K = \frac{K_W + K_E}{2}$ - Fused pairwise sample similarity matrix</p></li>
<li><p>$D = 1 - K$ - Fused pairwise sample distance matrix</p></li>
<li><p>(Clustering) Determine branching according to lineage tracing algorithm using $D$</p></li>
<li><p>(Visualizing) Pseudo-ordering of samples in branches according to distance from root node $r$, i.e., $D(r,:)$</p></li>
</ul>
<p><strong>Aknowledgement</strong></p>
<ul class="simple">
<li><p>The diffusion distance and pseudo-ordering is performed according to the lineage tracing algorithm presented in Haghverdi, et al. (2019).</p></li>
<li><p>The code for computing the ordering is largely adopted from the scanpy implementation in Python.</p></li>
</ul>
<p><strong>Input</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">X</span></code> : RNA-Seq data matrix</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">genelist</span></code> : list of genes of interest in <code class="docutils literal notranslate"><span class="pre">X</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">G</span></code> : gene-gene (or protein-protein) interaction network</p></li>
</ul>
<p><strong>Algorithm</strong></p>
<ol class="arabic simple">
<li><p>Compute sample-pairwise gene-1-hop-neighborhood distances:</p>
<ul class="simple">
<li><p>Wasserstein distances (shape): For each gene <code class="docutils literal notranslate"><span class="pre">g</span></code> in the <code class="docutils literal notranslate"><span class="pre">genelist</span></code>, compute $$d_W^{(g)}(sample_i, sample_j)$$ which is the Wasserstein distance of gene <code class="docutils literal notranslate"><span class="pre">g</span></code>’s 1-hop neighborhood between every two samples <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></li>
<li><p>Euclidean distances (scale): For each gene <code class="docutils literal notranslate"><span class="pre">g</span></code> in the <code class="docutils literal notranslate"><span class="pre">genelist</span></code>, compute $$d_E^{(g)}(sample_i, sample_j)$$ which is the Euclidean distance of gene <code class="docutils literal notranslate"><span class="pre">g</span></code>’s 1-hop neighborhood (including self) between every two samples <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p></li>
</ul>
</li>
<li><p>Compute net sample-pairwise distances:</p>
<ul class="simple">
<li><p>Wasserstein distance (shape): $$d_W(sample_i, sample_j) = |d_W^{(g)}(sample_i, sample_j)|$$ as the $L_1$ or $L_2$ norm of the vector of gene-1-hop-neighborhood Wasserstein distances for all genes <code class="docutils literal notranslate"><span class="pre">g</span></code> in the <code class="docutils literal notranslate"><span class="pre">genelist</span></code>.</p></li>
<li><p>Euclidean distance (scale): $$d_E(sample_i, sample_j) = |d_E^{(g)}(sample_i, sample_j)|$$ as the $L_1$ or $L_2$ norm of the vector of gene-1-hop-neighborhood Euclidean distances for all genes <code class="docutils literal notranslate"><span class="pre">g</span></code> in the <code class="docutils literal notranslate"><span class="pre">genelist</span></code>.</p></li>
</ul>
</li>
<li><p>Convert net sample-pairwise distances to standardized similarities:</p>
<ul class="simple">
<li><p>$\sigma$ : Kernel width representing each data point’s accessible neighbors.</p></li>
<li><p>Set $\sigma$ normalization for each obs as the distance to its k-th neighbor : $$K_{ij}(d) = \sqrt{\frac{2\sigma_i\sigma_j}{\sigma_i^2 + \sigma_j^2}}e^{-\frac{|d_{ij}^2|}{2(\sigma_i^2 + \sigma_j^2)}}$$
where for each observation $i$, $\sigma_i$ is the distance to its $k$-th nearest neighbor.</p>
<ul>
<li><p>Standardized sample-pairwise Wasserstein similarity: $$K_W = K(d_W)$$</p></li>
<li><p>Standardized sample-pairwise Euclidean similarity: $$K_E = K(d_E)$$</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Compute fused sample-pairwise distance $d_F$:</p>
<ul class="simple">
<li><p>$d_F = 1 - \frac{K_W + K_E}{2}$ (Note : could choose other weights to fuse with an unbalanced combination)</p></li>
</ul>
</li>
</ol>
<!-- 5. Compute sample-pairwise co-branch frequency from pseudo-organization:
    - Compute pseudo-organization branching using each sample as the root.
    - Count the number (or percentage) of times every two samples are found in the same branch - `tracker(sample_i, sample_j)`
6. Cluster samples and generate organization schema:
    - user specified parameters:
        - `percentage (0 < percentage <= 100)` : Percentage of pseudo-organizations that samples must be found in the same branch to be considered part of the same cluster.
        - `min_clus_component_size (1 <= min_clus_component_size <= largest number of samples within a single connected component)` : Remove each cluster where the connected component it belongs to has less than `min_island_clus_size` samples collectively.
    - approach for constructing the schema:
        - For each sample `i`, identify cluster `c_i` where $$c_i = \{ i \} \cup \{ j : tracker(i, j) >= percentage \}, $$ which is represented as a node in the schema.
        - Draw an edge between every two clusters/nodes (e.g., `c_i` and `c_j`) where there is an overlap in the samples associated with each clusters/nodes.
        - Remove connected components in the schema associated with less than `min_clus_component_size` samples, collectively.
        - (To do:) Draw fictitious edges to connect the connected-components based on inter-pseudo-organization distance

 --><p>First, import the necessary packages:</p>
</section>
<section id="load-libraries">
<h1>Load libraries<a class="headerlink" href="#load-libraries" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span> <span class="k">as</span> <span class="n">ddict</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sc_sparse</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">netflow</span></code> has not been installed, add the path to the library:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
<span class="c1"># sys.path.insert(0, pathlib.Path(pathlib.Path(&#39;.&#39;).absolute()).parents[0].resolve().as_posix())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">netflow</span> <span class="k">as</span> <span class="nn">nf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">netflow.probe</span> <span class="kn">import</span> <span class="n">visualization</span> <span class="k">as</span> <span class="n">nfv</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-up-directories">
<h1>Set up directories<a class="headerlink" href="#set-up-directories" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MAIN_DIR</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Paths to where data is stored:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">MAIN_DIR</span> <span class="o">/</span> <span class="s1">&#39;example_data&#39;</span> <span class="o">/</span> <span class="s1">&#39;breast_tcga&#39;</span>

<span class="n">RNA_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;rna_606.txt&#39;</span>
<span class="n">E_RNA_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;edgelist_hprd_rna_606.txt&#39;</span>

<span class="n">CNA_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;cna_606.txt&#39;</span>
<span class="n">E_CNA_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;edgelist_hprd_cna_606.txt&#39;</span>

<span class="n">METH_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;methylation_606.txt&#39;</span>
<span class="n">E_METH_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;edgelist_hprd_methylation_606.txt&#39;</span>

<span class="n">CLIN_FNAME</span> <span class="o">=</span> <span class="n">DATA_DIR</span> <span class="o">/</span> <span class="s1">&#39;clin_606.txt&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Directory where output should be saved:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">OUT_DIR</span> <span class="o">=</span> <span class="n">MAIN_DIR</span> <span class="o">/</span> <span class="s1">&#39;example_data&#39;</span> <span class="o">/</span> <span class="s1">&#39;results_netflow_breast_tcga&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-clinical-data">
<h1>Load clinical data<a class="headerlink" href="#load-clinical-data" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">CLIN_FNAME</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clin</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(606, 34)
</pre></div>
</div>
</div>
</div>
</section>
<section id="initialize-the-keeper">
<h1>Initialize the Keeper<a class="headerlink" href="#initialize-the-keeper" title="Permalink to this headline">#</a></h1>
<p>We use the same bulk-RNA TCGA breast cancer data (specifically, the RNA and methylation) as previously described in the Keeper tutorial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># uncomment to initialize Keeper with no output directory:</span>
<span class="c1"># keeper = nf.Keeper() </span>

<span class="c1"># initializing Keeper with output directory:</span>
<span class="n">keeper</span> <span class="o">=</span> <span class="n">nf</span><span class="o">.</span><span class="n">Keeper</span><span class="p">(</span><span class="n">outdir</span><span class="o">=</span><span class="n">OUT_DIR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">clin</span><span class="p">[[</span><span class="s1">&#39;ONCOTREE_CODE&#39;</span><span class="p">,</span> <span class="s1">&#39;TMB_NONSYNONYMOUS&#39;</span><span class="p">,</span> <span class="s1">&#39;OS_STATUS&#39;</span><span class="p">,</span> <span class="s1">&#39;OS_MONTHS&#39;</span><span class="p">,</span> 
      <span class="s1">&#39;DFS_STATUS&#39;</span><span class="p">,</span> <span class="s1">&#39;DFS_MONTHS&#39;</span><span class="p">,</span> <span class="s1">&#39;SEX&#39;</span><span class="p">,</span> <span class="s1">&#39;AGE&#39;</span><span class="p">,</span> <span class="s1">&#39;PAM50&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;TMB_NONSYNONYMOUS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># </span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;DFS_STATUS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;2:Unknown&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;DFS_MONTHS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;clin&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Load the feature data (RNA and methylation) from file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">RNA_FNAME</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rna&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="c1"># keeper.load_data(METH_FNAME, label=&#39;meth&#39;, header=0, index_col=0)</span>
</pre></div>
</div>
</div>
</div>
<p>Load the associated graphs from their edgelist files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">load_graph</span><span class="p">(</span><span class="n">E_RNA_FNAME</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;rna&#39;</span><span class="p">)</span>
<span class="c1"># keeper.load_graph(E_METH_FNAME, label=&#39;meth&#39;)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-observation-pairwise-distances">
<h1>Compute observation-pairwise distances<a class="headerlink" href="#compute-observation-pairwise-distances" title="Permalink to this headline">#</a></h1>
<p>We can compute observation-pairwise distances with respect to the feature data. This can be performed on all features, but here we select a specific set of immune related features for demonstration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gene_sig_label</span> <span class="o">=</span> <span class="s1">&#39;immune_signature&#39;</span>
<span class="c1"># gene_sig = [&#39;ACTB&#39;, &#39;CCR5&#39;, &#39;CD163&#39;, &#39;CD247&#39;, &#39;CD28&#39;, &#39;CD3D&#39;, &#39;CD3E&#39;, &#39;CD3G&#39;, </span>
<span class="c1">#             &#39;CD4&#39;, &#39;CD80&#39;, &#39;CD86&#39;, &#39;CD8A&#39;, &#39;CD8B&#39;, &#39;GZMA&#39;, &#39;GZMB&#39;, &#39;IFNG&#39;, </span>
<span class="c1">#             &#39;IL10&#39;, &#39;IL1A&#39;, &#39;IL1B&#39;, &#39;IL6&#39;, &#39;ITGB7&#39;, &#39;ITK&#39;, &#39;KLF10&#39;, &#39;LAT&#39;, </span>
<span class="c1">#             &#39;LCK&#39;, &#39;LCP2&#39;, &#39;PTPN6&#39;, &#39;SNAI1&#39;, &#39;TGFB2&#39;, &#39;TGFBR1&#39;, &#39;TGFBR2&#39;, </span>
<span class="c1">#             &#39;TNF&#39;, &#39;TUBA1A&#39;, &#39;VAV1&#39;, &#39;VEGFA&#39;, &#39;ZAP70&#39;, &#39;ZEB1&#39;]</span>

<span class="n">gene_sig</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ACTB&#39;</span><span class="p">,</span> <span class="s1">&#39;CCR5&#39;</span><span class="p">,</span> <span class="s1">&#39;CD163&#39;</span><span class="p">,</span> <span class="s1">&#39;CD247&#39;</span><span class="p">,</span> <span class="s1">&#39;CD28&#39;</span><span class="p">,</span> <span class="s1">&#39;CD3D&#39;</span><span class="p">,</span> <span class="s1">&#39;CD3E&#39;</span><span class="p">,</span> <span class="s1">&#39;CD3G&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;CD4&#39;</span><span class="p">,</span> <span class="s1">&#39;CD40LG&#39;</span><span class="p">,</span> <span class="s1">&#39;CD80&#39;</span><span class="p">,</span> <span class="s1">&#39;CD86&#39;</span><span class="p">,</span> <span class="s1">&#39;CD8A&#39;</span><span class="p">,</span> <span class="s1">&#39;CD8B&#39;</span><span class="p">,</span> <span class="s1">&#39;CIITA&#39;</span><span class="p">,</span> <span class="s1">&#39;CXCR3&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;GZMA&#39;</span><span class="p">,</span> <span class="s1">&#39;GZMB&#39;</span><span class="p">,</span> <span class="s1">&#39;HLA-DPA1&#39;</span><span class="p">,</span> <span class="s1">&#39;HLA-DPB1&#39;</span><span class="p">,</span> <span class="s1">&#39;HLA-DQA1&#39;</span><span class="p">,</span> <span class="s1">&#39;HLA-DQA2&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;HLA-DQB1&#39;</span><span class="p">,</span> <span class="s1">&#39;HLA-DRA&#39;</span><span class="p">,</span> <span class="s1">&#39;HLA-DRB1&#39;</span><span class="p">,</span> <span class="s1">&#39;HLA-DRB5&#39;</span><span class="p">,</span> <span class="s1">&#39;IFNG&#39;</span><span class="p">,</span> <span class="s1">&#39;IL10&#39;</span><span class="p">,</span> <span class="s1">&#39;IL1A&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;IL1B&#39;</span><span class="p">,</span> <span class="s1">&#39;IL6&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB7&#39;</span><span class="p">,</span> <span class="s1">&#39;ITK&#39;</span><span class="p">,</span> <span class="s1">&#39;KLF10&#39;</span><span class="p">,</span> <span class="s1">&#39;LAG3&#39;</span><span class="p">,</span> <span class="s1">&#39;LAT&#39;</span><span class="p">,</span> <span class="s1">&#39;LCK&#39;</span><span class="p">,</span> <span class="s1">&#39;LCP2&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;PRF1&#39;</span><span class="p">,</span> <span class="s1">&#39;PTPN6&#39;</span><span class="p">,</span> <span class="s1">&#39;SNAI1&#39;</span><span class="p">,</span> <span class="s1">&#39;TGFB2&#39;</span><span class="p">,</span> <span class="s1">&#39;TGFBR1&#39;</span><span class="p">,</span> <span class="s1">&#39;TGFBR2&#39;</span><span class="p">,</span> <span class="s1">&#39;TNF&#39;</span><span class="p">,</span> <span class="s1">&#39;TUBA1A&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;VAV1&#39;</span><span class="p">,</span> <span class="s1">&#39;VEGFA&#39;</span><span class="p">,</span> <span class="s1">&#39;ZAP70&#39;</span><span class="p">,</span> <span class="s1">&#39;ZEB1&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gene_sig</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50
</pre></div>
</div>
</div>
</div>
<p>We check that all features in <code class="docutils literal notranslate"><span class="pre">gene_sig</span></code> are also in the graphs:</p>
<section id="feature-neighborhood-distances">
<h2>Feature neighborhood distances<a class="headerlink" href="#feature-neighborhood-distances" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s1">&#39;clin&#39;</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">wass_distance_pairwise_observation_feature_nbhd</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">gene_sig</span><span class="p">,</span>
                                                           <span class="n">include_self</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">gene_sig_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">netflow.methods.classes: <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">08</span>/<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">05</span>/<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">2024</span> <span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">01:41:55</span>  PM | <span style="color: #808000; text-decoration-color: #808000; font-weight: bold">MSG</span> |                                                           
classes:multiple_pairwise_observation_neighborhood_wass_distan<span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">ce:818</span> | &gt;&gt;&gt; Loaded saved observation pairwise <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1</span>-hop 
neighborhood Wasserstein distances from rna_immune_signature_wass_dist_observation_pairwise_nbhds_without_self     
profiles of size <span style="font-weight: bold">(</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">183315</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">48</span><span style="font-weight: bold">)</span>.                                                                                     
</pre>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for dd in keeper.data:</span>
<span class="c1">#     keeper.euc_distance_pairwise_observation_feature_nbhd(dd.label, dd.label, features=gene_sig,</span>
<span class="c1">#                                                            include_self=False, label=gene_sig_label,</span>
<span class="c1">#                                                            metric=&#39;euclidean&#39;)</span>
</pre></div>
</div>
</div>
</div>
<section id="distance-from-a-single-feature-neighborhood">
<h3>Distance from a single feature neighborhood<a class="headerlink" href="#distance-from-a-single-feature-neighborhood" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rna_CD28_nbhd_wass_dist</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">misc</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;rna_</span><span class="si">{</span><span class="n">gene_sig_label</span><span class="si">}</span><span class="s2">_wass_dist_observation_pairwise_nbhds_without_self&quot;</span><span class="p">][</span><span class="s1">&#39;CD28&#39;</span><span class="p">]</span>
<span class="n">rna_CD28_nbhd_wass_dist</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>observation_a    observation_b  
TCGA-E9-A295-01  TCGA-AR-A1AS-01    0.226186
                 TCGA-AQ-A1H2-01    0.223247
                 TCGA-A8-A08O-01    0.246211
                 TCGA-BH-A1FJ-01    0.322797
                 TCGA-JL-A3YX-01    0.382493
Name: CD28, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">add_stacked_distance</span><span class="p">(</span><span class="n">rna_CD28_nbhd_wass_dist</span><span class="p">,</span> <span class="s1">&#39;wass_dist_rna_CD28_nbhd&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="distance-from-norm-of-feature-neighborhood-distances">
<h3>Distance from norm of feature neighborhood distances<a class="headerlink" href="#distance-from-norm-of-feature-neighborhood-distances" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># misc_key = f&quot;rna_{gene_sig_label}_wass_dist_observation_pairwise_nbhds_without_self&quot;</span>
<span class="c1"># distance_label = f&quot;norm_{misc_key}&quot;</span>
<span class="c1"># nf.methods.metrics.norm_features_as_sym_dist(keeper, misc_key,label=distance_label,</span>
<span class="c1">#                                              features=None, method=&#39;L1&#39;)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="feature-profile-distances">
<h2>Feature profile distances<a class="headerlink" href="#feature-profile-distances" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># hvg = keeper.data[&#39;rna&#39;].to_frame().var(axis=1).nlargest(100).index.tolist()</span>
<span class="c1"># hvg_label = &#39;hvg100&#39;</span>

<span class="c1"># for dd in keeper.data:    </span>
<span class="c1">#     # Wasserstein distances:</span>
<span class="c1">#     keeper.wass_distance_pairwise_observation_profile(dd.label, dd.label, </span>
<span class="c1">#                                                       features=hvg, label=hvg_label,                                                      </span>
<span class="c1">#                                                       graph_distances=None, edge_weight=None)</span>
    
<span class="c1">#     # Euclidean distances highly variable:</span>
<span class="c1">#     keeper.euc_distance_pairwise_observation_profile(dd.label, features=hvg, label=hvg_label)                                                                  </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>    
    <span class="c1"># Wasserstein distances:</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">wass_distance_pairwise_observation_profile</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> 
                                                      <span class="n">features</span><span class="o">=</span><span class="n">gene_sig</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">gene_sig_label</span><span class="p">,</span>                                                      
                                                      <span class="n">graph_distances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Euclidean distances:</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">euc_distance_pairwise_observation_profile</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">gene_sig</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">gene_sig_label</span><span class="p">)</span>                                                                  
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="compute-similarities-from-distances">
<h1>Compute similarities from distances<a class="headerlink" href="#compute-similarities-from-distances" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">distances</span><span class="p">:</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">compute_similarity_from_distance</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>                                                    
                                            <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">knn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see the labels of all the similarities that have been added to the keeper (one for each distance that was in the keeper):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">similarities</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>similarity_max5nn_wass_dist_rna_CD28_nbhd
</pre></div>
</div>
</div>
</div>
</section>
<section id="fused-similarities">
<h1>Fused similarities<a class="headerlink" href="#fused-similarities" title="Permalink to this headline">#</a></h1>
<p>We can take any combination of similarities and add them as a fused similarity to the keeper.</p>
<p>For example, we can fuse the Wasserstein and Euclidean RNA profile distances.</p>
<p>This can be done in two ways :</p>
<ol class="arabic simple">
<li><p>Explicitly, by computing the fused distance and then adding it to the keeper or,</p></li>
<li><p>implicitly, using the keeper’s method <code class="docutils literal notranslate"><span class="pre">fuse_similarities</span></code>. In this approach, you provide:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">similarity_keys</span></code> : the list of keys referencing the similarities that should be fused</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weights</span></code> (optional) : weights for how much each similarity should contribute to the fusion. The default behavior is to assign uniform weights and compute the average.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fused_key</span></code> (optional) : the key used to store the fused similarity in the keeper. The default behavior is to fuse the keys of the original similarities.</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">fuse_similarities</span><span class="p">([</span><span class="s1">&#39;similarity_max5nn_rna_immune_signature_wass_dist_observation_pairwise_profiles&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;similarity_max5nn_rna_immune_signature_euc_dist_observation_pairwise_profiles&#39;</span><span class="p">],</span>
                         <span class="c1"># weights=None,  # uncomment to add fused weighting</span>
                        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that the fused similarity has been added to the Keeper with the key
<code class="docutils literal notranslate"><span class="pre">'fused_similarity_max5nn_rna_immune_signature_wass_euc_dist_observation_pairwise_profiles'</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">similarities</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>similarity_max5nn_wass_dist_rna_CD28_nbhd
similarity_max5nn_rna_immune_signature_wass_dist_observation_pairwise_profiles
similarity_max5nn_rna_immune_signature_euc_dist_observation_pairwise_profiles
fused_similarity_max5nn_rna_immune_signature_wass_euc_dist_observation_pairwise_profiles
</pre></div>
</div>
</div>
</div>
<p>Or, we can fuse the RNA and methylation Wasserstein profile distances:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># keeper.fuse_similarities([&#39;similarity_max5nn_rna_immune_signature_wass_dist_observation_pairwise_profiles&#39;,</span>
<span class="c1">#                           &#39;similarity_max5nn_meth_immune_signature_wass_dist_observation_pairwise_profiles&#39;])</span>
</pre></div>
</div>
</div>
</div>
<p>We can check that it has been added to the similarities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;fused_similarity_max5nn_rna_meth_immune_signature_wass_dist_observation_pairwise_profiles&#39; in keeper.similarities</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Since the similarities range from 0 to 1 (0 being the least similar and 1 being the most similar), we can transform them into distances by taking 1-similarity.</p></li>
</ul>
<p>Next, we add the distances from each similarity to <code class="docutils literal notranslate"><span class="pre">keeper.distances</span></code>, so they can be used in later analysis:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">similarities</span><span class="p">:</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">convert_similarity_to_distance</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-diffusion-distances">
<h1>Compute diffusion distances<a class="headerlink" href="#compute-diffusion-distances" title="Permalink to this headline">#</a></h1>
<p>Next we show how to compute the multi-scale diffusion distance from a similarity. This entails computing the transition matrix associated with the similarity which is stored in the misc keeper.</p>
<p>To compute the diffusion distance for each similarity, we simply loop through the similarities stored in the keeper. See the documentation for a description of additional options.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">sim</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">similarities</span><span class="p">:</span>
    <span class="n">keeper</span><span class="o">.</span><span class="n">compute_dpt_from_similarity</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">density_normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for sim in keeper.similarities:</span>
<span class="c1">#     keeper.compute_transitions_from_similarity(sim.label, density_normalize=True)</span>
<span class="c1">#     T_sym_label = f&quot;transitions_sym_{sim.label}&quot;</span>
<span class="c1">#     keeper.compute_dpt_from_augmented_sym_transitions(T_sym_label)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-the-pose">
<h1>Compute the POSE<a class="headerlink" href="#compute-the-pose" title="Permalink to this headline">#</a></h1>
<p>The POSE can be computed from any distance in the keeper. We demonstrate this next using the multi-scale Wasserstein distance between RNA immune signature profiles, with the reference key <code class="docutils literal notranslate"><span class="pre">'dpt_from_transitions_sym_similarity_max5nn_rna_immune_signature_wass_dist_observation_pairwise_profiles'</span></code> in the keeper.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">POSER</span></code> class is used to perform the iterative branching and keep track the branches and their splits.
The final <strong>POSE</strong>, i.e., the <strong>P</strong>seudo-<strong>O</strong>rganizational <strong>S</strong>tructur<strong>E</strong> of the observations is returned as a graph where each observation is represented as a node. The edges show the organizational relationship determined from the ordering (lineage tracing algorithm) and nearest neighbors (alleviates strict assumptions of lineage tracing that do not apply).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">distances</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>wass_dist_rna_CD28_nbhd
dpt_from_transitions_sym_similarity_max5nn_wass_dist_rna_CD28_nbhd
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># key = &#39;distance_from_fused_similarity_max5nn_rna_meth_immune_signature_wass_dist_observation_pairwise_profiles&#39;</span>
<span class="c1"># key = &#39;dpt_from_transitions_sym_similarity_max5nn_norm_rna_immune_signature_wass_dist_observation_pairwise_nbhds_without_self&#39;</span>
<span class="c1"># key = &#39;dpt_from_transitions_sym_similarity_max5nn_meth_immune_signature_wass_dist_observation_pairwise_profiles&#39;</span>
<span class="c1"># key = &#39;dpt_from_transitions_sym_similarity_max5nn_meth_immune_signature_euc_dist_observation_pairwise_profiles&#39;</span>
<span class="c1"># key = &#39;dpt_from_transitions_sym_fused_similarity_max5nn_rna_immune_signature_wass_euc_dist_observation_pairwise_profiles&#39;</span>

<span class="c1"># key = &#39;dpt_from_transitions_sym_similarity_max5nn_rna_hvg100_euc_dist_observation_pairwise_profiles&#39;</span>
<span class="c1"># key = &#39;dpt_from_transitions_sym_similarity_max5nn_rna_hvg100_wass_dist_observation_pairwise_profiles&#39;</span>

<span class="c1"># key = &#39;dpt_from_transitions_sym_similarity_max5nn_rna_immune_signature_euc_dist_observation_pairwise_profiles&#39;</span>
<span class="c1"># key = &#39;dpt_from_transitions_sym_similarity_max5nn_rna_immune_signature_wass_dist_observation_pairwise_profiles&#39;</span>
<span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;dpt_from_transitions_sym_similarity_max5nn_wass_dist_rna_CD28_nbhd&#39;</span>


<span class="n">poser</span><span class="p">,</span> <span class="n">G_poser_nn</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">construct_pose</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">n_branches</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="c1"># 5, </span>
                                          <span class="n">min_branch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                          <span class="n">until_branched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="a-closer-look-at-the-poser">
<h2>A closer look at the POSER<a class="headerlink" href="#a-closer-look-at-the-poser" title="Permalink to this headline">#</a></h2>
<p>First, we can get the index of the observation that was used as the root:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poser</span><span class="o">.</span><span class="n">root</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>433
</pre></div>
</div>
</div>
</div>
<p>We can also get the label of the root observation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;TCGA-OL-A5RW-01&#39;
</pre></div>
</div>
</div>
</div>
<p>We can get an overview of the branching:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poser</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">disp</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>            ┌1 (n = 58)
            ├2 (n = 60)
            │                   ┌0 - trunk (n = 13)
            │                   ├4 (n = 2)
            ├0 - trunk (n = 113)┤
            │                   ├6 (n = 97)
            │                   └5 (n = 1)
 0 (n = 606)┤
            │           ┌3 - trunk (n = 20)
            │           ├7 (n = 17)
            │           ├9 (n = 4)
            └3 (n = 375)┤
                        │           ┌8 - trunk (n = 53)
                        │           ├10 (n = 14)
                        │           ├11 (n = 248)
                        └8 (n = 334)┤
                                    │           ┌12 - trunk (n = 11)
                                    │           ├13 (n = 1)
                                    └12 (n = 19)┤
                                                ├15 (n = 2)
                                                └14 (n = 5)
</pre></div>
</div>
</div>
</div>
<p>We can get a list of the branches that were split in the order in which they were split:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poser</span><span class="o">.</span><span class="n">branched_ordering</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0 (n = 606), 0 - trunk (n = 113), 3 (n = 375), 8 (n = 334), 12 (n = 19)]
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-the-pose">
<h2>Visualizing the POSE<a class="headerlink" href="#visualizing-the-pose" title="Permalink to this headline">#</a></h2>
<p>We can get a record of the branch that each observation is assigned to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">branch_record</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;branch&#39;</span><span class="p">,</span> 
                                                     <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)))</span>
<span class="n">branch_record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
</pre></div>
</div>
</div>
</div>
<section id="kaplan-meier-survival-analysis">
<h3>Kaplan-Meier survival analysis<a class="headerlink" href="#kaplan-meier-survival-analysis" title="Permalink to this headline">#</a></h3>
<p>Next, we perform Kaplan-Meier survival analysis grouping the observations by their branch.</p>
<p><strong>Note:</strong> We point out that the branches provide an ordering (and not a partition). While branching captures breaks in relational structure of the observations, it does not necessarily partition the observations into hetergeneous clusters where the clusters are made up of homogeneous observations. Further clustering is recommended</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">clin</span><span class="p">[</span><span class="s1">&#39;OS_MONTHS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">E</span> <span class="o">=</span> <span class="n">clin</span><span class="p">[</span><span class="s1">&#39;OS_STATUS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;0:LIVING&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;1:DECEASED&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">display</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="n">TE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>282.69
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    530
1     76
Name: OS_STATUS, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cut</span> <span class="o">=</span> <span class="mf">12.</span><span class="o">*</span><span class="mf">10.</span>
<span class="n">Tcut</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Tcut</span><span class="p">[</span><span class="n">Tcut</span> <span class="o">&gt;</span> <span class="n">cut</span><span class="p">]</span> <span class="o">=</span> <span class="n">cut</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Tcut</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">Ecut</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">Ecut</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">T</span> <span class="o">&gt;</span> <span class="n">cut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">E</span><span class="o">==</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">display</span><span class="p">(</span><span class="n">Ecut</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="n">TEcut</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">Tcut</span><span class="p">,</span> <span class="n">Ecut</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>120.0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    534
1     72
Name: OS_STATUS, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">10</span> <span class="k">else</span> <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>

<span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
    <span class="n">color_cycler</span> <span class="o">=</span> <span class="n">colors</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> 
                                       <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mapper</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gist_rainbow</span><span class="p">)</span>
    <span class="n">color_cycler</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapper</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>

<span class="n">nfv</span><span class="o">.</span><span class="n">KM_between_groups</span><span class="p">(</span><span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_MONTHS&#39;</span><span class="p">],</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_STATUS&#39;</span><span class="p">],</span> 
                      <span class="n">branch_record</span><span class="p">,</span> <span class="n">min_group_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">show_at_risk_counts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">ttl</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;POSE branching</span><span class="se">\n</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>                      
                      <span class="n">colors</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">color_cycler</span><span class="p">))),</span> 
                      <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;time (months)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                      <span class="n">censor_styles</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="c1"># &#39;markeredgecolor&#39;: &#39;#ff0000&#39;,</span>
                                    <span class="p">},</span>
                      <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f267f5c85b988e4cd56aa5a86cef0b74d063f044c8e0230d95152ff71594662d.png" src="../../_images/f267f5c85b988e4cd56aa5a86cef0b74d063f044c8e0230d95152ff71594662d.png" />
</div>
</div>
</section>
<section id="visualize-pose">
<h3>Visualize POSE<a class="headerlink" href="#visualize-pose" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First determine features to color nodes by:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root_obs</span> <span class="o">=</span> <span class="n">poser</span><span class="o">.</span><span class="n">root</span>
<span class="n">nodelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">)</span>
<span class="n">edgelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
<span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">}</span>
<span class="n">edge_style</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">ee</span><span class="p">][</span><span class="s1">&#39;edge_origin&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">edgelist</span><span class="p">]</span>
<span class="n">node_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span> <span class="k">if</span> <span class="n">k</span><span class="o">==</span> <span class="n">root_obs</span> <span class="k">else</span> <span class="mi">30</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
<span class="c1"># node_shape = clin[&#39;Dead&#39;].replace({False: &#39;alive&#39;, True: &#39;deceased&#39;}).loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>
<span class="c1"># node_shape_response = clin[&#39;Response&#39;].loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>
<span class="n">node_shape_pam50</span> <span class="o">=</span> <span class="n">clin</span><span class="p">[</span><span class="s1">&#39;PAM50&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">node_shape_os</span> <span class="o">=</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_STATUS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Deceased&#39;</span><span class="p">,</span> 
                                            <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Alive&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">nsm_pam50</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal&#39;</span><span class="p">:</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;LumA&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;Basal&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;LumB&#39;</span><span class="p">:</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;Her2&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">}</span>
<span class="n">nsm_os</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Alive&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;Deceased&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">}</span>

<span class="n">node_colors_record</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;pseudo-distance to root&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span> 
<span class="n">node_colors_record</span><span class="p">[</span><span class="s1">&#39;OS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_MONTHS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> 
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mean </span><span class="si">{</span><span class="n">gene_sig_label</span><span class="si">}</span><span class="s2"> rna signature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gene_sig</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># node_colors_record[&#39;CD28 rna&#39;] = keeper.data[&#39;rna&#39;].subset(features=[&#39;CD28&#39;]).loc[&#39;CD28&#39;].loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>

<span class="k">for</span> <span class="n">gn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD28&#39;</span><span class="p">,</span> <span class="s1">&#39;ITK&#39;</span><span class="p">,</span> <span class="s1">&#39;LCK&#39;</span><span class="p">,</span> <span class="s1">&#39;CD4&#39;</span><span class="p">,</span> <span class="s1">&#39;CD247&#39;</span><span class="p">,</span><span class="s1">&#39;CD80&#39;</span><span class="p">,</span><span class="s1">&#39;CD86&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB7&#39;</span><span class="p">]:</span> <span class="c1"># [&#39;CD28&#39;, &#39;CD4&#39;, &#39;CCR5&#39;, &#39;CD3G&#39;, &#39;LCP2&#39;, &#39;LCK&#39;, &#39;ITK&#39;, &#39;ITGB7&#39;]: # [&#39;CD28&#39;, &#39;GZMB&#39;, &#39;TGFBR2&#39;, &#39;TNF&#39;]:</span>
    <span class="n">node_colors_record</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="c1"># gridspec_kw={&#39;hspace&#39;:0.001, &#39;wspace&#39;: 0.02},</span>
                         <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 42</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POSE: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">nodes colored by:&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">node_shape</span><span class="p">,</span> <span class="n">nsm</span><span class="p">,</span> <span class="n">ncde</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_colors_record</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                           <span class="p">[</span><span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nipy_spectral&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">node_shape_os</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">nsm_os</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1">#  + [{0: &#39;NIV3-NAIVE&#39;, 1: &#39;NIV3-PROG&#39;}] + [None]*3,</span>
                                                           <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                           <span class="n">with_node_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_edge_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                           <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>                   
                           <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_shape_mapper</span><span class="o">=</span><span class="n">nsm</span><span class="p">,</span> 
                           <span class="n">border_linewidths</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="c1"># 0.5, </span>
                           <span class="n">bordercolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edge_style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">,</span> 
                           <span class="n">edge_style_mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;POSE + NN&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;POSE&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;NN&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">},</span>
                           <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
                           <span class="n">node_cmap_drawedges</span><span class="o">=</span><span class="n">ncde</span><span class="p">,</span>
                           <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                          <span class="p">)</span>        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/da43f74056fb4d3604da2f90cee4d7448c780266b7fdf369ea7dd6e5a15894d9.png" src="../../_images/da43f74056fb4d3604da2f90cee4d7448c780266b7fdf369ea7dd6e5a15894d9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Graph with 606 nodes and 985 edges
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root_obs</span> <span class="o">=</span> <span class="n">poser</span><span class="o">.</span><span class="n">root</span>
<span class="n">nodelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">)</span>
<span class="n">edgelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
<span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">}</span>
<span class="n">edge_style</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">ee</span><span class="p">][</span><span class="s1">&#39;edge_origin&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">edgelist</span><span class="p">]</span>
<span class="n">node_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span> <span class="k">if</span> <span class="n">k</span><span class="o">==</span> <span class="n">root_obs</span> <span class="k">else</span> <span class="mi">30</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
<span class="c1"># node_shape = clin[&#39;Dead&#39;].replace({False: &#39;alive&#39;, True: &#39;deceased&#39;}).loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>
<span class="c1"># node_shape_response = clin[&#39;Response&#39;].loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>
<span class="n">node_shape_pam50</span> <span class="o">=</span> <span class="n">clin</span><span class="p">[</span><span class="s1">&#39;PAM50&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">node_shape_os</span> <span class="o">=</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_STATUS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Deceased&#39;</span><span class="p">,</span> 
                                            <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Alive&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">nsm_pam50</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal&#39;</span><span class="p">:</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;LumA&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;Basal&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;LumB&#39;</span><span class="p">:</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;Her2&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">}</span>
<span class="n">nsm_os</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Alive&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;Deceased&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">}</span>

<span class="n">node_colors_record</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;pseudo-distance to root&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span> 
<span class="n">node_colors_record</span><span class="p">[</span><span class="s1">&#39;OS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_MONTHS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> 
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mean </span><span class="si">{</span><span class="n">gene_sig_label</span><span class="si">}</span><span class="s2"> rna signature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gene_sig</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># node_colors_record[&#39;CD28 rna&#39;] = keeper.data[&#39;rna&#39;].subset(features=[&#39;CD28&#39;]).loc[&#39;CD28&#39;].loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>

<span class="k">for</span> <span class="n">gn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD28&#39;</span><span class="p">,</span> <span class="s1">&#39;CD4&#39;</span><span class="p">,</span> <span class="s1">&#39;CCR5&#39;</span><span class="p">,</span> <span class="s1">&#39;CD3G&#39;</span><span class="p">,</span> <span class="s1">&#39;LCP2&#39;</span><span class="p">,</span> <span class="s1">&#39;LCK&#39;</span><span class="p">,</span> <span class="s1">&#39;ITK&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB7&#39;</span><span class="p">]:</span> <span class="c1"># [&#39;CD28&#39;, &#39;GZMB&#39;, &#39;TGFBR2&#39;, &#39;TNF&#39;]: </span>
    <span class="c1"># [&#39;CD28&#39;, &#39;ITK&#39;, &#39;LCK&#39;, &#39;CD4&#39;, &#39;CD247&#39;,&#39;CD80&#39;,&#39;CD86&#39;]</span>
    
    <span class="n">node_colors_record</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="c1"># gridspec_kw={&#39;hspace&#39;:0.001, &#39;wspace&#39;: 0.02},</span>
                         <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 42</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POSE: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">nodes colored by:&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">node_shape</span><span class="p">,</span> <span class="n">nsm</span><span class="p">,</span> <span class="n">ncde</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_colors_record</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                           <span class="p">[</span><span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nipy_spectral&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">node_shape_os</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">nsm_os</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1">#  + [{0: &#39;NIV3-NAIVE&#39;, 1: &#39;NIV3-PROG&#39;}] + [None]*3,</span>
                                                           <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                           <span class="n">with_node_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_edge_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                           <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>                   
                           <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_shape_mapper</span><span class="o">=</span><span class="n">nsm</span><span class="p">,</span> 
                           <span class="n">border_linewidths</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="c1"># 0.5, </span>
                           <span class="n">bordercolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edge_style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">,</span> 
                           <span class="n">edge_style_mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;POSE + NN&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;POSE&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;NN&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">},</span>
                           <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
                           <span class="n">node_cmap_drawedges</span><span class="o">=</span><span class="n">ncde</span><span class="p">,</span>
                           <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                          <span class="p">)</span>        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5101dcf25716dab962fe53951ac183bb5c36c42865f01f50d4082eb6b33771c8.png" src="../../_images/5101dcf25716dab962fe53951ac183bb5c36c42865f01f50d4082eb6b33771c8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node_colors_record</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
<span class="k">for</span> <span class="n">gn</span> <span class="ow">in</span> <span class="n">gene_sig</span><span class="p">:</span>
    <span class="n">node_colors_record</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="c1"># gridspec_kw={&#39;hspace&#39;:0.001, &#39;wspace&#39;: 0.02},</span>
                         <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 42</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POSE: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">nodes colored by:&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">);</span>
<span class="n">node_size</span><span class="o">=</span><span class="mi">5</span>
<span class="k">for</span> <span class="p">(</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">node_shape</span><span class="p">,</span> <span class="n">nsm</span><span class="p">,</span> <span class="n">ncde</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_colors_record</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                           <span class="p">[</span><span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nipy_spectral&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># 2 + [node_shape_os] + [node_shape_pam50]*6,</span>
                                                           <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *2 + [nsm_os] + [nsm_pam50]*6,</span>
                                                           <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8,</span>
                                                           <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8, #  + [{0: &#39;NIV3-NAIVE&#39;, 1: &#39;NIV3-PROG&#39;}] + [None]*3,</span>
                                                           <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                           <span class="n">with_node_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_edge_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                           <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>                   
                           <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_shape_mapper</span><span class="o">=</span><span class="n">nsm</span><span class="p">,</span> 
                           <span class="n">border_linewidths</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="c1"># 0.5, </span>
                           <span class="n">bordercolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edge_style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">,</span> 
                           <span class="n">edge_style_mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;POSE + NN&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;POSE&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;NN&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">},</span>
                           <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
                           <span class="n">node_cmap_drawedges</span><span class="o">=</span><span class="n">ncde</span><span class="p">,</span>
                           <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                           <span class="n">edge_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e849f69bef33b43f1281ea3dd0ccc241cfc876bdff3a9a0a1e6e5684018d6350.png" src="../../_images/e849f69bef33b43f1281ea3dd0ccc241cfc876bdff3a9a0a1e6e5684018d6350.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">node_colors_record</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
<span class="k">for</span> <span class="n">gn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD28&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="s1">&#39;CD28&#39;</span><span class="p">)):</span> <span class="c1"># gene_sig:</span>
    <span class="n">node_colors_record</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="c1"># gridspec_kw={&#39;hspace&#39;:0.001, &#39;wspace&#39;: 0.02},</span>
                         <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 42</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POSE: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">nodes colored by:&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">);</span>
<span class="n">node_size</span><span class="o">=</span><span class="mi">5</span>
<span class="k">for</span> <span class="p">(</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">node_shape</span><span class="p">,</span> <span class="n">nsm</span><span class="p">,</span> <span class="n">ncde</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_colors_record</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                           <span class="p">[</span><span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nipy_spectral&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                           <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># 2 + [node_shape_os] + [node_shape_pam50]*6,</span>
                                                           <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *2 + [nsm_os] + [nsm_pam50]*6,</span>
                                                           <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8,</span>
                                                           <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8, #  + [{0: &#39;NIV3-NAIVE&#39;, 1: &#39;NIV3-PROG&#39;}] + [None]*3,</span>
                                                           <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                           <span class="n">with_node_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_edge_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                           <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>                   
                           <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_shape_mapper</span><span class="o">=</span><span class="n">nsm</span><span class="p">,</span> 
                           <span class="n">border_linewidths</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="c1"># 0.5, </span>
                           <span class="n">bordercolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edge_style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">,</span> 
                           <span class="n">edge_style_mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;POSE + NN&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;POSE&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;NN&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">},</span>
                           <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
                           <span class="n">node_cmap_drawedges</span><span class="o">=</span><span class="n">ncde</span><span class="p">,</span>
                           <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                           <span class="n">edge_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/54281fa0faff91bff2fcc42fb1ac0574eb1b5aa143249a02466285d7a08aff92.png" src="../../_images/54281fa0faff91bff2fcc42fb1ac0574eb1b5aa143249a02466285d7a08aff92.png" />
</div>
</div>
</section>
</section>
</section>
<section id="compare-poses">
<h1>Compare poses<a class="headerlink" href="#compare-poses" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">dd</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">distances</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>wass_dist_rna_CD28_nbhd
rna_immune_signature_wass_dist_observation_pairwise_profiles
rna_immune_signature_euc_dist_observation_pairwise_profiles
dpt_from_transitions_sym_similarity_max5nn_wass_dist_rna_CD28_nbhd
dpt_from_transitions_sym_similarity_max5nn_rna_immune_signature_wass_dist_observation_pairwise_profiles
dpt_from_transitions_sym_similarity_max5nn_rna_immune_signature_euc_dist_observation_pairwise_profiles
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">construct_pose</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on method construct_pose in module netflow.keepers.keeper:

construct_pose(key, root=None, min_branch_size=5, choose_largest_segment=False, flavor=&#39;haghverdi16&#39;, allow_kendall_tau_shift=False, smooth_corr=True, brute=True, split=True, verbose=None, n_branches=2, until_branched=False) method of netflow.keepers.keeper.Keeper instance
    Construct the POSE from specified distance.
    
    Parameters
    ----------
    key : `str`
        The label used to reference the distance matrix stored in ``keeper.distances``,
        of size (n_observations, n_observations).
    root : {`None`, `int`, &#39;density&#39;, &#39;ratio&#39;}
        The root. If `None`, &#39;density&#39; is used.
    
        options
        -------
        - `int` : index of observation
        - &#39;density&#39; : select observation with minimal distance-density
        - &#39;ratio&#39; : select observation which leads to maximal triangular ratio distance
    min_branch_size : {`int`, `float`}
        During recursive splitting of branches, only consider splitting a branch with at least
        ``min_branch_size &gt; 2`` data points.
        If a `float`, ``min_branch_size`` refers to the fraction of the total number of data points
        (``0 &lt; min_branch_size &lt; 1``).
    choose_largest_segment : `bool`
        If `True`, select largest segment for branching.
    flavor : {&#39;haghverdi16&#39;, &#39;wolf17_tri&#39;, &#39;wolf17_bi&#39;, &#39;wolf17_bi_un&#39;}
        Branching algorithm (based on `scanpy` implementation).
    allow_kendall_tau_shift : `bool`
        If a very small branch is detected upon splitting, shift away from
        maximum correlation in Kendall tau criterion of [Haghverdi16]_ to
        stabilize the splitting.
    smooth_corr : `bool`, default = `False`
        If `True`, smooth correlations before identifying cut points for branch splitting.
    brute : `bool`
        If `True`, data points not associated with any branch upon split are combined with
        undecided (trunk) points. Otherwise, if `False`, they are treated as individual islands,
        not associated with any branch (and assigned branch index -1).
    split : `bool` (default = True)
            if `True`, split segment into multiple branches. Otherwise,
            determine a single branching off of the main segment.
            This is ignored if flavor is not &#39;haghverdi16&#39;.
            If `True`, ``brute`` is ignored.
    n_branches : `int`
        Number of branches to look for (``n_branches &gt; 0``).
    until_branched : `bool`
        If `True`, iteratively find segment to branch and perform branching
        until a segement is successfully branched or no branchable segments
        remain. Otherwise, if `False`, attempt to perform branching only once 
        on the next potentially branchable segment.
    
        ..note::
    
          This is only applicable when branching is being performed. If previous
          iterations of branching has already been performed, it is not possible to
          identify the number of iterations where no branching was performed.
    
    Returns
    -------
    poser : `netflow.pose.POSER`
        The object used to construct the POSE.
    G_poser_nn : `networkx.Graph`
        The updated graph with nearest neighbor edges and edge attribute &quot;edge_origin&quot;
        with the possible values :
    
        - &quot;POSE&quot; : for edges in the original graph that are not nearest neighbor edges
        - &quot;NN&quot; : for nearest neighbor edges that were not in the original graph
        - &quot;POSE + NN&quot; : for edges in the original graph that are also nearest neighbor edges
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;TCGA-AR-A251-01&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
<span class="s1">&#39;TCGA-AR-A251-01&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;TCGA-3C-AALJ-01&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">num_observations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>606
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BRANCH_RECORDS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">distances</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">label</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;dpt_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;distance_fr&#39;</span><span class="p">)):</span>
        <span class="k">continue</span>
    <span class="n">poser</span><span class="p">,</span> <span class="n">G_poser_nn</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">construct_pose</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">n_branches</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="c1"># 5, </span>
                                              <span class="n">min_branch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                              <span class="n">until_branched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span>
    <span class="n">branch_record</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;branch&#39;</span><span class="p">,</span> 
                                                     <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)))</span>
    <span class="n">branch_record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
    <span class="n">BRANCH_RECORDS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">branch_record</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab10</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">10</span> <span class="k">else</span> <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
        <span class="n">color_cycler</span> <span class="o">=</span> <span class="n">colors</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> 
                                           <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mapper</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gist_rainbow</span><span class="p">)</span>
        <span class="n">color_cycler</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapper</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">nfv</span><span class="o">.</span><span class="n">KM_between_groups</span><span class="p">(</span><span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_MONTHS&#39;</span><span class="p">],</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_STATUS&#39;</span><span class="p">],</span> 
                          <span class="n">branch_record</span><span class="p">,</span> <span class="n">min_group_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                          <span class="c1"># figsize=(7, 4), </span>
                          <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                          <span class="n">show_censors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ci_show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">show_at_risk_counts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">ttl</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;POSE branching</span><span class="se">\n</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>                      
                          <span class="n">colors</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">branch_record</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">color_cycler</span><span class="p">))),</span> 
                          <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;time (months)&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">censor_styles</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="c1"># &#39;markeredgecolor&#39;: &#39;#ff0000&#39;,</span>
                                        <span class="p">},</span>
                          <span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/Users/renae12/Downloads/netflow_tutorial_test/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_KM.png&quot;</span><span class="p">,</span>
                <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">)</span>
    
    <span class="n">root_obs</span> <span class="o">=</span> <span class="n">poser</span><span class="o">.</span><span class="n">root</span>
    <span class="n">nodelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">)</span>
    <span class="n">edgelist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
    <span class="n">node_labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">}</span>
    <span class="n">edge_style</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">ee</span><span class="p">][</span><span class="s1">&#39;edge_origin&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">edgelist</span><span class="p">]</span>
    <span class="n">node_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span> <span class="k">if</span> <span class="n">k</span><span class="o">==</span> <span class="n">root_obs</span> <span class="k">else</span> <span class="mi">30</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
    <span class="c1"># node_shape = clin[&#39;Dead&#39;].replace({False: &#39;alive&#39;, True: &#39;deceased&#39;}).loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>
    <span class="c1"># node_shape_response = clin[&#39;Response&#39;].loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>
    <span class="n">node_shape_pam50</span> <span class="o">=</span> <span class="n">clin</span><span class="p">[</span><span class="s1">&#39;PAM50&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">node_shape_os</span> <span class="o">=</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_STATUS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;Deceased&#39;</span><span class="p">,</span> 
                                                <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;Alive&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">nsm_pam50</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Normal&#39;</span><span class="p">:</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;LumA&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;Basal&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;LumB&#39;</span><span class="p">:</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;Her2&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">}</span>
    <span class="n">nsm_os</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Alive&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;Deceased&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">}</span>

    <span class="n">node_colors_record</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
    <span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;pseudo-distance to root&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">distances</span><span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span> 
    <span class="n">node_colors_record</span><span class="p">[</span><span class="s1">&#39;OS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEcut</span><span class="p">[</span><span class="s1">&#39;OS_MONTHS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> 
    <span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;mean </span><span class="si">{</span><span class="n">gene_sig_label</span><span class="si">}</span><span class="s2"> rna signature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gene_sig</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="c1"># node_colors_record[&#39;CD28 rna&#39;] = keeper.data[&#39;rna&#39;].subset(features=[&#39;CD28&#39;]).loc[&#39;CD28&#39;].loc[[node_labels[kk] for kk in nodelist]].values.tolist()</span>

    <span class="k">for</span> <span class="n">gn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD28&#39;</span><span class="p">,</span> <span class="s1">&#39;CD4&#39;</span><span class="p">,</span> <span class="s1">&#39;CCR5&#39;</span><span class="p">,</span> <span class="s1">&#39;CD3G&#39;</span><span class="p">,</span> <span class="s1">&#39;LCP2&#39;</span><span class="p">,</span> <span class="s1">&#39;LCK&#39;</span><span class="p">,</span> <span class="s1">&#39;ITK&#39;</span><span class="p">,</span> <span class="s1">&#39;ITGB7&#39;</span><span class="p">]:</span> <span class="c1"># [&#39;CD28&#39;, &#39;GZMB&#39;, &#39;TGFBR2&#39;, &#39;TNF&#39;]: </span>
        <span class="c1"># [&#39;CD28&#39;, &#39;ITK&#39;, &#39;LCK&#39;, &#39;CD4&#39;, &#39;CD247&#39;,&#39;CD80&#39;,&#39;CD86&#39;]</span>
        <span class="c1"># [&#39;CD28&#39;, &#39;ITK&#39;, &#39;LCK&#39;, &#39;CD4&#39;, &#39;CD247&#39;,&#39;CD80&#39;,&#39;CD86&#39;, &#39;ITGB7&#39;]: # [&#39;CD28&#39;, &#39;CD4&#39;, &#39;CCR5&#39;, &#39;CD3G&#39;, &#39;LCP2&#39;, &#39;LCK&#39;, &#39;ITK&#39;, &#39;ITGB7&#39;]: # [&#39;CD28&#39;, &#39;GZMB&#39;, &#39;TGFBR2&#39;, &#39;TNF&#39;]:</span>
        <span class="n">node_colors_record</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="c1"># gridspec_kw={&#39;hspace&#39;:0.001, &#39;wspace&#39;: 0.02},</span>
                             <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 42</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POSE: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">nodes colored by:&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">node_shape</span><span class="p">,</span> <span class="n">nsm</span><span class="p">,</span> <span class="n">ncde</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_colors_record</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                               <span class="p">[</span><span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nipy_spectral&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                               <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">node_shape_os</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span>
                                                               <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">nsm_os</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">),</span>
                                                               <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                               <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1">#  + [{0: &#39;NIV3-NAIVE&#39;, 1: &#39;NIV3-PROG&#39;}] + [None]*3,</span>
                                                               <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">with_node_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_edge_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                               <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>                   
                               <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_shape_mapper</span><span class="o">=</span><span class="n">nsm</span><span class="p">,</span> 
                               <span class="n">border_linewidths</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="c1"># 0.5, </span>
                               <span class="n">bordercolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edge_style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">,</span> 
                               <span class="n">edge_style_mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;POSE + NN&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;POSE&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;NN&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">},</span>
                               <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
                               <span class="n">node_cmap_drawedges</span><span class="o">=</span><span class="n">ncde</span><span class="p">,</span>
                               <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                              <span class="p">)</span>        
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/Users/renae12/Downloads/netflow_tutorial_test/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_pose_clin.png&quot;</span><span class="p">,</span>
                <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    <span class="n">node_colors_record</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">gn</span> <span class="ow">in</span> <span class="n">gene_sig</span><span class="p">:</span>
        <span class="n">node_colors_record</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span> <span class="c1"># 7,6, figsize=(21,21), # gridspec_kw={&#39;hspace&#39;:0.001, &#39;wspace&#39;: 0.02},</span>
                             <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 42</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POSE: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">nodes colored by:&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">);</span>
    <span class="n">node_size</span><span class="o">=</span><span class="mi">5</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">node_shape</span><span class="p">,</span> <span class="n">nsm</span><span class="p">,</span> <span class="n">ncde</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_colors_record</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                               <span class="p">[</span><span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nipy_spectral&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                               <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># 2 + [node_shape_os] + [node_shape_pam50]*6,</span>
                                                               <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *2 + [nsm_os] + [nsm_pam50]*6,</span>
                                                               <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8,</span>
                                                               <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8, #  + [{0: &#39;NIV3-NAIVE&#39;, 1: &#39;NIV3-PROG&#39;}] + [None]*3,</span>
                                                               <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">with_node_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_edge_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                               <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>                   
                               <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_shape_mapper</span><span class="o">=</span><span class="n">nsm</span><span class="p">,</span> 
                               <span class="n">border_linewidths</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="c1"># 0.5, </span>
                               <span class="n">bordercolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edge_style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">,</span> 
                               <span class="n">edge_style_mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;POSE + NN&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;POSE&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;NN&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">},</span>
                               <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
                               <span class="n">node_cmap_drawedges</span><span class="o">=</span><span class="n">ncde</span><span class="p">,</span>
                               <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                               <span class="n">edge_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="p">)</span>
        
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/Users/renae12/Downloads/netflow_tutorial_test/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_pose_immune_sig.png&quot;</span><span class="p">,</span>
                <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    
    
    <span class="n">node_colors_record</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">node_colors_record</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">G_poser_nn</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">gn</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD28&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="s1">&#39;CD28&#39;</span><span class="p">)):</span> <span class="c1"># gene_sig:</span>
        <span class="n">node_colors_record</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">gn</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">gn</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">node_labels</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="n">nodelist</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="c1"># gridspec_kw={&#39;hspace&#39;:0.001, &#39;wspace&#39;: 0.02},</span>
                             <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">11</span> <span class="c1"># 42</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POSE: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">nodes colored by:&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">);</span>
    <span class="n">node_size</span><span class="o">=</span><span class="mi">5</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ttl</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">node_shape</span><span class="p">,</span> <span class="n">nsm</span><span class="p">,</span> <span class="n">ncde</span><span class="p">,</span> <span class="n">ntm</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_colors_record</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                               <span class="p">[</span><span class="s1">&#39;tab10&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span> <span class="k">else</span> <span class="s1">&#39;tab20&#39;</span> <span class="k">if</span> <span class="n">branch_record</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="k">else</span> <span class="s1">&#39;gist_rainbow&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nipy_spectral&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                                               <span class="p">[</span><span class="n">node_shape_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># 2 + [node_shape_os] + [node_shape_pam50]*6,</span>
                                                               <span class="p">[</span><span class="n">nsm_pam50</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *2 + [nsm_os] + [nsm_pam50]*6,</span>
                                                               <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8,</span>
                                                               <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">node_colors_record</span><span class="p">),</span> <span class="c1"># *8, #  + [{0: &#39;NIV3-NAIVE&#39;, 1: &#39;NIV3-PROG&#39;}] + [None]*3,</span>
                                                               <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">axes</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">plot_topology</span><span class="p">(</span><span class="n">G_poser_nn</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">with_node_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">with_edge_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">node_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">nodelist</span><span class="o">=</span><span class="n">nodelist</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                               <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span>                   
                               <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_shape_mapper</span><span class="o">=</span><span class="n">nsm</span><span class="p">,</span> 
                               <span class="n">border_linewidths</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="c1"># 0.5, </span>
                               <span class="n">bordercolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">edge_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edge_style</span><span class="o">=</span><span class="n">edge_style</span><span class="p">,</span> 
                               <span class="n">edge_style_mapper</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;POSE + NN&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;POSE&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;NN&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">},</span>
                               <span class="n">node_labels</span><span class="o">=</span><span class="n">node_labels</span><span class="p">,</span> <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">node_cbar_label</span><span class="o">=</span><span class="n">ttl</span><span class="p">,</span>
                               <span class="n">node_cmap_drawedges</span><span class="o">=</span><span class="n">ncde</span><span class="p">,</span>
                               <span class="n">node_ticklabels_mapper</span><span class="o">=</span><span class="n">ntm</span><span class="p">,</span>
                               <span class="n">edge_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">node_show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                              <span class="p">)</span>
        
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/Users/renae12/Downloads/netflow_tutorial_test/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_pose_CD28_nbhd.png&quot;</span><span class="p">,</span>
                <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cdc597e21bd95f53ba1c8a23a1f8c3e7f44bb0c049909ccdb964e829f4f5a20f.png" src="../../_images/cdc597e21bd95f53ba1c8a23a1f8c3e7f44bb0c049909ccdb964e829f4f5a20f.png" />
<img alt="../../_images/03e5cfadbdb40ebcae12e15c55edac1989de8a875a91192c1cf46e26d625cc4b.png" src="../../_images/03e5cfadbdb40ebcae12e15c55edac1989de8a875a91192c1cf46e26d625cc4b.png" />
<img alt="../../_images/20d15056ef05535a7b9126cdb0240e51011e2c6df24065e6ef57fbc7a8a42cc5.png" src="../../_images/20d15056ef05535a7b9126cdb0240e51011e2c6df24065e6ef57fbc7a8a42cc5.png" />
<img alt="../../_images/1d699d0d7ee7983d05cd9438856b44b1198dcde11fc372b59712aaa181add58d.png" src="../../_images/1d699d0d7ee7983d05cd9438856b44b1198dcde11fc372b59712aaa181add58d.png" />
<img alt="../../_images/4f9324a4cfa9cac383b4a5d81d6e80ccf0e2d05a54139838cebb3b9b27822465.png" src="../../_images/4f9324a4cfa9cac383b4a5d81d6e80ccf0e2d05a54139838cebb3b9b27822465.png" />
<img alt="../../_images/05bd9dedb2746754a1fa039168d4e152887b2ac2779f98027c9e66b9f2537b66.png" src="../../_images/05bd9dedb2746754a1fa039168d4e152887b2ac2779f98027c9e66b9f2537b66.png" />
<img alt="../../_images/71ae61207bc36d22308712a976f6220ed961eb4afb2d74cf32369341dacce62a.png" src="../../_images/71ae61207bc36d22308712a976f6220ed961eb4afb2d74cf32369341dacce62a.png" />
<img alt="../../_images/9626ed6791cdafad466205bc7c079d8eebd3d66ba09c2e01e8cfa32b004c0687.png" src="../../_images/9626ed6791cdafad466205bc7c079d8eebd3d66ba09c2e01e8cfa32b004c0687.png" />
<img alt="../../_images/c181c57dc4681e9af975d5532f1d8901dacd3dd2c29d9c02a9d746ae1df127cb.png" src="../../_images/c181c57dc4681e9af975d5532f1d8901dacd3dd2c29d9c02a9d746ae1df127cb.png" />
<img alt="../../_images/7bb529062b136ebb078b5ada18db881c4660bdb47e529182acf040f798d81c74.png" src="../../_images/7bb529062b136ebb078b5ada18db881c4660bdb47e529182acf040f798d81c74.png" />
<img alt="../../_images/b717bff75e7ca32eb86c81dc5f6bac3b4b2b615e9c8015e55d08c498e744d984.png" src="../../_images/b717bff75e7ca32eb86c81dc5f6bac3b4b2b615e9c8015e55d08c498e744d984.png" />
<img alt="../../_images/f30ee7f1e531e91edf8bdac8b8ee8d59881466b7bcbdb464dbf0eea4c6a2b658.png" src="../../_images/f30ee7f1e531e91edf8bdac8b8ee8d59881466b7bcbdb464dbf0eea4c6a2b658.png" />
</div>
</div>
</section>
<section id="test-interactive-plot">
<h1>Test interactive plot<a class="headerlink" href="#test-interactive-plot" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">Dash</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span><span class="p">,</span> <span class="n">State</span>
<span class="kn">from</span> <span class="nn">jupyter_dash</span> <span class="kn">import</span> <span class="n">JupyterDash</span>
<span class="kn">import</span> <span class="nn">dash_table</span>
<span class="c1"># import dash</span>

<span class="kn">import</span> <span class="nn">dash_cytoscape</span> <span class="k">as</span> <span class="nn">cyto</span>
<span class="kn">import</span> <span class="nn">dash.exceptions</span> <span class="k">as</span> <span class="nn">dash_exceptions</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">callback_context</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colormaps</span> <span class="k">as</span> <span class="n">mpl_cm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">G_poser_nn</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="c1"># D = poser.distances.copy() # keeper.distances[key].data.copy()</span>
</pre></div>
</div>
</div>
</div>
<p>TO DO:</p>
<ul class="simple">
<li><p>fix width/flex for node and edge legends</p></li>
<li><p>addd option to hover over a few nodes and output unique features</p></li>
<li><p>check variables for wavy spiral layout</p></li>
<li><p>add layout option to expand and contract the layout</p></li>
<li><p>add option to reset the layout</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">graphs</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="s1">&#39;CD28&#39;</span><span class="p">)),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CD247, CD4, CD80, CD86, DUSP14, GRAP2, GRB2, IL12A, ITK, LCK, LRRC23, NSF, PIK3CG, PIK3R1, PIK3R2, PLCG1, PTPRC
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;TCGA-OL-A5RW-01&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nf</span><span class="o">.</span><span class="n">render_pose</span><span class="p">(</span><span class="n">keeper</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="100%"
            height="650"
            src="http://127.0.0.1:8090/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import plotly.tools as tls</span>
<span class="kn">import</span> <span class="nn">plotly.figure_factory</span> <span class="k">as</span> <span class="nn">ff</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colormaps</span> <span class="k">as</span> <span class="n">mpl_cm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positions_records</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Helper function to create a Plotly colorbar figure</span>
<span class="k">def</span> <span class="nf">create_colorbar</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">color_scale</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)]])</span>
    <span class="c1"># color_scale = &#39;viridis&#39;    </span>
    <span class="n">trace</span> <span class="o">=</span> <span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
        <span class="n">z</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="c1"># [[v] for v in sorted(values)],</span>
        <span class="n">colorscale</span><span class="o">=</span><span class="n">color_scale</span><span class="p">,</span>
        <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">zmin</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="n">zmax</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">titleside</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                      <span class="n">ticks</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span> 
                      <span class="c1"># tickvals=[0, 0.5, 1], ticktext=[&#39;Low&#39;, &#39;Medium&#39;, &#39;High&#39;], </span>
                      <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">),</span>
             <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="c1"># ensure there are enough points to cover the whole image</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Picnic_r&quot;</span><span class="p">,</span>  <span class="c1"># any colorscale that has white at 0</span>
            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">zmid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">),</span>
            <span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">trace</span><span class="p">)</span> <span class="c1"># , layout=layout)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># 75, # 75 seems to work empirically, you may have to adjust the width</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># zeroing the margins gives a tighter figure, and is also important to make the other numbers work out</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="c1"># , showscale=True, zmin=values.min(), zmax=values.max())    </span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span> <span class="nf">get_node_colors</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_color_attr</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; get dict with color for each node </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    G : networkx.Graph</span>
<span class="sd">        The pose network.</span>
<span class="sd">    node_color_attr : {str, int, numpy array}</span>
<span class="sd">        Attribute to prescribe node colors. If a str, the corresponding </span>
<span class="sd">        node attribute in the graph is used. If an int, it is treated as the id of</span>
<span class="sd">        an observation and the distance to that observation is used as the node</span>
<span class="sd">        colors. If an array, expected to be the same length as the number of nodes</span>
<span class="sd">        with the values to be mapped to colors for each node, ordered consecutively by index.</span>
<span class="sd">    node_cmap : </span>
<span class="sd">    &quot;&quot;&quot;</span>    
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_color_attr</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">node_colors</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">node_color_attr</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_color_attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">node_color_attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">node_colors</span> <span class="o">=</span> <span class="n">node_color_attr</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">())]</span>
        
    <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">node_colors</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">node_colors</span><span class="p">))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl_cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">node_cmap</span><span class="p">)</span> <span class="c1"># cm.get_cmap(node_cmap)</span>
    <span class="c1"># if isinstance(node_color_attr, int):</span>
    <span class="c1">#     node_color_map = {node: colors.rgb2hex(cmap(norm(D[node_color_attr, node]))) for node in G.nodes()}</span>
    <span class="c1"># elif isinstance(node_color_attr, str):</span>
    <span class="c1">#     node_color_map = {node: colors.rgb2hex(cmap(norm(G.nodes[node][node_color_attr]))) for node in G.nodes()}            </span>
    <span class="c1"># else:</span>
    <span class="c1">#     node_color_map = {node: colors.rgb2hex(cmap(norm(node_color_attr[node]))) for node in G.nodes()}</span>
    <span class="n">node_color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">node_colors</span><span class="p">)}</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">create_colorbar</span><span class="p">(</span><span class="n">node_colors</span><span class="p">,</span> <span class="s1">&#39;nodes&#39;</span><span class="p">,</span> <span class="n">color_scale</span><span class="o">=</span><span class="n">node_cmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node_color_map</span><span class="p">,</span> <span class="n">cbar</span>

<span class="k">def</span> <span class="nf">get_edge_colors</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_color_attr</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; get dict with color for each edge &quot;&quot;&quot;</span>
    <span class="n">edge_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">edge_color_attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">()]</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">edge_colors</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">edge_colors</span><span class="p">))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl_cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">edge_cmap</span><span class="p">)</span> <span class="c1"># cm.get_cmap(edge_cmap)</span>
    <span class="n">edge_color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">edge</span><span class="p">:</span> <span class="n">colors</span><span class="o">.</span><span class="n">rgb2hex</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">edge_color_attr</span><span class="p">])))</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">()}</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">create_colorbar</span><span class="p">(</span><span class="n">edge_colors</span><span class="p">,</span> <span class="s1">&#39;edges&#39;</span><span class="p">,</span> <span class="n">color_scale</span><span class="o">=</span><span class="n">edge_cmap</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edge_color_map</span><span class="p">,</span> <span class="n">cbar</span>

<span class="k">def</span> <span class="nf">nx_to_cytoscape</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="c1"># node_size, </span>
                    <span class="c1"># edge_width, </span>
                    <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">node_color_attr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span>
                    <span class="n">edge_color_attr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">return_cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 

    <span class="n">elements</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">cytoscape_data</span><span class="p">(</span><span class="n">G</span><span class="p">)[</span><span class="s1">&#39;elements&#39;</span><span class="p">][</span><span class="s1">&#39;nodes&#39;</span><span class="p">],</span> <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">cytoscape_data</span><span class="p">(</span><span class="n">G</span><span class="p">)[</span><span class="s1">&#39;elements&#39;</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]}</span>
    
    <span class="c1"># elements = []</span>

    <span class="c1"># nodes       </span>
    <span class="k">if</span> <span class="n">node_color_attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># node_colors = [G.nodes[node][node_color_attr] for node in G.nodes()]</span>
        <span class="c1"># norm = colors.Normalize(vmin=min(node_colors), vmax=max(node_colors))</span>
        <span class="c1"># cmap = cm.get_cmap(node_cmap)</span>
        <span class="c1"># node_color_map = {node: colors.rgb2hex(cmap(norm(G.nodes[node][node_color_attr]))) for node in G.nodes()}        </span>
        <span class="n">node_color_map</span><span class="p">,</span> <span class="n">node_cbar_vis</span> <span class="o">=</span> <span class="n">get_node_colors</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_color_attr</span><span class="p">,</span> <span class="n">node_cmap</span><span class="o">=</span><span class="n">node_cmap</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_color_attr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">node_color_attr</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node_color_attr</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pseudo-distance from </span><span class="si">{</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_color_attr</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;feature&quot;</span>            
        <span class="c1"># label = node_color_attr if isinstance(node_color_attr, str) else f&quot;pseudo-distance from {G.nodes[node_color_attr][&#39;name&#39;]}&quot;        </span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="s1">&#39;#888&#39;</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>  <span class="c1"># Default color                                           </span>
        <span class="n">node_cbar_vis</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="c1">#     for node in G.nodes():</span>
    <span class="c1">#         node_elements = {</span>
    <span class="c1">#             &#39;data&#39;: {&#39;id&#39;: str(node), &#39;label&#39;: G.nodes[node][&#39;name&#39;], </span>
    <span class="c1">#                      &#39;size&#39;: node_size, </span>
    <span class="c1">#                      **G.nodes[node]},</span>
    <span class="c1">#             &#39;style&#39;: {&#39;background-color&#39;: node_color_map[node], # &#39;color&#39;: node_color_map[node],</span>
    <span class="c1">#                      },</span>
    <span class="c1">#             &#39;classes&#39;: &#39;node&#39;</span>
    <span class="c1">#         }</span>

    <span class="c1">#         if pos is None:</span>
    <span class="c1">#             pos = nx.kamada_kawai_layout(G)</span>
    <span class="c1">#         # if pos is not None:</span>
    <span class="c1">#         node_elements[&#39;position&#39;] = dict(zip([&#39;x&#39;, &#39;y&#39;], pos[node]))</span>
    <span class="c1">#         elements.append(node_elements)</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;kamada_kawai&#39;</span> <span class="ow">in</span> <span class="n">positions_records</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">positions_records</span><span class="p">[</span><span class="s1">&#39;kamada_kawai&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>                                    
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="c1"># positions_records[&#39;kamada_kawai&#39;] = pos</span>
            
        <span class="c1"># bounding_box=(0., 0., 400, 450)</span>
        <span class="n">bounding_box</span><span class="o">=</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">430</span><span class="p">)</span>
        <span class="n">X_MIN</span><span class="p">,</span> <span class="n">Y_MIN</span><span class="p">,</span> <span class="n">X_MAX</span><span class="p">,</span> <span class="n">Y_MAX</span> <span class="o">=</span> <span class="n">bounding_box</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># print(f&quot;*** set pos ***&quot;)</span>
        <span class="c1"># pos = {node: {&#39;x&#39;: (position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
        <span class="c1">#               &#39;y&#39;: (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
        <span class="c1">#               } for node, position in pos.items()}</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">X_MAX</span> <span class="o">-</span> <span class="n">X_MIN</span><span class="p">)</span> <span class="o">+</span> <span class="n">X_MIN</span><span class="p">,</span>
                               <span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y_MAX</span> <span class="o">-</span> <span class="n">Y_MIN</span><span class="p">)</span> <span class="o">+</span> <span class="n">Y_MIN</span><span class="p">,</span>
                              <span class="p">])</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            
    <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
        <span class="n">vv</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_color_map</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])]</span>
        <span class="c1"># vv[&#39;data&#39;][&#39;size&#39;] = node_size</span>
        <span class="n">vv</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])]))</span>
        <span class="c1"># vv[&#39;group&#39;] = &#39;nodes&#39;</span>
        <span class="c1"># vv[&#39;classes&#39;] = &#39;nodes&#39;</span>
        
        
    <span class="c1"># edges </span>
    <span class="k">if</span> <span class="n">edge_color_attr</span><span class="p">:</span>
        <span class="c1"># edge_colors = [G.edges[edge][edge_color_attr] for edge in G.edges()]</span>
        <span class="c1"># norm = colors.Normalize(vmin=min(edge_colors), vmax=max(edge_colors))</span>
        <span class="c1"># cmap = cm.get_cmap(edge_cmap)</span>
        <span class="c1"># edge_color_map = {edge: colors.rgb2hex(cmap(norm(G.edges[edge][edge_color_attr]))) for edge in G.edges()}</span>
        <span class="n">edge_color_map</span><span class="p">,</span> <span class="n">edge_cbar_vis</span> <span class="o">=</span> <span class="n">get_edge_colors</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">edge_color_attr</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="n">edge_cmap</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edge_color_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">edge</span><span class="p">:</span> <span class="s1">&#39;#222&#39;</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">()}</span>  <span class="c1"># Default color</span>
        <span class="n">edge_cbar_vis</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="c1"># for edge in G.edges():</span>
    <span class="c1">#     elements.append({</span>
    <span class="c1">#         &#39;data&#39;: {&#39;source&#39;: str(edge[0]), &#39;target&#39;: str(edge[1]), </span>
    <span class="c1">#                  &#39;width&#39;: edge_width, **G.edges[edge]},</span>
    <span class="c1">#         &#39;style&#39;: {&#39;line-color&#39;: edge_color_map[edge]},</span>
    <span class="c1">#         &#39;classes&#39;: &#39;edge&#39;</span>
    <span class="c1">#     })</span>
    <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">]:</span>
        <span class="n">edg</span> <span class="o">=</span> <span class="p">(</span><span class="n">ee</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">],</span> <span class="n">ee</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
        <span class="c1"># ee[&#39;group&#39;] = &#39;edges&#39;</span>
        <span class="c1"># ee[&#39;classes&#39;] = &#39;edges&#39;</span>
        <span class="n">ee</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_color_map</span><span class="p">[</span><span class="n">edg</span><span class="p">]</span>
        <span class="c1"># ee[&#39;data&#39;][&#39;width&#39;] = edge_width</span>
        
    <span class="c1"># print(f&quot;returning node_cbar_vis = {node_cbar_vis}&quot;) </span>
    <span class="k">if</span> <span class="n">return_cbar</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">elements</span><span class="p">,</span> <span class="n">node_cbar_vis</span><span class="p">,</span> <span class="n">edge_cbar_vis</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">elements</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import plotly.express as px</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># color_scale = px.colors.sequential.Viridis</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># positions_records = {}</span>
<span class="c1"># def get_node_colors(G, node_color_attr, node_cmap=&#39;jet&#39;):</span>
<span class="c1">#     &quot;&quot;&quot; get dict with color for each node </span>
    
<span class="c1">#     Parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     node_color_attr : {str, int}</span>
<span class="c1">#         Attribute to prescribe node colors. If a str, the corresponding </span>
<span class="c1">#         node attribute in the graph is used. If an int, it is treated as the id of</span>
<span class="c1">#         an observation and the distance to that observation is used as the node</span>
<span class="c1">#         colors. </span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     if isinstance(node_color_attr, int):</span>
<span class="c1">#         node_colors = D[node_color_attr, list(G.nodes())]</span>
<span class="c1">#     else:</span>
<span class="c1">#         node_colors = [G.nodes[node][node_color_attr] for node in G.nodes()]</span>
<span class="c1">#     norm = colors.Normalize(vmin=min(node_colors), vmax=max(node_colors))</span>
<span class="c1">#     cmap = cm.get_cmap(node_cmap)</span>
<span class="c1">#     if isinstance(node_color_attr, int):</span>
<span class="c1">#         node_color_map = {node: colors.rgb2hex(cmap(norm(D[node_color_attr, node]))) for node in G.nodes()}</span>
<span class="c1">#     else:</span>
<span class="c1">#         node_color_map = {node: colors.rgb2hex(cmap(norm(G.nodes[node][node_color_attr]))) for node in G.nodes()}            </span>
        
<span class="c1">#     label = node_color_attr if isinstance(node_color_attr, str) else f&quot;pseudo-distance from {G.nodes[int(node_color_attr)][&#39;name&#39;]}&quot;</span>
<span class="c1">#     #     colorbar_fig = go.Figure() # layout=dict(plot_bgcolor=&#39;white&#39;)</span>
<span class="c1">#     #     colorbar_fig.add_trace(go.Scatter(</span>
<span class="c1">#     #         x=[None],</span>
<span class="c1">#     #         y=[None],</span>
<span class="c1">#     #         mode=&#39;markers&#39;,</span>
<span class="c1">#     #         marker=dict(        </span>
<span class="c1">#     #             size=0,</span>
<span class="c1">#     #             colorscale=&#39;viridis&#39;,</span>
<span class="c1">#     #             cmin=min(node_colors), # 0,</span>
<span class="c1">#     #             cmax=max(node_colors), # 100,</span>
<span class="c1">#     #             colorbar=dict(</span>
<span class="c1">#     #             title=f&quot;nodes: {label}&quot; ,</span>
<span class="c1">#     #             thickness=15,</span>
<span class="c1">#     #             len=0.5,</span>
<span class="c1">#     #             x=0.3, # 0.5,</span>
<span class="c1">#     #             y=0.5, # 0.5,</span>
<span class="c1">#     #             xanchor=&#39;left&#39;,</span>
<span class="c1">#     #             # xanchor=&#39;center&#39;,</span>
<span class="c1">#     #             # yanchor=&#39;top&#39;,</span>
<span class="c1">#     #             # orientation=&#39;h&#39;,</span>
<span class="c1">#     #             ),</span>
<span class="c1">#     #         ),</span>
<span class="c1">#     #         showlegend=False,</span>
<span class="c1">#     #         hoverinfo=&#39;none&#39;</span>
<span class="c1">#     #     ))</span>

<span class="c1">#     #     colorbar_fig.update_layout(</span>
<span class="c1">#     #         margin=dict(l=0, r=0, t=0, b=0),</span>
<span class="c1">#     #         # height=100,</span>
<span class="c1">#     #         # width=300,</span>
<span class="c1">#     #         height=110, # 40, # 80, # 40, # 200, # 110,</span>
<span class="c1">#     #         width=60,# 200, # 120, # 60,</span>
<span class="c1">#     #         xaxis=dict(showticklabels=False, showgrid=False, zeroline=False),</span>
<span class="c1">#     #         yaxis=dict(showticklabels=False, showgrid=False, zeroline=False)</span>
<span class="c1">#     #     )</span>

<span class="c1">#     #     colorbar_figure_html = dcc.Graph(figure=colorbar_fig, config={&#39;displayModeBar&#39;: False})</span>
<span class="c1">#     colorbar_figure_html = dcc.Graph(</span>
<span class="c1">#         # id=&#39;node_colorbar_fig&#39;,</span>
<span class="c1">#         figure=px.imshow([[0, 1]], color_continuous_scale=color_scale, </span>
<span class="c1">#                          aspect=&#39;auto&#39;).update_layout(</span>
<span class="c1">#             coloraxis_showscale=True, </span>
<span class="c1">#             coloraxis_colorbar=dict(</span>
<span class="c1">#                 title=&#39;Score&#39;, </span>
<span class="c1">#                 ticks=&quot;outside&quot;,</span>
<span class="c1">#                 tickvals=[0, 0.5, 1],</span>
<span class="c1">#                 ticktext=[&#39;Low&#39;, &#39;Medium&#39;, &#39;High&#39;]</span>
<span class="c1">#             ),</span>
<span class="c1">#             margin=dict(t=20, b=20, l=80, r=20),</span>
<span class="c1">#         ).update_xaxes(visible=False).update_yaxes(visible=False).update_traces(hoverinfo=&#39;none&#39;, showscale=True, zmin=0, zmax=1),</span>
<span class="c1">#         config={&#39;displayModeBar&#39;: False}  # Hides the Plotly mode bar</span>
<span class="c1">#     )</span>
<span class="c1">#     return node_color_map, colorbar_figure_html</span>

<span class="c1"># # Generate the color bar with Matplotlib</span>
<span class="c1"># # def create_colorbar_fig(colormap, label):</span>
<span class="c1"># #     fig, ax = plt.subplots(figsize=(6, 1))</span>
<span class="c1"># #     fig.subplots_adjust(bottom=0.5)</span>

<span class="c1"># #     norm = mcolors.Normalize(vmin=0, vmax=100)</span>
<span class="c1"># #     fig.colorbar(mcolors.ScalarMappable(norm=norm, </span>
<span class="c1"># #                                         # cmap=colormap,</span>
<span class="c1"># #                                         cmap=plt.cm.viridis,</span>
<span class="c1"># #                                        ), </span>
<span class="c1"># #                  cax=ax, orientation=&#39;horizontal&#39;, label=label)</span>
        
    
<span class="c1"># #     plotly_fig = tls.mpl_to_plotly(fig)</span>
<span class="c1"># #     plotly_fig.update_layout(</span>
<span class="c1"># #         autosize=False,</span>
<span class="c1"># #         margin=dict(l=0, r=0, t=0, b=0)</span>
<span class="c1"># #     )</span>

<span class="c1"># #     cbar_graph = dcc.Graph(figure=plotly_fig, style={&#39;width&#39;: &#39;300px&#39;, &#39;height&#39;: &#39;50px&#39;})</span>
    
<span class="c1"># #     return cbar_graph</span>

<span class="c1"># def get_edge_colors(G, edge_color_attr, edge_cmap=&#39;jet&#39;):</span>
<span class="c1">#     &quot;&quot;&quot; get dict with color for each edge &quot;&quot;&quot;</span>
<span class="c1">#     edge_colors = [G.edges[edge][edge_color_attr] for edge in G.edges()]</span>
<span class="c1">#     norm = colors.Normalize(vmin=min(edge_colors), vmax=max(edge_colors))</span>
<span class="c1">#     cmap = cm.get_cmap(edge_cmap)</span>
<span class="c1">#     edge_color_map = {edge: colors.rgb2hex(cmap(norm(G.edges[edge][edge_color_attr]))) for edge in G.edges()}</span>
<span class="c1">#     return edge_color_map</span>

<span class="c1"># def nx_to_cytoscape(G, # node_size, </span>
<span class="c1">#                     # edge_width, </span>
<span class="c1">#                     pos=None,</span>
<span class="c1">#                     node_color_attr=None, node_cmap=&#39;jet&#39;,</span>
<span class="c1">#                     edge_color_attr=None, edge_cmap=&#39;jet&#39;, return_node_colorbar=True): </span>

<span class="c1">#     elements = {&#39;nodes&#39;: nx.cytoscape_data(G)[&#39;elements&#39;][&#39;nodes&#39;], &#39;edges&#39;: nx.cytoscape_data(G)[&#39;elements&#39;][&#39;edges&#39;]}</span>
    
<span class="c1">#     # elements = []</span>

<span class="c1">#     # nodes       </span>
<span class="c1">#     if node_color_attr: # should not work when node_color_attr is &#39;&#39;</span>
<span class="c1">#         # node_colors = [G.nodes[node][node_color_attr] for node in G.nodes()]</span>
<span class="c1">#         # norm = colors.Normalize(vmin=min(node_colors), vmax=max(node_colors))</span>
<span class="c1">#         # cmap = cm.get_cmap(node_cmap)</span>
<span class="c1">#         # node_color_map = {node: colors.rgb2hex(cmap(norm(G.nodes[node][node_color_attr]))) for node in G.nodes()}</span>
<span class="c1">#         node_color_map, colorbar_figure_html = get_node_colors(G, node_color_attr, node_cmap=node_cmap)</span>
        
<span class="c1">#         # label = node_color_attr if isinstance(node_color_attr, str) else f&quot;pseudo-distance from {G.nodes[node_color_attr][&#39;name&#39;]}&quot;</span>
<span class="c1">#         # plotly_node_cbar = [create_colorbar_fig(node_cmap, f&quot;nodes: {label}&quot;)]</span>
        
        
<span class="c1">#     else:</span>
<span class="c1">#         node_color_map = {node: &#39;#888&#39; for node in G.nodes()}  # Default color                                    </span>
<span class="c1">#         # plotly_node_cbar = []</span>
<span class="c1">#         colorbar_figure_html = html.Pre()</span>
        
<span class="c1">#     #     for node in G.nodes():</span>
<span class="c1">#     #         node_elements = {</span>
<span class="c1">#     #             &#39;data&#39;: {&#39;id&#39;: str(node), &#39;label&#39;: G.nodes[node][&#39;name&#39;], </span>
<span class="c1">#     #                      &#39;size&#39;: node_size, </span>
<span class="c1">#     #                      **G.nodes[node]},</span>
<span class="c1">#     #             &#39;style&#39;: {&#39;background-color&#39;: node_color_map[node], # &#39;color&#39;: node_color_map[node],</span>
<span class="c1">#     #                      },</span>
<span class="c1">#     #             &#39;classes&#39;: &#39;node&#39;</span>
<span class="c1">#     #         }</span>

<span class="c1">#     #         if pos is None:</span>
<span class="c1">#     #             pos = nx.kamada_kawai_layout(G)</span>
<span class="c1">#     #         # if pos is not None:</span>
<span class="c1">#     #         node_elements[&#39;position&#39;] = dict(zip([&#39;x&#39;, &#39;y&#39;], pos[node]))</span>
<span class="c1">#     #         elements.append(node_elements)</span>
<span class="c1">#     if pos is None:</span>
<span class="c1">#         if &#39;kamada_kawai&#39; in positions_records:</span>
<span class="c1">#             pos = positions_records[&#39;kamada_kawai&#39;]</span>
<span class="c1">#         else:                                    </span>
<span class="c1">#             pos = nx.kamada_kawai_layout(G)</span>
<span class="c1">#             # positions_records[&#39;kamada_kawai&#39;] = pos</span>
            
<span class="c1">#         # bounding_box=(0., 0., 400, 450)</span>
<span class="c1">#         bounding_box=(3., 3., 400, 430)</span>
<span class="c1">#         X_MIN, Y_MIN, X_MAX, Y_MAX = bounding_box</span>
<span class="c1">#         x = [k[0] for k in pos.values()]</span>
<span class="c1">#         y = [k[1] for k in pos.values()]</span>
<span class="c1">#         x_min, x_max, y_min, y_max = min(x), max(x), min(y), max(y)</span>

<span class="c1">#         # print(f&quot;*** set pos ***&quot;)</span>
<span class="c1">#         # pos = {node: {&#39;x&#39;: (position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
<span class="c1">#         #               &#39;y&#39;: (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
<span class="c1">#         #               } for node, position in pos.items()}</span>
<span class="c1">#         pos = {node: np.array([(position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
<span class="c1">#                                (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
<span class="c1">#                               ]) for node, position in pos.items()}</span>

            
<span class="c1">#     for vv in elements[&#39;nodes&#39;]:</span>
<span class="c1">#         vv[&#39;data&#39;][&#39;color&#39;] = node_color_map[int(vv[&#39;data&#39;][&#39;id&#39;])]</span>
<span class="c1">#         # vv[&#39;data&#39;][&#39;size&#39;] = node_size</span>
<span class="c1">#         vv[&#39;position&#39;] = dict(zip([&#39;x&#39;, &#39;y&#39;], pos[int(vv[&#39;data&#39;][&#39;id&#39;])]))</span>
<span class="c1">#         vv[&#39;group&#39;] = &#39;nodes&#39;</span>
<span class="c1">#         vv[&#39;classes&#39;] = &#39;nodes&#39;</span>
        
        
<span class="c1">#     # edges </span>
<span class="c1">#     if edge_color_attr:</span>
<span class="c1">#         # edge_colors = [G.edges[edge][edge_color_attr] for edge in G.edges()]</span>
<span class="c1">#         # norm = colors.Normalize(vmin=min(edge_colors), vmax=max(edge_colors))</span>
<span class="c1">#         # cmap = cm.get_cmap(edge_cmap)</span>
<span class="c1">#         # edge_color_map = {edge: colors.rgb2hex(cmap(norm(G.edges[edge][edge_color_attr]))) for edge in G.edges()}</span>
<span class="c1">#         edge_color_map = get_edge_colors(G, edge_color_attr, edge_cmap=edge_cmap)</span>
<span class="c1">#     else:</span>
<span class="c1">#         edge_color_map = {edge: &#39;#222&#39; for edge in G.edges()}  # Default color</span>
        
<span class="c1">#     # for edge in G.edges():</span>
<span class="c1">#     #     elements.append({</span>
<span class="c1">#     #         &#39;data&#39;: {&#39;source&#39;: str(edge[0]), &#39;target&#39;: str(edge[1]), </span>
<span class="c1">#     #                  &#39;width&#39;: edge_width, **G.edges[edge]},</span>
<span class="c1">#     #         &#39;style&#39;: {&#39;line-color&#39;: edge_color_map[edge]},</span>
<span class="c1">#     #         &#39;classes&#39;: &#39;edge&#39;</span>
<span class="c1">#     #     })</span>
<span class="c1">#     for ee in elements[&#39;edges&#39;]:</span>
<span class="c1">#         edg = (ee[&#39;data&#39;][&#39;source&#39;], ee[&#39;data&#39;][&#39;target&#39;])</span>
<span class="c1">#         ee[&#39;group&#39;] = &#39;edges&#39;</span>
<span class="c1">#         ee[&#39;classes&#39;] = &#39;edges&#39;</span>
<span class="c1">#         ee[&#39;data&#39;][&#39;color&#39;] = edge_color_map[edg]</span>
<span class="c1">#         # ee[&#39;data&#39;][&#39;width&#39;] = edge_width</span>
        
<span class="c1">#     if return_node_colorbar:</span>
<span class="c1">#         return elements, colorbar_figure_html # , plotly_node_cbar</span>
    
<span class="c1">#     return elements</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # LATEST WORKING COPY</span>
<span class="c1"># # Initialize the Dash app</span>
<span class="c1"># external_stylesheets = [&#39;https://codepen.io/chriddyp/pen/bWLwgP.css&#39;]</span>

<span class="c1"># # app = JupyterDash(__name__, external_stylesheets=external_stylesheets)</span>
<span class="c1"># app = JupyterDash(__name__)</span>

<span class="c1"># styles = {</span>
<span class="c1">#     &#39;container&#39;: {</span>
<span class="c1">#         &#39;position&#39;: &#39;fixed&#39;,</span>
<span class="c1">#         &#39;display&#39;: &#39;flex&#39;,</span>
<span class="c1">#         &#39;flex-direction&#39;: &#39;row&#39;,</span>
<span class="c1">#         &#39;height&#39;: &#39;98%&#39;,</span>
<span class="c1">#         &#39;width&#39;: &#39;100%&#39;,</span>
<span class="c1">#         # @ &#39;padding&#39;: </span>
<span class="c1">#         &#39;gap&#39;: &#39;10px&#39;,</span>
<span class="c1">#         # &#39;margin&#39;: &#39;10px&#39;,</span>
        
<span class="c1">#     },    </span>
<span class="c1">#     # &#39;control-panel-container&#39;: {</span>
<span class="c1">#     #     &#39;width&#39;: &#39;20%&#39;, </span>
<span class="c1">#     #     &#39;display&#39;: &#39;inline-block&#39;, </span>
<span class="c1">#     #     &#39;verticalAlign&#39;: &#39;top&#39;, </span>
<span class="c1">#     #     &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
<span class="c1">#     #     &#39;border&#39;: &#39;1px solid black&#39;, </span>
<span class="c1">#     #     &#39;border-radius&#39;: &#39;20px&#39;, </span>
<span class="c1">#     #     &#39;padding&#39;: &#39;5px&#39;,</span>
<span class="c1">#     #     &#39;margin&#39;: &#39;3px&#39;,</span>
<span class="c1">#     #     # &#39;flex&#39;: &#39;1&#39;, &#39;display&#39;: &#39;flex&#39;, &#39;flexDirection&#39;: &#39;column&#39;,</span>
<span class="c1">#     #     # &#39;flex&#39;: &#39;0.2&#39;,</span>
<span class="c1">#     #     # &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#     #     # &#39;position&#39;: &#39;relative&#39;, &#39;flex&#39;: &#39;1&#39;,</span>
<span class="c1">#     # },  </span>
<span class="c1">#     &#39;control-panel-container&#39;: {</span>
<span class="c1">#         &#39;width&#39;: &#39;20%&#39;, </span>
<span class="c1">#         # &#39;flex&#39;: &#39;0.20&#39;,</span>
<span class="c1">#         &#39;display&#39;: &#39;inline-block&#39;, </span>
<span class="c1">#         &#39;verticalAlign&#39;: &#39;top&#39;, </span>
<span class="c1">#         # &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
<span class="c1">#         &#39;border&#39;: &#39;1px solid black&#39;, </span>
<span class="c1">#         &#39;border-radius&#39;: &#39;20px&#39;, </span>
<span class="c1">#         &#39;padding&#39;: &#39;5px&#39;,</span>
<span class="c1">#         &#39;margin&#39;: &#39;3px&#39;,</span>
<span class="c1">#         # &#39;flex&#39;: &#39;1&#39;, &#39;display&#39;: &#39;flex&#39;, &#39;flexDirection&#39;: &#39;column&#39;,</span>
<span class="c1">#         # &#39;flex&#39;: &#39;0.2&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;relative&#39;, &#39;flex&#39;: &#39;1&#39;,</span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;control-panel&#39; : {</span>
<span class="c1">#         &#39;display&#39;: &#39;inline-block&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;absolute&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#         &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
<span class="c1">#         # &#39;width&#39;: &#39;98%&#39;,</span>
<span class="c1">#         &#39;height&#39;: &#39;81%&#39;,</span>
<span class="c1">#         &#39;paddingRight&#39;: &#39;15px&#39;,</span>
<span class="c1">#         &#39;paddingLeft&#39;: &#39;8px&#39;,</span>
<span class="c1">#         &#39;paddingBottom&#39;: &#39;3px&#39;,</span>
<span class="c1">#         &#39;border&#39;: &#39;thin solid lightgrey&#39;,</span>
<span class="c1">#         &#39;border-radius&#39;: &#39;10px&#39;,</span>
<span class="c1">#         &#39;z-index&#39;: 999,</span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;cy-container&#39;: {</span>
<span class="c1">#         &#39;flex&#39;: &#39;0.78&#39;,</span>
<span class="c1">#         &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#         # &#39;paddingLeft&#39;: &#39;20px&#39;,</span>
<span class="c1">#         &#39;border&#39;: &#39;1px solid black&#39;,</span>
<span class="c1">#         &#39;border-radius&#39;: &#39;20px&#39;,</span>
<span class="c1">#         # &#39;padding&#39;: &#39;10px&#39;,</span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;cytoscape&#39;: {</span>
<span class="c1">#         &#39;position&#39;: &#39;absolute&#39;,</span>
<span class="c1">#         &#39;width&#39;: &#39;98%&#39;,</span>
<span class="c1">#         &#39;height&#39;: &#39;80%&#39;, # &#39;83%&#39;, # &#39;100%&#39;,</span>
<span class="c1">#         # &#39;padding&#39;: &#39;3px&#39;,</span>
<span class="c1">#        #  &#39;margin&#39;: &#39;15px&#39;,</span>
<span class="c1">#         &#39;z-index&#39;: 999</span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;pre&#39;: {</span>
<span class="c1">#         &#39;border&#39;: &#39;thin lightgrey solid&#39;,</span>
<span class="c1">#         &#39;border-radius&#39;: &#39;20px&#39;,</span>
<span class="c1">#         &#39;overflowX&#39;: &#39;scroll&#39;,</span>
<span class="c1">#         &#39;overflowY&#39;: &#39;scroll&#39;,</span>
<span class="c1">#         &#39;width&#39;: &#39;280px&#39;, # &#39;100%&#39;,</span>
<span class="c1">#         &#39;height&#39;: &#39;15%&#39;,</span>
<span class="c1">#         &#39;padding&#39;: &#39;10px&#39;,</span>
<span class="c1">#         # &#39;align&#39;: &#39;right&#39;,</span>
<span class="c1">#         &#39;margin&#39;: &#39;5px&#39;,</span>
<span class="c1">#         #  &#39;position&#39;: &#39;fixed&#39;, # &#39;relative&#39;,</span>
<span class="c1">#     }</span>
<span class="c1"># }</span>



<span class="c1"># # Define the layout of the app</span>
<span class="c1"># app.layout = html.Div(style=styles[&#39;container&#39;], </span>
<span class="c1">#                       children=[</span>
<span class="c1">#                           html.Div(className=&#39;control-panel-container&#39;, style=styles[&#39;control-panel-container&#39;], children=[</span>
<span class="c1">#                               html.H2(&quot;NetFlow POSE&quot;),</span>
<span class="c1">#                               html.H3(&quot;Settings&quot;),</span>
<span class="c1">#                           html.Div([</span>
<span class="c1">#                               dcc.Store(id=&#39;container-dimensions&#39;), ###</span>
<span class="c1">#                               # html.H2(&quot;NetFlow POSE&quot;),</span>
<span class="c1">#                               html.H4(&quot;Graph Layout&quot;),</span>
<span class="c1">#                               dcc.Dropdown(</span>
<span class="c1">#                                   id=&#39;layout-dropdown&#39;,</span>
<span class="c1">#                                   options=[{&#39;label&#39;: layout, &#39;value&#39;: layout} for layout in [&#39;kamada_kawai&#39;, &#39;spring&#39;, </span>
<span class="c1">#                                                                                              &#39;circular&#39;, # &#39;cose&#39;, </span>
<span class="c1">#                                                                                              &#39;shell&#39;, &#39;grid&#39;, </span>
<span class="c1">#                                                                                              &#39;breadthfirst&#39;, &#39;sin&#39;,</span>
<span class="c1">#                                                                                              &#39;wavy_spiral&#39;]],</span>
<span class="c1">#                                   value=&#39;kamada_kawai&#39;, # &#39;cose&#39;, # </span>
<span class="c1">#                               ),</span>
<span class="c1">#                               html.H4(&quot;Highlight Node by Label&quot;),</span>
<span class="c1">#                               dcc.Input(id=&#39;node-label&#39;, type=&#39;text&#39;, value=&#39;&#39;),</span>
<span class="c1">#                               html.Button(&#39;Highlight Node&#39;, id=&#39;highlight-button&#39;, n_clicks=0),                              </span>
<span class="c1">#                               html.H4(&quot;Node Size&quot;),</span>
<span class="c1">#                               dcc.Slider(id=&#39;node-size-slider&#39;, min=0.01, max=30, step=0.01, value=8, </span>
<span class="c1">#                                          marks={1: &#39;smaller&#39;, 30: &#39;larger&#39;}),</span>
<span class="c1">#                               html.H4(&quot;Node Attribute for Coloring&quot;),</span>
<span class="c1">#                               dcc.Dropdown(</span>
<span class="c1">#                                   id=&#39;node-attribute-dropdown&#39;,</span>
<span class="c1">#                                   options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: attr, &#39;value&#39;: attr} for attr in G.nodes(data=True)[0].keys()],</span>
<span class="c1">#                                   value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1">#                               ),       </span>
<span class="c1">#                               html.H4(&quot;Data Feature for Coloring Nodes&quot;),</span>
<span class="c1">#                               dcc.Dropdown(</span>
<span class="c1">#                                   id=&#39;keeper-data-dropdown&#39;,</span>
<span class="c1">#                                   options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: dataset.label, &#39;value&#39;: dataset.label} for dataset in keeper.data],</span>
<span class="c1">#                                   value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1">#                               ),  </span>
<span class="c1">#                               dcc.Input(id=&#39;feature-label&#39;, type=&#39;text&#39;, value=&#39;&#39;),</span>
<span class="c1">#                               html.Button(&#39;Color Nodes&#39;, id=&#39;node-color-button&#39;, n_clicks=0),                              </span>
                              
<span class="c1">#                               html.H4(&quot;Colormap for Nodes&quot;),</span>
<span class="c1">#                               dcc.Dropdown(</span>
<span class="c1">#                                   id=&#39;node-colormap-dropdown&#39;,</span>
<span class="c1">#                                   options=[{&#39;label&#39;: cmap, &#39;value&#39;: cmap} for cmap in [&#39;YlGnBu&#39;, &#39;viridis&#39;, &#39;cividis&#39;, &#39;jet&#39;, &#39;nipy_spectral&#39;, &#39;gist_ncar&#39;]],</span>
<span class="c1">#                                   value=&#39;YlGnBu&#39;</span>
<span class="c1">#                               ),</span>
<span class="c1">#                               html.H4(&quot;Edge Width&quot;),</span>
<span class="c1">#                               dcc.Slider(id=&#39;edge-width-slider&#39;, min=0.001, max=14, step=0.001, value=1.5,</span>
<span class="c1">#                                          marks={1: &#39;thinner&#39;, 14: &#39;wider&#39;}),</span>
<span class="c1">#                               html.H4(&quot;Edge Attribute for Coloring&quot;),</span>
<span class="c1">#                               dcc.Dropdown(</span>
<span class="c1">#                                   id=&#39;edge-attribute-dropdown&#39;,</span>
<span class="c1">#                                   options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: attr, &#39;value&#39;: attr} for attr in list(G.edges(data=True))[0][-1].keys()],</span>
<span class="c1">#                                   value=&#39;None&#39;, # &#39;distance&#39;</span>
<span class="c1">#                               ),                              </span>
<span class="c1">#                               html.H4(&quot;Colormap for Edges&quot;),</span>
<span class="c1">#                               dcc.Dropdown(</span>
<span class="c1">#                                   id=&#39;edge-colormap-dropdown&#39;,</span>
<span class="c1">#                                   options=[{&#39;label&#39;: cmap, &#39;value&#39;: cmap} for cmap in [&#39;YlGnBu&#39;, &#39;viridis&#39;, &#39;cividis&#39;, &#39;jet&#39;, &#39;nipy_spectral&#39;, &#39;gist_ncar&#39;]],</span>
<span class="c1">#                                   value=&#39;nipy_spectral&#39;</span>
<span class="c1">#                               ),</span>
<span class="c1">#                               dcc.Interval(id=&#39;interval&#39;, interval=1000, n_intervals=0)  # Interval to capture dimensions periodically                              </span>
<span class="c1">#                           ], </span>
<span class="c1">#                               style=styles[&#39;control-panel&#39;], # styles[&#39;control-panel-container&#39;],</span>
<span class="c1">#                           ),</span>
<span class="c1">#                           ]),</span>
                          
<span class="c1">#                           html.Div(className=&#39;cy-container&#39;, style=styles[&#39;cy-container&#39;], children=[   </span>
<span class="c1">#                               html.Pre(id=&#39;cytoscape-mouseoverNodeData&#39;, style=styles[&#39;pre&#39;]), </span>
<span class="c1">#                               cyto.Cytoscape(</span>
<span class="c1">#                                   id=&#39;network-graph&#39;,</span>
<span class="c1">#                                   elements=nx_to_cytoscape(G), # , 30, 1),        </span>
<span class="c1">#                                   # style={&#39;width&#39;: &#39;80%&#39;, &#39;height&#39;: &#39;800px&#39;},</span>
<span class="c1">#                                   style=styles[&#39;cytoscape&#39;],</span>
<span class="c1">#                                   # layout={&#39;name&#39;: &#39;kamada_kawai&#39;}, # &#39;cose&#39;},</span>
<span class="c1">#                                   layout={&#39;name&#39;: &#39;preset&#39;, &quot;fit&quot;: False},</span>
<span class="c1">#                                   # layout={&#39;name&#39;: &#39;cose&#39;},</span>
<span class="c1">#                                   zoom=1,  # Initial zoom level</span>
<span class="c1">#                                   pan={&#39;x&#39;: 0, &#39;y&#39;: 0},  # Initial pan position</span>
<span class="c1">#                                   stylesheet=[</span>
<span class="c1">#                                       {</span>
<span class="c1">#                                           &#39;selector&#39;: &#39;node&#39;,</span>
<span class="c1">#                                           &#39;style&#39;: {</span>
<span class="c1">#                                               # &#39;label&#39;: &#39;&#39;, # &#39;data(name)&#39;,</span>
<span class="c1">#                                               &#39;content&#39;: &#39;&#39;,</span>
<span class="c1">#                                               &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#                                               &#39;width&#39;: 8, # &#39;data(size)&#39;,</span>
<span class="c1">#                                               &#39;height&#39;: 8, # &#39;data(size)&#39;,</span>
<span class="c1">#                                               &#39;background-color&#39;: &#39;#888&#39;, # &#39;tan&#39;, # &#39;data(color)&#39;,                    </span>
<span class="c1">#                                               # &#39;background-color&#39;: &#39;style(background-color)&#39;,</span>
<span class="c1">#                                               &#39;text-opacity&#39;: 0.,  # Hide labels by default,                    </span>
<span class="c1">#                                           },</span>
<span class="c1">#                                           # &#39;z-index&#39;: 1001,</span>
<span class="c1">#                                       },</span>
<span class="c1">#                                       # {</span>
<span class="c1">#                                       #     &#39;selector&#39;: &#39;node:hover&#39;,                                          </span>
<span class="c1">#                                       #     &#39;style&#39;: {</span>
<span class="c1">#                                       #         # &#39;label&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#                                       #         &#39;content&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#                                       #         &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#                                       #         &#39;text-opacity&#39;: 1.,  # Show labels on hover</span>
<span class="c1">#                                       #     },</span>
<span class="c1">#                                       #     # &#39;z-index&#39;: 1005,</span>
<span class="c1">#                                       # },</span>
<span class="c1">#                                       {</span>
<span class="c1">#                                           &#39;selector&#39;: &#39;edge&#39;,</span>
<span class="c1">#                                           &#39;style&#39;: {</span>
<span class="c1">#                                               &#39;width&#39;: 1, # &#39;data(width)&#39;,</span>
<span class="c1">#                                               &#39;line-color&#39;: &#39;#222&#39;, # &#39;darkgray&#39;, # &#39;data(color)&#39;</span>
<span class="c1">#                                               # &#39;line-color&#39;: &#39;style(line-color)&#39;</span>
<span class="c1">#                                           }</span>
<span class="c1">#                                       },</span>
<span class="c1">#                                       # Class selectors</span>
<span class="c1">#                                       {</span>
<span class="c1">#                                           &#39;selector&#39;: &#39;.highlight&#39;,</span>
<span class="c1">#                                           &#39;style&#39;: {</span>
<span class="c1">#                                               &#39;border-width&#39;: 20,</span>
<span class="c1">#                                               &#39;border-color&#39;: &#39;black&#39;,</span>
<span class="c1">#                                               # &#39;outline-width&#39;: 20,</span>
<span class="c1">#                                               # &#39;outline-color&#39;: &#39;black&#39;,                    </span>
<span class="c1">#                                           },</span>
<span class="c1">#                                           # &#39;z-index&#39;: 1100,</span>
<span class="c1">#                                       },</span>
<span class="c1">#                                   ],       </span>
<span class="c1">#                                   # responsive=True,</span>
<span class="c1">#                               ),</span>
<span class="c1">#                           ]),</span>
                          
<span class="c1">#                       ])</span>



<span class="c1"># app.clientside_callback(</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     function(n_intervals) {</span>
<span class="c1">#         const container = document.getElementById(&#39;network-graph&#39;);</span>
<span class="c1">#         const dimensions = {width: container.offsetWidth, height: container.offsetHeight};</span>
<span class="c1">#         return dimensions;</span>
<span class="c1">#     }</span>
<span class="c1">#     &#39;&#39;&#39;,</span>
<span class="c1">#     Output(&#39;container-dimensions&#39;, &#39;data&#39;),</span>
<span class="c1">#     Input(&#39;interval&#39;, &#39;n_intervals&#39;)</span>
<span class="c1"># )</span>

<span class="c1"># @app.callback(</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;elements&#39;),</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;stylesheet&#39;),</span>
<span class="c1">#     Output(&#39;node-attribute-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;zoom&#39;),</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;pan&#39;),</span>
<span class="c1">#     # Output(&#39;network-graph&#39;, &#39;layout&#39;),</span>
<span class="c1">#     Input(&#39;layout-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;highlight-button&#39;, &#39;n_clicks&#39;), # </span>
<span class="c1">#     State(&#39;node-label&#39;, &#39;value&#39;), # </span>
<span class="c1">#     Input(&#39;node-size-slider&#39;, &#39;value&#39;), # </span>
<span class="c1">#     Input(&#39;edge-width-slider&#39;, &#39;value&#39;), # </span>
<span class="c1">#     Input(&#39;node-attribute-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;edge-attribute-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;node-colormap-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;edge-colormap-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1">#     Input(&#39;network-graph&#39;, &#39;tapNodeData&#39;),</span>
<span class="c1">#     State(&#39;network-graph&#39;, &#39;elements&#39;),</span>
<span class="c1">#     State(&#39;container-dimensions&#39;, &#39;data&#39;),</span>
<span class="c1">#     State(&#39;network-graph&#39;, &#39;zoom&#39;),</span>
<span class="c1">#     State(&#39;network-graph&#39;, &#39;pan&#39;),</span>
<span class="c1">#     Input(&#39;node-color-button&#39;, &#39;n_clicks&#39;),</span>
<span class="c1">#     Input(&#39;feature-label&#39;, &#39;value&#39;),</span>
<span class="c1">#     Input(&#39;keeper-data-dropdown&#39;, &#39;value&#39;),</span>

<span class="c1">#     # prevent_initial_call=True ###</span>
<span class="c1"># )</span>
<span class="c1"># def update_graph(layout, n_clicks, node_label, </span>
<span class="c1">#                  node_size, </span>
<span class="c1">#                  edge_width, </span>
<span class="c1">#                  node_attr, edge_attr, node_cmap, edge_cmap, </span>
<span class="c1">#                  tap_node_data,</span>
<span class="c1">#                  elements_in, dimensions,</span>
<span class="c1">#                  current_zoom, current_pan, feature_n_clicks, ft_label, data_label):</span>
    
<span class="c1">#     # Determine which input triggered the callback</span>
<span class="c1">#     triggered_input = callback_context.triggered[0][&#39;prop_id&#39;].split(&#39;.&#39;)[0]</span>
    
<span class="c1">#     if not dimensions:</span>
<span class="c1">#         raise dash_exceptions.PreventUpdate</span>
<span class="c1">#     width, height = dimensions[&#39;width&#39;], dimensions[&#39;height&#39;]</span>
    
    
<span class="c1">#     # print(f&quot;width = {width}, height = {height}&quot;)</span>
<span class="c1">#     # Get positions based on layout</span>
    
<span class="c1">#     # print(f&quot;*** LAYOUT = {layout}***&quot;)</span>
<span class="c1">#     # print(f&quot;*** positions of elements in : {int(elements_in[&#39;nodes&#39;][0][&#39;data&#39;][&#39;id&#39;])}: {elements_in[&#39;nodes&#39;][0]} ***&quot;)</span>
<span class="c1">#     #  print(f&quot;*** is layout in positions_records: </span>
<span class="c1">#     if layout in positions_records.keys():</span>
<span class="c1">#         pos = positions_records[layout]</span>
<span class="c1">#     else:</span>
<span class="c1">#         if layout == &#39;spring&#39;:</span>
<span class="c1">#             pos = nx.spring_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;circular&#39;:</span>
<span class="c1">#             pos = nx.circular_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;kamada_kawai&#39;:</span>
<span class="c1">#             pos = nx.kamada_kawai_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;shell&#39;:        </span>
<span class="c1">#             pos = nx.shell_layout(G)  </span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;grid&#39;:</span>
<span class="c1">#             pos = nx.planar_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;sin&#39;:</span>
<span class="c1">#             pos = nfv.sin_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;wavy_spiral&#39;:</span>
<span class="c1">#             pos = nfv.wavy_curve_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;cose&#39;:</span>
<span class="c1">#             pos = None</span>
<span class="c1">#         else:</span>
<span class="c1">#             warnings.warn(&quot;Layout not recognized, using &#39;kamada_kawai&#39; instead.&quot;)</span>
<span class="c1">#             pos = nx.kamada_kawai_layout(G)          </span>
        
<span class="c1">#     if pos is not None:</span>
<span class="c1">#         # bounding_box=(0., 0., 1400, 650)</span>
<span class="c1">#         # bounding_box=(0., 0., width, height)</span>
<span class="c1">#         bounding_box=(3., 3., width-3., height-3.)</span>
<span class="c1">#         X_MIN, Y_MIN, X_MAX, Y_MAX = bounding_box</span>
<span class="c1">#         x = [k[0] for k in pos.values()]</span>
<span class="c1">#         y = [k[1] for k in pos.values()]</span>
<span class="c1">#         x_min, x_max, y_min, y_max = min(x), max(x), min(y), max(y)</span>

<span class="c1">#         # print(f&quot;*** set pos ***&quot;)</span>
<span class="c1">#         # pos = {node: {&#39;x&#39;: (position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
<span class="c1">#         #               &#39;y&#39;: (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
<span class="c1">#         #               } for node, position in pos.items()}</span>
<span class="c1">#         pos = {node: np.array([(position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
<span class="c1">#                                (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
<span class="c1">#                               ]) for node, position in pos.items()}</span>
        
<span class="c1">#     if triggered_input == &#39;network-graph&#39;: # tap_node_data:</span>
<span class="c1">#         node_attr = int(tap_node_data[&#39;id&#39;])</span>
<span class="c1">#         node_attr_value = &#39;None&#39;</span>
<span class="c1">#     else:</span>
<span class="c1">#         node_attr_value = node_attr # node_attr_state # node_attr</span>
<span class="c1">#     elements = nx_to_cytoscape(G, # node_size, edge_width, </span>
<span class="c1">#                                pos=pos,</span>
<span class="c1">#                                node_color_attr=None if node_attr==&#39;None&#39; else node_attr, </span>
<span class="c1">#                                node_cmap=node_cmap,</span>
<span class="c1">#                                edge_color_attr=None if edge_attr==&#39;None&#39; else edge_attr, </span>
<span class="c1">#                                edge_cmap=edge_cmap)</span>

<span class="c1">#     # print(f&quot;*** positions of elements after : {int(elements[&#39;nodes&#39;][0][&#39;data&#39;][&#39;id&#39;])}: {elements[&#39;nodes&#39;][0]} ***&quot;)</span>
<span class="c1">#     if (pos is None) and (layout not in positions_records):</span>
<span class="c1">#         positions_records[layout] = {int(k[&#39;data&#39;][&#39;id&#39;]): np.array([k[&#39;position&#39;][&#39;x&#39;], k[&#39;position&#39;][&#39;y&#39;]]) for k in elements[&#39;nodes&#39;]}</span>
<span class="c1">#         print(&quot;*** updated position records ***&quot;)</span>
                    
<span class="c1">#     # Highlight node by label                       </span>
<span class="c1">#     if node_label:</span>
<span class="c1">#         for element in elements[&#39;nodes&#39;]:</span>
<span class="c1">#             if element[&#39;data&#39;].get(&#39;name&#39;) == node_label:</span>
<span class="c1">#                 element[&#39;classes&#39;] += &#39; highlight&#39;</span>
<span class="c1">#                 break    </span>
    
<span class="c1">#     # for element in elements:</span>
<span class="c1">#     #     if &#39;node&#39; in element[&#39;classes&#39;]:</span>
<span class="c1">#     #         element[&#39;data&#39;][&#39;size&#39;] = node_size</span>
<span class="c1">#     #     if &#39;edge&#39; in element[&#39;classes&#39;]:</span>
<span class="c1">#     #         element[&#39;data&#39;][&#39;width&#39;] = edge_width</span>

<span class="c1">#     # # Color nodes by attribute</span>
<span class="c1">#     # if node_attr:</span>
<span class="c1">#     #     color_nodes = {node: G.nodes[node][node_attr] for node in G.nodes()}</span>
<span class="c1">#     # else:</span>
<span class="c1">#     #     color_nodes = None</span>
    
    
<span class="c1">#     stylesheet=[        </span>
<span class="c1">#             {</span>
<span class="c1">#                 &#39;selector&#39;: &#39;node&#39;,</span>
<span class="c1">#                 &#39;style&#39;: {</span>
<span class="c1">#                     # &#39;label&#39;: &#39;data(label)&#39;,</span>
<span class="c1">#                     # &#39;label&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#                     # &#39;label&#39;: &#39;&#39;,</span>
<span class="c1">#                     &#39;content&#39;: &#39;&#39;, # &#39;data(label)&#39;,</span>
<span class="c1">#                     &#39;width&#39;: node_size, # &#39;data(size)&#39;,</span>
<span class="c1">#                     &#39;height&#39;: node_size, # &#39;data(size)&#39;,</span>
<span class="c1">#                     &#39;background-color&#39;: &#39;data(color)&#39;,</span>
<span class="c1">#                     # &#39;background-color&#39;: &#39;style(background-color)&#39;,</span>
<span class="c1">#                     &#39;text-opacity&#39;: &#39;0&#39;,  # Hide labels by default,   </span>
<span class="c1">#                     &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#                     # &#39;z-index&#39;: 1001,</span>
<span class="c1">#                 },</span>
<span class="c1">#                 # &#39;z-index&#39;: 1001,</span>
<span class="c1">#             },</span>
<span class="c1">#             # {</span>
<span class="c1">#             #     &#39;selector&#39;: &#39;node:hover&#39;,</span>
<span class="c1">#             #     &#39;style&#39;: {</span>
<span class="c1">#             #         # &#39;label&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#             #         &#39;content&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#             #         &#39;text-opacity&#39;: &#39;1&#39;,  # Show labels on hover</span>
<span class="c1">#             #         &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#             #     }</span>
<span class="c1">#             # },</span>
<span class="c1">#             {</span>
<span class="c1">#                 &#39;selector&#39;: &#39;edge&#39;,</span>
<span class="c1">#                 &#39;style&#39;: {</span>
<span class="c1">#                     &#39;width&#39;: edge_width, # &#39;data(width)&#39;,</span>
<span class="c1">#                     &#39;line-color&#39;: &#39;data(color)&#39;</span>
<span class="c1">#                     # &#39;line-color&#39;: &#39;style(line-color)&#39;</span>
<span class="c1">#                 },</span>
<span class="c1">#                 # &#39;z-index&#39;: 1005,</span>
<span class="c1">#             },</span>
<span class="c1">#             # Class selectors</span>
<span class="c1">#             {</span>
<span class="c1">#                 &#39;selector&#39;: &#39;.highlight&#39;,</span>
<span class="c1">#                 &#39;style&#39;: {</span>
<span class="c1">#                     &#39;border-width&#39;: 20,</span>
<span class="c1">#                     &#39;border-color&#39;: &#39;k&#39;,</span>
<span class="c1">#                     # &#39;outline-width&#39;: 20,</span>
<span class="c1">#                     # &#39;outline-color&#39;: &#39;black&#39;,                   </span>
<span class="c1">#                 },</span>
<span class="c1">#                 # &#39;z-index&#39;: 1100,</span>
<span class="c1">#             },</span>
<span class="c1">#         ]    </span>
            
<span class="c1">#     layout = {&#39;name&#39;: &#39;preset&#39;},</span>
<span class="c1">#     return elements, stylesheet, node_attr_value, current_zoom, current_pan # , layout</span>

<span class="c1"># # @app.callback(Output(&#39;cytoscape-tapNodeData&#39;, &#39;children&#39;),</span>
<span class="c1"># #               Input(&#39;network-graph&#39;, &#39;tapNodeData&#39;))</span>
<span class="c1"># # def displayTapNodeData(data):</span>
<span class="c1"># #     return json.dumps(data, indent=2) # f&quot;You selected node {data} # {data[&#39;id&#39;]} -- {data[&#39;name&#39;]}&quot; # </span>

<span class="c1"># @app.callback(Output(&#39;cytoscape-mouseoverNodeData&#39;, &#39;children&#39;),</span>
<span class="c1">#               Input(&#39;network-graph&#39;, &#39;mouseoverNodeData&#39;))</span>
<span class="c1"># def displayHoverNodeData(data):</span>
<span class="c1">#     # return json.dumps(data, indent=2) # f&quot;You selected node {data} # {data[&#39;id&#39;]} -- {data[&#39;name&#39;]}&quot; # </span>
<span class="c1">#     if data is None:</span>
<span class="c1">#         return &quot;Hover node data&quot;</span>
<span class="c1">#     return &quot;\n&quot;.join([f&quot;{k}: {data[k] if not k.startswith(&#39;pse&#39;) else np.round(data[k], 3)}&quot; for k in [&#39;name&#39;, </span>
<span class="c1">#                                                                                                        &#39;id&#39;, &#39;is_root&#39;, </span>
<span class="c1">#                                                                                                        &#39;undecided&#39;, </span>
<span class="c1">#                                                                                                        &#39;unidentified&#39;,</span>
<span class="c1">#                                                                                                        &#39;pseudo-distance from root&#39;,</span>
<span class="c1">#                                                                                                       ]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # ORIGINAL WORKING COPY - USE THIS!</span>

<span class="c1"># # Initialize the Dash app</span>
<span class="c1"># external_stylesheets = [&#39;https://codepen.io/chriddyp/pen/bWLwgP.css&#39;]</span>

<span class="c1"># # app = JupyterDash(__name__, external_stylesheets=external_stylesheets)</span>
<span class="c1"># app = JupyterDash(__name__)</span>

<span class="c1"># styles = {</span>
<span class="c1">#     &#39;container&#39;: {</span>
<span class="c1">#         &#39;position&#39;: &#39;fixed&#39;,</span>
<span class="c1">#         &#39;display&#39;: &#39;flex&#39;,</span>
<span class="c1">#         &#39;flex-direction&#39;: &#39;row&#39;,</span>
<span class="c1">#         &#39;height&#39;: &#39;98%&#39;,</span>
<span class="c1">#         &#39;width&#39;: &#39;100%&#39;,</span>
<span class="c1">#         # @ &#39;padding&#39;: </span>
<span class="c1">#         &#39;gap&#39;: &#39;10px&#39;,</span>
<span class="c1">#         # &#39;margin&#39;: &#39;10px&#39;,</span>
        
<span class="c1">#     },    </span>
<span class="c1">#     # &#39;control-panel-container&#39;: {</span>
<span class="c1">#     #     &#39;width&#39;: &#39;20%&#39;, </span>
<span class="c1">#     #     &#39;display&#39;: &#39;inline-block&#39;, </span>
<span class="c1">#     #     &#39;verticalAlign&#39;: &#39;top&#39;, </span>
<span class="c1">#     #     &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
<span class="c1">#     #     &#39;border&#39;: &#39;1px solid black&#39;, </span>
<span class="c1">#     #     &#39;border-radius&#39;: &#39;20px&#39;, </span>
<span class="c1">#     #     &#39;padding&#39;: &#39;5px&#39;,</span>
<span class="c1">#     #     &#39;margin&#39;: &#39;3px&#39;,</span>
<span class="c1">#     #     # &#39;flex&#39;: &#39;1&#39;, &#39;display&#39;: &#39;flex&#39;, &#39;flexDirection&#39;: &#39;column&#39;,</span>
<span class="c1">#     #     # &#39;flex&#39;: &#39;0.2&#39;,</span>
<span class="c1">#     #     # &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#     #     # &#39;position&#39;: &#39;relative&#39;, &#39;flex&#39;: &#39;1&#39;,</span>
<span class="c1">#     # },  </span>
<span class="c1">#     &#39;control-panel-container&#39;: {</span>
<span class="c1">#         &#39;width&#39;: &#39;20%&#39;, </span>
<span class="c1">#         # &#39;flex&#39;: &#39;0.20&#39;,</span>
<span class="c1">#         &#39;display&#39;: &#39;inline-block&#39;, </span>
<span class="c1">#         &#39;verticalAlign&#39;: &#39;top&#39;, </span>
<span class="c1">#         # &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
<span class="c1">#         &#39;border&#39;: &#39;1px solid black&#39;, </span>
<span class="c1">#         &#39;border-radius&#39;: &#39;20px&#39;, </span>
<span class="c1">#         &#39;padding&#39;: &#39;5px&#39;,</span>
<span class="c1">#         &#39;margin&#39;: &#39;3px&#39;,</span>
<span class="c1">#         # &#39;flex&#39;: &#39;1&#39;, &#39;display&#39;: &#39;flex&#39;, &#39;flexDirection&#39;: &#39;column&#39;,</span>
<span class="c1">#         # &#39;flex&#39;: &#39;0.2&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;relative&#39;, &#39;flex&#39;: &#39;1&#39;,</span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;control-panel&#39; : {</span>
<span class="c1">#         &#39;display&#39;: &#39;inline-block&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;absolute&#39;,</span>
<span class="c1">#         # &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#         &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
<span class="c1">#         # &#39;width&#39;: &#39;98%&#39;,</span>
<span class="c1">#         &#39;height&#39;: &#39;81%&#39;,</span>
<span class="c1">#         &#39;paddingRight&#39;: &#39;15px&#39;,</span>
<span class="c1">#         &#39;paddingLeft&#39;: &#39;8px&#39;,</span>
<span class="c1">#         &#39;paddingBottom&#39;: &#39;3px&#39;,</span>
<span class="c1">#         &#39;border&#39;: &#39;thin solid lightgrey&#39;,</span>
<span class="c1">#         &#39;border-radius&#39;: &#39;10px&#39;,</span>
<span class="c1">#         &#39;z-index&#39;: 999,</span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;cy-container&#39;: {</span>
<span class="c1">#         &#39;flex&#39;: &#39;0.78&#39;,</span>
<span class="c1">#         &#39;position&#39;: &#39;relative&#39;,</span>
<span class="c1">#         # &#39;paddingLeft&#39;: &#39;20px&#39;,</span>
<span class="c1">#         &#39;border&#39;: &#39;1px solid black&#39;,</span>
<span class="c1">#         &#39;border-radius&#39;: &#39;20px&#39;,</span>
<span class="c1">#         # &#39;padding&#39;: &#39;10px&#39;,        </span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;cytoscape&#39;: {</span>
<span class="c1">#         &#39;position&#39;: &#39;absolute&#39;,</span>
<span class="c1">#         &#39;width&#39;: &#39;100%&#39;, # &#39;98%&#39;,</span>
<span class="c1">#         &#39;height&#39;: &#39;80%&#39;, # &#39;83%&#39;, # &#39;100%&#39;,</span>
<span class="c1">#         # &#39;padding&#39;: &#39;3px&#39;,</span>
<span class="c1">#        #  &#39;margin&#39;: &#39;15px&#39;,</span>
<span class="c1">#         &#39;z-index&#39;: 999</span>
<span class="c1">#     },</span>
<span class="c1">#     &#39;pre&#39;: {</span>
<span class="c1">#         &#39;border&#39;: &#39;thin lightgrey solid&#39;,</span>
<span class="c1">#         &#39;border-radius&#39;: &#39;20px&#39;,</span>
<span class="c1">#         &#39;overflowX&#39;: &#39;scroll&#39;,</span>
<span class="c1">#         &#39;overflowY&#39;: &#39;scroll&#39;,</span>
<span class="c1">#         &#39;width&#39;: &#39;280px&#39;, # &#39;100%&#39;, </span>
<span class="c1">#         &#39;height&#39;: &#39;15%&#39;,</span>
<span class="c1">#         &#39;padding&#39;: &#39;10px&#39;,</span>
<span class="c1">#         # &#39;align&#39;: &#39;right&#39;,</span>
<span class="c1">#         &#39;margin&#39;: &#39;5px&#39;,</span>
<span class="c1">#         #  &#39;position&#39;: &#39;fixed&#39;, # &#39;relative&#39;,</span>
<span class="c1">#     }</span>
<span class="c1"># }</span>



<span class="c1"># # Define the layout of the app</span>
<span class="c1"># app.layout = html.Div(style=styles[&#39;container&#39;], </span>
<span class="c1">#                       children=[</span>
<span class="c1">#                           html.Div(className=&#39;control-panel-container&#39;, </span>
<span class="c1">#                                    style=styles[&#39;control-panel-container&#39;], children=[</span>
<span class="c1">#                                        html.H2(&quot;NetFlow POSE&quot;),</span>
<span class="c1">#                                        html.H3(&quot;Settings&quot;),</span>
<span class="c1">#                                        html.Div([</span>
<span class="c1">#                                            dcc.Store(id=&#39;container-dimensions&#39;), ###</span>
<span class="c1">#                                            # html.H2(&quot;NetFlow POSE&quot;),</span>
<span class="c1">#                                            html.H4(&quot;Graph Layout&quot;),</span>
<span class="c1">#                                            dcc.Dropdown(</span>
<span class="c1">#                                                id=&#39;layout-dropdown&#39;,</span>
<span class="c1">#                                                options=[{&#39;label&#39;: layout, &#39;value&#39;: layout} for layout in [&#39;kamada_kawai&#39;, &#39;spring&#39;, </span>
<span class="c1">#                                                                                                           &#39;circular&#39;, # &#39;cose&#39;, </span>
<span class="c1">#                                                                                                           &#39;shell&#39;, &#39;grid&#39;, </span>
<span class="c1">#                                                                                                           &#39;breadthfirst&#39;, &#39;sin&#39;,</span>
<span class="c1">#                                                                                                           &#39;wavy_spiral&#39;]],</span>
<span class="c1">#                                                value=&#39;kamada_kawai&#39;, # &#39;cose&#39;, # </span>
<span class="c1">#                                            ),</span>
<span class="c1">#                                            html.H4(&quot;Highlight Node by Label&quot;),</span>
<span class="c1">#                                            dcc.Input(id=&#39;node-label&#39;, type=&#39;text&#39;, value=&#39;&#39;),</span>
<span class="c1">#                                            html.Button(&#39;Highlight Node&#39;, id=&#39;highlight-button&#39;, n_clicks=0),                              </span>
<span class="c1">#                                            html.H4(&quot;Node Size&quot;),</span>
<span class="c1">#                                            dcc.Slider(id=&#39;node-size-slider&#39;, min=0.01, max=30, step=0.01, value=8, </span>
<span class="c1">#                                                       marks={1: &#39;smaller&#39;, 30: &#39;larger&#39;}),</span>
<span class="c1">#                                            # </span>
<span class="c1">#                                            # html.H4(&quot;Set node colors&quot;),</span>
<span class="c1">#                                            # dcc.Dropdown(</span>
<span class="c1">#                                            #     id=&#39;node-color-type-dropdown&#39;,</span>
<span class="c1">#                                            #     options=[{&#39;label&#39;: &#39;Node attribute&#39;, &#39;value&#39;: &#39;node_attribute&#39;}, </span>
<span class="c1">#                                            #              {&#39;label&#39;: &#39;Data feature&#39;, &#39;value&#39;: &#39;data_feature&#39;}],</span>
<span class="c1">#                                            #     value=0, # &#39;branch&#39;</span>
<span class="c1">#                                            # ),   </span>
<span class="c1">#                                            # html.Div(id=&#39;additional-controls&#39;, children=[</span>
<span class="c1">#                                            html.H4(&quot;Node Attribute for Coloring&quot;),</span>
<span class="c1">#                                            dcc.Dropdown(</span>
<span class="c1">#                                                id=&#39;node-attribute-dropdown&#39;,</span>
<span class="c1">#                                                options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: attr, &#39;value&#39;: attr} for attr in G.nodes(data=True)[0].keys()],</span>
<span class="c1">#                                                value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1">#                                            ),  </span>
<span class="c1">#                                            # ]),</span>
<span class="c1">#                                            # OR </span>
<span class="c1">#                                            html.H4(&quot;Data Feature for Coloring Nodes&quot;),</span>
<span class="c1">#                                            dcc.Dropdown(</span>
<span class="c1">#                                                id=&#39;keeper-data-dropdown&#39;,</span>
<span class="c1">#                                                options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: dataset.label, &#39;value&#39;: dataset.label} for dataset in keeper.data],</span>
<span class="c1">#                                                value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1">#                                            ),  </span>
<span class="c1">#                                            # dcc.Input(id=&#39;feature-label&#39;, type=&#39;text&#39;, value=&#39;&#39;),</span>
<span class="c1">#                                            dcc.Dropdown(</span>
<span class="c1">#                                                id=&#39;feature-label&#39;,</span>
<span class="c1">#                                                options=[], # [{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}],</span>
<span class="c1">#                                                value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1">#                                            ),  </span>
<span class="c1">#                                            html.Button(&#39;Color Nodes&#39;, id=&#39;node-color-button&#39;, n_clicks=0),                              </span>
                              
<span class="c1">#                                            html.H4(&quot;Colormap for Nodes&quot;),</span>
<span class="c1">#                                            dcc.Dropdown(</span>
<span class="c1">#                                                id=&#39;node-colormap-dropdown&#39;,</span>
<span class="c1">#                                                options=[{&#39;label&#39;: cmap, &#39;value&#39;: cmap} for cmap in [&#39;YlGnBu&#39;, &#39;viridis&#39;, &#39;cividis&#39;, &#39;jet&#39;, &#39;nipy_spectral&#39;, &#39;gist_ncar&#39;]],</span>
<span class="c1">#                                                value=&#39;YlGnBu&#39;</span>
<span class="c1">#                                            ),</span>
<span class="c1">#                                            html.H4(&quot;Edge Width&quot;),</span>
<span class="c1">#                                            dcc.Slider(id=&#39;edge-width-slider&#39;, min=0.001, max=14, step=0.001, value=1.5,</span>
<span class="c1">#                                                       marks={1: &#39;thinner&#39;, 14: &#39;wider&#39;}),</span>
<span class="c1">#                                            html.H4(&quot;Edge Attribute for Coloring&quot;),</span>
<span class="c1">#                                            dcc.Dropdown(</span>
<span class="c1">#                                                id=&#39;edge-attribute-dropdown&#39;,</span>
<span class="c1">#                                                options=[{&#39;label&#39;: &#39;None&#39;, </span>
<span class="c1">#                                                          &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: attr, </span>
<span class="c1">#                                                                                &#39;value&#39;: attr} for attr in list(G.edges(data=True))[0][-1].keys()],</span>
<span class="c1">#                                                value=&#39;None&#39;, # &#39;distance&#39;</span>
<span class="c1">#                                            ),                              </span>
<span class="c1">#                                            html.H4(&quot;Colormap for Edges&quot;),</span>
<span class="c1">#                                            dcc.Dropdown(</span>
<span class="c1">#                                                id=&#39;edge-colormap-dropdown&#39;,</span>
<span class="c1">#                                                options=[{&#39;label&#39;: cmap, </span>
<span class="c1">#                                                          &#39;value&#39;: cmap} for cmap in [&#39;YlGnBu&#39;, &#39;viridis&#39;, &#39;cividis&#39;, </span>
<span class="c1">#                                                                                      &#39;jet&#39;, &#39;nipy_spectral&#39;, &#39;gist_ncar&#39;]],</span>
<span class="c1">#                                                value=&#39;nipy_spectral&#39;,</span>
<span class="c1">#                                            ),</span>
<span class="c1">#                                            dcc.Interval(id=&#39;interval&#39;, interval=1000, n_intervals=0)  # Interval to capture dimensions periodically                              </span>
<span class="c1">#                                        ], </span>
<span class="c1">#                                            style=styles[&#39;control-panel&#39;], # styles[&#39;control-panel-container&#39;],</span>
<span class="c1">#                                        ),</span>
<span class="c1">#                                    ]),</span>
                          
<span class="c1">#                           html.Div(className=&#39;cy-container&#39;, style=styles[&#39;cy-container&#39;], children=[   </span>
<span class="c1">#                               html.Pre(id=&#39;cytoscape-mouseoverNodeData&#39;, style=styles[&#39;pre&#39;]),                               </span>
<span class="c1">#                               cyto.Cytoscape(</span>
<span class="c1">#                                   id=&#39;network-graph&#39;,</span>
<span class="c1">#                                   elements=nx_to_cytoscape(G), # , 30, 1),        </span>
<span class="c1">#                                   # style={&#39;width&#39;: &#39;80%&#39;, &#39;height&#39;: &#39;800px&#39;},</span>
<span class="c1">#                                   style=styles[&#39;cytoscape&#39;],</span>
<span class="c1">#                                   # layout={&#39;name&#39;: &#39;kamada_kawai&#39;}, # &#39;cose&#39;},</span>
<span class="c1">#                                   layout={&#39;name&#39;: &#39;preset&#39;, &quot;fit&quot;: False},</span>
<span class="c1">#                                   # layout={&#39;name&#39;: &#39;cose&#39;},</span>
<span class="c1">#                                   zoom=1,  # Initial zoom level</span>
<span class="c1">#                                   pan={&#39;x&#39;: 0, &#39;y&#39;: 0},  # Initial pan position</span>
<span class="c1">#                                   stylesheet=[</span>
<span class="c1">#                                       {</span>
<span class="c1">#                                           &#39;selector&#39;: &#39;node&#39;,</span>
<span class="c1">#                                           &#39;style&#39;: {</span>
<span class="c1">#                                               # &#39;label&#39;: &#39;&#39;, # &#39;data(name)&#39;,</span>
<span class="c1">#                                               # &#39;content&#39;: &#39;&#39;,</span>
<span class="c1">#                                               &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#                                               &#39;width&#39;: 8, # &#39;data(size)&#39;,</span>
<span class="c1">#                                               &#39;height&#39;: 8, # &#39;data(size)&#39;,</span>
<span class="c1">#                                               &#39;background-color&#39;: &#39;#888&#39;, # &#39;tan&#39;, # &#39;data(color)&#39;,                    </span>
<span class="c1">#                                               # &#39;background-color&#39;: &#39;style(background-color)&#39;,</span>
<span class="c1">#                                               &#39;text-opacity&#39;: 0.,  # Hide labels by default,                    </span>
<span class="c1">#                                           },</span>
<span class="c1">#                                           # &#39;z-index&#39;: 1001,</span>
<span class="c1">#                                       },</span>
<span class="c1">#                                       # {</span>
<span class="c1">#                                       #     &#39;selector&#39;: &#39;node:hover&#39;,                                          </span>
<span class="c1">#                                       #     &#39;style&#39;: {</span>
<span class="c1">#                                       #         # &#39;label&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#                                       #         &#39;content&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#                                       #         &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#                                       #         &#39;text-opacity&#39;: 1.,  # Show labels on hover</span>
<span class="c1">#                                       #     },</span>
<span class="c1">#                                       #     # &#39;z-index&#39;: 1005,</span>
<span class="c1">#                                       # },</span>
<span class="c1">#                                       {</span>
<span class="c1">#                                           &#39;selector&#39;: &#39;edge&#39;,</span>
<span class="c1">#                                           &#39;style&#39;: {</span>
<span class="c1">#                                               &#39;width&#39;: 1, # &#39;data(width)&#39;,</span>
<span class="c1">#                                               &#39;line-color&#39;: &#39;#222&#39;, # &#39;darkgray&#39;, # &#39;data(color)&#39;</span>
<span class="c1">#                                               # &#39;line-color&#39;: &#39;style(line-color)&#39;</span>
<span class="c1">#                                           }</span>
<span class="c1">#                                       },</span>
<span class="c1">#                                       # Class selectors</span>
<span class="c1">#                                       {</span>
<span class="c1">#                                           &#39;selector&#39;: &#39;.highlight&#39;,</span>
<span class="c1">#                                           &#39;style&#39;: {</span>
<span class="c1">#                                               &#39;border-width&#39;: 20,</span>
<span class="c1">#                                               &#39;border-color&#39;: &#39;black&#39;,</span>
<span class="c1">#                                               # &#39;outline-width&#39;: 20,</span>
<span class="c1">#                                               # &#39;outline-color&#39;: &#39;black&#39;,                    </span>
<span class="c1">#                                           },</span>
<span class="c1">#                                           # &#39;z-index&#39;: 1100,</span>
<span class="c1">#                                       },</span>
<span class="c1">#                                   ],       </span>
<span class="c1">#                                   # responsive=True,</span>
<span class="c1">#                               ),</span>
<span class="c1">#                           ]),</span>
                          
<span class="c1">#                       ])</span>



<span class="c1"># app.clientside_callback(</span>
<span class="c1">#     &#39;&#39;&#39;</span>
<span class="c1">#     function(n_intervals) {</span>
<span class="c1">#         const container = document.getElementById(&#39;network-graph&#39;);</span>
<span class="c1">#         const dimensions = {width: container.offsetWidth, height: container.offsetHeight};</span>
<span class="c1">#         return dimensions;</span>
<span class="c1">#     }</span>
<span class="c1">#     &#39;&#39;&#39;,</span>
<span class="c1">#     Output(&#39;container-dimensions&#39;, &#39;data&#39;),</span>
<span class="c1">#     Input(&#39;interval&#39;, &#39;n_intervals&#39;)</span>
<span class="c1"># )</span>

<span class="c1"># # @app.callback(</span>
<span class="c1"># #     Output(&#39;additional-controls&#39;, &#39;children&#39;),</span>
<span class="c1"># #     Input(&#39;node-color-type-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1"># # )</span>
<span class="c1"># # def display_node_color_options(attribute_source):</span>
<span class="c1"># #     if attribute_source == &#39;node_attribute&#39;:</span>
<span class="c1"># #         return html.Div([html.H4(&quot;Node Attribute for Coloring&quot;),</span>
<span class="c1"># #                          dcc.Dropdown(</span>
<span class="c1"># #                              id=&#39;node-attribute-dropdown&#39;,</span>
<span class="c1"># #                              options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: attr, &#39;value&#39;: attr} for attr in G.nodes(data=True)[0].keys()],</span>
<span class="c1"># #                              value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1"># #                          ), </span>
<span class="c1"># #                         ])</span>
<span class="c1"># #     else:</span>
<span class="c1"># #         return html.Div([html.H4(&quot;Data Feature for Coloring Nodes&quot;),</span>
<span class="c1"># #                          dcc.Dropdown(</span>
<span class="c1"># #                              id=&#39;keeper-data-dropdown&#39;,</span>
<span class="c1"># #                              options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: dataset.label, &#39;value&#39;: dataset.label} for dataset in keeper.data],</span>
<span class="c1"># #                              value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1"># #                          ),  </span>
<span class="c1"># #                          dcc.Input(id=&#39;feature-label&#39;, type=&#39;text&#39;, value=&#39;&#39;),</span>
<span class="c1"># #                          html.Button(&#39;Color Nodes&#39;, id=&#39;node-color-button&#39;, n_clicks=0), </span>
<span class="c1"># #                         ])</span>

<span class="c1"># @app.callback(</span>
<span class="c1">#     Output(&#39;feature-label&#39;, &#39;options&#39;),</span>
<span class="c1">#     Input(&#39;keeper-data-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1"># )</span>
<span class="c1"># def set_feature_options(data_label):</span>
<span class="c1">#     if data_label == &#39;None&#39;:</span>
<span class="c1">#         options = [] # [{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}]</span>
<span class="c1">#     else:</span>
<span class="c1">#         options = [{&#39;label&#39;: ft, &#39;value&#39;: ft} for ft in keeper.data[data_label].feature_labels]</span>
<span class="c1">#     return options</span>

<span class="c1"># @app.callback(</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;elements&#39;),</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;stylesheet&#39;),</span>
<span class="c1">#     Output(&#39;node-attribute-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1">#     Output(&#39;keeper-data-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1">#     Output(&#39;feature-label&#39;, &#39;value&#39;),</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;zoom&#39;),</span>
<span class="c1">#     Output(&#39;network-graph&#39;, &#39;pan&#39;),</span>
<span class="c1">#     # Output(&#39;network-graph&#39;, &#39;layout&#39;),</span>
<span class="c1">#     Input(&#39;layout-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;highlight-button&#39;, &#39;n_clicks&#39;), # </span>
<span class="c1">#     State(&#39;node-label&#39;, &#39;value&#39;), # </span>
<span class="c1">#     Input(&#39;node-size-slider&#39;, &#39;value&#39;), # </span>
<span class="c1">#     Input(&#39;edge-width-slider&#39;, &#39;value&#39;), # </span>
<span class="c1">#     Input(&#39;node-attribute-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;edge-attribute-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;node-colormap-dropdown&#39;, &#39;value&#39;), ###</span>
<span class="c1">#     Input(&#39;edge-colormap-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1">#     Input(&#39;network-graph&#39;, &#39;tapNodeData&#39;),</span>
<span class="c1">#     State(&#39;network-graph&#39;, &#39;elements&#39;),</span>
<span class="c1">#     State(&#39;container-dimensions&#39;, &#39;data&#39;),</span>
<span class="c1">#     State(&#39;network-graph&#39;, &#39;zoom&#39;),</span>
<span class="c1">#     State(&#39;network-graph&#39;, &#39;pan&#39;),</span>
<span class="c1">#     Input(&#39;node-color-button&#39;, &#39;n_clicks&#39;),    </span>
<span class="c1">#     State(&#39;keeper-data-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1">#     State(&#39;feature-label&#39;, &#39;value&#39;),</span>

<span class="c1">#     # prevent_initial_call=True ###</span>
<span class="c1"># )</span>
<span class="c1"># def update_graph(layout, n_clicks, node_label, </span>
<span class="c1">#                  node_size, </span>
<span class="c1">#                  edge_width, </span>
<span class="c1">#                  node_attr, edge_attr, node_cmap, edge_cmap, </span>
<span class="c1">#                  tap_node_data,</span>
<span class="c1">#                  elements_in, dimensions,</span>
<span class="c1">#                  current_zoom, current_pan, feature_n_clicks, data_label, ft_label):</span>
    
<span class="c1">#     # Determine which input triggered the callback</span>
<span class="c1">#     triggered_input = callback_context.triggered[0][&#39;prop_id&#39;].split(&#39;.&#39;)[0]</span>
    
<span class="c1">#     if not dimensions:</span>
<span class="c1">#         raise dash_exceptions.PreventUpdate</span>
<span class="c1">#     width, height = dimensions[&#39;width&#39;], dimensions[&#39;height&#39;]        </span>
    
<span class="c1">#     # print(f&quot;width = {width}, height = {height}&quot;)</span>
<span class="c1">#     # Get positions based on layout</span>
    
<span class="c1">#     # print(f&quot;*** LAYOUT = {layout}***&quot;)</span>
<span class="c1">#     # print(f&quot;*** positions of elements in : {int(elements_in[&#39;nodes&#39;][0][&#39;data&#39;][&#39;id&#39;])}: {elements_in[&#39;nodes&#39;][0]} ***&quot;)</span>
<span class="c1">#     #  print(f&quot;*** is layout in positions_records: </span>
<span class="c1">#     if layout in positions_records.keys():</span>
<span class="c1">#         pos = positions_records[layout]</span>
<span class="c1">#     else:</span>
<span class="c1">#         if layout == &#39;spring&#39;:</span>
<span class="c1">#             pos = nx.spring_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;circular&#39;:</span>
<span class="c1">#             pos = nx.circular_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;kamada_kawai&#39;:</span>
<span class="c1">#             pos = nx.kamada_kawai_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;shell&#39;:        </span>
<span class="c1">#             pos = nx.shell_layout(G)  </span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;grid&#39;:</span>
<span class="c1">#             pos = nx.planar_layout(G)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;sin&#39;:</span>
<span class="c1">#             pos = nfv.sin_layout(G, D)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#         elif layout == &#39;wavy_spiral&#39;:</span>
<span class="c1">#             pos = nfv.wavy_curve_layout(G, D)</span>
<span class="c1">#             positions_records[layout] = pos</span>
<span class="c1">#             # elif layout == &#39;cose&#39;:</span>
<span class="c1">#             #     pos = None</span>
<span class="c1">#         else:</span>
<span class="c1">#             warnings.warn(&quot;Layout not recognized, using &#39;kamada_kawai&#39; instead.&quot;)</span>
<span class="c1">#             pos = nx.kamada_kawai_layout(G)          </span>
        
<span class="c1">#     if pos is not None:</span>
<span class="c1">#         # bounding_box=(0., 0., 1400, 650)</span>
<span class="c1">#         # bounding_box=(0., 0., width, height)</span>
<span class="c1">#         bounding_box=(3., 3., width-3., height-3.)</span>
<span class="c1">#         X_MIN, Y_MIN, X_MAX, Y_MAX = bounding_box</span>
<span class="c1">#         x = [k[0] for k in pos.values()]</span>
<span class="c1">#         y = [k[1] for k in pos.values()]</span>
<span class="c1">#         x_min, x_max, y_min, y_max = min(x), max(x), min(y), max(y)</span>

<span class="c1">#         # print(f&quot;*** set pos ***&quot;)</span>
<span class="c1">#         # pos = {node: {&#39;x&#39;: (position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
<span class="c1">#         #               &#39;y&#39;: (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
<span class="c1">#         #               } for node, position in pos.items()}</span>
<span class="c1">#         pos = {node: np.array([(position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
<span class="c1">#                                (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
<span class="c1">#                               ]) for node, position in pos.items()}</span>
        
<span class="c1">#     if triggered_input == &#39;network-graph&#39;: # tap_node_data:</span>
<span class="c1">#         node_attr = int(tap_node_data[&#39;id&#39;])</span>
<span class="c1">#         node_attr_value = &#39;None&#39;</span>
<span class="c1">#         data_label = &#39;None&#39;</span>
<span class="c1">#         ft_label = &#39;&#39;</span>
<span class="c1">#     elif triggered_input == &#39;node-attribute-dropdown&#39;:</span>
<span class="c1">#         node_attr_value = node_attr</span>
<span class="c1">#         data_label = &#39;None&#39;</span>
<span class="c1">#         ft_label = &#39;&#39;</span>
<span class="c1">#     elif triggered_input == &#39;node-color-button&#39;:</span>
<span class="c1">#         node_attr_value = &#39;None&#39;</span>
<span class="c1">#     else:</span>
<span class="c1">#         node_attr_value = node_attr # node_attr_state # node_attr        </span>
<span class="c1">#     if data_label != &#39;None&#39;:</span>
<span class="c1">#         nc = keeper.data[data_label].subset(features=[ft_label]).loc[ft_label].values</span>

<span class="c1">#     elements = nx_to_cytoscape(G, # node_size, edge_width, </span>
<span class="c1">#                                pos=pos,</span>
<span class="c1">#                                node_color_attr=None if (node_attr==&#39;None&#39; and data_label==&#39;None&#39;) else node_attr if node_attr!=&#39;None&#39; else nc, </span>
<span class="c1">#                                node_cmap=node_cmap,</span>
<span class="c1">#                                edge_color_attr=None if edge_attr==&#39;None&#39; else edge_attr, </span>
<span class="c1">#                                edge_cmap=edge_cmap)</span>

<span class="c1">#     # print(f&quot;*** positions of elements after : {int(elements[&#39;nodes&#39;][0][&#39;data&#39;][&#39;id&#39;])}: {elements[&#39;nodes&#39;][0]} ***&quot;)</span>
<span class="c1">#     if (pos is None) and (layout not in positions_records):</span>
<span class="c1">#         positions_records[layout] = {int(k[&#39;data&#39;][&#39;id&#39;]): np.array([k[&#39;position&#39;][&#39;x&#39;], k[&#39;position&#39;][&#39;y&#39;]]) for k in elements[&#39;nodes&#39;]}</span>
<span class="c1">#         # print(&quot;*** updated position records ***&quot;)</span>
                    
<span class="c1">#     # Highlight node by label                       </span>
<span class="c1">#     if node_label:</span>
<span class="c1">#         for element in elements[&#39;nodes&#39;]:</span>
<span class="c1">#             if element[&#39;data&#39;].get(&#39;name&#39;) == node_label:</span>
<span class="c1">#                 element[&#39;classes&#39;] += &#39; highlight&#39;</span>
<span class="c1">#                 break    </span>
    
<span class="c1">#     # for element in elements:</span>
<span class="c1">#     #     if &#39;node&#39; in element[&#39;classes&#39;]:</span>
<span class="c1">#     #         element[&#39;data&#39;][&#39;size&#39;] = node_size</span>
<span class="c1">#     #     if &#39;edge&#39; in element[&#39;classes&#39;]:</span>
<span class="c1">#     #         element[&#39;data&#39;][&#39;width&#39;] = edge_width</span>

<span class="c1">#     # # Color nodes by attribute</span>
<span class="c1">#     # if node_attr:</span>
<span class="c1">#     #     color_nodes = {node: G.nodes[node][node_attr] for node in G.nodes()}</span>
<span class="c1">#     # else:</span>
<span class="c1">#     #     color_nodes = None</span>
    
    
<span class="c1">#     stylesheet=[        </span>
<span class="c1">#             {</span>
<span class="c1">#                 &#39;selector&#39;: &#39;node&#39;,</span>
<span class="c1">#                 &#39;style&#39;: {</span>
<span class="c1">#                     # &#39;label&#39;: &#39;data(label)&#39;,</span>
<span class="c1">#                     # &#39;label&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#                     # &#39;label&#39;: &#39;&#39;,</span>
<span class="c1">#                     # &#39;content&#39;: &#39;&#39;, # &#39;data(label)&#39;,</span>
<span class="c1">#                     &#39;width&#39;: node_size, # &#39;data(size)&#39;,</span>
<span class="c1">#                     &#39;height&#39;: node_size, # &#39;data(size)&#39;,</span>
<span class="c1">#                     &#39;background-color&#39;: &#39;data(color)&#39;,</span>
<span class="c1">#                     # &#39;background-color&#39;: &#39;style(background-color)&#39;,</span>
<span class="c1">#                     &#39;text-opacity&#39;: &#39;0&#39;,  # Hide labels by default,   </span>
<span class="c1">#                     &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#                     # &#39;z-index&#39;: 1001,</span>
<span class="c1">#                 },</span>
<span class="c1">#                 # &#39;z-index&#39;: 1001,</span>
<span class="c1">#             },</span>
<span class="c1">#             # {</span>
<span class="c1">#             #     &#39;selector&#39;: &#39;node:hover&#39;,</span>
<span class="c1">#             #     &#39;style&#39;: {</span>
<span class="c1">#             #         # &#39;label&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#             #         &#39;content&#39;: &#39;data(name)&#39;,</span>
<span class="c1">#             #         &#39;text-opacity&#39;: &#39;1&#39;,  # Show labels on hover</span>
<span class="c1">#             #         &#39;font-size&#39;: &#39;8px&#39;,</span>
<span class="c1">#             #     }</span>
<span class="c1">#             # },</span>
<span class="c1">#             {</span>
<span class="c1">#                 &#39;selector&#39;: &#39;edge&#39;,</span>
<span class="c1">#                 &#39;style&#39;: {</span>
<span class="c1">#                     &#39;width&#39;: edge_width, # &#39;data(width)&#39;,</span>
<span class="c1">#                     &#39;line-color&#39;: &#39;data(color)&#39;</span>
<span class="c1">#                     # &#39;line-color&#39;: &#39;style(line-color)&#39;</span>
<span class="c1">#                 },</span>
<span class="c1">#                 # &#39;z-index&#39;: 1005,</span>
<span class="c1">#             },</span>
<span class="c1">#             # Class selectors</span>
<span class="c1">#             {</span>
<span class="c1">#                 &#39;selector&#39;: &#39;.highlight&#39;,</span>
<span class="c1">#                 &#39;style&#39;: {</span>
<span class="c1">#                     &#39;border-width&#39;: 20,</span>
<span class="c1">#                     &#39;border-color&#39;: &#39;k&#39;,</span>
<span class="c1">#                     # &#39;outline-width&#39;: 20,</span>
<span class="c1">#                     # &#39;outline-color&#39;: &#39;black&#39;,                   </span>
<span class="c1">#                 },</span>
<span class="c1">#                 # &#39;z-index&#39;: 1100,</span>
<span class="c1">#             },</span>
<span class="c1">#     ]    </span>
            
<span class="c1">#     # layout = {&#39;name&#39;: &#39;preset&#39;},</span>
<span class="c1">#     return elements, stylesheet, node_attr_value, data_label, ft_label, current_zoom, current_pan # , layout</span>

<span class="c1"># # @app.callback(Output(&#39;cytoscape-tapNodeData&#39;, &#39;children&#39;),</span>
<span class="c1"># #               Input(&#39;network-graph&#39;, &#39;tapNodeData&#39;))</span>
<span class="c1"># # def displayTapNodeData(data):</span>
<span class="c1"># #     return json.dumps(data, indent=2) # f&quot;You selected node {data} # {data[&#39;id&#39;]} -- {data[&#39;name&#39;]}&quot; # </span>

<span class="c1"># @app.callback(Output(&#39;cytoscape-mouseoverNodeData&#39;, &#39;children&#39;),</span>
<span class="c1">#               Input(&#39;network-graph&#39;, &#39;mouseoverNodeData&#39;))</span>
<span class="c1"># def displayHoverNodeData(data):</span>
<span class="c1">#     # return json.dumps(data, indent=2) # f&quot;You selected node {data} # {data[&#39;id&#39;]} -- {data[&#39;name&#39;]}&quot; # </span>
<span class="c1">#     if data is None:</span>
<span class="c1">#         return &quot;Hover node data&quot;</span>
<span class="c1">#     return &quot;\n&quot;.join([f&quot;{k}: {data[k] if not k.startswith(&#39;pse&#39;) else np.round(data[k], 3)}&quot; for k in [&#39;name&#39;, </span>
<span class="c1">#                                                                                                        &#39;id&#39;, &#39;is_root&#39;, </span>
<span class="c1">#                                                                                                        &#39;undecided&#39;, </span>
<span class="c1">#                                                                                                        &#39;unidentified&#39;,</span>
<span class="c1">#                                                                                                        &#39;pseudo-distance from root&#39;,</span>
<span class="c1">#                                                                                                       ]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the Dash app</span>
<span class="n">external_stylesheets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://codepen.io/chriddyp/pen/bWLwgP.css&#39;</span><span class="p">]</span>

<span class="c1"># app = JupyterDash(__name__, external_stylesheets=external_stylesheets)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">JupyterDash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">styles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;container&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
        <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;flex-direction&#39;</span><span class="p">:</span> <span class="s1">&#39;row&#39;</span><span class="p">,</span>
        <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;98%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
        <span class="c1"># @ &#39;padding&#39;: </span>
        <span class="s1">&#39;gap&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;margin&#39;: &#39;10px&#39;,</span>
        
    <span class="p">},</span>    
    <span class="c1"># &#39;control-panel-container&#39;: {</span>
    <span class="c1">#     &#39;width&#39;: &#39;20%&#39;, </span>
    <span class="c1">#     &#39;display&#39;: &#39;inline-block&#39;, </span>
    <span class="c1">#     &#39;verticalAlign&#39;: &#39;top&#39;, </span>
    <span class="c1">#     &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
    <span class="c1">#     &#39;border&#39;: &#39;1px solid black&#39;, </span>
    <span class="c1">#     &#39;border-radius&#39;: &#39;20px&#39;, </span>
    <span class="c1">#     &#39;padding&#39;: &#39;5px&#39;,</span>
    <span class="c1">#     &#39;margin&#39;: &#39;3px&#39;,</span>
    <span class="c1">#     # &#39;flex&#39;: &#39;1&#39;, &#39;display&#39;: &#39;flex&#39;, &#39;flexDirection&#39;: &#39;column&#39;,</span>
    <span class="c1">#     # &#39;flex&#39;: &#39;0.2&#39;,</span>
    <span class="c1">#     # &#39;position&#39;: &#39;relative&#39;,</span>
    <span class="c1">#     # &#39;position&#39;: &#39;relative&#39;, &#39;flex&#39;: &#39;1&#39;,</span>
    <span class="c1"># },  </span>
    <span class="s1">&#39;control-panel-container&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;20%&#39;</span><span class="p">,</span> 
        <span class="c1"># &#39;flex&#39;: &#39;0.20&#39;,</span>
        <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline-block&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;verticalAlign&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> 
        <span class="c1"># &#39;overflow-y&#39;: &#39;scroll&#39;, </span>
        <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;1px solid black&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;border-radius&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="s1">&#39;3px&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;flex&#39;: &#39;1&#39;, &#39;display&#39;: &#39;flex&#39;, &#39;flexDirection&#39;: &#39;column&#39;,</span>
        <span class="c1"># &#39;flex&#39;: &#39;0.2&#39;,</span>
        <span class="c1"># &#39;position&#39;: &#39;relative&#39;,</span>
        <span class="c1"># &#39;position&#39;: &#39;relative&#39;, &#39;flex&#39;: &#39;1&#39;,</span>
    <span class="p">},</span>
    <span class="s1">&#39;control-panel&#39;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline-block&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;position&#39;: &#39;absolute&#39;,</span>
        <span class="c1"># &#39;position&#39;: &#39;relative&#39;,</span>
        <span class="s1">&#39;overflow-y&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span> 
        <span class="c1"># &#39;width&#39;: &#39;98%&#39;,</span>
        <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;81%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;paddingRight&#39;</span><span class="p">:</span> <span class="s1">&#39;15px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;paddingLeft&#39;</span><span class="p">:</span> <span class="s1">&#39;8px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;paddingBottom&#39;</span><span class="p">:</span> <span class="s1">&#39;3px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;thin solid lightgrey&#39;</span><span class="p">,</span>
        <span class="s1">&#39;border-radius&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;z-index&#39;</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;cy-container&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;flex&#39;</span><span class="p">:</span> <span class="s1">&#39;0.78&#39;</span><span class="p">,</span>
        <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;relative&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;paddingLeft&#39;: &#39;20px&#39;,</span>
        <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;1px solid black&#39;</span><span class="p">,</span>
        <span class="s1">&#39;border-radius&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;padding&#39;: &#39;10px&#39;,</span>
        <span class="c1"># &#39;display&#39;: &#39;inline-block&#39;, # HERE ADDED</span>
    <span class="p">},</span>
    <span class="s1">&#39;cytoscape&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span>
        <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="c1"># &#39;98%&#39;,</span>
        <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span> <span class="c1"># &#39;83%&#39;, # &#39;100%&#39;,</span>
        <span class="c1"># &#39;padding&#39;: &#39;3px&#39;,</span>
       <span class="c1">#  &#39;margin&#39;: &#39;15px&#39;,</span>
        <span class="s1">&#39;z-index&#39;</span><span class="p">:</span> <span class="mi">999</span>
    <span class="p">},</span>
    <span class="s1">&#39;pre&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;thin lightgrey solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;border-radius&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="s1">&#39;overflowX&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span>
        <span class="s1">&#39;overflowY&#39;</span><span class="p">:</span> <span class="s1">&#39;scroll&#39;</span><span class="p">,</span>
        <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;280px&#39;</span><span class="p">,</span> <span class="c1"># &#39;100%&#39;</span>
        <span class="c1"># &#39;height&#39;: &#39;15%&#39;,</span>
        <span class="c1"># &#39;height&#39;: &#39;20%&#39;,</span>
        <span class="s1">&#39;padding&#39;</span><span class="p">:</span> <span class="s1">&#39;10px&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;align&#39;: &#39;right&#39;,</span>
        <span class="s1">&#39;margin&#39;</span><span class="p">:</span> <span class="s1">&#39;5px&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;position&#39;: &#39;fixed&#39;, # &#39;relative&#39;,</span>
        
    <span class="p">},</span>
    <span class="s1">&#39;pre-container&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;border&#39;</span><span class="p">:</span> <span class="s1">&#39;thin lightgrey solid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;border-radius&#39;</span><span class="p">:</span> <span class="s1">&#39;20px&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;flex&#39;: &#39;0.2&#39;,</span>
        <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;18%&#39;</span><span class="p">,</span>
        <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;relative&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;display&#39;: &#39;inline-block&#39;,</span>
        <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">,</span>
        <span class="s1">&#39;flex-direction&#39;</span><span class="p">:</span> <span class="s1">&#39;row&#39;</span><span class="p">,</span>
        <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>



<span class="c1"># Define the layout of the app</span>
<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">],</span> 
                      <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                          <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s1">&#39;control-panel-container&#39;</span><span class="p">,</span> 
                                   <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;control-panel-container&#39;</span><span class="p">],</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                                       <span class="n">html</span><span class="o">.</span><span class="n">H2</span><span class="p">(</span><span class="s2">&quot;NetFlow POSE&quot;</span><span class="p">),</span>
                                       <span class="n">html</span><span class="o">.</span><span class="n">H3</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">),</span>
                                       <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;container-dimensions&#39;</span><span class="p">),</span> <span class="c1">###</span>
                                           <span class="c1"># html.H2(&quot;NetFlow POSE&quot;),</span>
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Graph Layout&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;layout-dropdown&#39;</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">layout</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">layout</span><span class="p">}</span> <span class="k">for</span> <span class="n">layout</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kamada_kawai&#39;</span><span class="p">,</span> <span class="s1">&#39;spring&#39;</span><span class="p">,</span> 
                                                                                                          <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="c1"># &#39;cose&#39;, </span>
                                                                                                          <span class="s1">&#39;shell&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">,</span> 
                                                                                                          <span class="s1">&#39;breadthfirst&#39;</span><span class="p">,</span> <span class="s1">&#39;sin&#39;</span><span class="p">,</span>
                                                                                                          <span class="s1">&#39;wavy_spiral&#39;</span><span class="p">]],</span>
                                               <span class="n">value</span><span class="o">=</span><span class="s1">&#39;kamada_kawai&#39;</span><span class="p">,</span> <span class="c1"># &#39;cose&#39;, # </span>
                                           <span class="p">),</span>
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Highlight Node by Label&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-label&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
                                           <span class="n">html</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Highlight Node&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;highlight-button&#39;</span><span class="p">,</span> <span class="n">n_clicks</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>                              
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Node Size&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-size-slider&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
                                                      <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;smaller&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">:</span> <span class="s1">&#39;larger&#39;</span><span class="p">}),</span>
                                           <span class="c1"># </span>
                                           <span class="c1"># html.H4(&quot;Set node colors&quot;),</span>
                                           <span class="c1"># dcc.Dropdown(</span>
                                           <span class="c1">#     id=&#39;node-color-type-dropdown&#39;,</span>
                                           <span class="c1">#     options=[{&#39;label&#39;: &#39;Node attribute&#39;, &#39;value&#39;: &#39;node_attribute&#39;}, </span>
                                           <span class="c1">#              {&#39;label&#39;: &#39;Data feature&#39;, &#39;value&#39;: &#39;data_feature&#39;}],</span>
                                           <span class="c1">#     value=0, # &#39;branch&#39;</span>
                                           <span class="c1"># ),   </span>
                                           <span class="c1"># html.Div(id=&#39;additional-controls&#39;, children=[</span>
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Node Attribute for Coloring&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-attribute-dropdown&#39;</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">}]</span> <span class="o">+</span> <span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">}</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                                               <span class="n">value</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="c1"># &#39;branch&#39;</span>
                                           <span class="p">),</span>  
                                           <span class="c1"># ]),</span>
                                           <span class="c1"># OR </span>
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Data Feature for Coloring Nodes&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;keeper-data-dropdown&#39;</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">}]</span> <span class="o">+</span> <span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">label</span><span class="p">}</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                               <span class="n">value</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="c1"># &#39;branch&#39;</span>
                                           <span class="p">),</span>  
                                           <span class="c1"># dcc.Input(id=&#39;feature-label&#39;, type=&#39;text&#39;, value=&#39;&#39;),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;feature-label&#39;</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">[],</span> <span class="c1"># [{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}],</span>
                                               <span class="n">value</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="c1"># &#39;branch&#39;</span>
                                           <span class="p">),</span>  
                                           <span class="n">html</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Color Nodes&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-color-button&#39;</span><span class="p">,</span> <span class="n">n_clicks</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>                              
                              
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Colormap for Nodes&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-colormap-dropdown&#39;</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">cmap</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cmap</span><span class="p">}</span> <span class="k">for</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;cividis&#39;</span><span class="p">,</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="s1">&#39;nipy_spectral&#39;</span><span class="p">,</span> <span class="s1">&#39;gist_ncar&#39;</span><span class="p">]],</span>
                                               <span class="n">value</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span>
                                           <span class="p">),</span>
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Edge Width&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;edge-width-slider&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
                                                      <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;thinner&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">:</span> <span class="s1">&#39;wider&#39;</span><span class="p">}),</span>
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Edge Attribute for Coloring&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;edge-attribute-dropdown&#39;</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> 
                                                         <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">}]</span> <span class="o">+</span> <span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">,</span> 
                                                                               <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">}</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                                               <span class="n">value</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="c1"># &#39;distance&#39;</span>
                                           <span class="p">),</span>                              
                                           <span class="n">html</span><span class="o">.</span><span class="n">H4</span><span class="p">(</span><span class="s2">&quot;Colormap for Edges&quot;</span><span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                                               <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;edge-colormap-dropdown&#39;</span><span class="p">,</span>
                                               <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">cmap</span><span class="p">,</span> 
                                                         <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cmap</span><span class="p">}</span> <span class="k">for</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;cividis&#39;</span><span class="p">,</span> 
                                                                                     <span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="s1">&#39;nipy_spectral&#39;</span><span class="p">,</span> <span class="s1">&#39;gist_ncar&#39;</span><span class="p">]],</span>
                                               <span class="n">value</span><span class="o">=</span><span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> <span class="c1"># &#39;nipy_spectral&#39;,</span>
                                           <span class="p">),</span>
                                           <span class="n">dcc</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_intervals</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Interval to capture dimensions periodically                              </span>
                                       <span class="p">],</span> 
                                           <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;control-panel&#39;</span><span class="p">],</span> <span class="c1"># styles[&#39;control-panel-container&#39;],</span>
                                       <span class="p">),</span>
                                   <span class="p">]),</span>
                          
                          <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s1">&#39;cy-container&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;cy-container&#39;</span><span class="p">],</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span> 
                              <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;top-panel&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;pre-container&#39;</span><span class="p">],</span> <span class="n">children</span><span class="o">=</span><span class="p">[</span>
                                  <span class="n">html</span><span class="o">.</span><span class="n">Pre</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;cytoscape-mouseoverNodeData&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;pre&#39;</span><span class="p">]),</span> 
                                  <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-colorbars-div&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span> 
                                                                           <span class="c1"># &#39;overflow&#39;: &#39;auto&#39;, </span>
                                                                           <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">,</span> <span class="c1"># &#39;width&#39;: &#39;30px&#39;,</span>
                                                                          <span class="p">},</span>
                                           <span class="n">children</span><span class="o">=</span><span class="p">[],</span> <span class="c1"># [html.H3(&quot;TESTING HERE&quot;)], # HERE</span>
                                          <span class="p">),</span>
                                  <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;edge-colorbars-div&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">},</span>
                                           <span class="n">children</span><span class="o">=</span><span class="p">[],</span> <span class="c1"># [html.H3(&quot;TESTING HERE&quot;)], # HERE</span>
                                          <span class="p">),</span>
                              <span class="p">],</span>
                                      <span class="p">),</span>                                       
                              <span class="n">cyto</span><span class="o">.</span><span class="n">Cytoscape</span><span class="p">(</span>
                                  <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span>
                                  <span class="n">elements</span><span class="o">=</span><span class="n">nx_to_cytoscape</span><span class="p">(</span><span class="n">G</span><span class="p">),</span> <span class="c1"># , 30, 1),        </span>
                                  <span class="c1"># style={&#39;width&#39;: &#39;80%&#39;, &#39;height&#39;: &#39;800px&#39;},</span>
                                  <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;cytoscape&#39;</span><span class="p">],</span>
                                  <span class="c1"># layout={&#39;name&#39;: &#39;kamada_kawai&#39;}, # &#39;cose&#39;},</span>
                                  <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;preset&#39;</span><span class="p">,</span> <span class="s2">&quot;fit&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
                                  <span class="c1"># layout={&#39;name&#39;: &#39;cose&#39;},</span>
                                  <span class="n">zoom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Initial zoom level</span>
                                  <span class="n">pan</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>  <span class="c1"># Initial pan position</span>
                                  <span class="n">stylesheet</span><span class="o">=</span><span class="p">[</span>
                                      <span class="p">{</span>
                                          <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="p">{</span>
                                              <span class="c1"># &#39;label&#39;: &#39;&#39;, # &#39;data(name)&#39;,</span>
                                              <span class="c1"># &#39;content&#39;: &#39;&#39;,</span>
                                              <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;8px&#39;</span><span class="p">,</span>
                                              <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="c1"># &#39;data(size)&#39;,</span>
                                              <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="c1"># &#39;data(size)&#39;,</span>
                                              <span class="s1">&#39;background-color&#39;</span><span class="p">:</span> <span class="s1">&#39;#888&#39;</span><span class="p">,</span> <span class="c1"># &#39;tan&#39;, # &#39;data(color)&#39;,                    </span>
                                              <span class="c1"># &#39;background-color&#39;: &#39;style(background-color)&#39;,</span>
                                              <span class="s1">&#39;text-opacity&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># Hide labels by default,                    </span>
                                          <span class="p">},</span>
                                          <span class="c1"># &#39;z-index&#39;: 1001,</span>
                                      <span class="p">},</span>
                                      <span class="c1"># {</span>
                                      <span class="c1">#     &#39;selector&#39;: &#39;node:hover&#39;,                                          </span>
                                      <span class="c1">#     &#39;style&#39;: {</span>
                                      <span class="c1">#         # &#39;label&#39;: &#39;data(name)&#39;,</span>
                                      <span class="c1">#         &#39;content&#39;: &#39;data(name)&#39;,</span>
                                      <span class="c1">#         &#39;font-size&#39;: &#39;8px&#39;,</span>
                                      <span class="c1">#         &#39;text-opacity&#39;: 1.,  # Show labels on hover</span>
                                      <span class="c1">#     },</span>
                                      <span class="c1">#     # &#39;z-index&#39;: 1005,</span>
                                      <span class="c1"># },</span>
                                      <span class="p">{</span>
                                          <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="p">{</span>
                                              <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># &#39;data(width)&#39;,</span>
                                              <span class="s1">&#39;line-color&#39;</span><span class="p">:</span> <span class="s1">&#39;#222&#39;</span><span class="p">,</span> <span class="c1"># &#39;darkgray&#39;, # &#39;data(color)&#39;</span>
                                              <span class="c1"># &#39;line-color&#39;: &#39;style(line-color)&#39;</span>
                                          <span class="p">}</span>
                                      <span class="p">},</span>
                                      <span class="c1"># Class selectors</span>
                                      <span class="p">{</span>
                                          <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;.highlight&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="p">{</span>
                                              <span class="s1">&#39;border-width&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                                              <span class="s1">&#39;border-color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                              <span class="c1"># &#39;outline-width&#39;: 20,</span>
                                              <span class="c1"># &#39;outline-color&#39;: &#39;black&#39;,                    </span>
                                          <span class="p">},</span>
                                          <span class="c1"># &#39;z-index&#39;: 1100,</span>
                                      <span class="p">},</span>
                                  <span class="p">],</span>       
                                  <span class="c1"># responsive=True,</span>
                              <span class="p">),</span>
                          <span class="p">]),</span>
                          
                      <span class="p">])</span>



<span class="n">app</span><span class="o">.</span><span class="n">clientside_callback</span><span class="p">(</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    function(n_intervals) {</span>
<span class="sd">        const container = document.getElementById(&#39;network-graph&#39;);</span>
<span class="sd">        const dimensions = {width: container.offsetWidth, height: container.offsetHeight};</span>
<span class="sd">        return dimensions;</span>
<span class="sd">    }</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;container-dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="s1">&#39;n_intervals&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># @app.callback(</span>
<span class="c1">#     Output(&#39;additional-controls&#39;, &#39;children&#39;),</span>
<span class="c1">#     Input(&#39;node-color-type-dropdown&#39;, &#39;value&#39;),</span>
<span class="c1"># )</span>
<span class="c1"># def display_node_color_options(attribute_source):</span>
<span class="c1">#     if attribute_source == &#39;node_attribute&#39;:</span>
<span class="c1">#         return html.Div([html.H4(&quot;Node Attribute for Coloring&quot;),</span>
<span class="c1">#                          dcc.Dropdown(</span>
<span class="c1">#                              id=&#39;node-attribute-dropdown&#39;,</span>
<span class="c1">#                              options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: attr, &#39;value&#39;: attr} for attr in G.nodes(data=True)[0].keys()],</span>
<span class="c1">#                              value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1">#                          ), </span>
<span class="c1">#                         ])</span>
<span class="c1">#     else:</span>
<span class="c1">#         return html.Div([html.H4(&quot;Data Feature for Coloring Nodes&quot;),</span>
<span class="c1">#                          dcc.Dropdown(</span>
<span class="c1">#                              id=&#39;keeper-data-dropdown&#39;,</span>
<span class="c1">#                              options=[{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}] + [{&#39;label&#39;: dataset.label, &#39;value&#39;: dataset.label} for dataset in keeper.data],</span>
<span class="c1">#                              value=&#39;None&#39;, # &#39;branch&#39;</span>
<span class="c1">#                          ),  </span>
<span class="c1">#                          dcc.Input(id=&#39;feature-label&#39;, type=&#39;text&#39;, value=&#39;&#39;),</span>
<span class="c1">#                          html.Button(&#39;Color Nodes&#39;, id=&#39;node-color-button&#39;, n_clicks=0), </span>
<span class="c1">#                         ])</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;feature-label&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;keeper-data-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">set_feature_options</span><span class="p">(</span><span class="n">data_label</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data_label</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># [{&#39;label&#39;: &#39;None&#39;, &#39;value&#39;: &#39;None&#39;}]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">ft</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">ft</span><span class="p">}</span> <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span><span class="o">.</span><span class="n">feature_labels</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">options</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;stylesheet&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;node-attribute-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;keeper-data-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;feature-label&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;zoom&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;pan&#39;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;node-colorbars-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>    
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;edge-colorbars-div&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="c1"># Output(&#39;network-graph&#39;, &#39;layout&#39;),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;layout-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="c1">###</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;highlight-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span> <span class="c1"># </span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;node-label&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="c1"># </span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;node-size-slider&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="c1"># </span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;edge-width-slider&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="c1"># </span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;node-attribute-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="c1">###</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;edge-attribute-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="c1">###</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;node-colormap-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="c1">###</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;edge-colormap-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;tapNodeData&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;container-dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;zoom&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;pan&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;node-color-button&#39;</span><span class="p">,</span> <span class="s1">&#39;n_clicks&#39;</span><span class="p">),</span>    
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;keeper-data-dropdown&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">State</span><span class="p">(</span><span class="s1">&#39;feature-label&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>

    <span class="c1"># prevent_initial_call=True ###</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">n_clicks</span><span class="p">,</span> <span class="n">node_label</span><span class="p">,</span>                  
                 <span class="n">node_size</span><span class="p">,</span> 
                 <span class="n">edge_width</span><span class="p">,</span> 
                 <span class="n">node_attr</span><span class="p">,</span> <span class="n">edge_attr</span><span class="p">,</span> <span class="n">node_cmap</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="p">,</span> 
                 <span class="n">tap_node_data</span><span class="p">,</span>
                 <span class="n">elements_in</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span>
                 <span class="n">current_zoom</span><span class="p">,</span> <span class="n">current_pan</span><span class="p">,</span> <span class="n">feature_n_clicks</span><span class="p">,</span> <span class="n">data_label</span><span class="p">,</span> <span class="n">ft_label</span><span class="p">):</span>                          
    
    <span class="c1"># Determine which input triggered the callback</span>
    <span class="n">triggered_input</span> <span class="o">=</span> <span class="n">callback_context</span><span class="o">.</span><span class="n">triggered</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;prop_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dimensions</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">dash_exceptions</span><span class="o">.</span><span class="n">PreventUpdate</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">dimensions</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>        
    
    <span class="c1"># print(f&quot;width = {width}, height = {height}&quot;)</span>
    <span class="c1"># Get positions based on layout</span>
    
    <span class="c1"># print(f&quot;*** LAYOUT = {layout}***&quot;)</span>
    <span class="c1"># print(f&quot;*** positions of elements in : {int(elements_in[&#39;nodes&#39;][0][&#39;data&#39;][&#39;id&#39;])}: {elements_in[&#39;nodes&#39;][0]} ***&quot;)</span>
    <span class="c1">#  print(f&quot;*** is layout in positions_records: </span>
    <span class="k">if</span> <span class="n">layout</span> <span class="ow">in</span> <span class="n">positions_records</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span>                          
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;spring&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">elif</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;circular&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">elif</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;kamada_kawai&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">elif</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;shell&#39;</span><span class="p">:</span>        
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shell_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>  
            <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">elif</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">planar_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">elif</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;sin&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">sin_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
            <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">elif</span> <span class="n">layout</span> <span class="o">==</span> <span class="s1">&#39;wavy_spiral&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nfv</span><span class="o">.</span><span class="n">wavy_curve_layout</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
            <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="c1"># elif layout == &#39;cose&#39;:</span>
            <span class="c1">#     pos = None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Layout not recognized, using &#39;kamada_kawai&#39; instead.&quot;</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">kamada_kawai_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>          
        
    <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># bounding_box=(0., 0., 1400, 650)</span>
        <span class="c1"># bounding_box=(0., 0., width, height)</span>
        <span class="n">bounding_box</span><span class="o">=</span><span class="p">(</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">width</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="n">height</span><span class="o">-</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">X_MIN</span><span class="p">,</span> <span class="n">Y_MIN</span><span class="p">,</span> <span class="n">X_MAX</span><span class="p">,</span> <span class="n">Y_MAX</span> <span class="o">=</span> <span class="n">bounding_box</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># print(f&quot;*** set pos ***&quot;)</span>
        <span class="c1"># pos = {node: {&#39;x&#39;: (position[0] - x_min) / (x_max - x_min) * (X_MAX - X_MIN) + X_MIN,</span>
        <span class="c1">#               &#39;y&#39;: (position[1] - y_min) / (y_max - y_min) * (Y_MAX - Y_MIN) + Y_MIN,</span>
        <span class="c1">#               } for node, position in pos.items()}</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">X_MAX</span> <span class="o">-</span> <span class="n">X_MIN</span><span class="p">)</span> <span class="o">+</span> <span class="n">X_MIN</span><span class="p">,</span>
                               <span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Y_MAX</span> <span class="o">-</span> <span class="n">Y_MIN</span><span class="p">)</span> <span class="o">+</span> <span class="n">Y_MIN</span><span class="p">,</span>
                              <span class="p">])</span> <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="n">pos</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        
    <span class="k">if</span> <span class="n">triggered_input</span> <span class="o">==</span> <span class="s1">&#39;network-graph&#39;</span><span class="p">:</span> <span class="c1"># tap_node_data:</span>
        <span class="n">node_attr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tap_node_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">node_attr_value</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
        <span class="n">data_label</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
        <span class="n">ft_label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">triggered_input</span> <span class="o">==</span> <span class="s1">&#39;node-attribute-dropdown&#39;</span><span class="p">:</span>
        <span class="n">node_attr_value</span> <span class="o">=</span> <span class="n">node_attr</span>
        <span class="n">data_label</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
        <span class="n">ft_label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">triggered_input</span> <span class="o">==</span> <span class="s1">&#39;node-color-button&#39;</span><span class="p">:</span>
        <span class="n">node_attr_value</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_attr_value</span> <span class="o">=</span> <span class="n">node_attr</span> <span class="c1"># node_attr_state # node_attr        </span>
    <span class="k">if</span> <span class="n">data_label</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">data_label</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">ft_label</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ft_label</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>                          

    <span class="n">elements</span><span class="p">,</span> <span class="n">node_cbar_vis</span><span class="p">,</span> <span class="n">edge_cbar_vis</span> <span class="o">=</span> <span class="n">nx_to_cytoscape</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="c1"># node_size, edge_width, </span>
                                                             <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
                                                             <span class="n">node_color_attr</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">node_attr</span><span class="o">==</span><span class="s1">&#39;None&#39;</span> <span class="ow">and</span> <span class="n">data_label</span><span class="o">==</span><span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">node_attr</span> <span class="k">if</span> <span class="n">node_attr</span><span class="o">!=</span><span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="n">nc</span><span class="p">,</span> 
                                                             <span class="n">node_cmap</span><span class="o">=</span><span class="n">node_cmap</span><span class="p">,</span>
                                                             <span class="n">edge_color_attr</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">edge_attr</span><span class="o">==</span><span class="s1">&#39;None&#39;</span> <span class="k">else</span> <span class="n">edge_attr</span><span class="p">,</span> 
                                                             <span class="n">edge_cmap</span><span class="o">=</span><span class="n">edge_cmap</span><span class="p">,</span> <span class="n">return_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    
    <span class="k">if</span> <span class="n">node_cbar_vis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">node_cbar_vis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node_cbar_vis</span> <span class="o">=</span> <span class="p">[</span><span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">node_cbar_vis</span><span class="p">,</span>
                                   <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>  <span class="c1"># Hides the Plotly mode bar</span>
                                   <span class="c1"># id=&#39;node_colorbar_fig&#39;,  </span>
                                  <span class="p">),</span>            
                        <span class="p">]</span>
    <span class="k">if</span> <span class="n">edge_cbar_vis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">edge_cbar_vis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edge_cbar_vis</span> <span class="o">=</span> <span class="p">[</span><span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">edge_cbar_vis</span><span class="p">,</span>
                                   <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>  
                                  <span class="p">),</span>            
                        <span class="p">]</span>
    
    <span class="c1"># print(f&quot;and now: node_cbar_vis = None: {node_cbar_vis is None} -- {node_cbar_vis}&quot;)</span>
    
    <span class="c1"># print(f&quot;*** positions of elements after : {int(elements[&#39;nodes&#39;][0][&#39;data&#39;][&#39;id&#39;])}: {elements[&#39;nodes&#39;][0]} ***&quot;)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">layout</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">positions_records</span><span class="p">):</span>
        <span class="n">positions_records</span><span class="p">[</span><span class="n">layout</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]):</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]}</span>
        <span class="c1"># print(&quot;*** updated position records ***&quot;)</span>
                    
    <span class="c1"># Highlight node by label                       </span>
    <span class="k">if</span> <span class="n">node_label</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">node_label</span><span class="p">:</span>
                <span class="n">element</span><span class="p">[</span><span class="s1">&#39;classes&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39; highlight&#39;</span>
                <span class="k">break</span>    
    
    <span class="c1"># for element in elements:</span>
    <span class="c1">#     if &#39;node&#39; in element[&#39;classes&#39;]:</span>
    <span class="c1">#         element[&#39;data&#39;][&#39;size&#39;] = node_size</span>
    <span class="c1">#     if &#39;edge&#39; in element[&#39;classes&#39;]:</span>
    <span class="c1">#         element[&#39;data&#39;][&#39;width&#39;] = edge_width</span>

    <span class="c1"># # Color nodes by attribute</span>
    <span class="c1"># if node_attr:</span>
    <span class="c1">#     color_nodes = {node: G.nodes[node][node_attr] for node in G.nodes()}</span>
    <span class="c1"># else:</span>
    <span class="c1">#     color_nodes = None</span>
    
    
    <span class="n">stylesheet</span><span class="o">=</span><span class="p">[</span>        
            <span class="p">{</span>
                <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span>
                <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="c1"># &#39;label&#39;: &#39;data(label)&#39;,</span>
                    <span class="c1"># &#39;label&#39;: &#39;data(name)&#39;,</span>
                    <span class="c1"># &#39;label&#39;: &#39;&#39;,</span>
                    <span class="c1"># &#39;content&#39;: &#39;&#39;, # &#39;data(label)&#39;,</span>
                    <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">node_size</span><span class="p">,</span> <span class="c1"># &#39;data(size)&#39;,</span>
                    <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">node_size</span><span class="p">,</span> <span class="c1"># &#39;data(size)&#39;,</span>
                    <span class="s1">&#39;background-color&#39;</span><span class="p">:</span> <span class="s1">&#39;data(color)&#39;</span><span class="p">,</span>
                    <span class="c1"># &#39;background-color&#39;: &#39;style(background-color)&#39;,</span>
                    <span class="s1">&#39;text-opacity&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>  <span class="c1"># Hide labels by default,   </span>
                    <span class="s1">&#39;font-size&#39;</span><span class="p">:</span> <span class="s1">&#39;8px&#39;</span><span class="p">,</span>
                    <span class="c1"># &#39;z-index&#39;: 1001,</span>
                <span class="p">},</span>
                <span class="c1"># &#39;z-index&#39;: 1001,</span>
            <span class="p">},</span>
            <span class="c1"># {</span>
            <span class="c1">#     &#39;selector&#39;: &#39;node:hover&#39;,</span>
            <span class="c1">#     &#39;style&#39;: {</span>
            <span class="c1">#         # &#39;label&#39;: &#39;data(name)&#39;,</span>
            <span class="c1">#         &#39;content&#39;: &#39;data(name)&#39;,</span>
            <span class="c1">#         &#39;text-opacity&#39;: &#39;1&#39;,  # Show labels on hover</span>
            <span class="c1">#         &#39;font-size&#39;: &#39;8px&#39;,</span>
            <span class="c1">#     }</span>
            <span class="c1"># },</span>
            <span class="p">{</span>
                <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span>
                <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">edge_width</span><span class="p">,</span> <span class="c1"># &#39;data(width)&#39;,</span>
                    <span class="s1">&#39;line-color&#39;</span><span class="p">:</span> <span class="s1">&#39;data(color)&#39;</span>
                    <span class="c1"># &#39;line-color&#39;: &#39;style(line-color)&#39;</span>
                <span class="p">},</span>
                <span class="c1"># &#39;z-index&#39;: 1005,</span>
            <span class="p">},</span>
            <span class="c1"># Class selectors</span>
            <span class="p">{</span>
                <span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;.highlight&#39;</span><span class="p">,</span>
                <span class="s1">&#39;style&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;border-width&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                    <span class="s1">&#39;border-color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="c1"># &#39;outline-width&#39;: 20,</span>
                    <span class="c1"># &#39;outline-color&#39;: &#39;black&#39;,                   </span>
                <span class="p">},</span>
                <span class="c1"># &#39;z-index&#39;: 1100,</span>
            <span class="p">},</span>
    <span class="p">]</span>    
            
    <span class="c1"># layout = {&#39;name&#39;: &#39;preset&#39;},</span>
    <span class="k">return</span> <span class="n">elements</span><span class="p">,</span> <span class="n">stylesheet</span><span class="p">,</span> <span class="n">node_attr_value</span><span class="p">,</span> <span class="n">data_label</span><span class="p">,</span> <span class="n">ft_label</span><span class="p">,</span> <span class="n">current_zoom</span><span class="p">,</span> <span class="n">current_pan</span><span class="p">,</span> <span class="n">node_cbar_vis</span><span class="p">,</span> <span class="n">edge_cbar_vis</span> <span class="c1"># , layout</span>

<span class="c1"># @app.callback(Output(&#39;cytoscape-tapNodeData&#39;, &#39;children&#39;),</span>
<span class="c1">#               Input(&#39;network-graph&#39;, &#39;tapNodeData&#39;))</span>
<span class="c1"># def displayTapNodeData(data):</span>
<span class="c1">#     return json.dumps(data, indent=2) # f&quot;You selected node {data} # {data[&#39;id&#39;]} -- {data[&#39;name&#39;]}&quot; # </span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">Output</span><span class="p">(</span><span class="s1">&#39;cytoscape-mouseoverNodeData&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
              <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;network-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;mouseoverNodeData&#39;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">displayHoverNodeData</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># return json.dumps(data, indent=2) # f&quot;You selected node {data} # {data[&#39;id&#39;]} -- {data[&#39;name&#39;]}&quot; # </span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Hover node data&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;pse&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> 
                                                                                                       <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;is_root&#39;</span><span class="p">,</span> 
                                                                                                       <span class="s1">&#39;undecided&#39;</span><span class="p">,</span> 
                                                                                                       <span class="s1">&#39;unidentified&#39;</span><span class="p">,</span>
                                                                                                       <span class="s1">&#39;pseudo-distance from root&#39;</span><span class="p">,</span>
                                                                                                      <span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">external_stylesheets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://codepen.io/chriddyp/pen/bWLwgP.css&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># app = JupyterDash(__name__, external_stylesheets=external_stylesheets)</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">app</span> <span class="o">=</span> <span class="n">JupyterDash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">styles</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="s1">&#39;container&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="s1">&#39;position&#39;</span><span class="p">:</span> <span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span>     <span class="p">},</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span> <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">108</span> <span class="c1"># Define the layout of the app</span>

<span class="ne">NameError</span>: name &#39;JupyterDash&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;TCGA-A2-A0YG-01&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">,:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dtype(&#39;int64&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># b = keeper.data[&#39;rna&#39;].data[3,:].dtype</span>
<span class="n">b</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flo</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># all(isinstance(v, (int, float)) for v in values)</span>
<span class="c1"># is_numeric = lambda x: all(isinstance(v, (int, float)) for v in keeper.data[&#39;rna&#39;].data[x, :])</span>
<span class="n">is_numeric</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">ft</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">ft</span><span class="p">}</span> <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feature_labels</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_numeric</span><span class="p">(</span><span class="n">ix</span><span class="p">)])]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># is_numeric = lambda x: pd.to_numeric(keeper.data[&#39;rna&#39;].subset(features=[x]).loc[x], errors=&#39;coerce&#39;).notna().all() # new add          </span>
<span class="n">is_numeric</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">options</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">ft</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">ft</span><span class="p">}</span> <span class="k">for</span> <span class="n">ft</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keeper</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rna&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">feature_labels</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_numeric</span><span class="p">(</span><span class="n">ft</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pd.to_numeric(df[&#39;column&#39;], errors=&#39;coerce&#39;).notnull().all()</span>
<span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">/var/folders/lg/f99dqckx2slg0trjr85zmr8w0000gq/T/ipykernel_57416/3835847318.py</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="c1"># pd.to_numeric(df[&#39;column&#39;], errors=&#39;coerce&#39;).notnull().all()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">())</span>

<span class="nn">~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/pandas/core/frame.py</span> in <span class="ni">?</span><span class="nt">(self, func, axis, raw, result_type, args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">8829</span>             <span class="n">result_type</span><span class="o">=</span><span class="n">result_type</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">8830</span>             <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">8831</span>             <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">8832</span>         <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">8833</span>         <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span><span class="o">.</span><span class="n">__finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;apply&quot;</span><span class="p">)</span>

<span class="nn">~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/pandas/core/apply.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">723</span>         <span class="c1"># raw</span>
<span class="g g-Whitespace">    </span><span class="mi">724</span>         <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">725</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_raw</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">726</span> 
<span class="ne">--&gt; </span><span class="mi">727</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_standard</span><span class="p">()</span>

<span class="nn">~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/pandas/core/apply.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">850</span>     <span class="k">def</span> <span class="nf">apply_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">851</span>         <span class="n">results</span><span class="p">,</span> <span class="n">res_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_series_generator</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">852</span> 
<span class="g g-Whitespace">    </span><span class="mi">853</span>         <span class="c1"># wrap results</span>
<span class="g g-Whitespace">    </span><span class="mi">854</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrap_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">res_index</span><span class="p">)</span>

<span class="nn">~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/pandas/core/apply.py</span> in <span class="ni">?</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">867</span>                 <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ABCSeries</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>                     <span class="c1"># If we have a view on v, we need to make a copy because</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>                     <span class="c1">#  series_generator will swap out the underlying data</span>
<span class="ne">--&gt; </span><span class="mi">871</span>                     <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span> 
<span class="g g-Whitespace">    </span><span class="mi">873</span>         <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">res_index</span>

<span class="nn">/var/folders/lg/f99dqckx2slg0trjr85zmr8w0000gq/T/ipykernel_57416/3835847318.py</span> in <span class="ni">?</span><span class="nt">(x)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">())</span>

<span class="nn">~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(self, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">5579</span>             <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessors</span>
<span class="g g-Whitespace">   </span><span class="mi">5580</span>             <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_axis</span><span class="o">.</span><span class="n">_can_hold_identifiers_and_holds_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5581</span>         <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">5582</span>             <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="ne">-&gt; </span><span class="mi">5583</span>         <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="ne">AttributeError</span>: &#39;Series&#39; object has no attribute &#39;isnumeric&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">poser</span><span class="o">.</span><span class="n">root</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;TCGA-OL-A5RW-01&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colorbar_fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">height</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">fix</span> <span class="n">colorbar</span> <span class="o">-</span> <span class="n">maybe</span> <span class="n">the</span> height<span class="o">?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># a = keeper.data[&#39;rna&#39;].subset(features=[&#39;TP53&#39;]) #.loc[&#39;TP53&#39;]</span>
<span class="c1"># a</span>
<span class="n">a</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;TCGA-E9-A295-01&#39;, &#39;TCGA-AR-A1AS-01&#39;, &#39;TCGA-AQ-A1H2-01&#39;,
       &#39;TCGA-A8-A08O-01&#39;, &#39;TCGA-BH-A1FJ-01&#39;, &#39;TCGA-JL-A3YX-01&#39;,
       &#39;TCGA-A7-A425-01&#39;, &#39;TCGA-AC-A2BM-01&#39;, &#39;TCGA-LL-A6FP-01&#39;,
       &#39;TCGA-A7-A26E-01&#39;,
       ...
       &#39;TCGA-A2-A1G0-01&#39;, &#39;TCGA-WT-AB41-01&#39;, &#39;TCGA-EW-A1P6-01&#39;,
       &#39;TCGA-XX-A89A-01&#39;, &#39;TCGA-A7-A4SD-01&#39;, &#39;TCGA-AC-A6IX-01&#39;,
       &#39;TCGA-AR-A24L-01&#39;, &#39;TCGA-BH-A42U-01&#39;, &#39;TCGA-AR-A24S-01&#39;,
       &#39;TCGA-BH-A0BC-01&#39;],
      dtype=&#39;object&#39;, length=606)
</pre></div>
</div>
</div>
</div>
<p>colorbars from : https://stackoverflow.com/questions/76963287/plotly-create-standalone-colorbar</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gene_sig</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;CD86&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;jupyterlab&#39;</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">8090</span><span class="p">,</span> <span class="n">dev_tools_ui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
              <span class="n">dev_tools_hot_reload</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="100%"
            height="650"
            src="http://127.0.0.1:8090/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">COLORMAP_OPTIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="s1">&#39;plasma&#39;</span><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;cividis&#39;</span><span class="p">,</span> <span class="s1">&#39;twilight&#39;</span><span class="p">,</span> <span class="s1">&#39;turbo&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="s1">&#39;BrBG&#39;</span><span class="p">,</span> <span class="s1">&#39;BuGn&#39;</span><span class="p">,</span> <span class="s1">&#39;BuPu&#39;</span><span class="p">,</span> <span class="s1">&#39;GnBu&#39;</span><span class="p">,</span> <span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="s1">&#39;Greys&#39;</span><span class="p">,</span> <span class="s1">&#39;OrRd&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Oranges&#39;</span><span class="p">,</span> <span class="s1">&#39;PRGn&#39;</span><span class="p">,</span> <span class="s1">&#39;PiYG&#39;</span><span class="p">,</span> <span class="s1">&#39;PuBu&#39;</span><span class="p">,</span> <span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> <span class="s1">&#39;PuOr&#39;</span><span class="p">,</span> <span class="s1">&#39;PuRd&#39;</span><span class="p">,</span> <span class="s1">&#39;Purples&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="s1">&#39;RdGy&#39;</span><span class="p">,</span> <span class="s1">&#39;RdPu&#39;</span><span class="p">,</span> <span class="s1">&#39;RdYlBu&#39;</span><span class="p">,</span> <span class="s1">&#39;RdYlGn&#39;</span><span class="p">,</span> <span class="s1">&#39;Reds&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectral&#39;</span><span class="p">,</span> <span class="s1">&#39;YlGn&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span> <span class="s1">&#39;YlOrBr&#39;</span><span class="p">,</span> <span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="s1">&#39;hsv&#39;</span><span class="p">,</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="s1">&#39;icefire&#39;</span><span class="p">]</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">[[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">COLORMAP_OPTIONS</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;magma&#39;,
 &#39;magma_r&#39;,
 &#39;inferno&#39;,
 &#39;inferno_r&#39;,
 &#39;plasma&#39;,
 &#39;plasma_r&#39;,
 &#39;viridis&#39;,
 &#39;viridis_r&#39;,
 &#39;cividis&#39;,
 &#39;cividis_r&#39;,
 &#39;twilight&#39;,
 &#39;twilight_r&#39;,
 &#39;turbo&#39;,
 &#39;turbo_r&#39;,
 &#39;Blues&#39;,
 &#39;Blues_r&#39;,
 &#39;BrBG&#39;,
 &#39;BrBG_r&#39;,
 &#39;BuGn&#39;,
 &#39;BuGn_r&#39;,
 &#39;BuPu&#39;,
 &#39;BuPu_r&#39;,
 &#39;GnBu&#39;,
 &#39;GnBu_r&#39;,
 &#39;Greens&#39;,
 &#39;Greens_r&#39;,
 &#39;Greys&#39;,
 &#39;Greys_r&#39;,
 &#39;OrRd&#39;,
 &#39;OrRd_r&#39;,
 &#39;Oranges&#39;,
 &#39;Oranges_r&#39;,
 &#39;PRGn&#39;,
 &#39;PRGn_r&#39;,
 &#39;PiYG&#39;,
 &#39;PiYG_r&#39;,
 &#39;PuBu&#39;,
 &#39;PuBu_r&#39;,
 &#39;PuBuGn&#39;,
 &#39;PuBuGn_r&#39;,
 &#39;PuOr&#39;,
 &#39;PuOr_r&#39;,
 &#39;PuRd&#39;,
 &#39;PuRd_r&#39;,
 &#39;Purples&#39;,
 &#39;Purples_r&#39;,
 &#39;RdBu&#39;,
 &#39;RdBu_r&#39;,
 &#39;RdGy&#39;,
 &#39;RdGy_r&#39;,
 &#39;RdPu&#39;,
 &#39;RdPu_r&#39;,
 &#39;RdYlBu&#39;,
 &#39;RdYlBu_r&#39;,
 &#39;RdYlGn&#39;,
 &#39;RdYlGn_r&#39;,
 &#39;Reds&#39;,
 &#39;Reds_r&#39;,
 &#39;Spectral&#39;,
 &#39;Spectral_r&#39;,
 &#39;YlGn&#39;,
 &#39;YlGn_r&#39;,
 &#39;YlGnBu&#39;,
 &#39;YlGnBu_r&#39;,
 &#39;YlOrBr&#39;,
 &#39;YlOrBr_r&#39;,
 &#39;YlOrRd&#39;,
 &#39;YlOrRd_r&#39;,
 &#39;gray&#39;,
 &#39;gray_r&#39;,
 &#39;hot&#39;,
 &#39;hot_r&#39;,
 &#39;hsv&#39;,
 &#39;hsv_r&#39;,
 &#39;jet&#39;,
 &#39;jet_r&#39;,
 &#39;rainbow&#39;,
 &#39;rainbow_r&#39;,
 &#39;icefire&#39;,
 &#39;icefire_r&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mpl_cm</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;aggrnyl&#39;</span><span class="p">,</span> <span class="s1">&#39;agsunset&#39;</span><span class="p">,</span> <span class="s1">&#39;algae&#39;</span><span class="p">,</span> <span class="s1">&#39;amp&#39;</span><span class="p">,</span> <span class="s1">&#39;armyrose&#39;</span><span class="p">,</span> <span class="s1">&#39;balance&#39;</span><span class="p">,</span>
             <span class="s1">&#39;blackbody&#39;</span><span class="p">,</span> <span class="s1">&#39;bluered&#39;</span><span class="p">,</span> <span class="s1">&#39;blues&#39;</span><span class="p">,</span> <span class="s1">&#39;blugrn&#39;</span><span class="p">,</span> <span class="s1">&#39;bluyl&#39;</span><span class="p">,</span> <span class="s1">&#39;brbg&#39;</span><span class="p">,</span>
             <span class="s1">&#39;brwnyl&#39;</span><span class="p">,</span> <span class="s1">&#39;bugn&#39;</span><span class="p">,</span> <span class="s1">&#39;bupu&#39;</span><span class="p">,</span> <span class="s1">&#39;burg&#39;</span><span class="p">,</span> <span class="s1">&#39;burgyl&#39;</span><span class="p">,</span> <span class="s1">&#39;cividis&#39;</span><span class="p">,</span> <span class="s1">&#39;curl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;darkmint&#39;</span><span class="p">,</span> <span class="s1">&#39;deep&#39;</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;dense&#39;</span><span class="p">,</span> <span class="s1">&#39;earth&#39;</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;electric&#39;</span><span class="p">,</span>
             <span class="s1">&#39;emrld&#39;</span><span class="p">,</span> <span class="s1">&#39;fall&#39;</span><span class="p">,</span> <span class="s1">&#39;geyser&#39;</span><span class="p">,</span> <span class="s1">&#39;gnbu&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;greens&#39;</span><span class="p">,</span> <span class="s1">&#39;greys&#39;</span><span class="p">,</span>
             <span class="s1">&#39;haline&#39;</span><span class="p">,</span> <span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="s1">&#39;hsv&#39;</span><span class="p">,</span> <span class="s1">&#39;ice&#39;</span><span class="p">,</span> <span class="s1">&#39;icefire&#39;</span><span class="p">,</span> <span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="s1">&#39;jet&#39;</span><span class="p">,</span>
             <span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="s1">&#39;matter&#39;</span><span class="p">,</span> <span class="s1">&#39;mint&#39;</span><span class="p">,</span> <span class="s1">&#39;mrybm&#39;</span><span class="p">,</span> <span class="s1">&#39;mygbm&#39;</span><span class="p">,</span> <span class="s1">&#39;oranges&#39;</span><span class="p">,</span>
             <span class="s1">&#39;orrd&#39;</span><span class="p">,</span> <span class="s1">&#39;oryel&#39;</span><span class="p">,</span> <span class="s1">&#39;oxy&#39;</span><span class="p">,</span> <span class="s1">&#39;peach&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="s1">&#39;picnic&#39;</span><span class="p">,</span> <span class="s1">&#39;pinkyl&#39;</span><span class="p">,</span>
             <span class="s1">&#39;piyg&#39;</span><span class="p">,</span> <span class="s1">&#39;plasma&#39;</span><span class="p">,</span> <span class="s1">&#39;plotly3&#39;</span><span class="p">,</span> <span class="s1">&#39;portland&#39;</span><span class="p">,</span> <span class="s1">&#39;prgn&#39;</span><span class="p">,</span> <span class="s1">&#39;pubu&#39;</span><span class="p">,</span> <span class="s1">&#39;pubugn&#39;</span><span class="p">,</span>
             <span class="s1">&#39;puor&#39;</span><span class="p">,</span> <span class="s1">&#39;purd&#39;</span><span class="p">,</span> <span class="s1">&#39;purp&#39;</span><span class="p">,</span> <span class="s1">&#39;purples&#39;</span><span class="p">,</span> <span class="s1">&#39;purpor&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="s1">&#39;rdbu&#39;</span><span class="p">,</span>
             <span class="s1">&#39;rdgy&#39;</span><span class="p">,</span> <span class="s1">&#39;rdpu&#39;</span><span class="p">,</span> <span class="s1">&#39;rdylbu&#39;</span><span class="p">,</span> <span class="s1">&#39;rdylgn&#39;</span><span class="p">,</span> <span class="s1">&#39;redor&#39;</span><span class="p">,</span> <span class="s1">&#39;reds&#39;</span><span class="p">,</span> <span class="s1">&#39;solar&#39;</span><span class="p">,</span>
             <span class="s1">&#39;spectral&#39;</span><span class="p">,</span> <span class="s1">&#39;speed&#39;</span><span class="p">,</span> <span class="s1">&#39;sunset&#39;</span><span class="p">,</span> <span class="s1">&#39;sunsetdark&#39;</span><span class="p">,</span> <span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="s1">&#39;tealgrn&#39;</span><span class="p">,</span>
             <span class="s1">&#39;tealrose&#39;</span><span class="p">,</span> <span class="s1">&#39;tempo&#39;</span><span class="p">,</span> <span class="s1">&#39;temps&#39;</span><span class="p">,</span> <span class="s1">&#39;thermal&#39;</span><span class="p">,</span> <span class="s1">&#39;tropic&#39;</span><span class="p">,</span> <span class="s1">&#39;turbid&#39;</span><span class="p">,</span>
             <span class="s1">&#39;turbo&#39;</span><span class="p">,</span> <span class="s1">&#39;twilight&#39;</span><span class="p">,</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;ylgn&#39;</span><span class="p">,</span> <span class="s1">&#39;ylgnbu&#39;</span><span class="p">,</span> <span class="s1">&#39;ylorbr&#39;</span><span class="p">,</span>
             <span class="s1">&#39;ylorrd&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;magma&#39;,
 &#39;inferno&#39;,
 &#39;plasma&#39;,
 &#39;viridis&#39;,
 &#39;cividis&#39;,
 &#39;twilight&#39;,
 &#39;turbo&#39;,
 &#39;Blues&#39;,
 &#39;BrBG&#39;,
 &#39;BuGn&#39;,
 &#39;BuPu&#39;,
 &#39;GnBu&#39;,
 &#39;Greens&#39;,
 &#39;Greys&#39;,
 &#39;OrRd&#39;,
 &#39;Oranges&#39;,
 &#39;PRGn&#39;,
 &#39;PiYG&#39;,
 &#39;PuBu&#39;,
 &#39;PuBuGn&#39;,
 &#39;PuOr&#39;,
 &#39;PuRd&#39;,
 &#39;Purples&#39;,
 &#39;RdBu&#39;,
 &#39;RdGy&#39;,
 &#39;RdPu&#39;,
 &#39;RdYlBu&#39;,
 &#39;RdYlGn&#39;,
 &#39;Reds&#39;,
 &#39;Spectral&#39;,
 &#39;YlGn&#39;,
 &#39;YlGnBu&#39;,
 &#39;YlOrBr&#39;,
 &#39;YlOrRd&#39;,
 &#39;gray&#39;,
 &#39;hot&#39;,
 &#39;hsv&#39;,
 &#39;jet&#39;,
 &#39;rainbow&#39;,
 &#39;icefire&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;external&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the app</span>
<span class="c1"># app.run_server(mode=&#39;inline&#39;)</span>
<span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>nodename nor servname provided, or not known
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">51</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Run the app</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># app.run_server(mode=&#39;inline&#39;)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/jupyter_dash/jupyter_app.py:339,</span> in <span class="ni">JupyterDash.run_server</span><span class="nt">(self, mode, width, height, inline_exceptions, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span>         <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://</span><span class="si">{host}</span><span class="s2">:</span><span class="si">{port}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span>             <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="n">JupyterDash</span><span class="o">.</span><span class="n">_token</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span>         <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">333</span>             <span class="s2">&quot;Address &#39;</span><span class="si">{url}</span><span class="s2">&#39; already in use.</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">334</span>             <span class="s2">&quot;    Try passing a different port to run_server.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">335</span>                 <span class="n">url</span><span class="o">=</span><span class="n">url</span>
<span class="g g-Whitespace">    </span><span class="mi">336</span>             <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">337</span>         <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">339</span> <span class="n">wait_for_app</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span> <span class="k">if</span> <span class="n">JupyterDash</span><span class="o">.</span><span class="n">_in_colab</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_display_in_colab</span><span class="p">(</span><span class="n">dashboard_url</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

<span class="nn">File ~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/retrying.py:49,</span> in <span class="ni">retry.&lt;locals&gt;.wrap.&lt;locals&gt;.wrapped_f</span><span class="nt">(*args, **kw)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="nd">@six</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span> <span class="k">def</span> <span class="nf">wrapped_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">49</span>     <span class="k">return</span> <span class="n">Retrying</span><span class="p">(</span><span class="o">*</span><span class="n">dargs</span><span class="p">,</span> <span class="o">**</span><span class="n">dkw</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="nn">File ~/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/retrying.py:220,</span> in <span class="ni">Retrying.call</span><span class="nt">(self, fn, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span>         <span class="n">jitter</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_jitter_max</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>         <span class="n">sleep</span> <span class="o">=</span> <span class="n">sleep</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">jitter</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">220</span>     <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">222</span> <span class="n">attempt_number</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">_terminate_server_for_jupyter</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="testing-chatgpt">
<h1>TESTING CHATGPT<a class="headerlink" href="#testing-chatgpt" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a sample NetworkX graph</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">karate_club_graph</span><span class="p">()</span>

<span class="c1"># Define some example attributes</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">])</span>
    <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
    <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">])</span>

<span class="c1"># Create Dash app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">JupyterDash</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
    <span class="n">dcc</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;memory-output&#39;</span><span class="p">),</span>
    <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s1">&#39;Node Color Attribute&#39;</span><span class="p">),</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-color-attribute&#39;</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">}</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;group&#39;</span>
            <span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s1">&#39;Node Size Attribute&#39;</span><span class="p">),</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;node-size-attribute&#39;</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">}</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;size&#39;</span>
            <span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s1">&#39;Edge Color Attribute&#39;</span><span class="p">),</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;edge-color-attribute&#39;</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">}</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;type&#39;</span>
            <span class="p">),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="s1">&#39;Edge Width Attribute&#39;</span><span class="p">),</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;edge-width-attribute&#39;</span><span class="p">,</span>
                <span class="n">options</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">}</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span>
            <span class="p">),</span>
        <span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;20%&#39;</span><span class="p">,</span> <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline-block&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical-align&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">}),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;mouseover-data&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;20%&#39;</span><span class="p">,</span> <span class="s1">&#39;overflow&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">}),</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;colorbars&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;20%&#39;</span><span class="p">,</span> <span class="s1">&#39;overflow&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;flex&#39;</span><span class="p">}),</span>
            <span class="n">cyto</span><span class="o">.</span><span class="n">Cytoscape</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;cytoscape-graph&#39;</span><span class="p">,</span>
                <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cose&#39;</span><span class="p">},</span>
                <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;80%&#39;</span><span class="p">,</span> <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline-block&#39;</span><span class="p">})</span>
    <span class="p">])</span>
<span class="p">])</span>

<span class="c1"># Helper function to generate the cytoscape elements from a NetworkX graph</span>
<span class="k">def</span> <span class="nf">generate_elements</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_color_attr</span><span class="p">,</span> <span class="n">node_size_attr</span><span class="p">,</span> <span class="n">edge_color_attr</span><span class="p">,</span> <span class="n">edge_width_attr</span><span class="p">):</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="o">**</span><span class="n">data</span><span class="p">},</span>
            <span class="s1">&#39;classes&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">node_color_attr</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">node_size_attr</span><span class="p">])])</span>
        <span class="p">})</span>
    <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">target</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">},</span>
            <span class="s1">&#39;classes&#39;</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge_color_attr</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">edge_width_attr</span><span class="p">])])</span>
        <span class="p">})</span>
    <span class="k">return</span> <span class="n">elements</span>

<span class="c1"># Helper function to create a Plotly colorbar figure</span>
<span class="k">def</span> <span class="nf">create_colorbar</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">color_scale</span> <span class="o">=</span> <span class="s1">&#39;Viridis&#39;</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
        <span class="n">z</span><span class="o">=</span><span class="p">[[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)],</span>
        <span class="n">colorscale</span><span class="o">=</span><span class="n">color_scale</span><span class="p">,</span>
        <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">titleside</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
        <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">trace</span><span class="p">],</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;cytoscape-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">),</span>
    <span class="c1"># Output(&#39;mouseover-data&#39;, &#39;children&#39;),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;colorbars&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;node-color-attribute&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;node-size-attribute&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;edge-color-attribute&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;edge-width-attribute&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">update_graph</span><span class="p">(</span><span class="n">node_color_attr</span><span class="p">,</span> <span class="n">node_size_attr</span><span class="p">,</span> <span class="n">edge_color_attr</span><span class="p">,</span> <span class="n">edge_width_attr</span><span class="p">):</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">generate_elements</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_color_attr</span><span class="p">,</span> <span class="n">node_size_attr</span><span class="p">,</span> <span class="n">edge_color_attr</span><span class="p">,</span> <span class="n">edge_width_attr</span><span class="p">)</span>

    <span class="c1"># Generate colorbars for nodes and edges</span>
    <span class="n">node_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">node_color_attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
    <span class="n">edge_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="n">edge_color_attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">]</span>
    
    <span class="n">node_colorbar</span> <span class="o">=</span> <span class="n">create_colorbar</span><span class="p">(</span><span class="n">node_colors</span><span class="p">,</span> <span class="n">node_color_attr</span><span class="p">)</span>
    <span class="n">edge_colorbar</span> <span class="o">=</span> <span class="n">create_colorbar</span><span class="p">(</span><span class="n">edge_colors</span><span class="p">,</span> <span class="n">edge_color_attr</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">elements</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="s1">&#39;Node Color Bar:&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontWeight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}),</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">node_colorbar</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
        <span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;50%&#39;</span><span class="p">,</span> <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline-block&#39;</span><span class="p">}),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">([</span>
            <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span><span class="s1">&#39;Edge Color Bar:&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontWeight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">}),</span>
            <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">figure</span><span class="o">=</span><span class="n">edge_colorbar</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;displayModeBar&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}),</span>
        <span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;50%&#39;</span><span class="p">,</span> <span class="s1">&#39;display&#39;</span><span class="p">:</span> <span class="s1">&#39;inline-block&#39;</span><span class="p">}),</span>
    <span class="p">]</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;mouseover-data&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;cytoscape-graph&#39;</span><span class="p">,</span> <span class="s1">&#39;mouseoverNodeData&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">display_mouseover_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Node data: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;Hover over a node to see its information here.&quot;</span>


<span class="c1"># app.run_server(mode=&#39;inline&#39;)</span>
<span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;external&#39;</span><span class="p">,</span> <span class="c1"># &#39;inline&#39;, # &#39;jupyterlab&#39;, </span>
               <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8090</span><span class="p">,</span> <span class="n">dev_tools_ui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># False,                                                                                                                                                                            </span>
              <span class="n">dev_tools_hot_reload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dash app running on http://127.0.0.1:8090/
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/renae12/opt/anaconda3/envs/geo_env_test/lib/python3.9/site-packages/dash/dash.py:516: UserWarning: JupyterDash is deprecated, use Dash instead.
See https://dash.plotly.com/dash-in-jupyter for more details.
  warnings.warn(
</pre></div>
</div>
<div class="output text_html">
        <iframe
            width="100%"
            height="650"
            src="http://127.0.0.1:8090/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">heatmap</span><span class="o">.</span><span class="n">ColorBar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Help on class ColorBar in module plotly.graph_objs.heatmap._colorbar:

class ColorBar(plotly.basedatatypes.BaseTraceHierarchyType)
 |  ColorBar(arg=None, bgcolor=None, bordercolor=None, borderwidth=None, dtick=None, exponentformat=None, len=None, lenmode=None, minexponent=None, nticks=None, orientation=None, outlinecolor=None, outlinewidth=None, separatethousands=None, showexponent=None, showticklabels=None, showtickprefix=None, showticksuffix=None, thickness=None, thicknessmode=None, tick0=None, tickangle=None, tickcolor=None, tickfont=None, tickformat=None, tickformatstops=None, tickformatstopdefaults=None, ticklabeloverflow=None, ticklabelposition=None, ticklabelstep=None, ticklen=None, tickmode=None, tickprefix=None, ticks=None, ticksuffix=None, ticktext=None, ticktextsrc=None, tickvals=None, tickvalssrc=None, tickwidth=None, title=None, titlefont=None, titleside=None, x=None, xanchor=None, xpad=None, y=None, yanchor=None, ypad=None, **kwargs)
 |  
 |  Method resolution order:
 |      ColorBar
 |      plotly.basedatatypes.BaseTraceHierarchyType
 |      plotly.basedatatypes.BasePlotlyType
 |      builtins.object
 |  
 |  Methods defined here:
 |  
 |  __init__(self, arg=None, bgcolor=None, bordercolor=None, borderwidth=None, dtick=None, exponentformat=None, len=None, lenmode=None, minexponent=None, nticks=None, orientation=None, outlinecolor=None, outlinewidth=None, separatethousands=None, showexponent=None, showticklabels=None, showtickprefix=None, showticksuffix=None, thickness=None, thicknessmode=None, tick0=None, tickangle=None, tickcolor=None, tickfont=None, tickformat=None, tickformatstops=None, tickformatstopdefaults=None, ticklabeloverflow=None, ticklabelposition=None, ticklabelstep=None, ticklen=None, tickmode=None, tickprefix=None, ticks=None, ticksuffix=None, ticktext=None, ticktextsrc=None, tickvals=None, tickvalssrc=None, tickwidth=None, title=None, titlefont=None, titleside=None, x=None, xanchor=None, xpad=None, y=None, yanchor=None, ypad=None, **kwargs)
 |      Construct a new ColorBar object
 |      
 |      Parameters
 |      ----------
 |      arg
 |          dict of properties compatible with this constructor or
 |          an instance of
 |          :class:`plotly.graph_objs.heatmap.ColorBar`
 |      bgcolor
 |          Sets the color of padded area.
 |      bordercolor
 |          Sets the axis line color.
 |      borderwidth
 |          Sets the width (in px) or the border enclosing this
 |          color bar.
 |      dtick
 |          Sets the step in-between ticks on this axis. Use with
 |          `tick0`. Must be a positive number, or special strings
 |          available to &quot;log&quot; and &quot;date&quot; axes. If the axis `type`
 |          is &quot;log&quot;, then ticks are set every 10^(n*dtick) where n
 |          is the tick number. For example, to set a tick mark at
 |          1, 10, 100, 1000, ... set dtick to 1. To set tick marks
 |          at 1, 100, 10000, ... set dtick to 2. To set tick marks
 |          at 1, 5, 25, 125, 625, 3125, ... set dtick to
 |          log_10(5), or 0.69897000433. &quot;log&quot; has several special
 |          values; &quot;L&lt;f&gt;&quot;, where `f` is a positive number, gives
 |          ticks linearly spaced in value (but not position). For
 |          example `tick0` = 0.1, `dtick` = &quot;L0.5&quot; will put ticks
 |          at 0.1, 0.6, 1.1, 1.6 etc. To show powers of 10 plus
 |          small digits between, use &quot;D1&quot; (all digits) or &quot;D2&quot;
 |          (only 2 and 5). `tick0` is ignored for &quot;D1&quot; and &quot;D2&quot;.
 |          If the axis `type` is &quot;date&quot;, then you must convert the
 |          time to milliseconds. For example, to set the interval
 |          between ticks to one day, set `dtick` to 86400000.0.
 |          &quot;date&quot; also has special values &quot;M&lt;n&gt;&quot; gives ticks
 |          spaced by a number of months. `n` must be a positive
 |          integer. To set ticks on the 15th of every third month,
 |          set `tick0` to &quot;2000-01-15&quot; and `dtick` to &quot;M3&quot;. To set
 |          ticks every 4 years, set `dtick` to &quot;M48&quot;
 |      exponentformat
 |          Determines a formatting rule for the tick exponents.
 |          For example, consider the number 1,000,000,000. If
 |          &quot;none&quot;, it appears as 1,000,000,000. If &quot;e&quot;, 1e+9. If
 |          &quot;E&quot;, 1E+9. If &quot;power&quot;, 1x10^9 (with 9 in a super
 |          script). If &quot;SI&quot;, 1G. If &quot;B&quot;, 1B.
 |      len
 |          Sets the length of the color bar This measure excludes
 |          the padding of both ends. That is, the color bar length
 |          is this length minus the padding on both ends.
 |      lenmode
 |          Determines whether this color bar&#39;s length (i.e. the
 |          measure in the color variation direction) is set in
 |          units of plot &quot;fraction&quot; or in *pixels. Use `len` to
 |          set the value.
 |      minexponent
 |          Hide SI prefix for 10^n if |n| is below this number.
 |          This only has an effect when `tickformat` is &quot;SI&quot; or
 |          &quot;B&quot;.
 |      nticks
 |          Specifies the maximum number of ticks for the
 |          particular axis. The actual number of ticks will be
 |          chosen automatically to be less than or equal to
 |          `nticks`. Has an effect only if `tickmode` is set to
 |          &quot;auto&quot;.
 |      orientation
 |          Sets the orientation of the colorbar.
 |      outlinecolor
 |          Sets the axis line color.
 |      outlinewidth
 |          Sets the width (in px) of the axis line.
 |      separatethousands
 |          If &quot;true&quot;, even 4-digit integers are separated
 |      showexponent
 |          If &quot;all&quot;, all exponents are shown besides their
 |          significands. If &quot;first&quot;, only the exponent of the
 |          first tick is shown. If &quot;last&quot;, only the exponent of
 |          the last tick is shown. If &quot;none&quot;, no exponents appear.
 |      showticklabels
 |          Determines whether or not the tick labels are drawn.
 |      showtickprefix
 |          If &quot;all&quot;, all tick labels are displayed with a prefix.
 |          If &quot;first&quot;, only the first tick is displayed with a
 |          prefix. If &quot;last&quot;, only the last tick is displayed with
 |          a suffix. If &quot;none&quot;, tick prefixes are hidden.
 |      showticksuffix
 |          Same as `showtickprefix` but for tick suffixes.
 |      thickness
 |          Sets the thickness of the color bar This measure
 |          excludes the size of the padding, ticks and labels.
 |      thicknessmode
 |          Determines whether this color bar&#39;s thickness (i.e. the
 |          measure in the constant color direction) is set in
 |          units of plot &quot;fraction&quot; or in &quot;pixels&quot;. Use
 |          `thickness` to set the value.
 |      tick0
 |          Sets the placement of the first tick on this axis. Use
 |          with `dtick`. If the axis `type` is &quot;log&quot;, then you
 |          must take the log of your starting tick (e.g. to set
 |          the starting tick to 100, set the `tick0` to 2) except
 |          when `dtick`=*L&lt;f&gt;* (see `dtick` for more info). If the
 |          axis `type` is &quot;date&quot;, it should be a date string, like
 |          date data. If the axis `type` is &quot;category&quot;, it should
 |          be a number, using the scale where each category is
 |          assigned a serial number from zero in the order it
 |          appears.
 |      tickangle
 |          Sets the angle of the tick labels with respect to the
 |          horizontal. For example, a `tickangle` of -90 draws the
 |          tick labels vertically.
 |      tickcolor
 |          Sets the tick color.
 |      tickfont
 |          Sets the color bar&#39;s tick label font
 |      tickformat
 |          Sets the tick label formatting rule using d3 formatting
 |          mini-languages which are very similar to those in
 |          Python. For numbers, see:
 |          https://github.com/d3/d3-format/tree/v1.4.5#d3-format.
 |          And for dates see: https://github.com/d3/d3-time-
 |          format/tree/v2.2.3#locale_format. We add two items to
 |          d3&#39;s date formatter: &quot;%h&quot; for half of the year as a
 |          decimal number as well as &quot;%{n}f&quot; for fractional
 |          seconds with n digits. For example, *2016-10-13
 |          09:15:23.456* with tickformat &quot;%H~%M~%S.%2f&quot; would
 |          display &quot;09~15~23.46&quot;
 |      tickformatstops
 |          A tuple of :class:`plotly.graph_objects.heatmap.colorba
 |          r.Tickformatstop` instances or dicts with compatible
 |          properties
 |      tickformatstopdefaults
 |          When used in a template (as layout.template.data.heatma
 |          p.colorbar.tickformatstopdefaults), sets the default
 |          property values to use for elements of
 |          heatmap.colorbar.tickformatstops
 |      ticklabeloverflow
 |          Determines how we handle tick labels that would
 |          overflow either the graph div or the domain of the
 |          axis. The default value for inside tick labels is *hide
 |          past domain*. In other cases the default is *hide past
 |          div*.
 |      ticklabelposition
 |          Determines where tick labels are drawn relative to the
 |          ticks. Left and right options are used when
 |          `orientation` is &quot;h&quot;, top and bottom when `orientation`
 |          is &quot;v&quot;.
 |      ticklabelstep
 |          Sets the spacing between tick labels as compared to the
 |          spacing between ticks. A value of 1 (default) means
 |          each tick gets a label. A value of 2 means shows every
 |          2nd label. A larger value n means only every nth tick
 |          is labeled. `tick0` determines which labels are shown.
 |          Not implemented for axes with `type` &quot;log&quot; or
 |          &quot;multicategory&quot;, or when `tickmode` is &quot;array&quot;.
 |      ticklen
 |          Sets the tick length (in px).
 |      tickmode
 |          Sets the tick mode for this axis. If &quot;auto&quot;, the number
 |          of ticks is set via `nticks`. If &quot;linear&quot;, the
 |          placement of the ticks is determined by a starting
 |          position `tick0` and a tick step `dtick` (&quot;linear&quot; is
 |          the default value if `tick0` and `dtick` are provided).
 |          If &quot;array&quot;, the placement of the ticks is set via
 |          `tickvals` and the tick text is `ticktext`. (&quot;array&quot; is
 |          the default value if `tickvals` is provided).
 |      tickprefix
 |          Sets a tick label prefix.
 |      ticks
 |          Determines whether ticks are drawn or not. If &quot;&quot;, this
 |          axis&#39; ticks are not drawn. If &quot;outside&quot; (&quot;inside&quot;),
 |          this axis&#39; are drawn outside (inside) the axis lines.
 |      ticksuffix
 |          Sets a tick label suffix.
 |      ticktext
 |          Sets the text displayed at the ticks position via
 |          `tickvals`. Only has an effect if `tickmode` is set to
 |          &quot;array&quot;. Used with `tickvals`.
 |      ticktextsrc
 |          Sets the source reference on Chart Studio Cloud for
 |          `ticktext`.
 |      tickvals
 |          Sets the values at which ticks on this axis appear.
 |          Only has an effect if `tickmode` is set to &quot;array&quot;.
 |          Used with `ticktext`.
 |      tickvalssrc
 |          Sets the source reference on Chart Studio Cloud for
 |          `tickvals`.
 |      tickwidth
 |          Sets the tick width (in px).
 |      title
 |          :class:`plotly.graph_objects.heatmap.colorbar.Title`
 |          instance or dict with compatible properties
 |      titlefont
 |          Deprecated: Please use heatmap.colorbar.title.font
 |          instead. Sets this color bar&#39;s title font. Note that
 |          the title&#39;s font used to be set by the now deprecated
 |          `titlefont` attribute.
 |      titleside
 |          Deprecated: Please use heatmap.colorbar.title.side
 |          instead. Determines the location of color bar&#39;s title
 |          with respect to the color bar. Defaults to &quot;top&quot; when
 |          `orientation` if &quot;v&quot; and  defaults to &quot;right&quot; when
 |          `orientation` if &quot;h&quot;. Note that the title&#39;s location
 |          used to be set by the now deprecated `titleside`
 |          attribute.
 |      x
 |          Sets the x position of the color bar (in plot
 |          fraction). Defaults to 1.02 when `orientation` is &quot;v&quot;
 |          and 0.5 when `orientation` is &quot;h&quot;.
 |      xanchor
 |          Sets this color bar&#39;s horizontal position anchor. This
 |          anchor binds the `x` position to the &quot;left&quot;, &quot;center&quot;
 |          or &quot;right&quot; of the color bar. Defaults to &quot;left&quot; when
 |          `orientation` is &quot;v&quot; and &quot;center&quot; when `orientation` is
 |          &quot;h&quot;.
 |      xpad
 |          Sets the amount of padding (in px) along the x
 |          direction.
 |      y
 |          Sets the y position of the color bar (in plot
 |          fraction). Defaults to 0.5 when `orientation` is &quot;v&quot;
 |          and 1.02 when `orientation` is &quot;h&quot;.
 |      yanchor
 |          Sets this color bar&#39;s vertical position anchor This
 |          anchor binds the `y` position to the &quot;top&quot;, &quot;middle&quot; or
 |          &quot;bottom&quot; of the color bar. Defaults to &quot;middle&quot; when
 |          `orientation` is &quot;v&quot; and &quot;bottom&quot; when `orientation` is
 |          &quot;h&quot;.
 |      ypad
 |          Sets the amount of padding (in px) along the y
 |          direction.
 |      
 |      Returns
 |      -------
 |      ColorBar
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |  
 |  bgcolor
 |      Sets the color of padded area.
 |      
 |      The &#39;bgcolor&#39; property is a color and may be specified as:
 |        - A hex string (e.g. &#39;#ff0000&#39;)
 |        - An rgb/rgba string (e.g. &#39;rgb(255,0,0)&#39;)
 |        - An hsl/hsla string (e.g. &#39;hsl(0,100%,50%)&#39;)
 |        - An hsv/hsva string (e.g. &#39;hsv(0,100%,100%)&#39;)
 |        - A named CSS color:
 |              aliceblue, antiquewhite, aqua, aquamarine, azure,
 |              beige, bisque, black, blanchedalmond, blue,
 |              blueviolet, brown, burlywood, cadetblue,
 |              chartreuse, chocolate, coral, cornflowerblue,
 |              cornsilk, crimson, cyan, darkblue, darkcyan,
 |              darkgoldenrod, darkgray, darkgrey, darkgreen,
 |              darkkhaki, darkmagenta, darkolivegreen, darkorange,
 |              darkorchid, darkred, darksalmon, darkseagreen,
 |              darkslateblue, darkslategray, darkslategrey,
 |              darkturquoise, darkviolet, deeppink, deepskyblue,
 |              dimgray, dimgrey, dodgerblue, firebrick,
 |              floralwhite, forestgreen, fuchsia, gainsboro,
 |              ghostwhite, gold, goldenrod, gray, grey, green,
 |              greenyellow, honeydew, hotpink, indianred, indigo,
 |              ivory, khaki, lavender, lavenderblush, lawngreen,
 |              lemonchiffon, lightblue, lightcoral, lightcyan,
 |              lightgoldenrodyellow, lightgray, lightgrey,
 |              lightgreen, lightpink, lightsalmon, lightseagreen,
 |              lightskyblue, lightslategray, lightslategrey,
 |              lightsteelblue, lightyellow, lime, limegreen,
 |              linen, magenta, maroon, mediumaquamarine,
 |              mediumblue, mediumorchid, mediumpurple,
 |              mediumseagreen, mediumslateblue, mediumspringgreen,
 |              mediumturquoise, mediumvioletred, midnightblue,
 |              mintcream, mistyrose, moccasin, navajowhite, navy,
 |              oldlace, olive, olivedrab, orange, orangered,
 |              orchid, palegoldenrod, palegreen, paleturquoise,
 |              palevioletred, papayawhip, peachpuff, peru, pink,
 |              plum, powderblue, purple, red, rosybrown,
 |              royalblue, rebeccapurple, saddlebrown, salmon,
 |              sandybrown, seagreen, seashell, sienna, silver,
 |              skyblue, slateblue, slategray, slategrey, snow,
 |              springgreen, steelblue, tan, teal, thistle, tomato,
 |              turquoise, violet, wheat, white, whitesmoke,
 |              yellow, yellowgreen
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  bordercolor
 |      Sets the axis line color.
 |      
 |      The &#39;bordercolor&#39; property is a color and may be specified as:
 |        - A hex string (e.g. &#39;#ff0000&#39;)
 |        - An rgb/rgba string (e.g. &#39;rgb(255,0,0)&#39;)
 |        - An hsl/hsla string (e.g. &#39;hsl(0,100%,50%)&#39;)
 |        - An hsv/hsva string (e.g. &#39;hsv(0,100%,100%)&#39;)
 |        - A named CSS color:
 |              aliceblue, antiquewhite, aqua, aquamarine, azure,
 |              beige, bisque, black, blanchedalmond, blue,
 |              blueviolet, brown, burlywood, cadetblue,
 |              chartreuse, chocolate, coral, cornflowerblue,
 |              cornsilk, crimson, cyan, darkblue, darkcyan,
 |              darkgoldenrod, darkgray, darkgrey, darkgreen,
 |              darkkhaki, darkmagenta, darkolivegreen, darkorange,
 |              darkorchid, darkred, darksalmon, darkseagreen,
 |              darkslateblue, darkslategray, darkslategrey,
 |              darkturquoise, darkviolet, deeppink, deepskyblue,
 |              dimgray, dimgrey, dodgerblue, firebrick,
 |              floralwhite, forestgreen, fuchsia, gainsboro,
 |              ghostwhite, gold, goldenrod, gray, grey, green,
 |              greenyellow, honeydew, hotpink, indianred, indigo,
 |              ivory, khaki, lavender, lavenderblush, lawngreen,
 |              lemonchiffon, lightblue, lightcoral, lightcyan,
 |              lightgoldenrodyellow, lightgray, lightgrey,
 |              lightgreen, lightpink, lightsalmon, lightseagreen,
 |              lightskyblue, lightslategray, lightslategrey,
 |              lightsteelblue, lightyellow, lime, limegreen,
 |              linen, magenta, maroon, mediumaquamarine,
 |              mediumblue, mediumorchid, mediumpurple,
 |              mediumseagreen, mediumslateblue, mediumspringgreen,
 |              mediumturquoise, mediumvioletred, midnightblue,
 |              mintcream, mistyrose, moccasin, navajowhite, navy,
 |              oldlace, olive, olivedrab, orange, orangered,
 |              orchid, palegoldenrod, palegreen, paleturquoise,
 |              palevioletred, papayawhip, peachpuff, peru, pink,
 |              plum, powderblue, purple, red, rosybrown,
 |              royalblue, rebeccapurple, saddlebrown, salmon,
 |              sandybrown, seagreen, seashell, sienna, silver,
 |              skyblue, slateblue, slategray, slategrey, snow,
 |              springgreen, steelblue, tan, teal, thistle, tomato,
 |              turquoise, violet, wheat, white, whitesmoke,
 |              yellow, yellowgreen
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  borderwidth
 |      Sets the width (in px) or the border enclosing this color bar.
 |      
 |      The &#39;borderwidth&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  dtick
 |      Sets the step in-between ticks on this axis. Use with `tick0`.
 |      Must be a positive number, or special strings available to
 |      &quot;log&quot; and &quot;date&quot; axes. If the axis `type` is &quot;log&quot;, then ticks
 |      are set every 10^(n*dtick) where n is the tick number. For
 |      example, to set a tick mark at 1, 10, 100, 1000, ... set dtick
 |      to 1. To set tick marks at 1, 100, 10000, ... set dtick to 2.
 |      To set tick marks at 1, 5, 25, 125, 625, 3125, ... set dtick to
 |      log_10(5), or 0.69897000433. &quot;log&quot; has several special values;
 |      &quot;L&lt;f&gt;&quot;, where `f` is a positive number, gives ticks linearly
 |      spaced in value (but not position). For example `tick0` = 0.1,
 |      `dtick` = &quot;L0.5&quot; will put ticks at 0.1, 0.6, 1.1, 1.6 etc. To
 |      show powers of 10 plus small digits between, use &quot;D1&quot; (all
 |      digits) or &quot;D2&quot; (only 2 and 5). `tick0` is ignored for &quot;D1&quot; and
 |      &quot;D2&quot;. If the axis `type` is &quot;date&quot;, then you must convert the
 |      time to milliseconds. For example, to set the interval between
 |      ticks to one day, set `dtick` to 86400000.0. &quot;date&quot; also has
 |      special values &quot;M&lt;n&gt;&quot; gives ticks spaced by a number of months.
 |      `n` must be a positive integer. To set ticks on the 15th of
 |      every third month, set `tick0` to &quot;2000-01-15&quot; and `dtick` to
 |      &quot;M3&quot;. To set ticks every 4 years, set `dtick` to &quot;M48&quot;
 |      
 |      The &#39;dtick&#39; property accepts values of any type
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  exponentformat
 |      Determines a formatting rule for the tick exponents. For
 |      example, consider the number 1,000,000,000. If &quot;none&quot;, it
 |      appears as 1,000,000,000. If &quot;e&quot;, 1e+9. If &quot;E&quot;, 1E+9. If
 |      &quot;power&quot;, 1x10^9 (with 9 in a super script). If &quot;SI&quot;, 1G. If
 |      &quot;B&quot;, 1B.
 |      
 |      The &#39;exponentformat&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;none&#39;, &#39;e&#39;, &#39;E&#39;, &#39;power&#39;, &#39;SI&#39;, &#39;B&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  len
 |      Sets the length of the color bar This measure excludes the
 |      padding of both ends. That is, the color bar length is this
 |      length minus the padding on both ends.
 |      
 |      The &#39;len&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  lenmode
 |      Determines whether this color bar&#39;s length (i.e. the measure in
 |      the color variation direction) is set in units of plot
 |      &quot;fraction&quot; or in *pixels. Use `len` to set the value.
 |      
 |      The &#39;lenmode&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;fraction&#39;, &#39;pixels&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  minexponent
 |      Hide SI prefix for 10^n if |n| is below this number. This only
 |      has an effect when `tickformat` is &quot;SI&quot; or &quot;B&quot;.
 |      
 |      The &#39;minexponent&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  nticks
 |      Specifies the maximum number of ticks for the particular axis.
 |      The actual number of ticks will be chosen automatically to be
 |      less than or equal to `nticks`. Has an effect only if
 |      `tickmode` is set to &quot;auto&quot;.
 |      
 |      The &#39;nticks&#39; property is a integer and may be specified as:
 |        - An int (or float that will be cast to an int)
 |          in the interval [0, 9223372036854775807]
 |      
 |      Returns
 |      -------
 |      int
 |  
 |  orientation
 |      Sets the orientation of the colorbar.
 |      
 |      The &#39;orientation&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;h&#39;, &#39;v&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  outlinecolor
 |      Sets the axis line color.
 |      
 |      The &#39;outlinecolor&#39; property is a color and may be specified as:
 |        - A hex string (e.g. &#39;#ff0000&#39;)
 |        - An rgb/rgba string (e.g. &#39;rgb(255,0,0)&#39;)
 |        - An hsl/hsla string (e.g. &#39;hsl(0,100%,50%)&#39;)
 |        - An hsv/hsva string (e.g. &#39;hsv(0,100%,100%)&#39;)
 |        - A named CSS color:
 |              aliceblue, antiquewhite, aqua, aquamarine, azure,
 |              beige, bisque, black, blanchedalmond, blue,
 |              blueviolet, brown, burlywood, cadetblue,
 |              chartreuse, chocolate, coral, cornflowerblue,
 |              cornsilk, crimson, cyan, darkblue, darkcyan,
 |              darkgoldenrod, darkgray, darkgrey, darkgreen,
 |              darkkhaki, darkmagenta, darkolivegreen, darkorange,
 |              darkorchid, darkred, darksalmon, darkseagreen,
 |              darkslateblue, darkslategray, darkslategrey,
 |              darkturquoise, darkviolet, deeppink, deepskyblue,
 |              dimgray, dimgrey, dodgerblue, firebrick,
 |              floralwhite, forestgreen, fuchsia, gainsboro,
 |              ghostwhite, gold, goldenrod, gray, grey, green,
 |              greenyellow, honeydew, hotpink, indianred, indigo,
 |              ivory, khaki, lavender, lavenderblush, lawngreen,
 |              lemonchiffon, lightblue, lightcoral, lightcyan,
 |              lightgoldenrodyellow, lightgray, lightgrey,
 |              lightgreen, lightpink, lightsalmon, lightseagreen,
 |              lightskyblue, lightslategray, lightslategrey,
 |              lightsteelblue, lightyellow, lime, limegreen,
 |              linen, magenta, maroon, mediumaquamarine,
 |              mediumblue, mediumorchid, mediumpurple,
 |              mediumseagreen, mediumslateblue, mediumspringgreen,
 |              mediumturquoise, mediumvioletred, midnightblue,
 |              mintcream, mistyrose, moccasin, navajowhite, navy,
 |              oldlace, olive, olivedrab, orange, orangered,
 |              orchid, palegoldenrod, palegreen, paleturquoise,
 |              palevioletred, papayawhip, peachpuff, peru, pink,
 |              plum, powderblue, purple, red, rosybrown,
 |              royalblue, rebeccapurple, saddlebrown, salmon,
 |              sandybrown, seagreen, seashell, sienna, silver,
 |              skyblue, slateblue, slategray, slategrey, snow,
 |              springgreen, steelblue, tan, teal, thistle, tomato,
 |              turquoise, violet, wheat, white, whitesmoke,
 |              yellow, yellowgreen
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  outlinewidth
 |      Sets the width (in px) of the axis line.
 |      
 |      The &#39;outlinewidth&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  separatethousands
 |      If &quot;true&quot;, even 4-digit integers are separated
 |      
 |      The &#39;separatethousands&#39; property must be specified as a bool
 |      (either True, or False)
 |      
 |      Returns
 |      -------
 |      bool
 |  
 |  showexponent
 |      If &quot;all&quot;, all exponents are shown besides their significands.
 |      If &quot;first&quot;, only the exponent of the first tick is shown. If
 |      &quot;last&quot;, only the exponent of the last tick is shown. If &quot;none&quot;,
 |      no exponents appear.
 |      
 |      The &#39;showexponent&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;all&#39;, &#39;first&#39;, &#39;last&#39;, &#39;none&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  showticklabels
 |      Determines whether or not the tick labels are drawn.
 |      
 |      The &#39;showticklabels&#39; property must be specified as a bool
 |      (either True, or False)
 |      
 |      Returns
 |      -------
 |      bool
 |  
 |  showtickprefix
 |      If &quot;all&quot;, all tick labels are displayed with a prefix. If
 |      &quot;first&quot;, only the first tick is displayed with a prefix. If
 |      &quot;last&quot;, only the last tick is displayed with a suffix. If
 |      &quot;none&quot;, tick prefixes are hidden.
 |      
 |      The &#39;showtickprefix&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;all&#39;, &#39;first&#39;, &#39;last&#39;, &#39;none&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  showticksuffix
 |      Same as `showtickprefix` but for tick suffixes.
 |      
 |      The &#39;showticksuffix&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;all&#39;, &#39;first&#39;, &#39;last&#39;, &#39;none&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  thickness
 |      Sets the thickness of the color bar This measure excludes the
 |      size of the padding, ticks and labels.
 |      
 |      The &#39;thickness&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  thicknessmode
 |      Determines whether this color bar&#39;s thickness (i.e. the measure
 |      in the constant color direction) is set in units of plot
 |      &quot;fraction&quot; or in &quot;pixels&quot;. Use `thickness` to set the value.
 |      
 |      The &#39;thicknessmode&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;fraction&#39;, &#39;pixels&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  tick0
 |      Sets the placement of the first tick on this axis. Use with
 |      `dtick`. If the axis `type` is &quot;log&quot;, then you must take the
 |      log of your starting tick (e.g. to set the starting tick to
 |      100, set the `tick0` to 2) except when `dtick`=*L&lt;f&gt;* (see
 |      `dtick` for more info). If the axis `type` is &quot;date&quot;, it should
 |      be a date string, like date data. If the axis `type` is
 |      &quot;category&quot;, it should be a number, using the scale where each
 |      category is assigned a serial number from zero in the order it
 |      appears.
 |      
 |      The &#39;tick0&#39; property accepts values of any type
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  tickangle
 |      Sets the angle of the tick labels with respect to the
 |      horizontal. For example, a `tickangle` of -90 draws the tick
 |      labels vertically.
 |      
 |      The &#39;tickangle&#39; property is a angle (in degrees) that may be
 |      specified as a number between -180 and 180. Numeric values outside this
 |      range are converted to the equivalent value
 |      (e.g. 270 is converted to -90).
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  tickcolor
 |      Sets the tick color.
 |      
 |      The &#39;tickcolor&#39; property is a color and may be specified as:
 |        - A hex string (e.g. &#39;#ff0000&#39;)
 |        - An rgb/rgba string (e.g. &#39;rgb(255,0,0)&#39;)
 |        - An hsl/hsla string (e.g. &#39;hsl(0,100%,50%)&#39;)
 |        - An hsv/hsva string (e.g. &#39;hsv(0,100%,100%)&#39;)
 |        - A named CSS color:
 |              aliceblue, antiquewhite, aqua, aquamarine, azure,
 |              beige, bisque, black, blanchedalmond, blue,
 |              blueviolet, brown, burlywood, cadetblue,
 |              chartreuse, chocolate, coral, cornflowerblue,
 |              cornsilk, crimson, cyan, darkblue, darkcyan,
 |              darkgoldenrod, darkgray, darkgrey, darkgreen,
 |              darkkhaki, darkmagenta, darkolivegreen, darkorange,
 |              darkorchid, darkred, darksalmon, darkseagreen,
 |              darkslateblue, darkslategray, darkslategrey,
 |              darkturquoise, darkviolet, deeppink, deepskyblue,
 |              dimgray, dimgrey, dodgerblue, firebrick,
 |              floralwhite, forestgreen, fuchsia, gainsboro,
 |              ghostwhite, gold, goldenrod, gray, grey, green,
 |              greenyellow, honeydew, hotpink, indianred, indigo,
 |              ivory, khaki, lavender, lavenderblush, lawngreen,
 |              lemonchiffon, lightblue, lightcoral, lightcyan,
 |              lightgoldenrodyellow, lightgray, lightgrey,
 |              lightgreen, lightpink, lightsalmon, lightseagreen,
 |              lightskyblue, lightslategray, lightslategrey,
 |              lightsteelblue, lightyellow, lime, limegreen,
 |              linen, magenta, maroon, mediumaquamarine,
 |              mediumblue, mediumorchid, mediumpurple,
 |              mediumseagreen, mediumslateblue, mediumspringgreen,
 |              mediumturquoise, mediumvioletred, midnightblue,
 |              mintcream, mistyrose, moccasin, navajowhite, navy,
 |              oldlace, olive, olivedrab, orange, orangered,
 |              orchid, palegoldenrod, palegreen, paleturquoise,
 |              palevioletred, papayawhip, peachpuff, peru, pink,
 |              plum, powderblue, purple, red, rosybrown,
 |              royalblue, rebeccapurple, saddlebrown, salmon,
 |              sandybrown, seagreen, seashell, sienna, silver,
 |              skyblue, slateblue, slategray, slategrey, snow,
 |              springgreen, steelblue, tan, teal, thistle, tomato,
 |              turquoise, violet, wheat, white, whitesmoke,
 |              yellow, yellowgreen
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  tickfont
 |      Sets the color bar&#39;s tick label font
 |      
 |      The &#39;tickfont&#39; property is an instance of Tickfont
 |      that may be specified as:
 |        - An instance of :class:`plotly.graph_objs.heatmap.colorbar.Tickfont`
 |        - A dict of string/value properties that will be passed
 |          to the Tickfont constructor
 |      
 |          Supported dict properties:
 |      
 |              color
 |      
 |              family
 |                  HTML font family - the typeface that will be
 |                  applied by the web browser. The web browser
 |                  will only be able to apply a font if it is
 |                  available on the system which it operates.
 |                  Provide multiple font families, separated by
 |                  commas, to indicate the preference in which to
 |                  apply fonts if they aren&#39;t available on the
 |                  system. The Chart Studio Cloud (at
 |                  https://chart-studio.plotly.com or on-premise)
 |                  generates images on a server, where only a
 |                  select number of fonts are installed and
 |                  supported. These include &quot;Arial&quot;, &quot;Balto&quot;,
 |                  &quot;Courier New&quot;, &quot;Droid Sans&quot;,, &quot;Droid Serif&quot;,
 |                  &quot;Droid Sans Mono&quot;, &quot;Gravitas One&quot;, &quot;Old
 |                  Standard TT&quot;, &quot;Open Sans&quot;, &quot;Overpass&quot;, &quot;PT Sans
 |                  Narrow&quot;, &quot;Raleway&quot;, &quot;Times New Roman&quot;.
 |              size
 |      
 |      Returns
 |      -------
 |      plotly.graph_objs.heatmap.colorbar.Tickfont
 |  
 |  tickformat
 |      Sets the tick label formatting rule using d3 formatting mini-
 |      languages which are very similar to those in Python. For
 |      numbers, see:
 |      https://github.com/d3/d3-format/tree/v1.4.5#d3-format. And for
 |      dates see: https://github.com/d3/d3-time-
 |      format/tree/v2.2.3#locale_format. We add two items to d3&#39;s date
 |      formatter: &quot;%h&quot; for half of the year as a decimal number as
 |      well as &quot;%{n}f&quot; for fractional seconds with n digits. For
 |      example, *2016-10-13 09:15:23.456* with tickformat
 |      &quot;%H~%M~%S.%2f&quot; would display &quot;09~15~23.46&quot;
 |      
 |      The &#39;tickformat&#39; property is a string and must be specified as:
 |        - A string
 |        - A number that will be converted to a string
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  tickformatstopdefaults
 |      When used in a template (as
 |      layout.template.data.heatmap.colorbar.tickformatstopdefaults),
 |      sets the default property values to use for elements of
 |      heatmap.colorbar.tickformatstops
 |      
 |      The &#39;tickformatstopdefaults&#39; property is an instance of Tickformatstop
 |      that may be specified as:
 |        - An instance of :class:`plotly.graph_objs.heatmap.colorbar.Tickformatstop`
 |        - A dict of string/value properties that will be passed
 |          to the Tickformatstop constructor
 |      
 |          Supported dict properties:
 |      
 |      Returns
 |      -------
 |      plotly.graph_objs.heatmap.colorbar.Tickformatstop
 |  
 |  tickformatstops
 |      The &#39;tickformatstops&#39; property is a tuple of instances of
 |      Tickformatstop that may be specified as:
 |        - A list or tuple of instances of plotly.graph_objs.heatmap.colorbar.Tickformatstop
 |        - A list or tuple of dicts of string/value properties that
 |          will be passed to the Tickformatstop constructor
 |      
 |          Supported dict properties:
 |      
 |              dtickrange
 |                  range [*min*, *max*], where &quot;min&quot;, &quot;max&quot; -
 |                  dtick values which describe some zoom level, it
 |                  is possible to omit &quot;min&quot; or &quot;max&quot; value by
 |                  passing &quot;null&quot;
 |              enabled
 |                  Determines whether or not this stop is used. If
 |                  `false`, this stop is ignored even within its
 |                  `dtickrange`.
 |              name
 |                  When used in a template, named items are
 |                  created in the output figure in addition to any
 |                  items the figure already has in this array. You
 |                  can modify these items in the output figure by
 |                  making your own item with `templateitemname`
 |                  matching this `name` alongside your
 |                  modifications (including `visible: false` or
 |                  `enabled: false` to hide it). Has no effect
 |                  outside of a template.
 |              templateitemname
 |                  Used to refer to a named item in this array in
 |                  the template. Named items from the template
 |                  will be created even without a matching item in
 |                  the input figure, but you can modify one by
 |                  making an item with `templateitemname` matching
 |                  its `name`, alongside your modifications
 |                  (including `visible: false` or `enabled: false`
 |                  to hide it). If there is no template or no
 |                  matching item, this item will be hidden unless
 |                  you explicitly show it with `visible: true`.
 |              value
 |                  string - dtickformat for described zoom level,
 |                  the same as &quot;tickformat&quot;
 |      
 |      Returns
 |      -------
 |      tuple[plotly.graph_objs.heatmap.colorbar.Tickformatstop]
 |  
 |  ticklabeloverflow
 |      Determines how we handle tick labels that would overflow either
 |      the graph div or the domain of the axis. The default value for
 |      inside tick labels is *hide past domain*. In other cases the
 |      default is *hide past div*.
 |      
 |      The &#39;ticklabeloverflow&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;allow&#39;, &#39;hide past div&#39;, &#39;hide past domain&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  ticklabelposition
 |      Determines where tick labels are drawn relative to the ticks.
 |      Left and right options are used when `orientation` is &quot;h&quot;, top
 |      and bottom when `orientation` is &quot;v&quot;.
 |      
 |      The &#39;ticklabelposition&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;outside&#39;, &#39;inside&#39;, &#39;outside top&#39;, &#39;inside top&#39;,
 |              &#39;outside left&#39;, &#39;inside left&#39;, &#39;outside right&#39;, &#39;inside
 |              right&#39;, &#39;outside bottom&#39;, &#39;inside bottom&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  ticklabelstep
 |      Sets the spacing between tick labels as compared to the spacing
 |      between ticks. A value of 1 (default) means each tick gets a
 |      label. A value of 2 means shows every 2nd label. A larger value
 |      n means only every nth tick is labeled. `tick0` determines
 |      which labels are shown. Not implemented for axes with `type`
 |      &quot;log&quot; or &quot;multicategory&quot;, or when `tickmode` is &quot;array&quot;.
 |      
 |      The &#39;ticklabelstep&#39; property is a integer and may be specified as:
 |        - An int (or float that will be cast to an int)
 |          in the interval [1, 9223372036854775807]
 |      
 |      Returns
 |      -------
 |      int
 |  
 |  ticklen
 |      Sets the tick length (in px).
 |      
 |      The &#39;ticklen&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  tickmode
 |      Sets the tick mode for this axis. If &quot;auto&quot;, the number of
 |      ticks is set via `nticks`. If &quot;linear&quot;, the placement of the
 |      ticks is determined by a starting position `tick0` and a tick
 |      step `dtick` (&quot;linear&quot; is the default value if `tick0` and
 |      `dtick` are provided). If &quot;array&quot;, the placement of the ticks
 |      is set via `tickvals` and the tick text is `ticktext`. (&quot;array&quot;
 |      is the default value if `tickvals` is provided).
 |      
 |      The &#39;tickmode&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;auto&#39;, &#39;linear&#39;, &#39;array&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  tickprefix
 |      Sets a tick label prefix.
 |      
 |      The &#39;tickprefix&#39; property is a string and must be specified as:
 |        - A string
 |        - A number that will be converted to a string
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  ticks
 |      Determines whether ticks are drawn or not. If &quot;&quot;, this axis&#39;
 |      ticks are not drawn. If &quot;outside&quot; (&quot;inside&quot;), this axis&#39; are
 |      drawn outside (inside) the axis lines.
 |      
 |      The &#39;ticks&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;outside&#39;, &#39;inside&#39;, &#39;&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  ticksuffix
 |      Sets a tick label suffix.
 |      
 |      The &#39;ticksuffix&#39; property is a string and must be specified as:
 |        - A string
 |        - A number that will be converted to a string
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  ticktext
 |      Sets the text displayed at the ticks position via `tickvals`.
 |      Only has an effect if `tickmode` is set to &quot;array&quot;. Used with
 |      `tickvals`.
 |      
 |      The &#39;ticktext&#39; property is an array that may be specified as a tuple,
 |      list, numpy array, or pandas Series
 |      
 |      Returns
 |      -------
 |      numpy.ndarray
 |  
 |  ticktextsrc
 |      Sets the source reference on Chart Studio Cloud for `ticktext`.
 |      
 |      The &#39;ticktextsrc&#39; property must be specified as a string or
 |      as a plotly.grid_objs.Column object
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  tickvals
 |      Sets the values at which ticks on this axis appear. Only has an
 |      effect if `tickmode` is set to &quot;array&quot;. Used with `ticktext`.
 |      
 |      The &#39;tickvals&#39; property is an array that may be specified as a tuple,
 |      list, numpy array, or pandas Series
 |      
 |      Returns
 |      -------
 |      numpy.ndarray
 |  
 |  tickvalssrc
 |      Sets the source reference on Chart Studio Cloud for `tickvals`.
 |      
 |      The &#39;tickvalssrc&#39; property must be specified as a string or
 |      as a plotly.grid_objs.Column object
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  tickwidth
 |      Sets the tick width (in px).
 |      
 |      The &#39;tickwidth&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  title
 |      The &#39;title&#39; property is an instance of Title
 |      that may be specified as:
 |        - An instance of :class:`plotly.graph_objs.heatmap.colorbar.Title`
 |        - A dict of string/value properties that will be passed
 |          to the Title constructor
 |      
 |          Supported dict properties:
 |      
 |              font
 |                  Sets this color bar&#39;s title font. Note that the
 |                  title&#39;s font used to be set by the now
 |                  deprecated `titlefont` attribute.
 |              side
 |                  Determines the location of color bar&#39;s title
 |                  with respect to the color bar. Defaults to
 |                  &quot;top&quot; when `orientation` if &quot;v&quot; and  defaults
 |                  to &quot;right&quot; when `orientation` if &quot;h&quot;. Note that
 |                  the title&#39;s location used to be set by the now
 |                  deprecated `titleside` attribute.
 |              text
 |                  Sets the title of the color bar. Note that
 |                  before the existence of `title.text`, the
 |                  title&#39;s contents used to be defined as the
 |                  `title` attribute itself. This behavior has
 |                  been deprecated.
 |      
 |      Returns
 |      -------
 |      plotly.graph_objs.heatmap.colorbar.Title
 |  
 |  titlefont
 |      Deprecated: Please use heatmap.colorbar.title.font instead.
 |      Sets this color bar&#39;s title font. Note that the title&#39;s font
 |      used to be set by the now deprecated `titlefont` attribute.
 |      
 |      The &#39;font&#39; property is an instance of Font
 |      that may be specified as:
 |        - An instance of :class:`plotly.graph_objs.heatmap.colorbar.title.Font`
 |        - A dict of string/value properties that will be passed
 |          to the Font constructor
 |      
 |          Supported dict properties:
 |      
 |              color
 |      
 |              family
 |                  HTML font family - the typeface that will be
 |                  applied by the web browser. The web browser
 |                  will only be able to apply a font if it is
 |                  available on the system which it operates.
 |                  Provide multiple font families, separated by
 |                  commas, to indicate the preference in which to
 |                  apply fonts if they aren&#39;t available on the
 |                  system. The Chart Studio Cloud (at
 |                  https://chart-studio.plotly.com or on-premise)
 |                  generates images on a server, where only a
 |                  select number of fonts are installed and
 |                  supported. These include &quot;Arial&quot;, &quot;Balto&quot;,
 |                  &quot;Courier New&quot;, &quot;Droid Sans&quot;,, &quot;Droid Serif&quot;,
 |                  &quot;Droid Sans Mono&quot;, &quot;Gravitas One&quot;, &quot;Old
 |                  Standard TT&quot;, &quot;Open Sans&quot;, &quot;Overpass&quot;, &quot;PT Sans
 |                  Narrow&quot;, &quot;Raleway&quot;, &quot;Times New Roman&quot;.
 |              size
 |      
 |      Returns
 |      -------
 |  
 |  titleside
 |      Deprecated: Please use heatmap.colorbar.title.side instead.
 |      Determines the location of color bar&#39;s title with respect to
 |      the color bar. Defaults to &quot;top&quot; when `orientation` if &quot;v&quot; and
 |      defaults to &quot;right&quot; when `orientation` if &quot;h&quot;. Note that the
 |      title&#39;s location used to be set by the now deprecated
 |      `titleside` attribute.
 |      
 |      The &#39;side&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;right&#39;, &#39;top&#39;, &#39;bottom&#39;]
 |      
 |      Returns
 |      -------
 |  
 |  x
 |      Sets the x position of the color bar (in plot fraction).
 |      Defaults to 1.02 when `orientation` is &quot;v&quot; and 0.5 when
 |      `orientation` is &quot;h&quot;.
 |      
 |      The &#39;x&#39; property is a number and may be specified as:
 |        - An int or float in the interval [-2, 3]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  xanchor
 |      Sets this color bar&#39;s horizontal position anchor. This anchor
 |      binds the `x` position to the &quot;left&quot;, &quot;center&quot; or &quot;right&quot; of
 |      the color bar. Defaults to &quot;left&quot; when `orientation` is &quot;v&quot; and
 |      &quot;center&quot; when `orientation` is &quot;h&quot;.
 |      
 |      The &#39;xanchor&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;left&#39;, &#39;center&#39;, &#39;right&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  xpad
 |      Sets the amount of padding (in px) along the x direction.
 |      
 |      The &#39;xpad&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  y
 |      Sets the y position of the color bar (in plot fraction).
 |      Defaults to 0.5 when `orientation` is &quot;v&quot; and 1.02 when
 |      `orientation` is &quot;h&quot;.
 |      
 |      The &#39;y&#39; property is a number and may be specified as:
 |        - An int or float in the interval [-2, 3]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  yanchor
 |      Sets this color bar&#39;s vertical position anchor This anchor
 |      binds the `y` position to the &quot;top&quot;, &quot;middle&quot; or &quot;bottom&quot; of
 |      the color bar. Defaults to &quot;middle&quot; when `orientation` is &quot;v&quot;
 |      and &quot;bottom&quot; when `orientation` is &quot;h&quot;.
 |      
 |      The &#39;yanchor&#39; property is an enumeration that may be specified as:
 |        - One of the following enumeration values:
 |              [&#39;top&#39;, &#39;middle&#39;, &#39;bottom&#39;]
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  ypad
 |      Sets the amount of padding (in px) along the y direction.
 |      
 |      The &#39;ypad&#39; property is a number and may be specified as:
 |        - An int or float in the interval [0, inf]
 |      
 |      Returns
 |      -------
 |      int|float
 |  
 |  ----------------------------------------------------------------------
 |  Methods inherited from plotly.basedatatypes.BasePlotlyType:
 |  
 |  __contains__(self, prop)
 |      Determine whether object contains a property or nested property
 |      
 |      Parameters
 |      ----------
 |      prop : str|tuple
 |          If prop is a simple string (e.g. &#39;foo&#39;), then return true of the
 |          object contains an element named &#39;foo&#39;
 |      
 |          If prop is a property path string (e.g. &#39;foo[0].bar&#39;),
 |          then return true if the obejct contains the nested elements for
 |          each entry in the path string (e.g. &#39;bar&#39; in obj[&#39;foo&#39;][0])
 |      
 |          If prop is a property path tuple (e.g. (&#39;foo&#39;, 0, &#39;bar&#39;)),
 |          then return true if the object contains the nested elements for
 |          each entry in the path string (e.g. &#39;bar&#39; in obj[&#39;foo&#39;][0])
 |      
 |      Returns
 |      -------
 |      bool
 |  
 |  __eq__(self, other)
 |      Test for equality
 |      
 |      To be considered equal, `other` must have the same type as this object
 |      and their `to_plotly_json` representaitons must be identical.
 |      
 |      Parameters
 |      ----------
 |      other
 |          The object to compare against
 |      
 |      Returns
 |      -------
 |      bool
 |  
 |  __getitem__(self, prop)
 |      Get item or nested item from object
 |      
 |      Parameters
 |      ----------
 |      prop : str|tuple
 |      
 |          If prop is the name of a property of this object, then the
 |          property is returned.
 |      
 |          If prop is a nested property path string (e.g. &#39;foo[1].bar&#39;),
 |          then a nested property is returned (e.g. obj[&#39;foo&#39;][1][&#39;bar&#39;])
 |      
 |          If prop is a path tuple (e.g. (&#39;foo&#39;, 1, &#39;bar&#39;)), then a nested
 |          property is returned (e.g. obj[&#39;foo&#39;][1][&#39;bar&#39;]).
 |      
 |      Returns
 |      -------
 |      Any
 |  
 |  __iter__(self)
 |      Return an iterator over the object&#39;s properties
 |  
 |  __reduce__(self)
 |      Custom implementation of reduce is used to support deep copying
 |      and pickling
 |  
 |  __repr__(self)
 |      Customize object representation when displayed in the
 |      terminal/notebook
 |  
 |  __setattr__(self, prop, value)
 |      Parameters
 |      ----------
 |      prop : str
 |          The name of a direct child of this object
 |      value
 |          New property value
 |      Returns
 |      -------
 |      None
 |  
 |  __setitem__(self, prop, value)
 |      Parameters
 |      ----------
 |      prop : str
 |          The name of a direct child of this object
 |      
 |          Note: Setting nested properties using property path string or
 |          property path tuples is not supported.
 |      value
 |          New property value
 |      
 |      Returns
 |      -------
 |      None
 |  
 |  on_change(self, callback, *args, **kwargs)
 |      Register callback function to be called when certain properties or
 |      subproperties of this object are modified.
 |      
 |      Callback will be invoked whenever ANY of these properties is
 |      modified. Furthermore, the callback will only be invoked once even
 |      if multiple properties are modified during the same restyle /
 |      relayout / update operation.
 |      
 |      Parameters
 |      ----------
 |      callback : function
 |          Function that accepts 1 + len(`args`) parameters. First parameter
 |          is this object. Second through last parameters are the
 |          property / subpropery values referenced by args.
 |      args : list[str|tuple[int|str]]
 |          List of property references where each reference may be one of:
 |      
 |            1) A property name string (e.g. &#39;foo&#39;) for direct properties
 |            2) A property path string (e.g. &#39;foo[0].bar&#39;) for
 |               subproperties
 |            3) A property path tuple (e.g. (&#39;foo&#39;, 0, &#39;bar&#39;)) for
 |               subproperties
 |      
 |      append : bool
 |          True if callback should be appended to previously registered
 |          callback on the same properties, False if callback should replace
 |          previously registered callbacks on the same properties. Defaults
 |          to False.
 |      
 |      Examples
 |      --------
 |      
 |      Register callback that prints out the range extents of the xaxis and
 |      yaxis whenever either either of them changes.
 |      
 |      &gt;&gt;&gt; import plotly.graph_objects as go
 |      &gt;&gt;&gt; fig = go.Figure(go.Scatter(x=[1, 2], y=[1, 0]))
 |      &gt;&gt;&gt; fig.layout.on_change(
 |      ...   lambda obj, xrange, yrange: print(&quot;%s-%s&quot; % (xrange, yrange)),
 |      ...   (&#39;xaxis&#39;, &#39;range&#39;), (&#39;yaxis&#39;, &#39;range&#39;))
 |      
 |      
 |      Returns
 |      -------
 |      None
 |  
 |  pop(self, key, *args)
 |      Remove the value associated with the specified key and return it
 |      
 |      Parameters
 |      ----------
 |      key: str
 |          Property name
 |      dflt
 |          The default value to return if key was not found in object
 |      
 |      Returns
 |      -------
 |      value
 |          The removed value that was previously associated with key
 |      
 |      Raises
 |      ------
 |      KeyError
 |          If key is not in object and no dflt argument specified
 |  
 |  to_plotly_json(self)
 |      Return plotly JSON representation of object as a Python dict
 |      
 |      Returns
 |      -------
 |      dict
 |  
 |  update(self, dict1=None, overwrite=False, **kwargs)
 |      Update the properties of an object with a dict and/or with
 |      keyword arguments.
 |      
 |      This recursively updates the structure of the original
 |      object with the values in the input dict / keyword arguments.
 |      
 |      Parameters
 |      ----------
 |      dict1 : dict
 |          Dictionary of properties to be updated
 |      overwrite: bool
 |          If True, overwrite existing properties. If False, apply updates
 |          to existing properties recursively, preserving existing
 |          properties that are not specified in the update operation.
 |      kwargs :
 |          Keyword/value pair of properties to be updated
 |      
 |      Returns
 |      -------
 |      BasePlotlyType
 |          Updated plotly object
 |  
 |  ----------------------------------------------------------------------
 |  Readonly properties inherited from plotly.basedatatypes.BasePlotlyType:
 |  
 |  figure
 |      Reference to the top-level Figure or FigureWidget that this object
 |      belongs to. None if the object does not belong to a Figure
 |      
 |      Returns
 |      -------
 |      Union[BaseFigure, None]
 |  
 |  parent
 |      Return the object&#39;s parent, or None if the object has no parent
 |      Returns
 |      -------
 |      BasePlotlyType|BaseFigure
 |  
 |  plotly_name
 |      The plotly name of the object
 |      
 |      Returns
 |      -------
 |      str
 |  
 |  ----------------------------------------------------------------------
 |  Data descriptors inherited from plotly.basedatatypes.BasePlotlyType:
 |  
 |  __dict__
 |      dictionary for instance variables (if defined)
 |  
 |  __weakref__
 |      list of weak references to the object (if defined)
 |  
 |  ----------------------------------------------------------------------
 |  Data and other attributes inherited from plotly.basedatatypes.BasePlotlyType:
 |  
 |  __hash__ = None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_colorbar</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">color_scale</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)]])</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
                <span class="n">z</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
                <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
                <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">zmin</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">zmax</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">titleside</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                          <span class="n">ticks</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span> <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                          <span class="n">ticktext</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">],</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="p">),</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
                <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="c1"># ensure there are enough points to cover the whole image</span>
                <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Picnic_r&quot;</span><span class="p">,</span>  <span class="c1"># any colorscale that has white at 0</span>
                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">zmid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="c1"># 75 seems to work empirically, you may have to adjust the width</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># zeroing the margins gives a tighter figure, and is also important to make the other numbers work out</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>                            <div id="e32db09b-f9ae-486a-a1ef-7950cce34370" class="plotly-graph-div" style="height:525px; width:75px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("e32db09b-f9ae-486a-a1ef-7950cce34370")) {                    Plotly.newPlot(                        "e32db09b-f9ae-486a-a1ef-7950cce34370",                        [{"colorbar":{"ticks":"outside","ticktext":["Low","Medium","High"],"tickvals":[0,0.5,1],"title":{"side":"right","text":"title"},"x":0},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"showscale":true,"z":[[0,1]],"zmax":1,"zmin":0,"type":"heatmap"},{"colorscale":[[0.0,"rgb(255,0,0)"],[0.1,"rgb(255,102,102)"],[0.2,"rgb(255,102,204)"],[0.3,"rgb(255,153,255)"],[0.4,"rgb(255,204,255)"],[0.5,"rgb(255,255,255)"],[0.6,"rgb(204,204,255)"],[0.7,"rgb(153,204,255)"],[0.8,"rgb(102,204,255)"],[0.9,"rgb(51,153,255)"],[1.0,"rgb(0,0,255)"]],"showscale":false,"z":[[0,0]],"zmid":0,"type":"heatmap"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"showgrid":false,"zeroline":false,"visible":false},"yaxis":{"showgrid":false,"zeroline":false,"visible":false},"margin":{"l":0,"r":0,"b":0,"t":0},"width":75},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('e32db09b-f9ae-486a-a1ef-7950cce34370');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper function to create a Plotly colorbar figure</span>
<span class="k">def</span> <span class="nf">create_colorbar</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">color_scale</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)]])</span>
    <span class="c1"># color_scale = &#39;viridis&#39;    </span>
    <span class="n">trace</span> <span class="o">=</span> <span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
        <span class="n">z</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="c1"># [[v] for v in sorted(values)],</span>
        <span class="n">colorscale</span><span class="o">=</span><span class="n">color_scale</span><span class="p">,</span>
        <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">zmin</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="n">zmax</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">titleside</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                      <span class="n">ticks</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span> <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="n">ticktext</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Low&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;High&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="p">),</span>
             <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="c1"># ensure there are enough points to cover the whole image</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Picnic_r&quot;</span><span class="p">,</span>  <span class="c1"># any colorscale that has white at 0</span>
            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">zmid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">),</span>
            <span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">trace</span><span class="p">)</span> <span class="c1"># , layout=layout)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="c1"># 75 seems to work empirically, you may have to adjust the width</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># zeroing the margins gives a tighter figure, and is also important to make the other numbers work out</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="c1"># , showscale=True, zmin=values.min(), zmax=values.max())    </span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">create_colorbar</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;group&#39;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>                            <div id="132bbd28-cdb3-423f-a4cf-7aeef945a340" class="plotly-graph-div" style="height:525px; width:315px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("132bbd28-cdb3-423f-a4cf-7aeef945a340")) {                    Plotly.newPlot(                        "132bbd28-cdb3-423f-a4cf-7aeef945a340",                        [{"colorbar":{"ticks":"outside","ticktext":["Low","Medium","High"],"tickvals":[0,0.5,1],"title":{"side":"right","text":"group"},"x":0},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"showscale":true,"z":[[0,1]],"zmax":1,"zmin":0,"type":"heatmap","hoverinfo":"none"},{"colorscale":[[0.0,"rgb(255,0,0)"],[0.1,"rgb(255,102,102)"],[0.2,"rgb(255,102,204)"],[0.3,"rgb(255,153,255)"],[0.4,"rgb(255,204,255)"],[0.5,"rgb(255,255,255)"],[0.6,"rgb(204,204,255)"],[0.7,"rgb(153,204,255)"],[0.8,"rgb(102,204,255)"],[0.9,"rgb(51,153,255)"],[1.0,"rgb(0,0,255)"]],"showscale":false,"z":[[0,0]],"zmid":0,"type":"heatmap","hoverinfo":"none"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"showgrid":false,"zeroline":false,"visible":false},"yaxis":{"showgrid":false,"zeroline":false,"visible":false},"margin":{"l":0,"r":0,"b":0,"t":0},"width":315},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('132bbd28-cdb3-423f-a4cf-7aeef945a340');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Helper function to create a Plotly colorbar figure</span>
<span class="c1"># def create_colorbar(values, title):</span>
<span class="c1">#     print(np.zeros_like([[v] for v in sorted(values)]))</span>
<span class="c1">#     color_scale = &#39;Viridis&#39;</span>
<span class="c1">#     trace = go.Heatmap(</span>
<span class="c1">#         z=[[v] for v in sorted(values)],</span>
<span class="c1">#         colorscale=color_scale,</span>
<span class="c1">#         showscale=True,</span>
<span class="c1">#         colorbar=dict(title=title, titleside=&#39;right&#39;,</span>
<span class="c1">#                      ticks=&#39;outside&#39;, tickvals=[0, 0.5, 1],</span>
<span class="c1">#                      ticktext=[&#39;Low&#39;, &#39;Medium&#39;, &#39;High&#39;])</span>
<span class="c1">#     )</span>
<span class="c1">#     layout = go.Layout(</span>
<span class="c1">#         autosize=False,</span>
<span class="c1">#         height=300,</span>
<span class="c1">#         margin=dict(l=0, r=200, t=0, b=0)</span>
<span class="c1">#     )</span>
<span class="c1">#     fig = go.Figure(data=[trace, go.Heatmap(</span>
<span class="c1">#             z=np.zeros_like([v for v in sorted(values)]), # ensure there are enough points to cover the whole image</span>
<span class="c1">#             colorscale=&quot;Picnic_r&quot;,  # any colorscale that has white at 0</span>
<span class="c1">#             showscale=False,</span>
<span class="c1">#             zmid=0,</span>
<span class="c1">#         )], layout=layout)</span>
<span class="c1">#     fig.update_yaxes(visible=False)</span>
<span class="c1">#     fig.update_xaxes(visible=False)</span>
<span class="c1">#     fig.update_traces(hoverinfo=&#39;none&#39;, showscale=True, zmin=0, zmax=10.)</span>
<span class="c1">#     fig.update_layout(width=115,</span>
<span class="c1">#                      xaxis_showgrid=False,</span>
<span class="c1">#     # yaxis_showgrid=False,</span>
<span class="c1">#     # xaxis_zeroline=False,</span>
<span class="c1">#     # yaxis_zeroline=False,</span>
<span class="c1">#     # xaxis_visible=False,</span>
<span class="c1">#     # yaxis_visible=False,</span>
<span class="c1">#                      )</span>
<span class="c1">#     return fig</span>


<span class="c1"># coloraxis_showscale=True, </span>
<span class="c1">#             coloraxis_colorbar=dict(</span>
<span class="c1">#                 title=&#39;Score&#39;, </span>
<span class="c1">#                 ticks=&quot;outside&quot;,</span>
<span class="c1">#                 tickvals=[0, 0.5, 1],</span>
<span class="c1">#                 ticktext=[&#39;Low&#39;, &#39;Medium&#39;, &#39;High&#39;]</span>
<span class="c1">#             ),</span>
<span class="c1">#             margin=dict(t=20, b=20, l=80, r=20),</span>
<span class="c1">#         ).update_xaxes(visible=False).update_yaxes(visible=False).update_traces(hoverinfo=&#39;none&#39;, showscale=True, zmin=0, zmax=1),</span>
<span class="c1">#         config={&#39;displayModeBar&#39;: False}  # Hides the Plotly mode bar</span>
<span class="c1">#     )</span>
<span class="c1">#     return node_color_map, colorbar_figure_html</span>

<span class="c1"># # Generate the color bar with Matplotlib</span>
<span class="c1"># # def create_colorbar_fig(colormap, label):</span>
<span class="c1"># #     fig, ax = plt.subplots(figsize=(6, 1))</span>
<span class="c1"># #     fig.subplots_adjust(bottom=0.5)</span>

<span class="c1"># #     norm = mcolors.Normalize(vmin=0, vmax=100)</span>
<span class="c1"># #     fig.colorbar(mcolors.ScalarMappable(norm=norm, </span>
<span class="c1"># #                                         # cmap=colormap,</span>
<span class="c1"># #                                         cmap=plt.cm.viridis,</span>
<span class="c1"># #                                        ), </span>
<span class="c1"># #                  cax=ax, orientation=&#39;horizontal&#39;, label=label)</span>
        
    
<span class="c1"># #     plotly_fig = tls.mpl_to_plotly(fig)</span>
<span class="c1"># #     plotly_fig.update_layout(</span>
<span class="c1"># #         autosize=False,</span>
<span class="c1"># #         margin=dict(l=0, r=0, t=0, b=0)</span>
<span class="c1"># #     )</span>

<span class="c1"># #     cbar_graph = dcc.Graph(figure=plotly_fig, style={&#39;width&#39;: &#39;300px&#39;, &#39;height&#39;: &#39;50px&#39;})</span>
    
<span class="c1"># #     return cbar_graph</span>
<span class="c1">###########</span>

<span class="c1">#     colorbar_figure_html = dcc.Graph(</span>
<span class="c1">#         # id=&#39;node_colorbar_fig&#39;,</span>
<span class="c1">#         figure=px.imshow([[0, 1]], color_continuous_scale=color_scale, </span>
<span class="c1">#                          aspect=&#39;auto&#39;).update_layout(</span>
<span class="c1">#             coloraxis_showscale=True, </span>
<span class="c1">#             coloraxis_colorbar=dict(</span>
<span class="c1">#                 title=&#39;Score&#39;, </span>
<span class="c1">#                 ticks=&quot;outside&quot;,</span>
<span class="c1">#                 tickvals=[0, 0.5, 1],</span>
<span class="c1">#                 ticktext=[&#39;Low&#39;, &#39;Medium&#39;, &#39;High&#39;]</span>
<span class="c1">#             ),</span>
<span class="c1">#             margin=dict(t=20, b=20, l=80, r=20),</span>
<span class="c1">#         ).update_xaxes(visible=False).update_yaxes(visible=False).update_traces(hoverinfo=&#39;none&#39;, showscale=True, zmin=0, zmax=1),</span>
<span class="c1">#         config={&#39;displayModeBar&#39;: False}  # Hides the Plotly mode bar</span>
<span class="c1">#     )</span>
    
    
<span class="c1">################################</span>
<span class="c1">#     #     colorbar_fig = go.Figure() # layout=dict(plot_bgcolor=&#39;white&#39;)</span>
<span class="c1">#     #     colorbar_fig.add_trace(go.Scatter(</span>
<span class="c1">#     #         x=[None],</span>
<span class="c1">#     #         y=[None],</span>
<span class="c1">#     #         mode=&#39;markers&#39;,</span>
<span class="c1">#     #         marker=dict(        </span>
<span class="c1">#     #             size=0,</span>
<span class="c1">#     #             colorscale=&#39;viridis&#39;,</span>
<span class="c1">#     #             cmin=min(node_colors), # 0,</span>
<span class="c1">#     #             cmax=max(node_colors), # 100,</span>
<span class="c1">#     #             colorbar=dict(</span>
<span class="c1">#     #             title=f&quot;nodes: {label}&quot; ,</span>
<span class="c1">#     #             thickness=15,</span>
<span class="c1">#     #             len=0.5,</span>
<span class="c1">#     #             x=0.3, # 0.5,</span>
<span class="c1">#     #             y=0.5, # 0.5,</span>
<span class="c1">#     #             xanchor=&#39;left&#39;,</span>
<span class="c1">#     #             # xanchor=&#39;center&#39;,</span>
<span class="c1">#     #             # yanchor=&#39;top&#39;,</span>
<span class="c1">#     #             # orientation=&#39;h&#39;,</span>
<span class="c1">#     #             ),</span>
<span class="c1">#     #         ),</span>
<span class="c1">#     #         showlegend=False,</span>
<span class="c1">#     #         hoverinfo=&#39;none&#39;</span>
<span class="c1">#     #     ))</span>

<span class="c1">#     #     colorbar_fig.update_layout(</span>
<span class="c1">#     #         margin=dict(l=0, r=0, t=0, b=0),</span>
<span class="c1">#     #         # height=100,</span>
<span class="c1">#     #         # width=300,</span>
<span class="c1">#     #         height=110, # 40, # 80, # 40, # 200, # 110,</span>
<span class="c1">#     #         width=60,# 200, # 120, # 60,</span>
<span class="c1">#     #         xaxis=dict(showticklabels=False, showgrid=False, zeroline=False),</span>
<span class="c1">#     #         yaxis=dict(showticklabels=False, showgrid=False, zeroline=False)</span>
<span class="c1">#     #     )</span>

<span class="c1">#     #     colorbar_figure_html = dcc.Graph(figure=colorbar_fig, config={&#39;displayModeBar&#39;: False})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">z</span><span class="o">=</span><span class="n">a</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>
            <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">zmin</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="n">zmax</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
            <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="c1"># ensure there are enough points to cover the whole image</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Picnic_r&quot;</span><span class="p">,</span>  <span class="c1"># any colorscale that has white at 0</span>
            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">zmid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="c1"># 75 seems to work empirically, you may have to adjust the width</span>
    <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># zeroing the margins gives a tighter figure, and is also important to make the other numbers work out</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>                            <div id="8982c596-2fc9-4d32-a927-6036ad76fa5f" class="plotly-graph-div" style="height:525px; width:75px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("8982c596-2fc9-4d32-a927-6036ad76fa5f")) {                    Plotly.newPlot(                        "8982c596-2fc9-4d32-a927-6036ad76fa5f",                        [{"colorbar":{"x":0},"colorscale":[[0.0,"rgb(247,251,255)"],[0.125,"rgb(222,235,247)"],[0.25,"rgb(198,219,239)"],[0.375,"rgb(158,202,225)"],[0.5,"rgb(107,174,214)"],[0.625,"rgb(66,146,198)"],[0.75,"rgb(33,113,181)"],[0.875,"rgb(8,81,156)"],[1.0,"rgb(8,48,107)"]],"showscale":true,"z":[[0,1]],"zmax":1,"zmin":0,"type":"heatmap"},{"colorscale":[[0.0,"rgb(255,0,0)"],[0.1,"rgb(255,102,102)"],[0.2,"rgb(255,102,204)"],[0.3,"rgb(255,153,255)"],[0.4,"rgb(255,204,255)"],[0.5,"rgb(255,255,255)"],[0.6,"rgb(204,204,255)"],[0.7,"rgb(153,204,255)"],[0.8,"rgb(102,204,255)"],[0.9,"rgb(51,153,255)"],[1.0,"rgb(0,0,255)"]],"showscale":false,"z":[[0,0]],"zmid":0,"type":"heatmap"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"showgrid":false,"zeroline":false,"visible":false},"yaxis":{"showgrid":false,"zeroline":false,"visible":false},"margin":{"l":0,"r":0,"b":0,"t":0},"width":75},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('8982c596-2fc9-4d32-a927-6036ad76fa5f');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">create_colorbar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="s1">&#39;group&#39;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>                            <div id="dbee8e73-fc44-4676-9d4a-1bb4ab2f6d79" class="plotly-graph-div" style="height:525px; width:75px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("dbee8e73-fc44-4676-9d4a-1bb4ab2f6d79")) {                    Plotly.newPlot(                        "dbee8e73-fc44-4676-9d4a-1bb4ab2f6d79",                        [{"colorbar":{"ticks":"outside","ticktext":["Low","Medium","High"],"tickvals":[0,0.5,1],"title":{"side":"right","text":"group"},"x":0},"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"showscale":true,"z":[[0,1]],"zmax":1,"zmin":0,"type":"heatmap"},{"colorscale":[[0.0,"rgb(255,0,0)"],[0.1,"rgb(255,102,102)"],[0.2,"rgb(255,102,204)"],[0.3,"rgb(255,153,255)"],[0.4,"rgb(255,204,255)"],[0.5,"rgb(255,255,255)"],[0.6,"rgb(204,204,255)"],[0.7,"rgb(153,204,255)"],[0.8,"rgb(102,204,255)"],[0.9,"rgb(51,153,255)"],[1.0,"rgb(0,0,255)"]],"showscale":false,"z":[0,0],"zmid":0,"type":"heatmap"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"showgrid":false,"zeroline":false,"visible":false},"yaxis":{"showgrid":false,"zeroline":false,"visible":false},"margin":{"l":0,"r":0,"b":0,"t":0},"width":75},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('dbee8e73-fc44-4676-9d4a-1bb4ab2f6d79');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Heatmap({
     &#39;colorbar&#39;: {&#39;ticks&#39;: &#39;outside&#39;,
                  &#39;ticktext&#39;: [Low, Medium, High],
                  &#39;tickvals&#39;: [0, 0.5, 1],
                  &#39;title&#39;: {&#39;side&#39;: &#39;right&#39;, &#39;text&#39;: &#39;group&#39;}},
     &#39;colorscale&#39;: [[0.0, &#39;#440154&#39;], [0.1111111111111111, &#39;#482878&#39;],
                    [0.2222222222222222, &#39;#3e4989&#39;], [0.3333333333333333,
                    &#39;#31688e&#39;], [0.4444444444444444, &#39;#26828e&#39;],
                    [0.5555555555555556, &#39;#1f9e89&#39;], [0.6666666666666666,
                    &#39;#35b779&#39;], [0.7777777777777778, &#39;#6ece58&#39;],
                    [0.8888888888888888, &#39;#b5de2b&#39;], [1.0, &#39;#fde725&#39;]],
     &#39;hoverinfo&#39;: &#39;none&#39;,
     &#39;showscale&#39;: True,
     &#39;z&#39;: [[0], [0.1], [0.4], [0.6], [1], [1.3]],
     &#39;zmax&#39;: 10.0,
     &#39;zmin&#39;: 0
 }),)
</pre></div>
</div>
</div>
</div>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../building/index.html">Installation</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../overview/index.html">User guide</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../index.html">Tutorials</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../index.html#primary-netflow-analysis-workflow">Primary netflow analysis workflow</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../reference/index.html">API reference</a></li>
<li class="toctree-l1 toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="../../references.html">References</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/tutorial/notebooks/poser_tutorial_BC_rna_interactive_test.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023-2025, The netflow community.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>